<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Debezium connector for Vitess :: Debezium Documentation</title>
    <link rel="canonical" href="https://debezium.io/documentation/reference/stable/connectors/vitess.html">
    <meta name="generator" content="Antora 3.1.7">
<link rel="stylesheet" href="../../debezium-antora/css/site.css">
<link rel="stylesheet" href="../../debezium-antora/css/debezium-antora.css">
<link rel="stylesheet" href="../../debezium-antora/css/highlightjs-dark.css">
<link rel="stylesheet" href="https://static.jboss.org/css/rhbar.css">
<script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.js"></script>
<script src="../../debezium-antora/js/jquery.ba-floatingscrollbar.js"></script>
</head>
<body class="article">
<header class="header">
  <div id="rhbar">
      <a class="jbdevlogo" href="https://developers.redhat.com"></a>
      <a class="rhlogo" href="https://www.redhat.com"></a>
  </div>
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
          <img src="/assets/images/color_white_debezium_type_600px.svg" style="height: 32px; margin-right: 14px;"/>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="/documentation/faq">FAQ</a>
        <a class="navbar-item" href="/documentation">DOCUMENTATION</a>
        <a class="navbar-item" href="/releases">RELEASES</a>
        <a class="navbar-item" href="/community">COMMUNITY</a>
        <a class="navbar-item" href="/blog">BLOG</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="reference" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Debezium nightly Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tutorial.html">Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../install.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../postgres-plugins.html">PostgreSQL Decoding Plugins</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../features.html">Features</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/avro.html">Avro Serialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/topic-auto-create-config.html">Customizing Topic Auto-Creation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/signalling.html">Sending Signals to Debezium</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/notification.html">Receive notifications from Debezium</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Source Connectors</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="mysql.html">MySQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="mariadb.html">MariaDB</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="mongodb.html">MongoDB</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="postgresql.html">PostgreSQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="oracle.html">Oracle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="sqlserver.html">SQL Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="db2.html">Db2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cassandra.html">Cassandra</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="vitess.html">Vitess</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spanner.html">Spanner</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="informix.html">Informix</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Sink Connectors</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index-sink.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="jdbc.html">JDBC</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Transformations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/topic-routing.html">Topic Routing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/event-flattening.html">New Record State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/mongodb-event-flattening.html">MongoDB New Document State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/event-changes.html">Event Changes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/outbox-event-router.html">Outbox Event Router</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/mongodb-outbox-event-router.html">MongoDB Outbox Event Router</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/filtering.html">Message Filtering</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/schema-change-event-filter.html">Schema Change Event Filtering</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/content-based-routing.html">Content-Based Routing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/applying-transformations-selectively.html">Using SMT Predicates to Selectively Apply Transformations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/partition-routing.html">Partition Routing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/header-to-value.html">HeaderToValue</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/timezone-converter.html">Timezone Converter</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/timescaledb.html">TimescaleDB Integration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/decode-logical-decoding-message-content.html">Decode Logical Decoding Message Content</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/convert-cloudevent-to-saveable-form.html">Convert CloudEvents to Saveable Form</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Post Processors</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../post-processors/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../post-processors/reselect-columns.html">Reselect Columns</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">API and SPI</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/engine.html">Debezium Engine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/converters.html">Custom Converters</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Integrations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/serdes.html">Change Event SerDes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/outbox.html">Outbox Quarkus Extension</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/cloudevents.html">CloudEvents</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/tracing.html">OpenTelemetry</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/testcontainers.html">Integration Testing with Testcontainers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Operations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/debezium-server.html">Debezium Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/monitoring.html">Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/kubernetes.html">Running on Kubernetes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/openshift.html">Running on Openshift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/debezium-ui.html">Debezium UI</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Debezium Documentation</span>
    <span class="version">nightly</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Debezium Documentation</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="/documentation/reference/nightly/index.html">nightly</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/3.0/index.html">3.0</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/2.7/index.html">2.7</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/2.6/index.html">2.6</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/2.5/index.html">2.5</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/2.4/index.html">2.4</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/2.3/index.html">2.3</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/2.2/index.html">2.2</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/2.1/index.html">2.1</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/2.0/index.html">2.0</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/1.9/index.html">1.9</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main" class="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../stable/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Debezium Documentation</a></li>
    <li>Source Connectors</li>
    <li><a href="vitess.html">Vitess</a></li>
  </ul>
</nav>
    <div class="page-versions-container">
    Version:
    <div class="page-versions">
        <button class="version-menu-toggle versions-menu-current" title="Show other versions of page">nightly</button>
        <div class="version-menu">
                <a class="version is-current" href="/documentation/reference/nightly/index.html">nightly</a>
                <a class="version" href="/documentation/reference/3.0/index.html">3.0</a>
                <a class="version" href="/documentation/reference/2.7/index.html">2.7</a>
                <a class="version" href="/documentation/reference/2.6/index.html">2.6</a>
                <a class="version" href="/documentation/reference/2.5/index.html">2.5</a>
                <a class="version" href="/documentation/reference/2.4/index.html">2.4</a>
                <a class="version" href="/documentation/reference/2.3/index.html">2.3</a>
                <a class="version" href="/documentation/reference/2.2/index.html">2.2</a>
                <a class="version" href="/documentation/reference/2.1/index.html">2.1</a>
                <a class="version" href="/documentation/reference/2.0/index.html">2.0</a>
                <a class="version" href="/documentation/reference/1.9/index.html">1.9</a>
        </div>
        |
    </div>
    </div>
  <div class="edit-this-page"><a href="https://github.com/debezium/debezium/edit/main/documentation/modules/ROOT/pages/connectors/vitess.adoc">Edit this Page</a></div>
  </div>
<div class="article-grid">
<div class="article-cell1">
<article class="doc">
        
    <div class="version-banner version-banner-development">
    You are viewing documentation for an unreleased version of Debezium.
    <br/>
            If you want to view the latest stable version of this page, please go <a href=/documentation/reference/stable/index.html>here</a>.
            
</div>            <h1 class="page">Debezium connector for Vitess</h1>
        <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#vitess-overview">Overview</a></li>
<li><a href="#how-the-vitess-connector-works">How the connector works</a>
<ul class="sectlevel2">
<li><a href="#vitess-snapshot">Snapshot</a></li>
<li><a href="#vitess-streaming-changes">Streaming changes</a></li>
<li><a href="#vitess-topic-names">Topics names</a></li>
<li><a href="#vitess-transaction-metadata">Transaction metadata</a></li>
<li><a href="#vitess-ordered-transaction-metadata">Ordered Transaction Metadata</a></li>
<li><a href="#vitess-efficient-transaction-metadata">Efficient Transaction Metadata</a></li>
</ul>
</li>
<li><a href="#vitess-events">Data change events</a>
<ul class="sectlevel2">
<li><a href="#vitess-change-events-key">Change event keys</a></li>
<li><a href="#vitess-change-events-value">Change event values</a></li>
<li><a href="#vitess-create-events"><em>create</em> events</a></li>
<li><a href="#vitess-update-events"><em>update</em> events</a></li>
<li><a href="#vitess-primary-key-updates">Primary key updates</a></li>
<li><a href="#vitess-delete-events"><em>delete</em> events</a></li>
</ul>
</li>
<li><a href="#vitess-data-types">Data type mappings</a>
<ul class="sectlevel2">
<li><a href="#vitess-basic-types">Basic types</a></li>
<li><a href="#vitess-temporal-types">Temporal types</a></li>
</ul>
</li>
<li><a href="#setting-up-vitess">Seting up Vitess</a>
<ul class="sectlevel2">
<li><a href="#grpc-authentication">gRPC authentication</a></li>
</ul>
</li>
<li><a href="#vitess-deploying-a-connector">Deployment</a>
<ul class="sectlevel2">
<li><a href="#vitess-example-configuration">Connector configuration example</a></li>
<li><a href="#vitess-example-configuration-offset-storage-per-task">Connector configuration example for offset-storage-per-task mode</a></li>
<li><a href="#vitess-adding-connector-configuration">Adding connector configuration</a></li>
<li><a href="#vitess-monitoring">Monitoring</a></li>
<li><a href="#_customized_mbean_names">Customized MBean names</a></li>
<li><a href="#vitess-connector-properties">Connector configuration properties</a></li>
</ul>
</li>
<li><a href="#vitess-when-things-go-wrong">Behavior when things go wrong</a>
<ul class="sectlevel2">
<li><a href="#vitess-connector-configuration-and-startup-errors">Configuration and startup errors</a></li>
<li><a href="#vitess-becomes-unavailable">Vitess becomes unavailable</a></li>
<li><a href="#invalid-column-name-error">Invalid column name error</a></li>
<li><a href="#vitess-kafka-connect-process-stops-gracefully">Kafka Connect process stops gracefully</a></li>
<li><a href="#vitess-kafka-connect-process-crashes">Kafka Connect process crashes</a></li>
<li><a href="#vitess-kafka-becomes-unavailable">Kafka becomes unavailable</a></li>
<li><a href="#vitess-connector-is-stopped-for-a-duration">Connector is stopped for a duration</a></li>
<li><a href="#vitess-connector-failed-before-finishing-the-snapshot">Connector fails before finishing the snapshot</a></li>
<li><a href="#limitations-with-earlier-vitess-versions">Limitations with earlier Vitess versions</a></li>
</ul>
</li>
</ul>
</div>
<div class="paragraph">
<p>Debezium&#8217;s Vitess connector captures row-level changes in the shards of a Vitess <a href="https://vitess.io/docs/concepts/keyspace/">keyspace</a>.
For information about the Vitess versions that are compatible with this connector, see the <a href="https://debezium.io/releases/">Debezium release overview</a>.</p>
</div>
<div class="paragraph">
<p>When the connector first connects to a Vitess cluster, it takes a consistent snapshot of the keyspace.
After that snapshot is complete, the connector continuously captures row-level changes that are committed to a Vitess keyspace to insert, update, or delete database content.
The connector generates data change event records and streams them to Kafka topics.
For each table, the default behavior is that the connector streams all generated events to a separate Kafka topic for that table.
Applications and services can then consume data change event records from the resulting topic.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vitess-overview"><a class="anchor" href="#vitess-overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vitess&#8217;s <a href="https://vitess.io/docs/concepts/vstream/">VStream</a> feature was introduced in version 4.0. It is a change event subscription service that provides equivalent information to the MySQL binary logs from the underlying MySQL shards of the Vitess cluster. An user can subscribe to multiple shards in a keyspace, making it a convenient tool to feed downstream CDC processes.</p>
</div>
<div class="paragraph">
<p>To read and process database changes, the Vitess connector subscribes to <a href="https://vitess.io/docs/concepts/vtgate/">VTGate</a>'s VStream gRPC service. VTGate is a lightweight, stateless gRPC server, which is part of the Vitess cluster setup.</p>
</div>
<div class="paragraph">
<p>The connector gives you the flexibility to choose to subscribe to the <code>MASTER</code> nodes, or to the <code>REPLICA</code> nodes for change events.</p>
</div>
<div class="paragraph">
<p>The connector produces a change event for every row-level insert, update, and delete operation that was captured and sends change event records for each table in a separate Kafka topic. Client applications read the Kafka topics that correspond to the database tables of interest, and can react to every row-level event they receive from those topics.</p>
</div>
<div class="paragraph">
<p>The underlying MySQL implementation in Vitess purges binary logs based on some configurable period of time.
Because the contents of the binlog might not be complete, the connector requires another mechanism to ensure that it captures the complete content of a particular database.
Thus, when the connector connects to a database for the first time, it performs a consistent snapshot of the database.
After the connector completes the snapshot, it continues streaming changes from the exact point at which the snapshot was made.
In this way, the connector starts with a consistent view of all of the data, and does not omit any changes that were made while the snapshot was being taken.</p>
</div>
<div class="paragraph">
<p>The connector is tolerant of failures.
As the connector reads changes and produces events, it records the Vitess global transaction ID (VGTID) position for each event.
If the connector stops for any reason (including communication failures, network problems, or crashes), after the connector restarts, it continues reading from VStream from the last change event entry that it stored.
This behavior does not apply to snapshots. If the connector stops during a snapshot, after a restart, the connector does not continue performing snapshots where it last left off.
We&#8217;ll talk later about how the connector behaves <a href="#vitess-when-things-go-wrong">when things go wrong</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-the-vitess-connector-works"><a class="anchor" href="#how-the-vitess-connector-works"></a>How the connector works</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To optimally configure and run a Debezium Vitess connector, it is helpful to understand how the connector performs snapshots, streams change events, determines Kafka topic names, and uses metadata.</p>
</div>
<div class="sect2">
<h3 id="vitess-snapshot"><a class="anchor" href="#vitess-snapshot"></a>Snapshot</h3>
<div class="paragraph">
<p>Typically, a MySQL server is not configured to retain the complete history of the database in the binary logs.
As a result, the connector is unable to read the entire history of the database from the binary logs.
For this reason, the first time that the connector starts, it performs an initial consistent snapshot of the database.
You can change this behavior by setting the <a href="#vitess-property-snapshot-mode"><code>snapshot.mode</code> connector configuration property</a> to a value other than <code>initial</code>.
This snapshot feature is built on <a href="https://vitess.io/docs/design-docs/vreplication/vstream/vscopy/">VStream Copy</a> introduced in version 7.0.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Automatic retry of a failed snapshot is expected to be available in a future release.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="vitess-streaming-changes"><a class="anchor" href="#vitess-streaming-changes"></a>Streaming changes</h3>
<div class="paragraph">
<p>The Vitess connector spends all its time streaming changes from the VTGate&#8217;s VStream gRPC service to which it is subscribed. The client receives changes from VStream as they are committed in the underlying MySQL server&#8217;s binlog at certain positions, which are referred to as VGTID.</p>
</div>
<div class="paragraph">
<p>The VGTID in Vitess is the equivalent of GTID in MySQL, it describes the position in the VStream in which a change event happens. Typically, A VGTID has multiple shard GTIDs, each shard GTID is a tuple of <code>(Keyspace, Shard, GTID)</code>, which describes the GTID position of a given shard.</p>
</div>
<div class="paragraph">
<p>When subscribing to a VStream service, the connector needs to provide a VGTID and a <a href="https://vitess.io/docs/concepts/tablet/#tablet-types">Tablet Type</a> (e.g. <code>MASTER</code>, <code>REPLICA</code>). The VGTID describes the position from which VStream should starts sending change events; the Tablet type describes which underlying MySQL instance (master or replica) in each shard do we read change events from.</p>
</div>
<div class="paragraph">
<p>The first time the connector connects to a Vitess cluster, it gets the current VGTID from a Vitess component called <a href="https://vitess.io/docs/concepts/vtctld/">VTCtld</a> and provides the current VGTID to VStream.</p>
</div>
<div class="paragraph">
<p>The Debezium Vitess connector acts as a gRPC client of VStream. When the connector receives changes it transforms the events into Debezium <em>create</em>, <em>update</em>, or <em>delete</em> events that include the VGTID of the event. The Vitess connector forwards these change events in records to the Kafka Connect framework, which is running in the same process. The Kafka Connect process asynchronously writes the change event records in the same order in which they were generated to the appropriate Kafka topic.</p>
</div>
<div class="paragraph">
<p>Periodically, Kafka Connect records the most recent <em>offset</em> in another Kafka topic. The offset indicates source-specific position information that Debezium includes with each event. For the Vitess connector, the VGTID recorded in each change event is the offset.</p>
</div>
<div class="paragraph">
<p>When Kafka Connect gracefully shuts down, it stops the connectors, flushes all event records to Kafka, and records the last offset received from each connector. When Kafka Connect restarts, it reads the last recorded offset for each connector, and starts each connector at its last recorded offset. When the connector restarts, it sends a request to VStream to send the events starting just after that position.</p>
</div>
</div>
<div class="sect2">
<h3 id="vitess-topic-names"><a class="anchor" href="#vitess-topic-names"></a>Topics names</h3>
<div class="paragraph">
<p>The Vitess connector writes events for all insert, update, and delete operations on a single table to a single Kafka topic. By default, the Kafka topic name is <em>topicPrefix</em>.<em>keyspaceName</em>.<em>tableName</em> where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>topicPrefix</em> is the topic prefix as specified by the <code>topic.prefix</code> connector configuration property.</p>
</li>
<li>
<p><em>keyspaceName</em> is the name of the keyspace (a.k.a. database) where the operation occurred.</p>
</li>
<li>
<p><em>tableName</em> is the name of the database table in which the operation occurred.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, suppose that <code>fulfillment</code> is the logical server name in the configuration for a connector that is capturing changes in a Vitess installation that has an <code>commerce</code> keyspace that contains four tables: <code>products</code>, <code>products_on_hand</code>, <code>customers</code>, and <code>orders</code>. Regardless of how many shards the keyspace has, the connector would stream records to these four Kafka topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fulfillment.commerce.products</code></p>
</li>
<li>
<p><code>fulfillment.commerce.products_on_hand</code></p>
</li>
<li>
<p><code>fulfillment.commerce.customers</code></p>
</li>
<li>
<p><code>fulfillment.commerce.orders</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="vitess-transaction-metadata"><a class="anchor" href="#vitess-transaction-metadata"></a>Transaction metadata</h3>
<div class="paragraph">
<p>Debezium can generate events that represent transaction boundaries and that enrich data change event messages.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Limits on when Debezium receives transaction metadata</div>
<div class="paragraph">
<p>Debezium registers and receives metadata only for transactions that occur after you deploy the connector.
Metadata for transactions that occur before you deploy the connector is not available.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Debezium generates transaction boundary events for the <code>BEGIN</code> and <code>END</code> delimiters in every transaction.
Transaction boundary events contain the following fields:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>status</code></dt>
<dd>
<p><code>BEGIN</code> or <code>END</code>.</p>
</dd>
<dt class="hdlist1"><code>id</code></dt>
<dd>
<p>String representation of the unique transaction identifier.</p>
</dd>
<dt class="hdlist1"><code>ts_ms</code></dt>
<dd>
<p>The time of a transaction boundary event (<code>BEGIN</code> or <code>END</code> event) at the data source.
If the data source does not provide Debezium with the event time, then the field instead represents the time at which Debezium processes the event. Note:`ts_ms` is in milliseconds, but only has seconds-level precision due to a limitation of MySQL, which can only provide binlog timestamps in seconds.</p>
</dd>
<dt class="hdlist1"><code>event_count</code> (for <code>END</code> events)</dt>
<dd>
<p>Total number of events emitted by the transaction.</p>
</dd>
<dt class="hdlist1"><code>data_collections</code> (for <code>END</code> events)</dt>
<dd>
<p>An array of pairs of <code>data_collection</code> and <code>event_count</code> elements that indicates the number of events that the connector emits for changes that originate from a data collection.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "status": "BEGIN",
  "id": "[{\"keyspace\":\"test_unsharded_keyspace\",\"shard\":\"0\",\"gtid\":\"MySQL56/e03ece6c-4c04-11ec-8e20-0242ac110004:1-37\"}]",
  "ts_ms": 1486500577000,
  "event_count": null,
  "data_collections": null
}

{
  "status": "END",
  "id": "[{\"keyspace\":\"test_unsharded_keyspace\",\"shard\":\"0\",\"gtid\":\"MySQL56/e03ece6c-4c04-11ec-8e20-0242ac110004:1-37\"}]",
  "ts_ms": 1486500577000,
  "event_count": 1,
  "data_collections": [
    {
      "data_collection": "test_unsharded_keyspace.my_seq",
      "event_count": 1
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unless overridden via the <a href="#vitess-property-topic-transaction"><code>topic.transaction</code></a> option,
the connector emits transaction events to the <a href="#vitess-property-topic-prefix"><code><em>&lt;topic.prefix&gt;</em></code></a><code>.transaction</code> topic.</p>
</div>
<div class="paragraph">
<div class="title">Change data event enrichment</div>
<p>When transaction metadata is enabled the data message <code>Envelope</code> is enriched with a new <code>transaction</code> field.
This field provides information about every event in the form of a composite of fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>id</code> - string representation of unique transaction identifier</p>
</li>
<li>
<p><code>total_order</code> - absolute position of the event among all events generated by the transaction</p>
</li>
<li>
<p><code>data_collection_order</code> - the per-data collection position of the event among all events that were emitted by the transaction</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Following is an example of a message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "before": null,
  "after": {
    "pk": "2",
    "aa": "1"
  },
  "source": {
...
  },
  "op": "c",
  "ts_ms": 1637988245467,
  "ts_us": 1637988245467841,
  "ts_ns": 1637988245467841698,
  "transaction": {
    "id": "[{\"keyspace\":\"test_unsharded_keyspace\",\"shard\":\"0\",\"gtid\":\"MySQL56/e03ece6c-4c04-11ec-8e20-0242ac110004:1-68\"}]",
    "total_order": 1,
    "data_collection_order": 1
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="vitess-ordered-transaction-metadata"><a class="anchor" href="#vitess-ordered-transaction-metadata"></a>Ordered Transaction Metadata</h3>
<div class="paragraph">
<p>You can configure Debezium to include additional metadata in data change event records.
Such supplemental metadata can assist downstream consumers in processing messages in the correct order when repartitioning, or some other disruption, might otherwise lead to data being consumed out of order.</p>
</div>
<div class="paragraph">
<div class="title">Change Data Enrichment</div>
<p>To configure the connector to emit enriched data change event records, set the <a href="#vitess-property-transaction-metadata-factory"><code>transaction.metadata.factory</code></a> property.
When this property is set to <code>VitessOrderedTransactionMetadataFactory</code>, the connector includes a <code>transaction</code> field in the message <code>Envelope</code>.
The <code>transaction</code> field adds metadata that provides information about the order in which transactions occur.
The following fields are added to every message:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>transaction_epoch</code></dt>
<dd>
<p>A non-decreasing value that represents the epoch that the transaction rank belongs to.</p>
</dd>
<dt class="hdlist1"><code>transaction_rank</code></dt>
<dd>
<p>A non-decreasing value within an epoch that represents the order of the transaction.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>A third field is also relevant to event ordering:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>total_order</code></dt>
<dd>
<p>Represents the absolute position of an event among all events generated by a transaction.
This field is included by default in the standard transaction metadata.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following example illustrates how to use these fields to establish event order.</p>
</div>
<div class="paragraph">
<p>Suppose Debezium emits change event records for two events that occur in the same shard and share the same primary key.
If the Kafka topic where these events are sent is repartitioned, then the consumer order of the two events cannot be trusted.
If Debezium is configured to provide enriched transaction metadata, applications that consume from the topic can apply the following logic to determine which of the two event to apply (the newer event) and which to discard:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the values for <code>transaction_epoch</code> are not equal, return the event with the higher <code>transaction_epoch</code> value. Otherwise, continue.</p>
</li>
<li>
<p>If the values for <code>transaction_rank</code> are not equal, return the event with the higher <code>transaction_rank</code> value. Otherwise, continue.</p>
</li>
<li>
<p>Return the event with a greater <code>total_order</code> value.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If neither of the two events have a higher <code>total_order</code> value, then the events are part of the same transaction.
Because the <code>total_order</code> field represents the order of events within a transaction, the event with the greater value is the most recent event.</p>
</div>
<div class="paragraph">
<p>The following example shows a data change event with ordered transaction metadata:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "before": null,
  "after": {
    "pk": "2",
    "aa": "1"
  },
  "source": {
...
  },
  "op": "c",
  "ts_ms": 1637988245467,
  "ts_us": 1637988245467841,
  "ts_ns": 1637988245467841698,
  "transaction": {
    "id": "[{\"keyspace\":\"test_unsharded_keyspace\",\"shard\":\"0\",\"gtid\":\"MySQL56/e03ece6c-4c04-11ec-8e20-0242ac110004:1-68\"}]",
    "total_order": 1,
    "data_collection_order": 1,
    "transaction_rank": 68,
    "transaction_epoch": 0
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="vitess-efficient-transaction-metadata"><a class="anchor" href="#vitess-efficient-transaction-metadata"></a>Efficient Transaction Metadata</h3>
<div class="paragraph">
<p>If you enable the connector to provide transaction metadata, it generates significantly more data.
Not only does the connector send additional messages to the transaction topics, but messages that it sends to the data change topics are larger, because they include a transaction metadata block.
The added volume is due to the following factors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The VGTID is stored twice, once as <code>source.vgtid</code>, and then again as <code>transaction.id</code>.
In keyspaces that include many shards, these VGTIDs can be quite large</p>
</li>
<li>
<p>In a sharded environment, the VGTID typically contains the VGTID for every shard.
In keyspaces with many shards, the amount of data in the VGTID field can be quite large.</p>
</li>
<li>
<p>The connector sends transaction topic messages for every transaction boundary event.
Typically, keyspaces that include many shards tend to generate a high number of transaction boundary events.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To enable the Vitess connector to encode transaction metadata without significantly increasing the volume of data produced, Debezium provides several single message transformations (SMTs).
The following SMTs are designed to reduce the amount of data in events that the Vitess connector emits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../transformations/vitess-use-local-vgtid.html" class="xref page">Use Local VGTID</a></p>
</li>
<li>
<p><a href="../transformations/vitess-remove-field.html" class="xref page">Remove Field</a></p>
</li>
<li>
<p><a href="../transformations/vitess-filter-transaction-topic-records.html" class="xref page">Filter Transaction Topic Records</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example shows an excerpt from the configuration of a Vitess connector that uses the preceding transformations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">}
 [...]
 "provide.transaction.metadata": "true",
 "transaction.metadata.factory": "io.debezium.connector.vitess.pipeline.txmetadata.VitessOrderedTransactionMetadataFactory",
 "transforms": "filterTransactionTopicRecords,removeField,useLocalVgtid",
 "transforms.filterTransactionTopicRecords.type": "io.debezium.connector.vitess.transforms.FilterTransactionTopicRecords",
 "transforms.removeField.type": "io.debezium.connector.vitess.transforms.RemoveField",
 "transforms.removeField.field_names": "transaction.id",
 "transforms.useLocalVgtid.type": "io.debezium.connector.vitess.transforms.UseLocalVgtid",
 [...]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vitess-events"><a class="anchor" href="#vitess-events"></a>Data change events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Debezium Vitess connector generates a data change event for each row-level <code>INSERT</code>, <code>UPDATE</code>, and <code>DELETE</code> operation. Each event contains a key and a value. The structure of the key and the value depends on the table that was changed.</p>
</div>
<div class="paragraph">
<p>Debezium and Kafka Connect are designed around <em>continuous streams of event messages</em>. However, the structure of these events may change over time, which can be difficult for consumers to handle. To address this, each event contains the schema for its content or, if you are using a schema registry, a schema ID that a consumer can use to obtain the schema from the registry. This makes each event self-contained.</p>
</div>
<div class="paragraph">
<p>The following skeleton JSON shows the basic four parts of a change event. However, how you configure the Kafka Connect converter that you choose to use in your application determines the representation of these four parts in change events. A <code>schema</code> field is in a change event only when you configure the converter to produce it. Likewise, the event key and event payload are in a change event only if you configure a converter to produce it. If you use the JSON converter and you configure it to produce all four basic change event parts, change events have this structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
 "schema": { <i class="conum" data-value="1"></i><b>(1)</b>
   ...
  },
 "payload": { <i class="conum" data-value="2"></i><b>(2)</b>
   ...
 },
 "schema": { <i class="conum" data-value="3"></i><b>(3)</b>
   ...
 },
 "payload": { <i class="conum" data-value="4"></i><b>(4)</b>
   ...
 },
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Overview of change event basic content</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Field name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>schema</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The first <code>schema</code> field is part of the event key. It specifies a Kafka Connect schema that describes what is in the event key&#8217;s <code>payload</code> portion. In other words, the first <code>schema</code> field describes the structure of the primary key, or the first single-column unique key if the table does not have a primary key, for the table that was changed. Multi-column unique key is not supported.<br>
<br>
It is possible to override the table&#8217;s primary key by setting the <a href="#vitess-property-message-key-columns"><code>message.key.columns</code> connector configuration property</a>. In this case, the first schema field describes the structure of the key identified by that property.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>payload</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The first <code>payload</code> field is part of the event key. It has the structure described by the previous <code>schema</code> field and it contains the key for the row that was changed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>schema</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The second <code>schema</code> field is part of the event value. It specifies the Kafka Connect schema that describes what is in the event value&#8217;s <code>payload</code> portion. In other words, the second <code>schema</code> describes the structure of the row that was changed. Typically, this schema contains nested schemas.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>payload</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The second <code>payload</code> field is part of the event value. It has the structure described by the previous <code>schema</code> field and it contains the actual data for the row that was changed.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>By default behavior is that the connector streams change event records to <a href="#vitess-topic-names">topics with names that are the same as the event&#8217;s originating table</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Starting with Kafka 0.10, Kafka can optionally record the event key and value with the <a href="https://kafka.apache.org/documentation.html#upgrade_10_performance_impact"><em>timestamp</em></a> at which the message was created (recorded by the producer) or written to the log by Kafka.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Vitess connector ensures that all Kafka Connect schema names adhere to the <a href="http://avro.apache.org/docs/current/spec.html#names">Avro schema name format</a>. This means that the logical server name must start with a Latin letter or an underscore, that is, a-z, A-Z, or _. Each remaining character in the logical server name and each character in the schema and table names must be a Latin letter, a digit, or an underscore, that is, a-z, A-Z, 0-9, or \_. If there is an invalid character it is replaced with an underscore character.</p>
</div>
<div class="paragraph">
<p>This can lead to unexpected conflicts if the logical server name, a schema name, or a table name contains invalid characters, and the only characters that distinguish names from one another are invalid and thus replaced with underscores.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The connector doesn&#8217;t allow to name columns with the <code>@</code> prefix at the moment. For example, <code>age</code> is a valid column name, and <code>@age</code> is not. The reason is that Vitess vstreamer has a bug that would send events with anonymized column names (e.g. column name <code>age</code> is anonymized to <code>@1</code>). There&#8217;s no easy way to differentiate between a legit column name with the <code>@</code> prefix, and the Vitess bug. See more discussion <a href="https://vitess.slack.com/archives/C0PQY0PTK/p1606817216038500">here</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="vitess-change-events-key"><a class="anchor" href="#vitess-change-events-key"></a>Change event keys</h3>
<div class="paragraph">
<p>For a given table, the change event&#8217;s key has a structure that contains a field for each column in the primary key of the table at the time the event was created.</p>
</div>
<div class="paragraph">
<p>Consider a <code>customers</code> table defined in the <code>commerce</code> keyspace and the example of a change event key for that table.</p>
</div>
<div class="listingblock">
<div class="title">Example table</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE TABLE customers (
  id INT NOT NULL,
  first_name VARCHAR(255) NOT NULL,
  last_name VARCHAR(255) NOT NULL,
  email VARCHAR(255) NOT NULL,
  PRIMARY KEY(id)
);</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Example change event key</div>
<p>If the <code>topic.prefix</code> connector configuration property has the value <code>Vitess_server</code>, every change event for the <code>customers</code> table while it has this definition has the same key structure, which in JSON looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "schema": { <i class="conum" data-value="1"></i><b>(1)</b>
    "type": "struct",
    "name": "Vitess_server.commerce.customers.Key", <i class="conum" data-value="2"></i><b>(2)</b>
    "optional": false, <i class="conum" data-value="3"></i><b>(3)</b>
    "fields": [ <i class="conum" data-value="4"></i><b>(4)</b>
          {
              "name": "id",
              "index": "0",
              "schema": {
                  "type": "INT32",
                  "optional": "false"
              }
          }
      ]
  },
  "payload": { <i class="conum" data-value="5"></i><b>(5)</b>
      "id": "1"
  },
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Description of change event key</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Field name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>schema</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The schema portion of the key specifies a Kafka Connect schema that describes what is in the key&#8217;s <code>payload</code> portion.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Vitess_server.commerce.customers.Key</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name of the schema that defines the structure of the key&#8217;s payload. This schema describes the structure of the primary key for the table that was changed. Key schema names have the format <em>connector-name</em>.<em>keyspace-name</em>.<em>table-name</em>.<code>Key</code>. In this example:<br></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Vitess_server</code> is the name of the connector that generated this event.<br></p>
</li>
<li>
<p><code>commerce</code> is the keyspace that contains the table that was changed.<br></p>
</li>
<li>
<p><code>customers</code> is the table that was updated.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>optional</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether the event key must contain a value in its <code>payload</code> field. In this example, a value in the key&#8217;s payload is required. A value in the key&#8217;s payload field is optional when a table does not have a primary key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fields</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies each field that is expected in the <code>payload</code>, including each field&#8217;s name, index, and schema.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>payload</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the key for the row for which this change event was generated. In this example, the key, contains a single <code>id</code> field whose value is <code>1</code>.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Although the <code>column.exclude.list</code> and <code>column.include.list</code> connector configuration properties allow you to capture only a subset of table columns, all columns in a primary or unique key are always included in the event&#8217;s key.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the table does not have a primary, then the change event&#8217;s key is null. The rows in a table without a primary key constraint cannot be uniquely identified.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="vitess-change-events-value"><a class="anchor" href="#vitess-change-events-value"></a>Change event values</h3>
<div class="paragraph">
<p>The value in a change event is a bit more complicated than the key. Like the key, the value has a <code>schema</code> section and a <code>payload</code> section. The <code>schema</code> section contains the schema that describes the <code>Envelope</code> structure of the <code>payload</code> section, including its nested fields. Change events for operations that create, update or delete data all have a value payload with an envelope structure.</p>
</div>
<div class="paragraph">
<p>Consider the same sample table that was used to show an example of a change event key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE TABLE customers (
  id INT NOT NULL,
  first_name VARCHAR(255) NOT NULL,
  last_name VARCHAR(255) NOT NULL,
  email VARCHAR(255) NOT NULL,
  PRIMARY KEY(id)
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The emitted events for <code>UPDATE</code> and <code>DELETE</code> operations contain the previous values of all columns in the table.</p>
</div>
</div>
<div class="sect2">
<h3 id="vitess-create-events"><a class="anchor" href="#vitess-create-events"></a><em>create</em> events</h3>
<div class="paragraph">
<p>The following example shows the value portion of a change event that the connector generates for an operation that creates data in the <code>customers</code> table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
    "schema": { <i class="conum" data-value="1"></i><b>(1)</b>
        "type": "struct",
        "fields": [
            {
                "type": "struct",
                "fields": [
                    {
                        "type": "int32",
                        "optional": false,
                        "field": "id"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "first_name"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "last_name"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "email"
                    }
                ],
                "optional": true,
                "name": "Vitess_server.commerce.customers.Value", <i class="conum" data-value="2"></i><b>(2)</b>
                "field": "before"
            },
            {
                "type": "struct",
                "fields": [
                    {
                        "type": "int32",
                        "optional": false,
                        "field": "id"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "first_name"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "last_name"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "email"
                    }
                ],
                "optional": true,
                "name": "Vitess_server.commerce.customers.Value",
                "field": "after"
            },
            {
                "type": "struct",
                "fields": [
                    {
                        "type": "string",
                        "optional": false,
                        "field": "version"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "connector"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "name"
                    },
                    {
                        "type": "int64",
                        "optional": false,
                        "field": "ts_ms"
                    },
                    {
                        "type": "int64",
                        "optional": false,
                        "field": "ts_us"
                    },
                    {
                        "type": "int64",
                        "optional": false,
                        "field": "ts_ns"
                    },
                    {
                        "type": "string",
                        "optional": true,
                        "name": "io.debezium.data.Enum",
                        "version": 1,
                        "parameters": {
                            "allowed": "true,last,false,incremental"
                        },
                        "default": "false",
                        "field": "snapshot"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "db"
                    },
                    {
                        "type": "string",
                        "optional": true,
                        "field": "sequence"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "keyspace"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "table"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "shard"
                    },
                    {
                        "type": "int64",
                        "optional": true,
                        "field": "vgtid"
                    }
                ],
                "optional": false,
                "name": "io.debezium.connector.vitess.Source", <i class="conum" data-value="3"></i><b>(3)</b>
                "field": "source"
            },
            {
                "type": "string",
                "optional": false,
                "field": "op"
            },
            {
                "type": "int64",
                "optional": true,
                "field": "ts_ms"
            },
            {
                "type": "int64",
                "optional": true,
                "field": "ts_us"
            },
            {
                "type": "int64",
                "optional": true,
                "field": "ts_ns"
            }
        ],
        "optional": false,
        "name": "Vitess_server.commerce.customers.Envelope" <i class="conum" data-value="4"></i><b>(4)</b>
    },
    "payload": { <i class="conum" data-value="5"></i><b>(5)</b>
        "before": null, <i class="conum" data-value="6"></i><b>(6)</b>
        "after": { <i class="conum" data-value="7"></i><b>(7)</b>
            "id": 1,
            "first_name": "Anne",
            "last_name": "Kretchmar",
            "email": "annek@noanswer.org"
        },
        "source": { <i class="conum" data-value="8"></i><b>(8)</b>
            "version": "3.0.0.Final",
            "connector": "vitess",
            "name": "my_sharded_connector",
            "ts_ms": 1559033904000,
            "ts_us": 1559033904000000,
            "ts_ns": 1559033904000000000,
            "snapshot": "false",
            "db": "",
            "sequence": null,
            "keyspace": "commerce",
            "table": "customers",
            "shard": "-80",
            "vgtid": "[{\"keyspace\":\"commerce\",\"shard\":\"80-\",\"gtid\":\"MariaDB/0-54610504-47\"},{\"keyspace\":\"commerce\",\"shard\":\"-80\",\"gtid\":\"MariaDB/0-1592148-45\"}]"
        },
        "op": "c", <i class="conum" data-value="9"></i><b>(9)</b>
        "ts_ms": 1559033904863, <i class="conum" data-value="10"></i><b>(10)</b>
        "ts_us": 1559033904863497, <i class="conum" data-value="10"></i><b>(10)</b>
        "ts_ns": 1559033904863497147 <i class="conum" data-value="10"></i><b>(10)</b>
    }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Descriptions of <em>create</em> event value fields</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Field name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>schema</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value&#8217;s schema, which describes the structure of the value&#8217;s payload. A change event&#8217;s value schema is the same in every change event that the connector generates for a particular table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>In the <code>schema</code> section, each <code>name</code> field specifies the schema for a field in the value&#8217;s payload.<br>
<br>
<code>Vitess_server.commerce.customers.Value</code> is the schema for the payload&#8217;s <code>before</code> and <code>after</code> fields. This schema is specific to the <code>customers</code> table.<br>
<br>
Names of schemas for <code>before</code> and <code>after</code> fields are of the form <code><em>logicalName</em>.<em>keyspaceName</em>.<em>tableName</em>.Value</code>, which ensures that the schema name is unique in the database. This means that when using the <a href="../configuration/avro.html" class="xref page">Avro converter</a>, the resulting Avro schema for each table in each logical source has its own evolution and history.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.connector.vitess.Source</code> is the schema for the payload&#8217;s <code>source</code> field. This schema is specific to the Vitess connector. The connector uses it for all events that it generates.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Vitess_server.commerce.customers.Envelope</code> is the schema for the overall structure of the payload, where <code>Vitess_server</code> is the connector name, <code>commerce</code> is the keyspace, and <code>customers</code> is the table.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>payload</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value&#8217;s actual data. This is the information that the change event is providing.<br>
<br>
It may appear that the JSON representations of the events are much larger than the rows they describe. This is because the JSON representation must include the schema and the payload portions of the message.
However, by using the <a href="../configuration/avro.html" class="xref page">Avro converter</a>, you can significantly decrease the size of the messages that the connector streams to Kafka topics.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>before</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional field that specifies the state of the row before the event occurred. When the <code>op</code> field is <code>c</code> for create, as it is in this example, the <code>before</code> field is <code>null</code> since this change event is for new content.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>after</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional field that specifies the state of the row after the event occurred. In this example, the <code>after</code> field contains the values of the new row&#8217;s <code>id</code>, <code>first_name</code>, <code>last_name</code>, and <code>email</code> columns.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>source</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory field that describes the source metadata for the event. This field contains information that you can use to compare this event with other events, with regard to the origin of the events, the order in which the events occurred, and whether events were part of the same transaction. The source metadata includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Debezium version</p>
</li>
<li>
<p>Connector type and name</p>
</li>
<li>
<p>Database (also known as keyspace), table, and shard that contains the new row</p>
</li>
<li>
<p>If the event was part of a snapshot (always <code>false</code>)</p>
</li>
<li>
<p>VGTID of the operation</p>
</li>
<li>
<p>Timestamp for when the change was made in the database</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>op</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory string that describes the type of operation that caused the connector to generate the event. In this example, <code>c</code> indicates that the operation created a row. Valid values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>c</code> = create</p>
</li>
<li>
<p><code>u</code> = update</p>
</li>
<li>
<p><code>d</code> = delete</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ts_ms</code>, <code>ts_us</code>, <code>ts_ns</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Optional field that displays the time at which the connector processed the event.
The time is based on the system clock in the JVM running the Kafka Connect task. <br>
<br>
In the <code>source</code> object, <code>ts_ms</code> indicates the time that the change was made in the database. By comparing the value for <code>payload.source.ts_ms</code> with the value for <code>payload.ts_ms</code>, you can determine the lag between the source database update and Debezium. Note:`ts_ms` is in milliseconds, but only has seconds-level precision due to a limitation of MySQL, which can only provide binlog timestamps in seconds.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="vitess-update-events"><a class="anchor" href="#vitess-update-events"></a><em>update</em> events</h3>
<div class="paragraph">
<p>The value of a change event for an update in the sample <code>customers</code> table has the same schema as a <em>create</em> event for that table. Likewise, the event value&#8217;s payload has the same structure. However, the event value payload contains different values in an <em>update</em> event. Here is an example of a change event value in an event that the connector generates for an update in the <code>customers</code> table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
    "schema": { ... },
    "payload": {
        "before": { <i class="conum" data-value="1"></i><b>(1)</b>
            "id": 1,
            "first_name": "Anne",
            "last_name": "Kretchmar",
            "email": "annek@noanswer.org"
        },
        "after": { <i class="conum" data-value="2"></i><b>(2)</b>
            "id": 1,
            "first_name": "Anne Marie",
            "last_name": "Kretchmar",
            "email": "annek@noanswer.org"
        },
        "source": { <i class="conum" data-value="3"></i><b>(3)</b>
            "version": "3.0.0.Final",
            "connector": "vitess",
            "name": "my_sharded_connector",
            "ts_ms": 1559033904000,
            "ts_us": 1559033904000000,
            "ts_ns": 1559033904000000000,
            "snapshot": "false",
            "db": "",
            "sequence": null,
            "keyspace": "commerce",
            "table": "customers",
            "shard": "-80",
            "vgtid": "[{\"keyspace\":\"commerce\",\"shard\":\"80-\",\"gtid\":\"MariaDB/0-54610504-47\"},{\"keyspace\":\"commerce\",\"shard\":\"-80\",\"gtid\":\"MariaDB/0-1592148-46\"}]"
        },
        "op": "u", <i class="conum" data-value="4"></i><b>(4)</b>
        "ts_ms": 1465584025523,  <i class="conum" data-value="5"></i><b>(5)</b>
        "ts_us": 1465584025523763,  <i class="conum" data-value="5"></i><b>(5)</b>
        "ts_ns": 1465584025523763547  <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Descriptions of <em>update</em> event value fields</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Field name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>before</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional field that contains all values of all columns that were in the row before the database commit.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>after</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional field that specifies the state of the row after the event occurred. In this example, the <code>first_name</code> value is now <code>Anne Marie</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>source</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory field that describes the source metadata for the event. The <code>source</code> field structure has the same fields as in a <em>create</em> event, but some values are different. The source metadata includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Debezium version</p>
</li>
<li>
<p>Connector type and name</p>
</li>
<li>
<p>Database (also known as keyspace), table, and shard that contains the new row</p>
</li>
<li>
<p>If the event was part of a snapshot (always <code>false</code>)</p>
</li>
<li>
<p>VGTID of the operation</p>
</li>
<li>
<p>Timestamp for when the change was made in the database</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>op</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory string that describes the type of operation. In an <em>update</em> event value, the <code>op</code> field value is <code>u</code>, signifying that this row changed because of an update.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ts_ms</code>, <code>ts_us</code>, <code>ts_ns</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Optional field that displays the time at which the connector processed the event.
The time is based on the system clock in the JVM running the Kafka Connect task. <br>
<br>
In the <code>source</code> object, <code>ts_ms</code> indicates the time that the change was made in the database. By comparing the value for <code>payload.source.ts_ms</code> with the value for <code>payload.ts_ms</code>, you can determine the lag between the source database update and Debezium. Note:`ts_ms` is in milliseconds, but only has seconds-level precision due to a limitation of MySQL, which can only provide binlog timestamps in seconds.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Updating the columns for a row&#8217;s primary key changes the value of the row&#8217;s key. When a key changes, Debezium outputs <em>three</em> events: a <code>DELETE</code> event and a <a href="#vitess-tombstone-events">tombstone event</a> with the old key for the row, followed by an event with the new key for the row. Details are in the next section.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="vitess-primary-key-updates"><a class="anchor" href="#vitess-primary-key-updates"></a>Primary key updates</h3>
<div class="paragraph">
<p>An <code>UPDATE</code> operation that changes a row&#8217;s primary key field(s) is known
as a primary key change. For a primary key change, in place of an <code>UPDATE</code> event record, the connector emits a <code>DELETE</code> event record for the old key and a <code>CREATE</code> event record for the new (updated) key. These events have the usual structure and content, and in addition, each one has a message header related to the primary key change:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>DELETE</code> event record has <code>__debezium.newkey</code> as a message header. The value of this header is the new primary key for the updated row.</p>
</li>
<li>
<p>The <code>CREATE</code> event record has <code>__debezium.oldkey</code> as a message header. The value of this header is the previous (old) primary key that the updated row had.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="vitess-delete-events"><a class="anchor" href="#vitess-delete-events"></a><em>delete</em> events</h3>
<div class="paragraph">
<p>The value in a <em>delete</em> change event has the same <code>schema</code> portion as <em>create</em> and <em>update</em> events for the same table. The <code>payload</code> portion in a <em>delete</em> event for the sample <code>customers</code> table looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "schema": { ... },
    "payload": {
        "before": { <i class="conum" data-value="1"></i><b>(1)</b>
            "id": 1,
            "first_name": "Anne Marie",
            "last_name": "Kretchmar",
            "email": "annek@noanswer.org"
        },
        "after": null, <i class="conum" data-value="2"></i><b>(2)</b>
        "source": { <i class="conum" data-value="3"></i><b>(3)</b>
            "version": "3.0.0.Final",
            "connector": "vitess",
            "name": "my_sharded_connector",
            "ts_ms": 1559033904000,
            "ts_us": 1559033904000000,
            "ts_ns": 1559033904000000000,
            "snapshot": "false",
            "db": "",
            "sequence": null,
            "keyspace": "commerce",
            "table": "customers",
            "shard": "-80",
            "vgtid": "[{\"keyspace\":\"commerce\",\"shard\":\"80-\",\"gtid\":\"MariaDB/0-54610504-47\"},{\"keyspace\":\"commerce\",\"shard\":\"-80\",\"gtid\":\"MariaDB/0-1592148-47\"}]"
        },
        "op": "d", <i class="conum" data-value="4"></i><b>(4)</b>
        "ts_ms": 1465581902461, <i class="conum" data-value="5"></i><b>(5)</b>
        "ts_us": 1465581902461324, <i class="conum" data-value="5"></i><b>(5)</b>
        "ts_ns": 1465581902461324871 <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Descriptions of <em>delete</em> event value fields</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Field name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>before</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional field that specifies the state of the row before the event occurred. In a <em>delete</em> event value, the <code>before</code> field contains the values that were in the row before it was deleted with the database commit.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>after</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional field that specifies the state of the row after the event occurred. In a <em>delete</em> event value, the <code>after</code> field is <code>null</code>, signifying that the row no longer exists.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>source</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory field that describes the source metadata for the event. In a <em>delete</em> event value, the <code>source</code> field structure is the same as for <em>create</em> and <em>update</em> events for the same table. Many <code>source</code> field values are also the same. In a <em>delete</em> event value, the <code>ts_ms</code> and <code>lsn</code> field values, as well as other values, might have changed. But the <code>source</code> field in a <em>delete</em> event value provides the same metadata:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Debezium version</p>
</li>
<li>
<p>Connector type and name</p>
</li>
<li>
<p>Database (also known as keyspace), table, and shard that contains the new row</p>
</li>
<li>
<p>If the event was part of a snapshot (always <code>false</code>)</p>
</li>
<li>
<p>VGTID of the operation</p>
</li>
<li>
<p>Timestamp for when the change was made in the database</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>op</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory string that describes the type of operation. The <code>op</code> field value is <code>d</code>, signifying that this row was deleted.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ts_ms</code>, <code>ts_us</code>, <code>ts_ns</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Optional field that displays the time at which the connector processed the event.
The time is based on the system clock in the JVM running the Kafka Connect task. <br>
<br>
In the <code>source</code> object, <code>ts_ms</code> indicates the time that the change was made in the database. By comparing the value for <code>payload.source.ts_ms</code> with the value for <code>payload.ts_ms</code>, you can determine the lag between the source database update and Debezium. Note:`ts_ms` is in milliseconds, but only has seconds-level precision due to a limitation of MySQL, which can only provide binlog timestamps in seconds.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A <em>delete</em> change event record provides a consumer with the information it needs to process the removal of this row.</p>
</div>
<div class="paragraph">
<p>Vitess connector events are designed to work with <a href="https://kafka.apache.org/documentation#compaction">Kafka log compaction</a>. Log compaction enables removal of some older messages as long as at least the most recent message for every key is kept. This lets Kafka reclaim storage space while ensuring that the topic contains a complete data set and can be used for reloading key-based state.</p>
</div>
<div id="vitess-tombstone-events" class="paragraph">
<div class="title">Tombstone events</div>
<p>When a row is deleted, the <em>delete</em> event value still works with log compaction, because Kafka can remove all earlier messages that have that same key. However, for Kafka to remove all messages that have that same key, the message value must be <code>null</code>. To make this possible, the Vitess connector follows a <em>delete</em> event with a special <em>tombstone</em> event that has the same key but a <code>null</code> value.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vitess-data-types"><a class="anchor" href="#vitess-data-types"></a>Data type mappings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Vitess connector represents changes to rows with events that are structured like the table in which the row exists. The event contains a field for each column value. How that value is represented in the event depends on the Vitess data type of the column. This section describes these mappings.</p>
</div>
<div class="paragraph">
<p>If the default data type conversions do not meet your needs, you can <a href="../development/converters.html#custom-converters" class="xref page">create a custom converter</a> for the connector.</p>
</div>
<div class="sect2">
<h3 id="vitess-basic-types"><a class="anchor" href="#vitess-basic-types"></a>Basic types</h3>
<div class="paragraph">
<p>The following table describes how the connector maps basic Vitess data types to a <em>literal type</em> and a <em>semantic type</em> in event fields.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>literal type</em> describes how the value is literally represented using Kafka Connect schema types: <code>INT8</code>, <code>INT16</code>, <code>INT32</code>, <code>INT64</code>, <code>FLOAT32</code>, <code>FLOAT64</code>, <code>BOOLEAN</code>, <code>STRING</code>, <code>BYTES</code>, <code>ARRAY</code>, <code>MAP</code>, and <code>STRUCT</code>.</p>
</li>
<li>
<p><em>semantic type</em> describes how the Kafka Connect schema captures the <em>meaning</em> of the field using the name of the Kafka Connect schema for the field.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Mappings for Vitess basic data types</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 20%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Vitess data type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name) and Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BOOLEAN, BOOL</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT16</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BIT(1)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Unsupported yet</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BIT(&gt;1)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Unsupported yet</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TINYINT</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT16</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>SMALLINT[(M)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT16</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>MEDIUMINT[(M)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT, INTEGER[(M)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BIGINT[(M)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>REAL[(M,D)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>FLOAT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>FLOAT[(M,D)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>FLOAT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DOUBLE[(M,D)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>FLOAT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>CHAR[(M)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>VARCHAR[(M)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BINARY[(M)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>VARBINARY[(M)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TINYBLOB</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TINYTEXT</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BLOB</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TEXT</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>MEDIUMBLOB</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>MEDIUMTEXT</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>LONGBLOB</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>LONGTEXT</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>JSON</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.Json</code><br>
Contains the string representation of a <code>JSON</code> document, array, or scalar.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>ENUM</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.Enum</code><br>
The <code>allowed</code> schema parameter contains the comma-separated list of allowed values.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>SET</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.EnumSet</code><br>
The <code>allowed</code> schema parameter contains the comma-separated list of allowed values.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>YEAR[(2|4)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>io.debezium.time.Year</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIMESTAMP[(M)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em><br>
In <code>yyyy-MM-dd HH:mm:ss.SSS</code> format with microsecond precision based on UTC. MySQL allows <code>M</code> to be in the range of <code>0-6</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>NUMERIC[(M[,D])]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DECIMAL[(M[,D])]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>GEOMETRY,<br>
LINESTRING,<br>
POLYGON,<br>
MULTIPOINT,<br>
MULTILINESTRING,<br>
MULTIPOLYGON,<br>
GEOMETRYCOLLECTION</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Unsupported yet</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="vitess-temporal-types"><a class="anchor" href="#vitess-temporal-types"></a>Temporal types</h3>
<div class="paragraph">
<p>Excluding the <code>TIMESTAMP</code> data type, Vitess temporal types depend on the value of the <a href="#vitess-property-time-precision-mode"><code>time.precision.mode</code></a> connector configuration property.</p>
</div>
<div class="paragraph">
<div class="title">Temporal values without time zones</div>
<p>The <code>DATETIME</code> type represents a local date and time such as "2018-01-13 09:48:27".
As you can see in the preceding example, this type does not include time zone information.
Columns of this type are converted into epoch milliseconds or microseconds based on the column’s precision by using UTC.
The <code>TIMESTAMP</code> type represents a timestamp without time zone information.
When writing data, MySQL converts the <code>TIMESTAMP</code> type from the time zone of the server or session into UTC format.
When it reads values, the database converts from UTC format to the current time zone of the server or session.
For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DATETIME</code> with a value of <code>2018-06-20 06:37:03</code> becomes <code>1529476623000</code>.</p>
</li>
<li>
<p><code>TIMESTAMP</code> with a value of <code>2018-06-20 06:37:03</code> becomes <code>2018-06-20T13:37:03Z</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Such columns are converted into an equivalent <code>io.debezium.time.ZonedTimestamp</code> in UTC, based on the time zone of the server or session.
By default, Debezium queries the server for the time zone.
If this fails, you must explicitly specify the timezone by setting the <code>connectionTimeZone</code> option in the JDBC connection string.
For example, if the database’s time zone (either globally, or as configured for the connector by means of the <code>connectionTimeZone</code> option) is "America/Los_Angeles", the TIMESTAMP value "2018-06-20 06:37:03" is represented by a <code>ZonedTimestamp</code> with the value "2018-06-20T13:37:03Z".</p>
</div>
<div class="paragraph">
<p>The time zone of the JVM that runs Kafka Connect and Debezium does not affect these conversions.</p>
</div>
<div class="paragraph">
<p>For more information about properties that affect temporal values, see the <a href="#vitess-connector-properties">connector configuration properties</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">time.precision.mode=adaptive_time_microseconds(default)</dt>
<dd>
<p>The Vitess connector determines the literal type and semantic type based on the column&#8217;s data type definition so that events represent exactly the values in the database.
All time fields are in microseconds.
Only positive <code>TIME</code> field values in the range of <code>00:00:00.000000</code> to <code>23:59:59.999999</code> can be captured correctly.</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Mappings when <code>time.precision.mode=adaptive_time_microseconds</code></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 20%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Vitess type</th>
<th class="tableblock halign-left valign-top">Literal type</th>
<th class="tableblock halign-left valign-top">Semantic type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DATE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.Date</code><br>
Represents the number of days elapsed since the UNIX epoch.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIME[(M)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.MicroTime</code><br>
Represents the time value in microseconds and does not include time zone information.
MySQL allows <code>M</code> to be in the range of <code>0-6</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DATETIME, DATETIME(0), DATETIME(1), DATETIME(2), DATETIME(3)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.Timestamp</code><br>
Represents the number of milliseconds elapsed since the UNIX epoch and does not include time zone information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DATETIME(4), DATETIME(5), DATETIME(6)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.MicroTimestamp</code><br>
Represents the number of microseconds elapsed since the UNIX epoch and does not include time zone information.</p>
</div></div></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1">time.precision.mode=connect</dt>
<dd>
<p>The Vitess connector uses defined Kafka Connect logical types.
This approach is less precise than the default approach, and the events could be less precise if the database column has a <em>fractional second precision</em> value that is greater than <code>3</code>.
The connector can process values that range from <code>00:00:00.000</code> to <code>23:59:59.999</code>.
Set <code>time.precision.mode=connect</code> only if you are certain that the <code>TIME</code> values in your tables never exceed the supported ranges.
The <code>connect</code> setting is expected to be removed in a future version of Debezium.</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Mappings when <code>time.precision.mode=connect</code></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 20%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Vitess data type</th>
<th class="tableblock halign-left valign-top">Literal type</th>
<th class="tableblock halign-left valign-top">Semantic type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DATE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Date</code><br>
Represents the number of days elapsed since the UNIX epoch.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIME[(M)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Time</code><br>
Represents the time value in microseconds since midnight and does not include time zone information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DATETIME[(M)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Timestamp</code><br>
Represents the number of milliseconds elapsed since the UNIX epoch, and does not include time zone information.</p>
</div></div></td>
</tr>
</tbody>
</table>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setting-up-vitess"><a class="anchor" href="#setting-up-vitess"></a>Seting up Vitess</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Debezium does not require any specific configuration for use with Vitess. Install Vitess according to the standard instructions in the <a href="https://vitess.io/docs/get-started/local-docker/">Local Install via Docker</a> guide, or the <a href="https://vitess.io/docs/get-started/operator/">Vitess Operator for Kubernetes</a> guide.</p>
</div>
<div class="ulist">
<div class="title">Checklist</div>
<ul>
<li>
<p>Make sure that the VTGate host and its gRPC port (default is 15991) is accessible from the machine where the Vitess connector is installed</p>
</li>
<li>
<p>Make sure that the VTCtld host and its gRPC port (default is 15999) is accessible from the machine where the Vitess connector is installed</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="grpc-authentication"><a class="anchor" href="#grpc-authentication"></a>gRPC authentication</h3>
<div class="paragraph">
<p>Because Vitess connector reads change events from the VTGate VStream gRPC server, it does not need to connect directly to MySQL instances. Therefore, no special database user and permissions are needed. At the moment, Vitess connector only supports unauthenticated access to the VTGate gRPC server.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vitess-deploying-a-connector"><a class="anchor" href="#vitess-deploying-a-connector"></a>Deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With <a href="https://zookeeper.apache.org">Zookeeper</a>, <a href="http://kafka.apache.org/">Kafka</a>, and <a href="https://kafka.apache.org/documentation.html#connect">Kafka Connect</a> installed, the remaining tasks to deploy a Debezium Vitess connector are to download the <a href="https://repo1.maven.org/maven2/io/debezium/debezium-connector-vitess/3.0.0.Final/debezium-connector-vitess-3.0.0.Final-plugin.tar.gz">connector&#8217;s plug-in archive</a>, extract the JAR files into your Kafka Connect environment, and add the directory with the JAR files to <a href="https://kafka.apache.org/documentation/#connectconfigs">Kafka Connect&#8217;s <code>plugin.path</code></a>. You then need to restart your Kafka Connect process to pick up the new JAR files.</p>
</div>
<div class="paragraph">
<p>If you are working with immutable containers, see <a href="https://quay.io/organization/debezium">Debezium&#8217;s Container images</a> for Zookeeper, Kafka and Kafka Connect with the Vitess connector already installed and ready to run. You can also <a href="../operations/openshift.html" class="xref page">run Debezium on Kubernetes and OpenShift</a>.</p>
</div>
<div class="sect2">
<h3 id="vitess-example-configuration"><a class="anchor" href="#vitess-example-configuration"></a>Connector configuration example</h3>
<div class="paragraph">
<p>Following is an example of the configuration for a Vitess connector that connects to a Vitess (VTGate&#8217;s VStream) server on port 15991 at 192.168.99.100, whose logical name is <code>fullfillment</code>. It also connects to a VTCtld server on port 15999 at 192.168.99.101 to get the initial VGTID. Typically, you configure the Debezium Vitess connector in a <code>.json</code> file using the configuration properties available for the connector.</p>
</div>
<div class="paragraph">
<p>You can choose to produce events for a subset of the schemas and tables. Optionally, ignore, mask, or truncate columns that are sensitive, too large, or not needed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "inventory-connector",  <i class="conum" data-value="1"></i><b>(1)</b>
  "config": {
    "connector.class": "io.debezium.connector.vitess.VitessConnector", <i class="conum" data-value="2"></i><b>(2)</b>
    "database.hostname": "192.168.99.100", <i class="conum" data-value="3"></i><b>(3)</b>
    "database.port": "15991", <i class="conum" data-value="4"></i><b>(4)</b>
    "database.user": "vitess", <i class="conum" data-value="5"></i><b>(5)</b>
    "database.password": "vitess_password", <i class="conum" data-value="6"></i><b>(6)</b>
    "vitess.keyspace": "commerce", <i class="conum" data-value="7"></i><b>(7)</b>
    "vitess.tablet.type": "MASTER", <i class="conum" data-value="8"></i><b>(8)</b>
    "vitess.vtctld.host": "192.168.99.101", <i class="conum" data-value="9"></i><b>(9)</b>
    "vitess.vtctld.port": "15999", <i class="conum" data-value="10"></i><b>(10)</b>
    "vitess.vtctld.user": "vitess", <i class="conum" data-value="11"></i><b>(11)</b>
    "vitess.vtctld.password": "vitess_password", <i class="conum" data-value="12"></i><b>(12)</b>
    "topic.prefix": "fullfillment", <i class="conum" data-value="13"></i><b>(13)</b>
    "tasks.max": 1 <i class="conum" data-value="14"></i><b>(14)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The name of the connector when registered with a Kafka Connect service.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The name of this Vitess connector class.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The address of the Vitess (VTGate&#8217;s VStream) server.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The port number of the Vitess (VTGate&#8217;s VStream) server.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The username of the Vitess database server (VTGate gRPC).</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The password of the Vitess database server (VTGate gRPC).</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The name of the keyspce (a.k.a database). Because no shard is specified, it reads change events from all shards in the keyspace.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The type of MySQL instance (MASTER OR REPLICA) to read change events from.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>The address of the VTCtld server.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>The port of the VTCtld server.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>The username of the VTCtld server (VTCtld gRPC).</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>The password of the VTCtld database server (VTCtld gRPC).</td>
</tr>
<tr>
<td><i class="conum" data-value="13"></i><b>13</b></td>
<td>The topic prefix for the Vitess cluster, which forms a namespace and is used in all the names of the Kafka topics to which the connector writes, the Kafka Connect schema names, and the namespaces of the corresponding Avro schema when the Avro converter is used.</td>
</tr>
<tr>
<td><i class="conum" data-value="14"></i><b>14</b></td>
<td>Only one task should operate at any one time.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See the <a href="#vitess-connector-properties">complete list of Vitess connector properties</a> that can be specified in these configurations.</p>
</div>
<div class="paragraph">
<p>You can send this configuration with a <code>POST</code> command to a running Kafka Connect service. The service records the configuration and starts the connector task that connects to the Vitess database and streams change event records to Kafka topics.</p>
</div>
</div>
<div class="sect2">
<h3 id="vitess-example-configuration-offset-storage-per-task"><a class="anchor" href="#vitess-example-configuration-offset-storage-per-task"></a>Connector configuration example for offset-storage-per-task mode</h3>
<div class="paragraph">
<p>When you have a big Vitess installation which requires more than one connector task to process the change logs, you can use offset-storage-per-task feature to launch multiple connector tasks and have each task work with a subset of vitess shards.  Each task will persist its offsets (the vgtids for the shards it&#8217;s tracking) in Kafka&#8217;s offset topic in its own partition space.</p>
</div>
<div class="paragraph">
<p>Following is the same example for a Vitess connector that connects to a Vitess (VTGate&#8217;s VStream) server but with three additional parameteres to invoke the offset-storage-per-task mode.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "inventory-connector",
  "config": {
    "connector.class": "io.debezium.connector.vitess.VitessConnector",
    "database.hostname": "192.168.99.100",
    "database.port": "15991",
    "database.user": "vitess",
    "database.password": "vitess_password",
    "topic.prefix": "fullfillment",
    "vitess.keyspace": "commerce",
    "vitess.tablet.type": "MASTER",
    "vitess.vtctld.host": "192.168.99.101",
    "vitess.vtctld.port": "15999",
    "vitess.vtctld.user": "vitess",
    "vitess.vtctld.password": "vitess_password",
    "vitess.offset.storage.per.task": true, <i class="conum" data-value="1"></i><b>(1)</b>
    "vitess.offset.storage.task.key.gen": 1, <i class="conum" data-value="2"></i><b>(2)</b>
    "vitess.prev.num.tasks": 1, <i class="conum" data-value="3"></i><b>(3)</b>
    "tasks.max": 2 <i class="conum" data-value="4"></i><b>(4)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify that we want to turn on offset-storage-per-task feature</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify that the generation number for the current task parallelism is 1</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify that the number of tasks in the previous generation of task parallelism is 1</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify that we want to launch two tasks for the current task parallelism</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The task to vitess shards distribution is based on a simple round robin algorithm.  In this example of launching two connector tasks and assume we have 4 vitess shards (-40,40-80,80-c0,c0-), task0 will be working on shards (-40,80-c0) and task1 will be working on shards (40-80,c0-).</p>
</div>
<div class="paragraph">
<p>The reason that we need three config params is to make sure the offsets saved by each connector task don&#8217;t collide with each other and to handle the migration of offsets by the previous task paralleism automatically.  In order to make sure that we don&#8217;t collide on the partition keys in Kafka offset topic, we are using this partition name scheme for each connector task: taskId_numTasks_gen.  So for the current example of launching two tasks with generation number 1, task0 will be writing its offsets in Kafka&#8217;s offset topic in partition key: task0_2_1 and task1 will be using partition key: (task1_2_1). The gen config param is used to distinguish the partition keys generated from different generations (generation corresponds to each change of task parallelism)</p>
</div>
<div class="paragraph">
<p>When the task paralleism changes (e.g. you want to launch 4 connector tasks instead of 2 to handle the bigger volume of traffic from vitess), you will specify tasks.max=4, vitess.offset.storage.task.key.gen=2, vitess.prev.num.tasks=2, the offset partition for this task paralleism generation will be: task0_4_2, task1_4_2, task2_4_2, task3_4_2.  Once the connector restarts, the connector will detect there is no previous offsets saved for the current 4 partition keys and it will invoke an automatic offset migration from the offsets saved in the previous generation keys: task0_2_1 and task1_2_1.  For the current example of 4 vitess shards (-40,40-80,80-c0,c0-), task0 will be working on shard:(-40), task1:(40-80), task2:(80-c0), task3:(c0-).  The offsets for those 4 shards from the previous generation of parallelism (using 2 tasks with each task working with 2 shards) will be auto-migrated to this generation of using 4 tasks (one task working with one shard each).</p>
</div>
<div class="paragraph">
<p>Note that the task parallelism gen number is defaulted to be 0 for the offsets saved in Kafka offset topic before offset-storage-per-task feature is enabled, there is a special offset lookup during offset migration.  So if you have the vitess connector running for a while without the offset-storage-per-task feature on and now you want to turn on this feature, please specify vitess.offset.storage.task.key.gen=1, vitess.prev.num.tasks=1 to help the offset auto migration.</p>
</div>
<div class="paragraph">
<p>Note that vitess.prev.num.tasks needs to match the actual number of tasks launched in the previous task parallelism generation.  The number of connector tasks is usually the same as the tasks.max config params you specified, but in the rare case that tasks.max &gt; number of vitess shards, the connector will only launch the_number_of_tasks = the_number_of_vitess_shards.  This rare case is probably a mis-configuration in the first place.</p>
</div>
<div class="paragraph">
<p>See the <a href="#vitess-connector-properties">complete list of Vitess connector properties</a> that can be specified in these configurations.</p>
</div>
<div class="paragraph">
<p>You can send this configuration with a <code>POST</code> command to a running Kafka Connect service. The service records the configuration and starts the connector task that connects to the Vitess database and streams change event records to Kafka topics.</p>
</div>
</div>
<div class="sect2">
<h3 id="vitess-adding-connector-configuration"><a class="anchor" href="#vitess-adding-connector-configuration"></a>Adding connector configuration</h3>
<div class="paragraph">
<p>To start running a Vitess connector, create a connector configuration and add the configuration to your Kafka Connect cluster.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The VTGate host and its gRPC port (default is 15991) is accessible from the machine where the Vitess connector is installed</p>
</li>
<li>
<p>The VTCtld host and its gRPC port (default is 15999) is accessible from the machine where the Vitess connector is installed</p>
</li>
<li>
<p>The Vitess connector is installed.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a configuration for the Vitess connector.</p>
</li>
<li>
<p>Use the <a href="https://kafka.apache.org/documentation/#connect_rest">Kafka Connect REST API</a> to add that connector configuration to your Kafka Connect cluster.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Results</div>
<p>When the connector starts, it starts generating data change events for row-level operations and streaming change event records to Kafka topics.</p>
</div>
</div>
<div class="sect2">
<h3 id="vitess-monitoring"><a class="anchor" href="#vitess-monitoring"></a>Monitoring</h3>
<div class="paragraph">
<p>The Debezium Vitess connector provides only one type of metrics that are in addition to the built-in support for JMX metrics that Zookeeper, Kafka, and Kafka Connect provide.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#vitess-streaming-metrics">Streaming metrics</a> provide information about connector operation when the connector is capturing changes and streaming change event records.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="../operations/monitoring.html#monitoring-debezium" class="xref page">Debezium monitoring documentation</a> provides details for how to expose these metrics by using JMX.</p>
</div>
</div>
<div class="sect2">
<h3 id="_customized_mbean_names"><a class="anchor" href="#_customized_mbean_names"></a>Customized MBean names</h3>
<div class="paragraph">
<p>Debezium connectors expose metrics via the MBean name for the connector.
These metrics, which are specific to each connector instance, provide data about the behavior of the connector&#8217;s snapshot, streaming, and schema history processes.</p>
</div>
<div class="paragraph">
<p>By default, when you deploy a correctly configured connector, Debezium generates a unique MBean name for each of the different connector metrics.
To view the metrics for a connector process, you configure your observability stack to monitor its MBean.
But these default MBean names depend on the connector configuration; configuration changes can result in changes to the MBean names.
A change to the MBean name breaks the linkage between the connector instance and the MBean, disrupting monitoring activity.
In this scenario, you must reconfigure the observability stack to use the new MBean name if you want to resume monitoring.</p>
</div>
<div class="paragraph">
<p>To prevent monitoring disruptions that result from MBean name changes, you can configure custom metrics tags.
You configure custom metrics by adding the <code>custom.metric.tags</code> property to the connector configuration.
The property accepts key-value pairs in which each key represents a tag for the MBean object name, and the corresponding value represents the value of that tag.
For example: <code>k1=v1,k2=v2</code>.
Debezium appends the specified tags to the MBean name of the connector.</p>
</div>
<div class="paragraph">
<p>After you configure the <code>custom.metric.tags</code> property for a connector, you can configure the observability stack to retrieve metrics associated with the specified tags.
The observability stack then uses the specified tags, rather than the mutable MBean names to uniquely identify connectors.
Later, if Debezium redefines how it constructs MBean names, or if the <code>topic.prefix</code> in the connector configuration changes, metrics collection is uninterrupted,
because the metrics scrape task uses the specified tag patterns to identify the connector.</p>
</div>
<div class="paragraph">
<p>A further benefit of using custom tags, is that you can use tags that reflect the architecture of your data pipeline, so that metrics are organized in a way that suits you operational needs.
For example, you might specify tags with values that declare the type of connector activity, the application context, or the data source, for example, <code>db1-streaming-for-application-abc</code>.
If you specify multiple key-value pairs, all of the specified pairs are appended to the connector&#8217;s MBean name.</p>
</div>
<div class="paragraph">
<p>The following example illustrates how tags modify the default MBean name.</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. How custom tags modify the connector MBean name</div>
<div class="content">
<div class="paragraph">
<p>By default, the Vitess connector uses the following MBean name for streaming metrics:
<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">debezium.vitess:type=connector-metrics,context=streaming,server=<em>&lt;topic.prefix&gt;</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you set the value of <code>custom.metric.tags</code> to <code>database=salesdb-streaming,table=inventory</code>, Debezium generates the following custom MBean name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">debezium.vitess:type=connector-metrics,context=streaming,server=<em>&lt;topic.prefix&gt;</em>,database=salesdb-streaming,table=inventory</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="vitess-streaming-metrics"><a class="anchor" href="#vitess-streaming-metrics"></a>Streaming metrics</h4>
<div class="paragraph">
<p>The <strong>MBean</strong> is <code>debezium.vitess:type=connector-metrics,context=streaming,server=<em>&lt;topic.prefix&gt;</em></code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 45%;">
<col style="width: 25%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attributes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-millisecondssincelastevent"></a><a href="#connectors-strm-metric-millisecondssincelastevent"><code>MilliSecondsSinceLastEvent</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of milliseconds since the connector has read and processed the most recent event.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-totalnumberofeventsseen"></a><a href="#connectors-strm-metric-totalnumberofeventsseen"><code>TotalNumberOfEventsSeen</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The total number of events that this connector has seen since last started or reset.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-numberofeventsfiltered"></a><a href="#connectors-strm-metric-numberofeventsfiltered"><code>NumberOfEventsFiltered</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of events that have been filtered by include/exclude list filtering rules configured on the connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-queuetotalcapacity"></a><a href="#connectors-strm-metric-queuetotalcapacity"><code>QueueTotalCapacity</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>int</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The length the queue used to pass events between the streamer and the main Kafka Connect loop.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-queueremainingcapacity"></a><a href="#connectors-strm-metric-queueremainingcapacity"><code>QueueRemainingCapacity</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>int</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The free capacity of the queue used to pass events between the streamer and the main Kafka Connect loop.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-connected"></a><a href="#connectors-strm-metric-connected"><code>Connected</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>boolean</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Flag that denotes whether the connector is currently connected to the database server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-millisecondsbehindsource"></a><a href="#connectors-strm-metric-millisecondsbehindsource"><code>MilliSecondsBehindSource</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of milliseconds between the last change event&#8217;s timestamp and the connector processing it.
The values will incorporate any differences between the clocks on the machines where the database server and the connector are running.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-numberofcommittedtransactions"></a><a href="#connectors-strm-metric-numberofcommittedtransactions"><code>NumberOfCommittedTransactions</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of processed transactions that were committed.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-maxqueuesizeinbytes"></a><a href="#connectors-strm-metric-maxqueuesizeinbytes"><code>MaxQueueSizeInBytes</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The maximum buffer of the queue in bytes used to pass events between the streamer and the main Kafka Connect loop.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-currentqueuesizeinbytes"></a><a href="#connectors-strm-metric-currentqueuesizeinbytes"><code>CurrentQueueSizeInBytes</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The current buffer of the queue in bytes used to pass events between the streamer and the main Kafka Connect loop.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="vitess-connector-properties"><a class="anchor" href="#vitess-connector-properties"></a>Connector configuration properties</h3>
<div class="paragraph">
<p>The Debezium Vitess connector has many configuration properties that you can use to achieve the right connector behavior for your application. Many properties have default values. Information about the properties is organized as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#vitess-required-configuration-properties">Required configuration properties</a></p>
</li>
<li>
<p><a href="#vitess-advanced-configuration-properties">Advanced configuration properties</a></p>
</li>
<li>
<p><a href="#vitess-pass-through-properties">Pass-through configuration properties</a></p>
</li>
</ul>
</div>
<div id="vitess-required-configuration-properties" class="paragraph">
<p>The following configuration properties are <em>required</em> unless a default value is available.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Required connector configuration properties</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 25%;">
<col style="width: 45%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-name"></a><a href="#vitess-property-name"><code>name</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No default</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Unique name for the connector. Attempting to register again with the same name will fail. This property is required by all Kafka Connect connectors.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-connector-class"></a><a href="#vitess-property-connector-class"><code>connector.class</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No default</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the Java class for the connector. Always use a value of <code>io.debezium.connector.vitess.VitessConnector</code> for the Vitess connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-tasks-max"></a><a href="#vitess-property-tasks-max"><code>tasks.max</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>1</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The maximum number of tasks that should be created for this connector. The Vitess connector can use more than 1 tasks if you enable offset.storage.per.task mode.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-database-hostname"></a><a href="#vitess-property-database-hostname"><code>database.hostname</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No default</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IP address or hostname of the Vitess database server (VTGate).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-database-port"></a><a href="#vitess-property-database-port"><code>database.port</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>15991</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Integer port number of the Vitess database server (VTGate).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-keyspace"></a><a href="#vitess-property-keyspace"><code>vitess.keyspace</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the keyspace from which to stream the changes.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-shard"></a><a href="#vitess-property-shard"><code>vitess.shard</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional name of the shard from which to stream the changes. If not configured, in case of unsharded keyspace, the connector streams changes from the only shard, in case of sharded keyspace, the connector streams changes from all shards in the keyspace. We recommend not configuring it in order to stream from all shards in the keyspace because it has better support for reshard operation. If configured, for example, <code>-80</code>, the connector will stream changes from the <code>-80</code> shard.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-gtid"></a><a href="#vitess-property-gtid"><code>vitess.gtid</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>current</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional GTID position for a shard to stream from. This has to be set together with <code>vitess.shard</code>. If not configured, the connector streams changes from the latest position for the given shard.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-stop-on-reshard"></a><a href="#vitess-property-stop-on-reshard"><code>vitess.stop_on_reshard</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>false</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Controls Vitess flag stop_on_reshard.<br>
<br>
<code>true</code> - the stream will be stopped after a reshard operation. <br>
<br>
<code>false</code> - the stream will be automatically migrated for the new shards after a reshard operation.<br>
<br>
If set to <code>true</code>, you should also consider setting <code>vitess.gtid</code> in the configuration.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-database-user"></a><a href="#vitess-property-database-user"><code>vitess.database.user</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional username of the Vitess database server (VTGate). If not configured, unauthenticated VTGate gRPC is used.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-database-password"></a><a href="#vitess-property-database-password"><code>vitess.database.password</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional password of the Vitess database server (VTGate). If not configured, unauthenticated VTGate gRPC is used.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-tablet-type"></a><a href="#vitess-property-tablet-type"><code>vitess.tablet.type</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>MASTER</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The type of Tablet (hence MySQL) from which to stream the changes:<br>
<br>
<code>MASTER</code> represents streaming from the master MySQL instance<br>
<br>
<code>REPLICA</code> represents streaming from the replica slave MySQL instance<br>
<br>
<code>RDONLY</code>  represents streaming from the read-only slave MySQL instance.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-topic-prefix"></a><a href="#vitess-property-topic-prefix"><code>topic.prefix</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No default</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Topic prefix that provides a namespace for the particular Vitess database server or cluster in which Debezium is capturing changes.
Only alphanumeric characters, hyphens, dots and underscores must be used in the database server logical name.
The prefix should be unique across all other connectors, since it is used as a topic name prefix for all Kafka topics that receive records from this connector.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not change the value of this property.
If you change the name value, after a restart, instead of continuing to emit events to the original topics, the connector emits subsequent events to topics whose names are based on the new value.</p>
</div>
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-table-include-list"></a><a href="#vitess-property-table-include-list"><code>table.include.list</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No default</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match fully-qualified table identifiers for tables whose changes you want to capture. Any table not included in <code>table.include.list</code> does not have its changes captured. Each identifier is of the form <em>keyspace</em>.<em>tableName</em>. By default, the connector captures changes in every non-system table in each schema whose changes are being captured. Do not also set the <code>table.exclude.list</code> property.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-table-exclude.list"></a><a href="#vitess-property-table-exclude.list"><code>table.exclude.list</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No default</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match fully-qualified table identifiers for tables whose changes you <strong>do not</strong> want to capture. Any table not included in <code>table.exclude.list</code> has it changes captured. Each identifier is of the form <em>keyspace</em>.<em>tableName</em>. Do not also set the <code>table.include.list</code> property.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-column-include-list"></a><a href="#vitess-property-column-include-list"><code>column.include.list</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No default</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match the fully-qualified names of columns that should be included in change event record values. Fully-qualified names for columns are of the form <em>keyspace</em>.<em>tableName</em>.<em>columnName</em>. Do not also set the <code>column.exclude.list</code> property.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-column-exclude-list"></a><a href="#vitess-property-column-exclude-list"><code>column.exclude.list</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No default</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match the fully-qualified names of columns that should be excluded from change event record values. Fully-qualified names for columns are of the form <em>keyspace</em>.<em>tableName</em>.<em>columnName</em>. Do not also set the <code>column.include.list</code> property.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-column-truncate-to-length-chars"></a><a href="#vitess-property-column-truncate-to-length-chars"><code>column.truncate.to.<em>length</em>.chars</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match the fully-qualified names of character-based columns.
Set this property if you want to truncate the data in a set of columns when it exceeds the number of characters specified by the <em>length</em> in the property name.
Set <code>length</code> to a positive integer value, for example, <code>column.truncate.to.20.chars</code>.</p>
</div>
<div class="paragraph">
<p>The fully-qualified name of a column observes the following format: <em>databaseName</em>.<em>tableName</em>.<em>columnName</em>.
To match the name of a column, Debezium applies the regular expression that you specify as an <em>anchored</em> regular expression.
That is, the specified expression is matched against the entire name string of the column; the expression does not match substrings that might be present in a column name.</p>
</div>
<div class="paragraph">
<p>You can specify multiple properties with different lengths in a single configuration.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-tombstones-on-delete"></a><a href="#vitess-property-tombstones-on-delete"><code>tombstones.on.delete</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>true</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Controls whether a <em>delete</em> event is followed by a tombstone event.<br>
<br>
<code>true</code> - a delete operation is represented by a <em>delete</em> event and a subsequent tombstone event. <br>
<br>
<code>false</code> - only a <em>delete</em> event is emitted.<br>
<br>
After a source record is deleted, emitting a tombstone event (the default behavior) allows Kafka to completely delete all events that pertain to the key of the deleted row in case <a href="https://kafka.apache.org/documentation/#compaction">log compaction</a> is enabled for the topic.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-offset-storage-per-task"></a><a href="#vitess-property-offset-storage-per-task"><code>vitess.offset.storage.per.task</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>false</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specify whether to turn on offset-storage-per-task mode launch multiple connector tasks and persist offsets partitioned by task.<br>
<br>
<code>true</code> - turn on offset-storage-per-task mode. <br>
<br>
<code>false</code> - do not use offset-storage-per-task mode.<br>
<br>
You will also you also need to specify vitess.offset.storage.task.key.gen and vitess.prev.num.tasks params if you turn on offset-storage-per-task mode.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-offset-storage-task-key-gen"></a><a href="#vitess-property-offset-storage-task-key-gen"><code>vitess.offset.storage.task.key.gen</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>-1</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specify the task paralleism generation number when vitess.offset.storage.per.task is turned on. You should increase the generation number when you decide to change the connector task parallelism (either launch more connector tasks or less)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-prev-num-tasks"></a><a href="#vitess-property-prev-num-tasks"><code>vitess.prev.num.tasks</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>-1</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specify the number of connector tasks used in the previous generation of task paralleism when vitess.offset.storage.per.task is turned on.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-message-key-columns"></a><a href="#vitess-property-message-key-columns"><code>message.key.columns</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>empty string</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A semicolon separated list of tables with regular expressions that match table column names. The connector maps values in matching columns to key fields in change event records that it sends to Kafka topics. This is useful when a table does not have a primary key, or when you want to order change event records in a Kafka topic according to a field that is not a primary key.<br>
<br>
Separate entries with semicolons. Insert a colon between the fully-qualified table name and its regular expression. The format is:<br>
<br>
<em>keyspace-name</em>.<em>table-name</em>:_regexp_;&#8230;&#8203;<br>
<br>
For example,<br>
<br>
<code>keyspaceA.table_a:regex_1;keyspaceA.table_b:regex_2;keyspaceA.table_c:regex_3</code><br>
<br>
If <code>table_a</code> has a an <code>id</code> column, and <code>regex_1</code> is <code>^i</code> (matches any column that starts with <code>i</code>), the connector maps the value in <code>table_a</code>'s <code>id</code> column to a key field in change events that the connector sends to Kafka.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-schema-name-adjustment-mode"></a><a href="#vitess-property-schema-name-adjustment-mode"><code>schema.name.adjustment.mode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>none</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies how schema names should be adjusted for compatibility with the message converter used by the connector. Possible settings: <br></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>none</code> does not apply any adjustment.<br></p>
</li>
<li>
<p><code>avro</code> replaces the characters that cannot be used in the Avro type name with underscore.<br></p>
</li>
<li>
<p><code>avro_unicode</code> replaces the underscore or characters that cannot be used in the Avro type name with corresponding unicode like _uxxxx. Note: _ is an escape sequence like backslash in Java<br></p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-field-name-adjustment-mode"></a><a href="#vitess-property-field-name-adjustment-mode"><code>field.name.adjustment.mode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>none</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies how field names should be adjusted for compatibility with the message converter used by the connector. Possible settings: <br></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>none</code> does not apply any adjustment.<br></p>
</li>
<li>
<p><code>avro</code> replaces the characters that cannot be used in the Avro type name with underscore.<br></p>
</li>
<li>
<p><code>avro_unicode</code> replaces the underscore or characters that cannot be used in the Avro type name with corresponding unicode like _uxxxx. Note: _ is an escape sequence like backslash in Java<br></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="../configuration/avro.html#avro-naming" class="xref page">Avro naming</a> for more details.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-snapshot-mode"></a><a href="#vitess-property-snapshot-mode"><code>snapshot.mode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>initial</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies the criteria for performing a snapshot when the connector starts.
Set the property to one of the following values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>initial</code></dt>
<dd>
<p>When the connector starts, if it does not detect a value in its offsets topic, it performs a snapshot of the database.</p>
</dd>
<dt class="hdlist1"><code>never</code></dt>
<dd>
<p>When the connector starts, it skips the snapshot process and immediately begins to stream change events for operations that the database records to the binary logs.</p>
</dd>
</dl>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-time-precision-mode"></a><a href="#vitess-property-time-precision-mode"><code>time.precision.mode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>adaptive_time_microseconds</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>You can set the following options to determine how Debezium represents the precision of time, date, and timestamp values:<br></p>
</div>
<div class="paragraph">
<p>+
<code>adaptive_time_microseconds</code>::
(Default) Captures date, datetime, and timestamp values exactly as they exist in the database.
Values are represented with a precision in milliseconds, microseconds, or nanoseconds, depending on the database column type, with the exception of <code>TIME</code> type fields, which are always captured as microseconds.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>connect</code></dt>
<dd>
<p>Time and timestamp values are always represented in the default Kafka Connect formats for Time, Date, and Timestamp, which use millisecond precision regardless of the database columns' precision.</p>
</dd>
</dl>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-bigint-unsigned-handling-mode"></a><a href="#vitess-property-bigint-unsigned-handling-mode"><code>bigint.unsigned.handling.mode.mode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>string</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specify how BIGINT UNSIGNED columns should be represented in change events.<br>
Set the property to one of the following values:<br>
<br>
<code>string</code>::<br>
represent values using Java&#8217;s <code>string</code><br>
<br>
<code>long</code>::<br>
represents values using Java&#8217;s <code>long</code>, which may not offer the precision but will be far easier to use in consumers.<br>
<br>
<code>precise</code>::<br>
represents values as precise (Java&#8217;s 'BigDecimal') values. This is precise but difficult to use.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div id="vitess-advanced-configuration-properties" class="paragraph">
<p>The following <em>advanced</em> configuration properties have defaults that work in most situations and therefore rarely need to be specified in the connector&#8217;s configuration.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Advanced connector configuration properties</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-converters"></a><a href="#vitess-property-converters"><code>converters</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No default</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Enumerates a comma-separated list of the symbolic names of the <a href="../development/converters.html#custom-converters" class="xref page">custom converter</a> instances that the connector can use.
For example,<br></p>
</div>
<div class="paragraph">
<p><code>isbn</code></p>
</div>
<div class="paragraph">
<p>You must set the <code>converters</code> property to enable the connector to use a custom converter.</p>
</div>
<div class="paragraph">
<p>For each converter that you configure for a connector, you must also add a <code>.type</code> property, which specifies the fully-qualified name of the class that implements the converter interface.
The <code>.type</code> property uses the following format:<br></p>
</div>
<div class="paragraph">
<p><code><em>&lt;converterSymbolicName&gt;</em>.type</code><br></p>
</div>
<div class="paragraph">
<p>For example,<br></p>
</div>
<div class="literalblock">
<div class="content">
<pre>isbn.type: io.debezium.test.IsbnConverter</pre>
</div>
</div>
<div class="paragraph">
<p>If you want to further control the behavior of a configured converter, you can add one or more configuration parameters to pass values to the converter.
To associate any additional configuration parameter with a converter, prefix the parameter names with the symbolic name of the converter.
For example,<br></p>
</div>
<div class="literalblock">
<div class="content">
<pre>isbn.schema.name: io.debezium.vitess.type.Isbn</pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-event-processing-failure-handling-mode"></a><a href="#vitess-property-event-processing-failure-handling-mode"><code>event.processing.failure.handling.mode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>fail</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies how the connector should react to exceptions during processing of events:<br>
<br>
<code>fail</code> propagates the exception, indicates the offset of the problematic event, and causes the connector to stop.<br>
<br>
<code>warn</code> logs the offset of the problematic event, skips that event, and continues processing.<br>
<br>
<code>skip</code> skips the problematic event and continues processing.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-max-queue-size"></a><a href="#vitess-property-max-queue-size"><code>max.queue.size</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>20240</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Positive integer value that specifies the maximum number of records that the blocking queue can hold.
When Debezium reads events streamed from the database, it places the events in the blocking queue before it writes them to Kafka.
The blocking queue can provide backpressure for reading change events from the database
in cases where the connector ingests messages faster than it can write them to Kafka, or when Kafka becomes unavailable.
Events that are held in the queue are disregarded when the connector periodically records offsets.
Always set the value of <code>max.queue.size</code> to be larger than the value of <a href="#vitess-property-max-batch-size"><code>max.batch.size</code></a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-max-batch-size"></a><a href="#vitess-property-max-batch-size"><code>max.batch.size</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>2048</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Positive integer value that specifies the maximum size of each batch of events that the connector processes.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-max-queue-size-in-bytes"></a><a href="#vitess-property-max-queue-size-in-bytes"><code>max.queue.size.in.bytes</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>0</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A long integer value that specifies the maximum volume of the blocking queue in bytes.
By default, volume limits are not specified for the blocking queue.
To specify the number of bytes that the queue can consume, set this property to a positive long value.<br>
If <a href="#vitess-property-max-queue-size"><code>max.queue.size</code></a> is also set, writing to the queue is blocked when the size of the queue reaches the limit specified by either property.
For example, if you set <code>max.queue.size=1000</code>, and <code>max.queue.size.in.bytes=5000</code>, writing to the queue is blocked after the queue contains 1000 records, or after the volume of the records in the queue reaches 5000 bytes.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-poll-interval-ms"></a><a href="#vitess-property-poll-interval-ms"><code>poll.interval.ms</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>500</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Positive integer value that specifies the number of milliseconds the connector should wait for new change events to appear before it starts processing a batch of events. Defaults to 500 milliseconds, or 0.5 second.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-skipped-operations"></a><a href="#vitess-property-skipped-operations"><code>skipped.operations</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>t</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A comma-separated list of operation types that will be skipped during streaming.
The operations include: <code>c</code> for inserts/create, <code>u</code> for updates, <code>d</code> for deletes, <code>t</code> for truncates, and <code>none</code> to not skip any operations.
By default, truncate operations are skipped (not emitted by this connector).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-provide-transaction-metadata"></a><a href="#vitess-property-provide-transaction-metadata"><code>provide.transaction.metadata</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>false</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Determines whether the connector generates events with transaction boundaries and enriches change event envelopes with transaction metadata. Specify <code>true</code> if you want the connector to do this. See <a href="#vitess-transaction-metadata">Transaction metadata</a> for details.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-transaction-metadata-factory"></a><a href="#vitess-property-transaction-metadata-factory"><code>transaction.metadata.factory</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.pipeline.txmetadata.DefaultTransactionMetadataFactory</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Determines the class that the connector uses to track transaction context and build the data structures and schemas to represent transactions.
<code>io.debezium.connector.vitess.pipeline.txmetadata.VitessOrderedTransactionMetadataFactory</code> provides additional transaction metadata that can help consumers to interpret the correct order of two events, regardless of the order in which they are consumed.
For more information, see <a href="#vitess-ordered-transaction-metadata">Ordered transaction metadata</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-keepalive-interval-ms"></a><a href="#vitess-property-keepalive-interval-ms"><code>vitess.keepalive.interval.ms</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Long.MAX_VALUE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Control the interval between periodic gPRC keepalive pings for VStream. Defaults to <code>Long.MAX_VALUE</code> (disabled).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-grpc-headers"></a><a href="#vitess-property-grpc-headers"><code>vitess.grpc.headers</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No default</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specify a comma-separated list of gRPC headers. Defaults to empty. The format is:<br>
<br>
<em>key1:value1,key2:value2</em>,&#8230;&#8203;<br>
<br>
For example,<br>
<br>
<code>x-envoy-upstream-rq-timeout-ms:0,x-envoy-max-retries:2</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-grpc-max-inbound-message-size"></a><a href="#vitess-property-grpc-max-inbound-message-size"><code>vitess.grpc.max_inbound_message_size</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No default</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specify the maximum message size in bytes allowed to be received on the channel.<br>
<br>
Default is 4MiB</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-column-propagate-source-type"></a><a href="#vitess-property-column-propagate-source-type"><code>column.propagate.source.type</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match the fully-qualified names of columns whose original type and length should be added as a parameter to the corresponding field schemas in the emitted change event records. These schema parameters:</p>
</div>
<div class="paragraph">
<p><code>__debezium.source.column.type</code></p>
</div>
<div class="paragraph">
<p>are used to propagate the original type name and length for variable-width types, respectively. This is useful to properly size corresponding columns in sink databases. Fully-qualified names for columns are of the following form:</p>
</div>
<div class="paragraph">
<p><em>keyspaceName</em>.<em>tableName</em>.<em>columnName</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-datatype-propagate-source-type"></a><a href="#vitess-property-datatype-propagate-source-type"><code>datatype.propagate.source.type</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match the database-specific data type name of columns whose original type and length should be added as a parameter to the corresponding field schemas in the emitted change event records. These schema parameters:</p>
</div>
<div class="paragraph">
<p><code>__debezium.source.column.type</code></p>
</div>
<div class="paragraph">
<p>are used to propagate the original type name and length for variable-width types, respectively. This is useful to properly size corresponding columns in sink databases. Fully-qualified names for columns are of the following form:</p>
</div>
<div class="paragraph">
<p><em>keyspaceName</em>.<em>tableName</em>.<em>columnName</em></p>
</div>
<div class="paragraph">
<p>See <a href="#vitess-data-types">how Vitess connectors map data types</a> for the list of Vitess-specific data type names.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-topic-naming-strategy"></a><a href="#vitess-property-topic-naming-strategy"><code>topic.naming.strategy</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.schema.SchemaTopicNamingStrategy</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the TopicNamingStrategy class that should be used to determine the topic name for data change, schema change, transaction, heartbeat event etc., defaults to <code>SchemaTopicNamingStrategy</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-override-data-change-topic-prefix"></a><a href="#vitess-property-override-data-change-topic-prefix"><code>override.data.change.topic.prefix</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No default</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies the prefix that the connector uses to create the names of data change topics when <a href="#vitess-property-topic-naming-strategy">topic.naming.strategy</a> is set to <code>io.debezium.connector.vitess.TableTopicNamingStrategy</code>.
The connector uses the value of this property instead of the specified <a href="#vitess-property-topic-prefix"><code>topic.prefix</code></a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-topic-delimiter"></a><a href="#vitess-property-topic-delimiter"><code>topic.delimiter</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>.</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specify the delimiter for topic name, defaults to <code>.</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-topic-cache-size"></a><a href="#vitess-property-topic-cache-size"><code>topic.cache.size</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>10000</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The size used for holding the topic names in bounded concurrent hash map. This cache will help to determine the topic name corresponding to a given data collection.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-topic-transaction"></a><a href="#vitess-property-topic-transaction"><code>topic.transaction</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>transaction</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Controls the name of the topic to which the connector sends transaction metadata messages. The topic name has this pattern:<br>
<br>
<em>topic.prefix</em>.<em>topic.transaction</em><br>
<br>
For example, if the topic prefix is <code>fulfillment</code>, the default topic name is <code>fulfillment.transaction</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-custom-metric-tags"></a><a href="#vitess-property-custom-metric-tags"><code>custom.metric.tags</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>No default</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The custom metric tags will accept key-value pairs to customize the MBean object name which should be appended the end of regular name, each key would represent a tag for the MBean object name, and the corresponding value would be the value of that tag the key is. For example: <code>k1=v1,k2=v2</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="vitess-property-errors-max-retires"></a><a href="#vitess-property-errors-max-retires"><code>errors.max.retries</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>-1</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies how the connector responds after an operation that results in a retriable error, such as a connection error.<br>
Set one of the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-1</code></dt>
<dd>
<p>No limit. The connector always restarts automatically, and retries the operation, regardless of the number of previous failures.</p>
</dd>
<dt class="hdlist1"><code>0</code></dt>
<dd>
<p>Disabled. The connector fails immediately, and never retries the operation.
User intervention is required to restart the connector.</p>
</dd>
<dt class="hdlist1"><code>&gt; 0</code></dt>
<dd>
<p>The connector restarts automatically until it reaches the specified maximum number of retries.
After the next failure, the connector stops, and user intervention is required to restart it.</p>
</dd>
</dl>
</div></div></td>
</tr>
</tbody>
</table>
<div id="vitess-pass-through-properties" class="paragraph">
<div class="title">Pass-through connector configuration properties</div>
<p>The connector also supports <em>pass-through</em> configuration properties that are used when creating the Kafka producer and consumer.</p>
</div>
<div class="paragraph">
<p>Be sure to consult the <a href="https://kafka.apache.org/documentation.html">Kafka documentation</a> for all of the configuration properties for Kafka producers and consumers. The Vitess connector does use the <a href="https://kafka.apache.org/documentation.html#consumerconfigs">new consumer configuration properties</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vitess-when-things-go-wrong"><a class="anchor" href="#vitess-when-things-go-wrong"></a>Behavior when things go wrong</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Debezium is a distributed system that captures all changes in multiple upstream databases; it never misses or loses an event. When the system is operating normally or being managed carefully then Debezium provides <em>exactly once</em> delivery of every change event record.</p>
</div>
<div class="paragraph">
<p>If a fault does happen then the system does not lose any events. However, while it is recovering from the fault, it might repeat some change events. In these abnormal situations, Debezium, like Kafka, provides <em>at least once</em> delivery of change events.</p>
</div>
<div class="paragraph">
<p>The rest of this section describes how Debezium handles various kinds of faults and problems.</p>
</div>
<div class="sect2">
<h3 id="vitess-connector-configuration-and-startup-errors"><a class="anchor" href="#vitess-connector-configuration-and-startup-errors"></a>Configuration and startup errors</h3>
<div class="paragraph">
<p>In the following situations, the connector fails when trying to start, reports an error/exception in the log, and stops running:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The connector&#8217;s configuration is invalid.</p>
</li>
<li>
<p>The connector cannot successfully connect to Vitess by using the specified connection parameters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In these cases, the error message has details about the problem and possibly a suggested workaround. After you correct the configuration or address the Vitess problem, restart the connector.</p>
</div>
</div>
<div class="sect2">
<h3 id="vitess-becomes-unavailable"><a class="anchor" href="#vitess-becomes-unavailable"></a>Vitess becomes unavailable</h3>
<div class="paragraph">
<p>When the connector is running, the Vitses server (VTGate) that it is connected to could become unavailable for any number of reasons. If this happens, the connector fails with an error and stops. When the server is available again, restart the connector.</p>
</div>
<div class="paragraph">
<p>The Vitess connector externally stores the last processed offset in the form of a Vitess VGTID. After a connector restarts and connects to a server instance, the connector communicates with the server to continue streaming from that particular offset.</p>
</div>
</div>
<div class="sect2">
<h3 id="invalid-column-name-error"><a class="anchor" href="#invalid-column-name-error"></a>Invalid column name error</h3>
<div class="paragraph">
<p>This error happens very rarely. If you receive an error with the message <code>Illegal prefix '@' for column: x, from schema: y, table: z</code>, and your table doesn&#8217;t have such a column, it is a Vitess vstream <a href="https://vitess.slack.com/archives/C0PQY0PTK/p1606817216038500">bug</a> that is caused by column renaming or column type change. It is a transient error. You can restart the connector after a small backoff and it should resolve automatically.</p>
</div>
</div>
<div class="sect2">
<h3 id="vitess-kafka-connect-process-stops-gracefully"><a class="anchor" href="#vitess-kafka-connect-process-stops-gracefully"></a>Kafka Connect process stops gracefully</h3>
<div class="paragraph">
<p>Suppose that Kafka Connect is being run in distributed mode and a Kafka Connect process is stopped gracefully. Prior to shutting down that process, Kafka Connect migrates the process&#8217;s connector tasks to another Kafka Connect process in that group. The new connector tasks start processing exactly where the prior tasks stopped. There is a short delay in processing while the connector tasks are stopped gracefully and restarted on the new processes.</p>
</div>
</div>
<div class="sect2">
<h3 id="vitess-kafka-connect-process-crashes"><a class="anchor" href="#vitess-kafka-connect-process-crashes"></a>Kafka Connect process crashes</h3>
<div class="paragraph">
<p>If the Kafka Connector process stops unexpectedly, any connector tasks it was running terminate without recording their most recently processed offsets. When Kafka Connect is being run in distributed mode, Kafka Connect restarts those connector tasks on other processes. However, Vitess connectors resume from the last offset that was <em>recorded</em> by the earlier processes. This means that the new replacement tasks might generate some of the same change events that were processed just prior to the crash. The number of duplicate events depends on the offset flush period and the volume of data changes just before the crash.</p>
</div>
<div class="paragraph">
<p>Because there is a chance that some events might be duplicated during a recovery from failure, consumers should always anticipate some duplicate events. Debezium changes are idempotent, so a sequence of events always results in the same state.</p>
</div>
<div class="paragraph">
<p>In each change event record, Debezium connectors insert source-specific information about the origin of the event, including the Vitess server&#8217;s time of the event, the position in the binlog where the transaction changes were written. Consumers can keep track of this information, especially the VGTID, to determine whether an event is a duplicate.</p>
</div>
</div>
<div class="sect2">
<h3 id="vitess-kafka-becomes-unavailable"><a class="anchor" href="#vitess-kafka-becomes-unavailable"></a>Kafka becomes unavailable</h3>
<div class="paragraph">
<p>As the connector generates change events, the Kafka Connect framework records those events in Kafka by using the Kafka producer API. Periodically, at a frequency that you specify in the Kafka Connect configuration, Kafka Connect records the latest offset that appears in those change events. If the Kafka brokers become unavailable, the Kafka Connect process that is running the connectors repeatedly tries to reconnect to the Kafka brokers. In other words, the connector tasks pause until a connection can be re-established, at which point the connectors resume exactly where they left off.</p>
</div>
</div>
<div class="sect2">
<h3 id="vitess-connector-is-stopped-for-a-duration"><a class="anchor" href="#vitess-connector-is-stopped-for-a-duration"></a>Connector is stopped for a duration</h3>
<div class="paragraph">
<p>If the connector is gracefully stopped, the database can continue to be used. Any changes are recorded in the Vitess binlog. When the connector restarts, it resumes streaming changes where it left off. That is, it generates change event records for all database changes that were made while the connector was stopped.</p>
</div>
<div class="paragraph">
<p>A properly configured Kafka cluster is able to handle massive throughput. Kafka Connect is written according to Kafka best practices, and given enough resources a Kafka Connect connector can also handle very large numbers of database change events. Because of this, after being stopped for a while, when a Debezium connector restarts, it is very likely to catch up with the database changes that were made while it was stopped. How quickly this happens depends on the capabilities and performance of Kafka and the volume of changes being made to the data in Vitess.</p>
</div>
</div>
<div class="sect2">
<h3 id="vitess-connector-failed-before-finishing-the-snapshot"><a class="anchor" href="#vitess-connector-failed-before-finishing-the-snapshot"></a>Connector fails before finishing the snapshot</h3>
<div class="paragraph">
<p>If a snapshot fails to complete, the connector does not automatically reattempt the snapshot.
If the connector is restarted with the previous offset, the connector skips the snapshot process and immediately begins to stream change events.</p>
</div>
<div class="paragraph">
<p>Consequently, to recover from the failure, <a href="https://debezium.io/documentation/faq/#how_to_remove_committed_offsets_for_a_connector/">remove the connector offsets manually</a> and start the connector.</p>
</div>
</div>
<div class="sect2">
<h3 id="limitations-with-earlier-vitess-versions"><a class="anchor" href="#limitations-with-earlier-vitess-versions"></a>Limitations with earlier Vitess versions</h3>
<div class="ulist">
<div class="title">Vitess 8.0.0</div>
<ul>
<li>
<p>Due to a minor Vitess padding issue (which is fixed in Vitess 9.0.0), decimal values with a precision that is greater than or equal to 13 will cause extra whitespaces in front of the number. E.g. if the column type is <code>decimal(13,4)</code> in the table definition, the value <code>-1.2300</code> becomes <code>"-        1.2300"</code>, and the value <code>1.2300</code> becomes <code>"        1.2300"</code>.</p>
</li>
<li>
<p>Does not support the <code>JSON</code> column type.</p>
</li>
<li>
<p>VStream 8.0.0 doesn&#8217;t provide additional metadata of permitted values for <code>ENUM</code> columns.
Therefore, the Connector does not support the <code>ENUM</code> column type.
The index number (1-based) will be emitted instead of the enumeration value.
E.g. <code>"3"</code> will be emitted as the value instead of <code>"L"</code> if the <code>ENUM</code> definition is <code>enum('S','M','L')</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</article>
</div>
<div class="article-cell2">
</div>
</div>

<div id="toc-rightbar"></div>    <footer class="footer">
        <div class="wrapper">
            <div class="copyright">Copyright &copy; 2024 Debezium Community (Rev: <span class="truncated"><a href="https://github.com/debezium/debezium/commit/05db5f5d7d2dbdae5dee4ed39e86647ede730146">05db5f5d</a></span>)
            
        </div>
    </footer>
</main></div>
<script>
    /* Make sure TOC carets are expanded if sub-elements exist */
    $("#toc").each(function(i,v) {
      $(this).closest('article').addClass('with-toc');
    });

    $("#toc ul.sectlevel1 > li").each(function(i,v) {
      $(this).has("ul").addClass("expanded");
    });

    $(function() {
        /* Expands all the documentation submenus */
        $(".nav-list > .nav-item:not(.is-active) .nav-item-toggle").click();
    });

    /**
     * This checks if a "#toc" element exists in the DOM and if so:
     *
     *  1. Appends a cloned copy of the #toc node to the #toc-rightbar div.
     *  2. Forces the #toc-rightbar div to be visible.
     *  3. Adds the .toc-right class to the #article-wrapper div to restrict the article's overall width.
     */
    var $toc = $("#toc");
    if ( $toc.length ) {
        $("#toc-rightbar").append($toc.clone());
        $("body .main").addClass("with-toc");
    }

    /**
     * In order to make CSS changes that are backward compatible with old adoc files, this applies a version
     * style to the body tag so we can use it to differentiate between CSS styles per version if needed,
     * such as tfoot rows.
     */
    var $version = $("body .nav-container").data("version");
    var $versionClass = "version-" + $version;
    $versionClass = $versionClass.replace('.','-');
    $("body").addClass($versionClass);

    /** A CSS trick to wrap long-width tables in a div that can be scrolled on smaller screens */
    $("table.tableblock").wrap("<div class='table-scroll-wrapper'></div>");

    $(function() {
        /* apply floating scrollbar to the scroll-wrapper */
        $(".table-scroll-wrapper").floatingScrollbar();
    });

</script>
<script src="../../debezium-antora/js/site.js"></script>
<script async src="../../debezium-antora/js/vendor/highlight.js"></script>

<script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
  try {
    var pageTracker = _gat._getTracker("UA-10656779-1");
    pageTracker._trackPageview();
  } catch(err) {}
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-76464546-1', 'auto');
  ga('send', 'pageview');
  ga('set', 'anonymizeIp', true);
  ga('require', 'linkid', 'linkid.js');
</script>
</body>
</html>