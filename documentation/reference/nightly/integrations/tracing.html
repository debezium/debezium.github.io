<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Distributed Tracing :: Debezium Documentation</title>
    <link rel="canonical" href="https://debezium.io/documentation/reference/stable/integrations/tracing.html">
    <meta name="generator" content="Antora 3.0.0-alpha.9">
<link rel="stylesheet" href="../../debezium-antora/css/site.css">
<link rel="stylesheet" href="../../debezium-antora/css/debezium-antora.css">
<link rel="stylesheet" href="../../debezium-antora/css/highlightjs-dark.css">
<link rel="stylesheet" href="https://static.jboss.org/css/rhbar.css">
<script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.js"></script>
<script src="../../debezium-antora/js/jquery.ba-floatingscrollbar.js"></script>
</head>
<body class="article">
<header class="header">
  <div id="rhbar">
      <a class="jbdevlogo" href="https://developers.redhat.com"></a>
      <a class="rhlogo" href="https://www.redhat.com"></a>
  </div>
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
          <img src="/assets/images/color_white_debezium_type_600px.svg" style="height: 32px; margin-right: 14px;"/>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="/documentation/faq">FAQ</a>
        <a class="navbar-item" href="/documentation">DOCUMENTATION</a>
        <a class="navbar-item" href="/releases">RELEASES</a>
        <a class="navbar-item" href="/community">COMMUNITY</a>
        <a class="navbar-item" href="/blog">BLOG</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="reference" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Debezium nightly Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tutorial.html">Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../install.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../postgres-plugins.html">PostgreSQL Decoding Plugins</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../features.html">Features</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/avro.html">Avro Serialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/topic-auto-create-config.html">Customizing Topic Auto-Creation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/signalling.html">Sending Signals to Debezium</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/notification.html">Receive notifications from Debezium</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Connectors</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/mysql.html">MySQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/mongodb.html">MongoDB</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/postgresql.html">PostgreSQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/oracle.html">Oracle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/sqlserver.html">SQL Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/db2.html">Db2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/cassandra.html">Cassandra</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/vitess.html">Vitess</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/spanner.html">Spanner</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/jdbc.html">Jdbc</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Transformations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/topic-routing.html">Topic Routing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/event-flattening.html">New Record State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/mongodb-event-flattening.html">MongoDB New Document State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/event-changes.html">Event Changes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/outbox-event-router.html">Outbox Event Router</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/mongodb-outbox-event-router.html">MongoDB Outbox Event Router</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/filtering.html">Message Filtering</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/schema-change-event-filter.html">Schema Change Event Filtering</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/content-based-routing.html">Content-Based Routing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/applying-transformations-selectively.html">Using SMT Predicates to Selectively Apply Transformations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/compute-partition.html">Compute Partition [Deprecated]</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/partition-routing.html">Partition Routing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/header-to-value.html">HeaderToValue</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/timezone-converter.html">Timezone Converter</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/timescaledb.html">TimescaleDB Integration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">API and SPI</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/engine.html">Debezium Engine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/converters.html">Custom Converters</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Integrations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="serdes.html">Change Event SerDes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="outbox.html">Outbox Quarkus Extension</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cloudevents.html">CloudEvents</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="tracing.html">OpenTelemetry</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="testcontainers.html">Integration Testing with Testcontainers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Operations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/debezium-server.html">Debezium Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/monitoring.html">Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/kubernetes.html">Running on Kubernetes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/openshift.html">Running on Openshift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/embedded.html">Embedding Debezium</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/debezium-ui.html">Debezium UI</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Debezium Documentation</span>
    <span class="version">nightly</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Debezium Documentation</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="/documentation/reference/nightly/index.html">nightly</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/2.5/index.html">2.5</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/2.4/index.html">2.4</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/2.3/index.html">2.3</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/2.2/index.html">2.2</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/2.1/index.html">2.1</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/2.0/index.html">2.0</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/1.9/index.html">1.9</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/1.8/index.html">1.8</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/1.7/index.html">1.7</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/1.6/index.html">1.6</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/1.5/index.html">1.5</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/1.4/index.html">1.4</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/1.3/index.html">1.3</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/1.1/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/1.0/index.html">1.0</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/0.10/index.html">0.10</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/0.9/index.html">0.9</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main" class="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../stable/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Debezium Documentation</a></li>
    <li>Integrations</li>
    <li><a href="tracing.html">OpenTelemetry</a></li>
  </ul>
</nav>
    <div class="page-versions-container">
    Version:
    <div class="page-versions">
        <button class="version-menu-toggle versions-menu-current" title="Show other versions of page">nightly</button>
        <div class="version-menu">
                <a class="version is-current" href="/documentation/reference/nightly/index.html">nightly</a>
                <a class="version" href="/documentation/reference/2.5/index.html">2.5</a>
                <a class="version" href="/documentation/reference/2.4/index.html">2.4</a>
                <a class="version" href="/documentation/reference/2.3/index.html">2.3</a>
                <a class="version" href="/documentation/reference/2.2/index.html">2.2</a>
                <a class="version" href="/documentation/reference/2.1/index.html">2.1</a>
                <a class="version" href="/documentation/reference/2.0/index.html">2.0</a>
                <a class="version" href="/documentation/reference/1.9/index.html">1.9</a>
                <a class="version" href="/documentation/reference/1.8/index.html">1.8</a>
                <a class="version" href="/documentation/reference/1.7/index.html">1.7</a>
                <a class="version" href="/documentation/reference/1.6/index.html">1.6</a>
                <a class="version" href="/documentation/reference/1.5/index.html">1.5</a>
                <a class="version" href="/documentation/reference/1.4/index.html">1.4</a>
                <a class="version is-missing" href="/documentation/reference/1.3/index.html">1.3</a>
                <a class="version is-missing" href="/documentation/reference/1.2/index.html">1.2</a>
                <a class="version is-missing" href="/documentation/reference/1.1/index.html">1.1</a>
                <a class="version is-missing" href="/documentation/reference/1.0/index.html">1.0</a>
                <a class="version is-missing" href="/documentation/reference/0.10/index.html">0.10</a>
                <a class="version is-missing" href="/documentation/reference/0.9/index.html">0.9</a>
        </div>
        |
    </div>
    </div>
  <div class="edit-this-page"><a href="https://github.com/debezium/debezium/edit/main/documentation/modules/ROOT/pages/integrations/tracing.adoc">Edit this Page</a></div>
  </div>
<div class="article-grid">
<div class="article-cell1">
<article class="doc">
        
    <div class="version-banner version-banner-development">
    You are viewing documentation for an unreleased version of Debezium.
    <br/>
            If you want to view the latest stable version of this page, please go <a href=/documentation/reference/stable/index.html>here</a>.
            
</div>            <h1 class="page">Distributed Tracing</h1>
        <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">Overview</a></li>
<li><a href="#_installation">Installation</a>
<ul class="sectlevel2">
<li><a href="#open-telemetry-manual-installation">Manual installation of OpenTelemetry</a></li>
<li><a href="#open-telemetry-docker-installation">Using Docker to install OpenTelemetry</a></li>
<li><a href="#open-telemetry-strimzi-installation">Using Strimzi to install Open Telemetry</a></li>
<li><a href="#_configuring_opentelemetry">Configuring OpenTelemetry</a></li>
</ul>
</li>
<li><a href="#_activatetracingspan_smt">ActivateTracingSpan SMT</a>
<ul class="sectlevel2">
<li><a href="#_kafka_producer_tracing">Kafka Producer tracing</a></li>
<li><a href="#_configuration_options">Configuration options</a></li>
</ul>
</li>
<li><a href="#_outbox_extension">Outbox Extension</a></li>
<li><a href="#_event_router_smt">Event Router SMT</a></li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Observability is an important aspect of microservice-oriented applications.
One of the key ingredients for observability is <a href="https://microservices.io/patterns/observability/distributed-tracing.html">distributed tracing</a>.</p>
</div>
<div class="paragraph">
<p>It is necessary to provide additional precautions when an application writes a record to a database that is later processed by Debezium.
The active trace is effectively demarcated by the write to the database.
If you want to include Debezium data in your application tracer, you must pass the trace metadata to Debezium.</p>
</div>
<div class="paragraph">
<p>You can add tracing support to Debezium through the <a href="https://opentelemetry.io/docs/specs/otel/">OpenTelemetry specification</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation"><a class="anchor" href="#_installation"></a>Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To enable traceability in Debezium, you must install the required OpenTelemetry API packages on your Kafka Connect cluster, together with the OpenTelemetry SDK.</p>
</div>
<div class="paragraph">
<p>There are three main methods for installing OpenTelemetry on Kafka Connect, each having its advantages:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#open-telemetry-manual-installation">Manual installation</a></dt>
<dd>
<p>Offers more control and customization.</p>
</dd>
<dt class="hdlist1"><a href="#open-telemetry-docker-installation">Docker installation</a></dt>
<dd>
<p>Provides easier integration.</p>
</dd>
<dt class="hdlist1"><a href="#open-telemetry-strimzi-installation">Strimzi installation</a></dt>
<dd>
<p>Presents a ready-to-use solution on Kubernetes that includes all of the necessary OpenTelemetry components.</p>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="open-telemetry-manual-installation"><a class="anchor" href="#open-telemetry-manual-installation"></a>Manual installation of OpenTelemetry</h3>
<div class="paragraph">
<p>A manual installation provides greater control and customization.</p>
</div>
<div class="sect3">
<h4 id="_installing_the_opentelemetry_api"><a class="anchor" href="#_installing_the_opentelemetry_api"></a>Installing the OpenTelemetry API</h4>
<div class="paragraph">
<p>Install the following packages to the Kafka Connect classpath:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://mvnrepository.com/artifact/io.opentelemetry/opentelemetry-api/">opentelemetry-api</a></p>
</li>
<li>
<p><a href="https://mvnrepository.com/artifact/io.opentelemetry/opentelemetry-context/">opentelemetry-context</a></p>
</li>
<li>
<p><a href="https://mvnrepository.com/artifact/io.opentelemetry/opentelemetry-semconv/">opentelemetry-semconv</a></p>
</li>
<li>
<p><a href="https://mvnrepository.com/artifact/io.opentelemetry.instrumentation/opentelemetry-instrumentation-api/">opentelemetry-instrumentation-api</a></p>
</li>
<li>
<p><a href="https://mvnrepository.com/artifact/io.opentelemetry.instrumentation/opentelemetry-instrumentation-api-semconv/">opentelemetry-instrumentation-api-semconv</a></p>
</li>
<li>
<p><a href="https://mvnrepository.com/artifact/io.opentelemetry.instrumentation/opentelemetry-kafka-clients-2.6/">opentelemetry-kafka-clients-2.6</a></p>
</li>
<li>
<p><a href="https://mvnrepository.com/artifact/io.opentelemetry.instrumentation/opentelemetry-kafka-clients-common/">opentelemetry-kafka-clients-common</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can download the OpenTelemetry packages directly from the Maven repository, or retrieve the packages by using the Maven dependency plugin to ensure version compatibility.</p>
</div>
<div class="sect4">
<h5 id="_using_the_maven_dependency_plugin"><a class="anchor" href="#_using_the_maven_dependency_plugin"></a>Using the Maven Dependency Plugin</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a POM file similar to the one in the following example.
In your version of the file, specify the version of the OpenTelemetry package that you want to use.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
 &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
 &lt;groupId&gt;group.id&lt;/groupId&gt;
 &lt;artifactId&gt;artifact-id&lt;/artifactId&gt;
 &lt;version&gt;0.0.1&lt;/version&gt;
 &lt;properties&gt;
  &lt;version.opentelemetry.api&gt;1.23.1&lt;/version.opentelemetry.api&gt;
  &lt;version.opentelemetry.kafka.clients.2.6&gt;1.23.0-alpha&lt;/version.opentelemetry.kafka.clients.2.6&gt;
 &lt;/properties&gt;
 &lt;dependencies&gt;
  &lt;dependency&gt;
   &lt;groupId&gt;io.opentelemetry&lt;/groupId&gt;
   &lt;artifactId&gt;opentelemetry-api&lt;/artifactId&gt;
   &lt;version&gt;${version.opentelemetry.api}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
   &lt;groupId&gt;io.opentelemetry.instrumentation&lt;/groupId&gt;
   &lt;artifactId&gt;opentelemetry-kafka-clients-2.6&lt;/artifactId&gt;
   &lt;version&gt;${version.opentelemetry.kafka.clients.2.6}&lt;/version&gt;
  &lt;/dependency&gt;
 &lt;/dependencies&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>In the directory that contains the <code>pom.xml</code> file, run the following command to download all dependencies (including transitives) to a specified directory (for example, <code>./lib</code>)</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn dependency:copy-dependencies -DoutputDirectory=./lib</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_installing_the_opentelemetry_sdk"><a class="anchor" href="#_installing_the_opentelemetry_sdk"></a>Installing the OpenTelemetry SDK</h4>
<div class="paragraph">
<p>After you install the API, install the OpenTelemetry SDK.
Install the OpenTelemetry SDK on your Kafka connect cluster by using the <a href="https://opentelemetry.io/docs/instrumentation/java/automatic/">Java agent</a> for automatic instrumentation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="open-telemetry-docker-installation"><a class="anchor" href="#open-telemetry-docker-installation"></a>Using Docker to install OpenTelemetry</h3>
<div class="paragraph">
<p>Prefer this installation method if you want to use Docker for local development or testing.</p>
</div>
<div class="paragraph">
<p>The OpenTelemetry API dependencies are installed in the <a href="https://quay.io/repository/debezium/connect">Debezium Kafka Connect</a> container image.
The JAR files are downloaded to a separate directory.
By default, the JAR files are not added to the class path.
To add the JAR files to the class path, set the environment variable <code>ENABLE_OTEL</code> to <code>true</code>.
You must also install the <a href="https://opentelemetry.io/docs/instrumentation/java/automatic/">OpenTelemetry Java agent</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="open-telemetry-strimzi-installation"><a class="anchor" href="#open-telemetry-strimzi-installation"></a>Using Strimzi to install Open Telemetry</h3>
<div class="paragraph">
<p><a href="https://strimzi.io/">Strimzi</a> provides a way to deploy an Apache Kafka cluster on Kubernetes.</p>
</div>
<div class="paragraph">
<p>The Strimzi Kafka image includes all of the necessary OpenTelemetry components.</p>
</div>
<div class="paragraph">
<p>If you want to view the OpenTelemetry components that are available in the Strimzi image, examine the compose file that is provided in the <a href="https://github.com/debezium/debezium-examples/tree/main/outbox">Debezium Outbox example</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_opentelemetry"><a class="anchor" href="#_configuring_opentelemetry"></a>Configuring OpenTelemetry</h3>
<div class="paragraph">
<p>For information about how to configure OpenTelemetry, see the <a href="https://opentelemetry.io/docs/instrumentation/java/automatic/agent-config/">OpenTelemetry documentation</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Debezium was tested with a Debezium Kafka Connect image, and a Strimzi distribution that included the following configuration settings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>otel.traces.exporter=otlp</code></p>
</li>
<li>
<p><code>otel.propagators=tracecontext</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_activatetracingspan_smt"><a class="anchor" href="#_activatetracingspan_smt"></a>ActivateTracingSpan SMT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The main implementation point of tracing in Debezium is <code>ActivateTracingSpan</code> SMT.
In this case, the application writing to a database is responsible for providing the tracing span context.
The writer must inject the span context into a <code>java.util.Properties</code> instance that is serialized and written to the database as a distinct field of the table.</p>
</div>
<div class="paragraph">
<p>If the span context is not provided then the SMT will create a new span.
In this case, Debezium operations together with metadata will be traced but will not be connected to business transaction traces to enable end-to-end tracing.</p>
</div>
<div class="paragraph">
<p>When this SMT is invoked with a message then it will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>extract the parent span context if present in the message</p>
</li>
<li>
<p>create the event <code>db-log-write</code> span context with the start timestamp set to the database log write timestamp</p>
</li>
<li>
<p>insert fields from <code>source</code> block into the span as <strong>tags</strong></p>
</li>
<li>
<p>create the processing <code>debezium-read</code> span as a child of <code>db-log-write</code> span with the start timestamp set to the processing time of the even</p>
</li>
<li>
<p>insert fields from envelope such as <code>op</code> into the processing span as <strong>tags</strong></p>
</li>
<li>
<p>injects the processing span context into message headers</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_kafka_producer_tracing"><a class="anchor" href="#_kafka_producer_tracing"></a>Kafka Producer tracing</h3>
<div class="paragraph">
<p>Optionally it is possible to enable tracing at the Kafka producer level.
If you enable tracing in the Kafka producer, when messages are written to the Kafka broker, the producer extracts the Debezium processing span context from the Kafka message headers, creates a new child span, and then records information about the write operation to the broker.
Then it injects the new span into the message headers so a consumer of the message can restore the trace and resume end-to-end tracing.</p>
</div>
<div class="paragraph">
<p>The interceptor cannot propagate the traceability context if the Kafka instrumentation is enabled.
The interceptor simply propagates the traceability context before delegating the instrumentation to the OpenTelemetry SDK.</p>
</div>
<div class="sect3">
<h4 id="_enabling_end_to_end_traceability"><a class="anchor" href="#_enabling_end_to_end_traceability"></a>Enabling end-to-end traceability</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download and install the <a href="https://mvnrepository.com/artifact/io.debezium/debezium-interceptor/">debezium-interceptor</a> to the Kafka Connect classpath.</p>
</li>
<li>
<p>Disable the automatic OpenTelemetry instrumentation at the Kafka producer and consumer by setting the value of <code>otel.instrumentation.common.default-enabled</code> to <code>false</code>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_options"><a class="anchor" href="#_configuration_options"></a>Configuration options</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 65%;">
<col style="width: 15%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Configuration property</p>
</div></div></td>
<td class="tableblock halign-right valign-top"><div class="content"><div class="paragraph">
<p>Type</p>
</div></div></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">Default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1"><code>tracing.span.context.field</code></dt>
<dd>
<p>The name of the field containing span context.<br></p>
<div class="paragraph">
<p><em>The sender must write the span context into the database column as a serialized instance of <code>java.util.Properties</code> with injected span context.</em></p>
</div>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-right valign-top"><div class="content"><div class="paragraph">
<p>string</p>
</div></div></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">tracingspancontext</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1"><code>tracing.operation.name</code></dt>
<dd>
<p>The operation name representing the Debezium processing span.<br></p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-right valign-top"><div class="content"><div class="paragraph">
<p>string</p>
</div></div></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">debezium-read</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1"><code>tracing.with.context.field.only</code></dt>
<dd>
<p>Only events that have serialized context field should be traced.</p>
<div class="paragraph">
<p><em>If set to <code>true</code> then tracing span will be created only for events with associated tracing span context field.
If set to <code>false</code> then the tracing span is created for all incoming events regardless of having associated span context.</em></p>
</div>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-right valign-top"><div class="content"><div class="paragraph">
<p>boolean</p>
</div></div></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_outbox_extension"><a class="anchor" href="#_outbox_extension"></a>Outbox Extension</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Debezium <a href="/documentation/reference/integrations/outbox">Quarkus extension</a> for implementing the outbox pattern provides the additional functionality necessary for tracing context propagation out-of-the-box.
Specifically, it provides the <code>tracingspancontext</code> field in the outbox table, which is used for passing the tracing span context from a service using the outbox extension to the Debezium connector.</p>
</div>
<div class="paragraph">
<p>When an outbox event is emitted, the extension will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>create a new <code>outbox-write</code> span as a child of current active span</p>
</li>
<li>
<p>inject the span context into that <code>java.util.Properties</code> instance that is serialized into the <code>tracingspancontext</code> column</p>
</li>
<li>
<p>write the record into the database</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The tracing integration in the outbox extension is automatically enabled if the <code>quarkus-opentelemetry</code> extension is present.
If you want to disable tracing support for the outbox extension despite the presence of  the <code>quarkus-opentelemetry</code> extension,
set the option <code>quarkus.debezium-outbox.tracing.enabled=false</code> in the Quarkus <code>application.properties</code> file.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_event_router_smt"><a class="anchor" href="#_event_router_smt"></a>Event Router SMT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="/documentation/reference/configuration/outbox-event-router">Event Router SMT</a> acts as an Outbox extension counterpart, it executes the same steps as the <code>ActivateTracingSpan</code> SMT, and is used instead of it.</p>
</div>
</div>
</div>
</article>
</div>
<div class="article-cell2">
</div>
</div>

<div id="toc-rightbar"></div>    <footer class="footer">
        <div class="wrapper">
            <div class="copyright">Copyright &copy; 2023 Debezium Community (Rev: <span class="truncated"><a href="https://github.com/debezium/debezium/commit/68481038b3f8a0bbdd46dd750550ab6106ae2872">68481038</a></span>)
            
        </div>
    </footer>
</main></div>
<script>
    /* Make sure TOC carets are expanded if sub-elements exist */
    $("#toc").each(function(i,v) {
      $(this).closest('article').addClass('with-toc');
    });

    $("#toc ul.sectlevel1 > li").each(function(i,v) {
      $(this).has("ul").addClass("expanded");
    });

    $(function() {
        /* Expands all the documentation submenus */
        $(".nav-list > .nav-item:not(.is-active) .nav-item-toggle").click();
    });

    /**
     * This checks if a "#toc" element exists in the DOM and if so:
     *
     *  1. Appends a cloned copy of the #toc node to the #toc-rightbar div.
     *  2. Forces the #toc-rightbar div to be visible.
     *  3. Adds the .toc-right class to the #article-wrapper div to restrict the article's overall width.
     */
    var $toc = $("#toc");
    if ( $toc.length ) {
        $("#toc-rightbar").append($toc.clone());
        $("body .main").addClass("with-toc");
    }

    /**
     * In order to make CSS changes that are backward compatible with old adoc files, this applies a version
     * style to the body tag so we can use it to differentiate between CSS styles per version if needed,
     * such as tfoot rows.
     */
    var $version = $("body .nav-container").data("version");
    var $versionClass = "version-" + $version;
    $versionClass = $versionClass.replace('.','-');
    $("body").addClass($versionClass);

    /** A CSS trick to wrap long-width tables in a div that can be scrolled on smaller screens */
    $("table.tableblock").wrap("<div class='table-scroll-wrapper'></div>");

    $(function() {
        /* apply floating scrollbar to the scroll-wrapper */
        $(".table-scroll-wrapper").floatingScrollbar();
    });

</script>
<script src="../../debezium-antora/js/site.js"></script>
<script async src="../../debezium-antora/js/vendor/highlight.js"></script>

<script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
  try {
    var pageTracker = _gat._getTracker("UA-10656779-1");
    pageTracker._trackPageview();
  } catch(err) {}
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-76464546-1', 'auto');
  ga('send', 'pageview');
  ga('set', 'anonymizeIp', true);
  ga('require', 'linkid', 'linkid.js');
</script>
</body>
</html>