<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Debezium connector for Cloud Spanner :: Debezium Documentation</title>
    <link rel="canonical" href="https://debezium.io/documentation/reference/stable/connectors/spanner.html">
    <meta name="generator" content="Antora 3.1.7">
<link rel="stylesheet" href="../../../debezium-antora/css/site.css">
<link rel="stylesheet" href="../../../debezium-antora/css/debezium-antora.css">
<link rel="stylesheet" href="../../../debezium-antora/css/highlightjs-dark.css">
<link rel="stylesheet" href="https://static.jboss.org/css/rhbar.css">
<script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.js"></script>
<script src="../../../debezium-antora/js/jquery.ba-floatingscrollbar.js"></script>
</head>
<body class="article">
<header class="header">
  <div id="rhbar">
      <a class="jbdevlogo" href="https://developers.redhat.com"></a>
      <a class="rhlogo" href="https://www.redhat.com"></a>
  </div>
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
          <img src="/assets/images/color_white_debezium_type_600px.svg" style="height: 32px; margin-right: 14px;"/>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="/documentation/faq">FAQ</a>
        <a class="navbar-item" href="/documentation">DOCUMENTATION</a>
        <a class="navbar-item" href="/releases">RELEASES</a>
        <a class="navbar-item" href="/community">COMMUNITY</a>
        <a class="navbar-item" href="/blog">BLOG</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="reference" data-version="stable">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Debezium 2.7 Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tutorial.html">Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../install.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../postgres-plugins.html">PostgreSQL Decoding Plugins</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../features.html">Features</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/avro.html">Avro Serialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/topic-auto-create-config.html">Customizing Topic Auto-Creation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/signalling.html">Sending Signals to Debezium</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/notification.html">Receive notifications from Debezium</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Connectors</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="mysql.html">MySQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="mariadb.html">MariaDB</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="mongodb.html">MongoDB</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="postgresql.html">PostgreSQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="oracle.html">Oracle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="sqlserver.html">SQL Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="db2.html">Db2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cassandra.html">Cassandra</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="vitess.html">Vitess</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="spanner.html">Spanner</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="jdbc.html">JDBC</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="informix.html">Informix</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Transformations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/topic-routing.html">Topic Routing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/event-flattening.html">New Record State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/mongodb-event-flattening.html">MongoDB New Document State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/event-changes.html">Event Changes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/outbox-event-router.html">Outbox Event Router</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/mongodb-outbox-event-router.html">MongoDB Outbox Event Router</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/filtering.html">Message Filtering</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/schema-change-event-filter.html">Schema Change Event Filtering</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/content-based-routing.html">Content-Based Routing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/applying-transformations-selectively.html">Using SMT Predicates to Selectively Apply Transformations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/partition-routing.html">Partition Routing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/header-to-value.html">HeaderToValue</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/timezone-converter.html">Timezone Converter</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/timescaledb.html">TimescaleDB Integration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transformations/convert-cloudevent-to-saveable-form.html">Convert CloudEvents to Saveable Form</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Post Processors</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../post-processors/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../post-processors/reselect-columns.html">Reselect Columns</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">API and SPI</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/engine.html">Debezium Engine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/converters.html">Custom Converters</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Integrations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/serdes.html">Change Event SerDes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/outbox.html">Outbox Quarkus Extension</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/cloudevents.html">CloudEvents</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/tracing.html">OpenTelemetry</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/testcontainers.html">Integration Testing with Testcontainers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Operations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/debezium-server.html">Debezium Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/monitoring.html">Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/kubernetes.html">Running on Kubernetes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/openshift.html">Running on Openshift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/debezium-ui.html">Debezium UI</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Debezium Documentation</span>
    <span class="version">2.7</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Debezium Documentation</span>
      <ul class="versions">
        <li class="version">
          <a href="/documentation/reference/nightly/index.html">nightly</a>
        </li>
        <li class="version is-current">
          <a href="/documentation/reference/2.7/index.html">2.7</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/3.0/index.html">3.0</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/2.6/index.html">2.6</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/2.5/index.html">2.5</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/2.4/index.html">2.4</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/2.3/index.html">2.3</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/2.2/index.html">2.2</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/2.1/index.html">2.1</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/2.0/index.html">2.0</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/1.9/index.html">1.9</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main" class="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Debezium Documentation</a></li>
    <li>Connectors</li>
    <li><a href="spanner.html">Spanner</a></li>
  </ul>
</nav>
    <div class="page-versions-container">
    Version:
    <div class="page-versions">
        <button class="version-menu-toggle versions-menu-current" title="Show other versions of page">2.7</button>
        <div class="version-menu">
                <a class="version" href="/documentation/reference/nightly/index.html">nightly</a>
                <a class="version is-current" href="/documentation/reference/2.7/index.html">2.7</a>
                <a class="version" href="/documentation/reference/3.0/index.html">3.0</a>
                <a class="version" href="/documentation/reference/2.6/index.html">2.6</a>
                <a class="version" href="/documentation/reference/2.5/index.html">2.5</a>
                <a class="version" href="/documentation/reference/2.4/index.html">2.4</a>
                <a class="version" href="/documentation/reference/2.3/index.html">2.3</a>
                <a class="version" href="/documentation/reference/2.2/index.html">2.2</a>
                <a class="version" href="/documentation/reference/2.1/index.html">2.1</a>
                <a class="version is-missing" href="/documentation/reference/2.0/index.html">2.0</a>
                <a class="version is-missing" href="/documentation/reference/1.9/index.html">1.9</a>
        </div>
        |
    </div>
    </div>
  <div class="edit-this-page"><a href="https://github.com/debezium/debezium/edit/2.7/documentation/modules/ROOT/pages/connectors/spanner.adoc">Edit this Page</a></div>
  </div>
<div class="article-grid">
<div class="article-cell1">
<article class="doc">
        
    <!-- This partial is a placeholder -->            <h1 class="page">Debezium connector for Cloud Spanner</h1>
        <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#spanner-overview">Overview</a></li>
<li><a href="#how-the-spanner-connector-works">How the connector works</a>
<ul class="sectlevel2">
<li><a href="#spanner-streaming-changes">Streaming changes</a></li>
<li><a href="#spanner-topic-names">Topic names</a></li>
</ul>
</li>
<li><a href="#spanner-events">Data change events</a>
<ul class="sectlevel2">
<li><a href="#spanner-change-events-key">Change event keys</a></li>
<li><a href="#spanner-change-events-value">Change event values</a></li>
<li><a href="#spanner-create-events"><em>create</em> events</a></li>
<li><a href="#spanner-update-events"><em>update</em> events</a></li>
<li><a href="#spanner-delete-events"><em>delete</em> events</a></li>
</ul>
</li>
<li><a href="#spanner-data-types">Data type mappings</a>
<ul class="sectlevel2">
<li><a href="#spanner-types">Spanner types</a></li>
</ul>
</li>
<li><a href="#setting-up-spanner">Setting up Spanner</a></li>
<li><a href="#spanner-deploying-a-connector">Deployment</a>
<ul class="sectlevel2">
<li><a href="#spanner-example-configuration">Connector configuration example</a></li>
<li><a href="#spanner-adding-connector-configuration">Adding connector configuration</a></li>
<li><a href="#spanner-monitoring">Monitoring</a></li>
<li><a href="#_customized_mbean_names">Customized MBean names</a></li>
<li><a href="#spanner-connector-properties">Connector configuration properties</a></li>
</ul>
</li>
<li><a href="#spanner-when-things-go-wrong">Behavior when things go wrong</a>
<ul class="sectlevel2">
<li><a href="#spanner-connector-configuration-and-startup-errors">Configuration and startup errors</a></li>
<li><a href="#spanner-becomes-unavailable">Spanner becomes unavailable</a></li>
<li><a href="#spanner-kafka-connect-process-stops-gracefully">Kafka Connect process stops gracefully</a></li>
<li><a href="#spanner-kafka-connect-process-crashes">Kafka Connect process crashes</a></li>
<li><a href="#spanner-kafka-becomes-unavailable">Kafka becomes unavailable</a></li>
<li><a href="#spanner-connector-is-stopped-for-a-duration">Connector is stopped for a duration</a></li>
</ul>
</li>
<li><a href="#spanner-limitations">Limitations</a></li>
</ul>
</div>
<div class="paragraph">
<p>Debezium&#8217;s Cloud Spanner connector consumes and outputs Spanner change streams data into a Kafka topic.</p>
</div>
<div class="paragraph">
<p>A Spanner <a href="https://cloud.google.com/spanner/docs/change-streams">change stream</a> watches and streams out a Spanner database&#8217;s data changes - inserts, updates, deletes - in near-real-time. The Spanner connector abstracts away the details of querying the Spanner change streams. With this connector, you don&#8217;t have to manage the change streams partition lifecycle, which is necessary when you <a href="https://cloud.devsite.corp.google.com/spanner/docs/change-streams/details#query">use the Spanner API directly</a>.</p>
</div>
<div class="paragraph">
<p>The connector does not support the snapshot feature at the moment. The first time the Kafka connector connects to a Spanner database, it will stream changes from either the provided timestamp, or the current timestamp if a timestamp is not provided.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spanner-overview"><a class="anchor" href="#spanner-overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To read and process database changes, the connector queries from a change stream.</p>
</div>
<div class="paragraph">
<p>The connector produces a change event for every row-level insert, update, and delete operation that was captured and sends change event records for each table in a separate Kafka topic. Client applications read the Kafka topics that correspond to the database tables of interest, and can react to every row-level event they receive from those topics.</p>
</div>
<div class="paragraph">
<p>The connector is tolerant of failures. As the connector reads changes and produces events, it records the last commit timestamp processed for each <a href="https://cloud.google.com/spanner/docs/change-streams/details">change stream partition</a>. If the connector stops for any reason (including communication failures, network problems, or crashes), upon restart the connector continues streaming records where it last left off.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-the-spanner-connector-works"><a class="anchor" href="#how-the-spanner-connector-works"></a>How the connector works</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To optimally configure and run a Debezium Spanner connector, it is helpful to understand how the connector streams change events, determines Kafka topic names, and uses metadata.</p>
</div>
<div class="sect2">
<h3 id="spanner-streaming-changes"><a class="anchor" href="#spanner-streaming-changes"></a>Streaming changes</h3>
<div class="paragraph">
<p>The Debezium Spanner connector spends all its time streaming changes from the change stream to which it is subscribed. When a change occurs on a table, Spanner writes a corresponding change stream record in the database, synchronously in the same transaction as the data change. To scale change streams writes and reads, Spanner splits and merges the internal change stream storage along with the database data. To support reading change stream records in near real-time as database writes scale, the Spanner API is designed for a change stream to be queried concurrently using the change stream partitions. See about Spanner change stream&#8217;s <a href="https://cloud.google.com/spanner/docs/change-streams/details">partitioning model</a>.</p>
</div>
<div class="paragraph">
<p>The connector offers an abstraction over the Spanner API for querying change streams. With this connector, you don&#8217;t have to manage the change stream partition lifecycle. The connector provides you with a stream of data change records so that you are free to focus more on application logic and less on specific API details and dynamic change stream partitioning.</p>
</div>
<div class="paragraph">
<p>When subscribing to a change stream, the connector needs to provide the the project ID, Spanner instance ID, Spanner database ID, as well as the change stream name. Optionally, the user can also provide a start timestamp and an end timestamp. See the <a href="#spanner-connector-properties">this section</a> for a more detailed list of the connector configuration properties.</p>
</div>
<div class="paragraph">
<p>When the connector receives changes it transforms the events into Debezium <em>create</em>, <em>update</em>, or <em>delete</em> events. The connector forwards these change events in records to the Kafka Connect framework, which is running in the same process. The Kafka Connect process asynchronously writes the change event records in the same order in which they were generated to the appropriate Kafka topic.</p>
</div>
<div class="paragraph">
<p>Periodically, Kafka Connect records the most recent <em>offset</em> in another Kafka topic. The offset indicates source-specific position information that Debezium includes with each event. For the Spanner connector, the last processed commit timestamps for the change stream partitions is the offset.</p>
</div>
<div class="paragraph">
<p>When Kafka Connect gracefully shuts down, it stops the connectors, flushes all event records to Kafka, and records the last offset received from each connector. When Kafka Connect restarts, it reads the last recorded offset for each connector, and starts each connector at its last recorded offset.</p>
</div>
<div class="paragraph">
<p>The Spanner connector also records metadata information in the following metadata topics during streaming. It is not advisable to modify the content or the configuration of these topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>_consumer_offsets</code>: A topic automatically created by Kafka. Stores consumer offsets for consumers created in the Kafka connector</p>
</li>
<li>
<p><code>_kafka-connect-offsets</code>: A topic automatically created by Kafka Connect. Stores the connector offsets.</p>
</li>
<li>
<p><code>_sync_topic_spanner_connector_connectorname</code>: A topic automatically created by the connector. Stores metadata regarding change stream partitions.</p>
</li>
<li>
<p><code>_rebalancing_topic_spanner_connector_connectorname</code>: A topic automatically created by the connector. Used to determine connector task aliveness.</p>
</li>
<li>
<p><code>_debezium-heartbeat.connectorname</code>: A topic used to process Spanner change stream heartbeats.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="spanner-topic-names"><a class="anchor" href="#spanner-topic-names"></a>Topic names</h3>
<div class="paragraph">
<p>The Spanner connector writes events for all insert, update, and delete operations on a single table to a single Kafka topic. By default, the Kafka topic name is <em>topicPrefix</em>.<em>connectorName</em>.<em>tableName</em> where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>topicPrefix</em> is the topic prefix as specified by the <code>topic.prefix</code> connector configuration property.</p>
</li>
<li>
<p><em>connectorName</em> is the user-specified name of the connector.</p>
</li>
<li>
<p><em>tableName</em> is the name of the database table in which the operation occurred.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, suppose that <code>spanner</code> is the logical name in the configuration for a connector that is capturing changes from a Spanner change stream that tracks changes in a database that contains four tables: <code>table1</code>, <code>table2</code>, <code>table3</code>, and <code>table4</code>. The connector would stream records to these four Kafka topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>spanner.table1</code></p>
</li>
<li>
<p><code>spanner.table2</code></p>
</li>
<li>
<p><code>spanner.table3</code></p>
</li>
<li>
<p><code>spanner.table4</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spanner-events"><a class="anchor" href="#spanner-events"></a>Data change events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Debezium Spanner connector generates a data change event for each row-level <code>INSERT</code>, <code>UPDATE</code>, and <code>DELETE</code> operation. Each event contains a key and a value. The key and value are separate documents. The structure of the key and the value depends on the table that was changed.</p>
</div>
<div class="paragraph">
<p>Debezium and Kafka Connect are designed around <em>continuous streams of event messages</em>. However, the structure of these events may change over time, which can be difficult for consumers to handle. To address this, each event contains the schema for its content or, if you are using a schema registry, a schema ID that a consumer can use to obtain the schema from the registry. This makes each event self-contained. The schema for the key will never change. Please note that the schema for the value is an amalgamation of all the columns in the table that the change stream has tracked since the start time of the connector.</p>
</div>
<div class="paragraph">
<p>The following skeleton JSON documents show the basic structure for the key and value documents. However, how you configure the Kafka Connect converter that you choose to use in your application determines the representation of the key and value documents. A <code>schema</code> field is in a change event key or change event value only when you configure the converter to produce it. Likewise, the event key and event payload are present only if you configure a converter to produce it. If you use the JSON converter and you configure it to produce schemas, change events have this structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">// Key
{
 "schema": { <i class="conum" data-value="1"></i><b>(1)</b>
   ...
  },
 "payload": { <i class="conum" data-value="2"></i><b>(2)</b>
   ...
 }
}

// Value
{
 "schema": { <i class="conum" data-value="3"></i><b>(3)</b>
   ...
 },
 "payload": { <i class="conum" data-value="4"></i><b>(4)</b>
   ...
 }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Overview of change event basic content</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Field name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>schema</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The first <code>schema</code> field is part of the event key. It specifies a Kafka Connect schema that describes what is in the event key&#8217;s <code>payload</code> portion. In other words, the first <code>schema</code> field describes the structure of the primary key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>payload</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The first <code>payload</code> field is part of the event key. It has the structure described by the previous <code>schema</code> field and it contains the key for the row that was changed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>schema</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The second <code>schema</code> field is part of the event value. It specifies the Kafka Connect schema that describes what is in the event value&#8217;s <code>payload</code> portion. In other words, the second <code>schema</code> describes the structure of the row that was changed. Typically, this schema contains nested schemas.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>payload</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The second <code>payload</code> field is part of the event value. It has the structure described by the previous <code>schema</code> field and it contains the actual data for the row that was changed.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The default behavior is that the connector streams change event records to <a href="#spanner-topic-names">topics with names that are the same as the event&#8217;s originating table</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Starting with Kafka 0.10, Kafka can optionally record the event key and value with the <a href="https://kafka.apache.org/documentation.html#upgrade_10_performance_impact"><em>timestamp</em></a> at which the message was created (recorded by the producer) or written to the log by Kafka.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="spanner-change-events-key"><a class="anchor" href="#spanner-change-events-key"></a>Change event keys</h3>
<div class="paragraph">
<p>For a given table, the change event&#8217;s key has a structure that contains a field for each column in the primary key of the table at the time the event was created. All key columns will be marked as non-optional.</p>
</div>
<div class="paragraph">
<p>Consider a <code>users</code> table defined in the <code>business</code> database and the example of a change event key for that table.</p>
</div>
<div class="listingblock">
<div class="title">Example table</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE TABLE Users (
  id INT64 NOT NULL,
  username STRING(MAX) NOT NULL,
  password STRING(MAX) NOT NULL,
  email STRING(MAX) NOT NULL)
PRIMARY KEY (id);</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Example change event key</div>
<p>Every change event for the <code>users</code> table while it has this definition has the same key structure, which in JSON looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "schema": { <i class="conum" data-value="1"></i><b>(1)</b>
    "type": "struct",
    "name": "Users.Key", <i class="conum" data-value="2"></i><b>(2)</b>
    "optional": false, <i class="conum" data-value="3"></i><b>(3)</b>
    "fields": [ <i class="conum" data-value="4"></i><b>(4)</b>
      {
        "type": "int64",
        "optional": "false",
        "field": "false"
      }
    ]
  },
  "payload": { <i class="conum" data-value="5"></i><b>(5)</b>
      "id": "1"
  },
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Description of change event key</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Field name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>schema</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The schema portion of the key specifies a Kafka Connect schema that describes what is in the key&#8217;s <code>payload</code> portion.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Users.Key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the schema that defines the structure of the key&#8217;s payload. This schema describes the structure of the primary key for the table that was changed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>optional</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether the event key must contain a value in its <code>payload</code> field. Primary key columns are always required.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fields</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies each field that is expected in the <code>payload</code>, including each field&#8217;s name, type, and whether it is optional.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>payload</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the key for the row for which this change event was generated. In this example, the key, contains a single <code>id</code> field whose value is <code>1</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="spanner-change-events-value"><a class="anchor" href="#spanner-change-events-value"></a>Change event values</h3>
<div class="paragraph">
<p>Consider the same sample table that was used to show an example of a change event key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE TABLE Users (
  id INT64 NOT NULL,
  username STRING(MAX) NOT NULL,
  password STRING(MAX) NOT NULL,
  email STRING(MAX) NOT NULL)
PRIMARY KEY (id);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spanner-create-events"><a class="anchor" href="#spanner-create-events"></a><em>create</em> events</h3>
<div class="paragraph">
<p>The following example shows the value portion of a change event that the connector generates for an operation that creates data in the <code>Users</code> table. If a Spanner column is marked is non-optional, its value is required for all mutations that insert a row. All primary key columns in Spanner will be marked as non-optional. Note that even if a non-key column is marked as non-optional in Spanner, it will be shown as optional in the schema. Only primary key columns are marked as non-optional in the schema.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
    "schema": { <i class="conum" data-value="1"></i><b>(1)</b>
        "type": "struct",
        "fields": [
            {
                "type": "struct",
                "fields": [
                    {
                        "type": "int32",
                        "optional": false,
                        "field": "id"
                    },
                    {
                        "type": "string",
                        "optional": true,
                        "field": "first_name"
                    },
                    {
                        "type": "string",
                        "optional": true,
                        "field": "last_name"
                    },
                    {
                        "type": "string",
                        "optional": true,
                        "field": "email"
                    }
                ],
                "optional": true,
                "name": "Users.Value", <i class="conum" data-value="2"></i><b>(2)</b>
                "field": "before"
            },
            {
                "type": "struct",
                "fields": [
                    {
                        "type": "int32",
                        "optional": false,
                        "field": "id"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "first_name"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "last_name"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "email"
                    }
                ],
                "optional": true,
                "name": "Users.Value",
                "field": "after"
            },
            {
                "type": "struct",
                "fields": [
                    {
                        "type": "string",
                        "optional": false,
                        "field": "version"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "connector"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "name"
                    },
                    {
                        "type": "int64",
                        "optional": false,
                        "field": "ts_ms"
                    },
                    {
                        "type": "int64",
                        "optional": false,
                        "field": "ts_us"
                    },
                    {
                        "type": "int64",
                        "optional": false,
                        "field": "ts_ns"
                    },
                    {
                        "type": "boolean",
                        "optional": true,
                        "default": false,
                        "field": "snapshot"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "db"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "sequence"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "project_id"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "instance_id"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "database_id"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "change_stream_name"
                    },
                    {
                        "type": "string",
                        "optional": true,
                        "field": "table"
                    }
                    {
                        "type": "string",
                        "optional": true,
                        "field": "server_transaction_id"
                    }
                    {
                        "type": "int64",
                        "optional": true,
                        "field": "low_watermark"
                    }
                    {
                        "type": "int64",
                        "optional": true,
                        "field": "read_at_timestamp"
                    }
                    {
                        "type": "int64",
                        "optional": true,
                        "field": "number_of_records_in_transaction"
                    }
                    {
                        "type": "string",
                        "optional": true,
                        "field": "transaction_tag"
                    }
                    {
                        "type": "boolean",
                        "optional": true,
                        "field": "system_transaction"
                    }
                    {
                        "type": "string",
                        "optional": true,
                        "field": "value_capture_type"
                    }
                    {
                        "type": "string",
                        "optional": true,
                        "field": "partition_token"
                    }
                    {
                        "type": "int32",
                        "optional": true,
                        "field": "mod_number"
                    }
                    {
                        "type": "boolean",
                        "optional": true,
                        "field": "is_last_record_in_transaction_in_partition"
                    }
                    {
                        "type": "int64",
                        "optional": true,
                        "field": "number_of_partitions_in_transaction"
                    }
                ],
                "optional": false,
                "name": "io.debezium.connector.spanner.Source", <i class="conum" data-value="3"></i><b>(3)</b>
                "field": "source"
            },
            {
                "type": "string",
                "optional": false,
                "field": "op"
            },
            {
                "type": "int64",
                "optional": true,
                "field": "ts_ms"
            },
            {
                "type": "int64",
                "optional": true,
                "field": "ts_us"
            },
            {
                "type": "int64",
                "optional": true,
                "field": "ts_ns"
            }
        ],
        "optional": false,
        "name": "connector_name.Users.Envelope" <i class="conum" data-value="4"></i><b>(4)</b>
    },
    "payload": { <i class="conum" data-value="5"></i><b>(5)</b>
        "before": null, <i class="conum" data-value="6"></i><b>(6)</b>
        "after": { <i class="conum" data-value="7"></i><b>(7)</b>
            "id": 1,
            "first_name": "Anne",
            "last_name": "Kretchmar",
            "email": "annek@noanswer.org"
        },
        "source": { <i class="conum" data-value="8"></i><b>(8)</b>
            "version": "2.7.0.Final",
            "connector": "spanner",
            "name": "spanner_connector",
            "ts_ms": 1670955531785,
            "ts_us": 1670955531785000,
            "ts_ns": 1670955531785000000,
            "snapshot": "false",
            "db": "database",
            "sequence": "1",
            "project_id": "project",
            "instance_id": "instance",
            "database_id": "database",
            "change_stream_name": "change_stream",
            "table": "Users",
            "server_transaction_id": "transaction_id",
            "low_watermark": 1670955471635,
            "read_at_timestamp": 1670955531791,
            "number_records_in_transaction": 2,
            "transaction_tag": "",
            "system_transaction": false,
            "value_capture_type": "OLD_AND_NEW_VALUES",
            "partition_token": "partition_token",
            "mod_number": 0,
            "is_last_record_in_transaction_in_partition": true,
            "number_of_partitions_in_transaction": 1
        },
        "op": "c", <i class="conum" data-value="9"></i><b>(9)</b>
        "ts_ms": 1559033904863, <i class="conum" data-value="10"></i><b>(10)</b>
        "ts_us": 1559033904863769, <i class="conum" data-value="10"></i><b>(10)</b>
        "ts_ns": 1559033904863769841 <i class="conum" data-value="10"></i><b>(10)</b>
    }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Descriptions of <em>create</em> event value fields</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Field name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>schema</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value&#8217;s schema, which describes the structure of the value&#8217;s payload. A change event&#8217;s value schema is the same in every change event that the connector generates for a particular table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>In the <code>schema</code> section, each <code>name</code> field specifies the schema for a field in the value&#8217;s payload.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.connector.spanner.Source</code> is the schema for the payload&#8217;s <code>source</code> field. This schema is specific to the Spanner connector. The connector uses it for all events that it generates.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>connector_name.Users.Envelope</code> is the schema for the overall structure of the payload, where <code>connector_name</code> is the connector name, and <code>customers</code> is the table.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>payload</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value&#8217;s actual data. This is the information that the change event is providing.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>before</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional field that specifies the state of the row before the event occurred. When the <code>op</code> field is <code>c</code> for create, as it is in this example, the <code>before</code> field is <code>null</code> since this change event is for new content.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>after</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional field that specifies the state of the row after the event occurred. In this example, the <code>after</code> field contains the values of the new row&#8217;s <code>id</code>, <code>first_name</code>, <code>last_name</code>, and <code>email</code> columns.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>source</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory field that describes the source metadata for the event. This field contains information that you can use to compare this event with other events, with regard to the origin of the events, the order in which the events occurred, and whether events were part of the same transaction. The source metadata includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Debezium version</p>
</li>
<li>
<p>Connector type and name</p>
</li>
<li>
<p>Database and table that contains the new row</p>
</li>
<li>
<p>If the event was part of a snapshot</p>
</li>
<li>
<p>The record sequence number for the data change event in the transaction</p>
</li>
<li>
<p>The project ID</p>
</li>
<li>
<p>The instance ID</p>
</li>
<li>
<p>The database ID</p>
</li>
<li>
<p>The change stream name</p>
</li>
<li>
<p>The transaction ID</p>
</li>
<li>
<p>The low watermark, which represents the timestamp at which all records with commit timestamp less than the low watermark timestamp have already been streamed out by the connector</p>
</li>
<li>
<p>The commit timestamp for when the change was made in the database</p>
</li>
<li>
<p>The timestamp at which the connnector processed the change</p>
</li>
<li>
<p>The number of records in the originating transaction</p>
</li>
<li>
<p>The transaction tag</p>
</li>
<li>
<p>Whether or not the transaction was a system transaction</p>
</li>
<li>
<p>The value capture type</p>
</li>
<li>
<p>The originating partition token used to query this change event</p>
</li>
<li>
<p>The mod number in the original data change event received from Spanner</p>
</li>
<li>
<p>Whether or not the data change event was the last record in the transaction in the partition</p>
</li>
<li>
<p>The total number of change stream partitions in the transaction</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>op</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory string that describes the type of operation that caused the connector to generate the event. In this example, <code>c</code> indicates that the operation created a row. Valid values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>c</code> = create</p>
</li>
<li>
<p><code>u</code> = update</p>
</li>
<li>
<p><code>d</code> = delete</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ts_ms</code>, <code>ts_us</code>, <code>ts_ns</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Optional field that displays the time at which the connector processed the event.
The time is based on the system clock in the JVM running the Kafka Connect task. <br>
<br>
In the <code>source</code> object, <code>ts_ms</code> indicates the time that the change was made in the database. By comparing the value for <code>payload.source.ts_ms</code> with the value for <code>payload.ts_ms</code>, you can determine the lag between the source database update and Debezium.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="spanner-update-events"><a class="anchor" href="#spanner-update-events"></a><em>update</em> events</h3>
<div class="paragraph">
<p>The value of a change event for an update in the sample <code>Users</code> table has the same schema as a <em>create</em> event for that table. Likewise, the event value&#8217;s payload has the same structure. However, the event value payload contains different values in an <em>update</em> event. Here is an example of a change event value in an event that the connector generates for an update in the <code>Users</code> table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
    "schema": { ... },
    "payload": {
        "before": { <i class="conum" data-value="1"></i><b>(1)</b>
            "id": 1,
            "first_name": "Anne",
            "last_name": "Kretchmar",
            "email": "annek@noanswer.org"
        },
        "after": { <i class="conum" data-value="2"></i><b>(2)</b>
            "id": 1,
            "first_name": "Anne Marie",
            "last_name": "Kretchmar",
            "email": "annek@noanswer.org"
        },
        "source": { <i class="conum" data-value="3"></i><b>(3)</b>
            "version": "2.7.0.Final",
            "connector": "spanner",
            "name": "spanner_connector",
            "ts_ms": 1670955531785,
            "ts_us": 1670955531785000,
            "ts_ns": 1670955531785000000,
            "snapshot": "false",
            "db": "database",
            "sequence": "1",
            "project_id": "project",
            "instance_id": "instance",
            "database_id": "database",
            "change_stream_name": "change_stream",
            "table": "Users",
            "server_transaction_id": "transaction_id",
            "low_watermark": 1670955471635,
            "read_at_timestamp": 1670955531791,
            "number_records_in_transaction": 2,
            "transaction_tag": "",
            "system_transaction": false,
            "value_capture_type": "OLD_AND_NEW_VALUES",
            "partition_token": "partition_token",
            "mod_number": 0,
            "is_last_record_in_transaction_in_partition": true,
            "number_of_partitions_in_transaction": 1
        },
        "op": "u", <i class="conum" data-value="4"></i><b>(4)</b>
        "ts_ms": 1465584025523,  <i class="conum" data-value="5"></i><b>(5)</b>
        "ts_us": 1465584025523614,  <i class="conum" data-value="5"></i><b>(5)</b>
        "ts_ns": 1465584025523614723  <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Descriptions of <em>update</em> event value fields</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Field name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>before</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional field that contains all values of all columns that were in the row before the database commit.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>after</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional field that specifies the state of the row after the event occurred. In this example, the <code>first_name</code> value is now <code>Anne Marie</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>source</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory field that describes the source metadata for the event. The <code>source</code> field structure has the same fields as in a <em>create</em> event, but some values are different. The source metadata includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Debezium version</p>
</li>
<li>
<p>Connector type and name</p>
</li>
<li>
<p>Database (a.k.a keyspace) and table that contains the new row</p>
</li>
<li>
<p>If the event was part of a snapshot</p>
</li>
<li>
<p>The record sequence number for the data change event in the transaction</p>
</li>
<li>
<p>The project ID</p>
</li>
<li>
<p>The instance ID</p>
</li>
<li>
<p>The database ID</p>
</li>
<li>
<p>The change stream name</p>
</li>
<li>
<p>The transaction ID</p>
</li>
<li>
<p>The low watermark, which represents the timestamp at which all records with commit timestamp less than the low watermark timestamp have already been streamed out by the connector</p>
</li>
<li>
<p>The commit timestamp for when the change was made in the database</p>
</li>
<li>
<p>The timestamp at which the connnector processed the change</p>
</li>
<li>
<p>The number of records in the originating transaction</p>
</li>
<li>
<p>The transaction tag</p>
</li>
<li>
<p>Whether or not the transaction was a system transaction</p>
</li>
<li>
<p>The value capture type</p>
</li>
<li>
<p>The originating partition token used to query this change event</p>
</li>
<li>
<p>The mod number in the original data change event received from Spanner</p>
</li>
<li>
<p>Whether or not the data change event was the last record in the transaction in the partition</p>
</li>
<li>
<p>The total number of change stream partitions in the transaction</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>op</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory string that describes the type of operation. In an <em>update</em> event value, the <code>op</code> field value is <code>u</code>, signifying that this row changed because of an update.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ts_ms</code>, <code>ts_us</code>, <code>ts_ns</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Optional field that displays the time at which the connector processed the event.
The time is based on the system clock in the JVM running the Kafka Connect task. <br>
<br>
In the <code>source</code> object, <code>ts_ms</code> indicates the time that the change was made in the database. By comparing the value for <code>payload.source.ts_ms</code> with the value for <code>payload.ts_ms</code>, you can determine the lag between the source database update and Debezium.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="spanner-delete-events"><a class="anchor" href="#spanner-delete-events"></a><em>delete</em> events</h3>
<div class="paragraph">
<p>The value in a <em>delete</em> change event has the same <code>schema</code> portion as <em>create</em> and <em>update</em> events for the same table. The <code>payload</code> portion in a <em>delete</em> event for the sample <code>Users</code> table looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "schema": { ... },
    "payload": {
        "before": { <i class="conum" data-value="1"></i><b>(1)</b>
            "id": 1,
            "first_name": "Anne Marie",
            "last_name": "Kretchmar",
            "email": "annek@noanswer.org"
        },
        "after": null, <i class="conum" data-value="2"></i><b>(2)</b>
        "source": { <i class="conum" data-value="3"></i><b>(3)</b>
            "version": "2.7.0.Final",
            "connector": "spanner",
            "name": "spanner_connector",
            "ts_ms": 1670955531785,
            "ts_us": 1670955531785000,
            "ts_ns": 1670955531785000000,
            "snapshot": "false",
            "db": "database",
            "sequence": "1",
            "project_id": "project",
            "instance_id": "instance",
            "database_id": "database",
            "change_stream_name": "change_stream",
            "table": "Users",
            "server_transaction_id": "transaction_id",
            "low_watermark": 1670955471635,
            "read_at_timestamp": 1670955531791,
            "number_records_in_transaction": 2,
            "transaction_tag": "",
            "system_transaction": false,
            "value_capture_type": "OLD_AND_NEW_VALUES",
            "partition_token": "partition_token",
            "mod_number": 0,
            "is_last_record_in_transaction_in_partition": true,
            "number_of_partitions_in_transaction": 1
        },
        "op": "d", <i class="conum" data-value="4"></i><b>(4)</b>
        "ts_ms": 1465581902461, <i class="conum" data-value="5"></i><b>(5)</b>
        "ts_us": 1465581902461425, <i class="conum" data-value="5"></i><b>(5)</b>
        "ts_ns": 1465581902461425378 <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Descriptions of <em>delete</em> event value fields</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Field name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>before</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional field that specifies the state of the row before the event occurred. In a <em>delete</em> event value, the <code>before</code> field contains the values that were in the row before it was deleted with the database commit.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>after</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional field that specifies the state of the row after the event occurred. In a <em>delete</em> event value, the <code>after</code> field is <code>null</code>, signifying that the row no longer exists.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>source</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory field that describes the source metadata for the event. In a <em>delete</em> event value, the <code>source</code> field structure is the same as for <em>create</em> and <em>update</em> events for the same table. Many <code>source</code> field values are also the same. In a <em>delete</em> event value, the <code>ts_ms</code> and <code>lsn</code> field values, as well as other values, might have changed. But the <code>source</code> field in a <em>delete</em> event value provides the same metadata:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Debezium version</p>
</li>
<li>
<p>Connector type and name</p>
</li>
<li>
<p>Database (a.k.a keyspace) and table that contains the new row</p>
</li>
<li>
<p>If the event was part of a snapshot</p>
</li>
<li>
<p>The record sequence number for the data change event in the transaction</p>
</li>
<li>
<p>The project ID</p>
</li>
<li>
<p>The instance ID</p>
</li>
<li>
<p>The database ID</p>
</li>
<li>
<p>The change stream name</p>
</li>
<li>
<p>The transaction ID</p>
</li>
<li>
<p>The low watermark, which represents the timestamp at which all records with commit timestamp less than the low watermark timestamp have already been streamed out by the connector</p>
</li>
<li>
<p>The commit timestamp for when the change was made in the database</p>
</li>
<li>
<p>The timestamp at which the connnector processed the change</p>
</li>
<li>
<p>The number of records in the originating transaction</p>
</li>
<li>
<p>The transaction tag</p>
</li>
<li>
<p>Whether or not the transaction was a system transaction</p>
</li>
<li>
<p>The value capture type</p>
</li>
<li>
<p>The originating partition token used to query this change event</p>
</li>
<li>
<p>The mod number in the original data change event received from Spanner</p>
</li>
<li>
<p>Whether or not the data change event was the last record in the transaction in the partition</p>
</li>
<li>
<p>The total number of change stream partitions in the transaction</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>op</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory string that describes the type of operation. The <code>op</code> field value is <code>d</code>, signifying that this row was deleted.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ts_ms</code>, <code>ts_us</code>, <code>ts_ns</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Optional field that displays the time at which the connector processed the event.
The time is based on the system clock in the JVM running the Kafka Connect task. <br>
<br>
In the <code>source</code> object, <code>ts_ms</code> indicates the time that the change was made in the database. By comparing the value for <code>payload.source.ts_ms</code> with the value for <code>payload.ts_ms</code>, you can determine the lag between the source database update and Debezium.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A <em>delete</em> change event record provides a consumer with the information it needs to process the removal of this row.</p>
</div>
<div class="paragraph">
<p>Spanner connector events are designed to work with <a href="https://kafka.apache.org/documentation#compaction">Kafka log compaction</a>. Log compaction enables removal of some older messages as long as at least the most recent message for every key is kept. This lets Kafka reclaim storage space while ensuring that the topic contains a complete data set and can be used for reloading key-based state. Note that if the low watermark is enabled, compaction should not be enabled.</p>
</div>
<div id="spanner-tombstone-events" class="paragraph">
<div class="title">Tombstone events</div>
<p>When a row is deleted, the <em>delete</em> event value still works with log compaction, because Kafka can remove all earlier messages that have that same key. However, for Kafka to remove all messages that have that same key, the message value must be <code>null</code>. To make this possible, the connector follows a <em>delete</em> event with a special <em>tombstone</em> event that has the same key but a <code>null</code> value.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spanner-data-types"><a class="anchor" href="#spanner-data-types"></a>Data type mappings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Spanner connector represents changes to rows with events that are structured like the table in which the row exists. The event contains a field for each column value. How that value is represented in the event depends on the Spanner data type of the column. This section describes these mappings.</p>
</div>
<div class="sect2">
<h3 id="spanner-types"><a class="anchor" href="#spanner-types"></a>Spanner types</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Mappings for Spanner data types</caption>
<colgroup>
<col style="width: 55.5555%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Spanner data type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BOOLEAN</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BOOLEAN</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>ARRAY</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>ARRAY</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>FLOAT</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DOUBLE</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>NUMERIC</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIMESTAMP</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>NUMERIC</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setting-up-spanner"><a class="anchor" href="#setting-up-spanner"></a>Setting up Spanner</h2>
<div class="sectionbody">
<div class="ulist">
<div class="title">Checklist</div>
<ul>
<li>
<p>Make sure to provide a project ID, Spanner instance ID, Spanner database ID, and change stream name. See <a href="https://cloud.google.com/spanner/docs/change-streams/manage">documentation</a> on how to create change streams.</p>
</li>
<li>
<p>Make sure to create and configure a GCP service account with the proper credentials. The service account key will need to be provided in the connector configuration. See more <a href="https://cloud.google.com/iam/docs/service-accounts">information</a> about service accounts here.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the following section on how to configure a Debezium Spanner connector.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spanner-deploying-a-connector"><a class="anchor" href="#spanner-deploying-a-connector"></a>Deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With <a href="https://zookeeper.apache.org">Zookeeper</a>, <a href="http://kafka.apache.org/">Kafka</a>, and <a href="https://kafka.apache.org/documentation.html#connect">Kafka Connect</a> installed, the remaining tasks to deploy a Debezium Spanner connector are to download the <a href="https://repo1.maven.org/maven2/io/debezium/debezium-connector-spanner/2.7.0.Final/debezium-connector-spanner-2.7.0.Final-plugin.tar.gz">connector&#8217;s plug-in archive</a>, extract the JAR files into your Kafka Connect environment, and add the directory with the JAR files to <a href="https://kafka.apache.org/documentation/#connectconfigs">Kafka Connect&#8217;s <code>plugin.path</code></a>. You then need to restart your Kafka Connect process to pick up the new JAR files.</p>
</div>
<div class="paragraph">
<p>If you are working with immutable containers, see <a href="https://quay.io/organization/debezium">Debezium&#8217;s Container images</a> for Zookeeper, Kafka and Kafka Connect with the Spanner connector already installed and ready to run. You can also <a href="../operations/openshift.html" class="xref page">run Debezium on Kubernetes and OpenShift</a>.</p>
</div>
<div class="sect2">
<h3 id="spanner-example-configuration"><a class="anchor" href="#spanner-example-configuration"></a>Connector configuration example</h3>
<div class="paragraph">
<p>Following is an example of the configuration for a Spanner connector that connects to a change stream called <code>changeStreamAll</code> in the database <code>Database</code> in instance <code>Instance</code> and project <code>Project</code>.</p>
</div>
<div class="paragraph">
<p>You can choose to produce events for a subset of the schemas and tables. Optionally, ignore, mask, or truncate columns that are sensitive, too large, or not needed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "spanner-connector",  <i class="conum" data-value="1"></i><b>(1)</b>
  "config": {
    "connector.class": "io.debezium.connector.spanner.SpannerConnector", <i class="conum" data-value="2"></i><b>(2)</b>
    "gcp.spanner.change.stream": "changeStreamAll", <i class="conum" data-value="3"></i><b>(3)</b>
    "gcp.spanner.project.id": "Project", <i class="conum" data-value="4"></i><b>(4)</b>
    "gcp.spanner.instance.id": "Instance", <i class="conum" data-value="5"></i><b>(5)</b>
    "gcp.spanner.database.id": "Database", <i class="conum" data-value="6"></i><b>(6)</b>
    "gcp.spanner.credentials.json": &lt;key.json&gt;, <i class="conum" data-value="7"></i><b>(7)</b>
    "tasks.max": 1 <i class="conum" data-value="8"></i><b>(8)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The name of the connector when registered with a Kafka Connect service.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The name of this Spanner connector class.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The change stream name.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The GCP Project ID.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The Spanner Instance ID.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The Spanner Database ID.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The GCP service account key JSON.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The maximum number of tasks.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See the <a href="#spanner-connector-properties">complete list of Spanner connector properties</a> that can be specified in these configurations.</p>
</div>
</div>
<div class="sect2">
<h3 id="spanner-adding-connector-configuration"><a class="anchor" href="#spanner-adding-connector-configuration"></a>Adding connector configuration</h3>
<div class="paragraph">
<p>To start running a Spanner connector, create a connector configuration and add the configuration to your Kafka Connect cluster.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Spanner change stream is created and available.</p>
</li>
<li>
<p>The Spanner connector is installed.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a configuration for the Spanner connector.</p>
</li>
<li>
<p>Use the <a href="https://kafka.apache.org/documentation/#connect_rest">Kafka Connect REST API</a> to add that connector configuration to your Kafka Connect cluster.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Results</div>
<p>When the connector starts, it starts generating data change events for row-level operations and streaming change event records to Kafka topics.</p>
</div>
</div>
<div class="sect2">
<h3 id="spanner-monitoring"><a class="anchor" href="#spanner-monitoring"></a>Monitoring</h3>
<div class="paragraph">
<p>The Debezium Spanner connector provides only one type of metric in addition to the built-in support for JMX metrics that Zookeeper, Kafka, and Kafka Connect provide.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#spanner-streaming-metrics">Streaming metrics</a> provide information about connector operations when the connector is capturing changes and streaming change event records.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="../operations/monitoring.html#monitoring-debezium" class="xref page">Debezium monitoring documentation</a> provides details for how to expose these metrics by using JMX.</p>
</div>
</div>
<div class="sect2">
<h3 id="_customized_mbean_names"><a class="anchor" href="#_customized_mbean_names"></a>Customized MBean names</h3>
<div class="paragraph">
<p>Debezium connectors expose metrics via the MBean name for the connector.
These metrics, which are specific to each connector instance, provide data about the behavior of the connector&#8217;s snapshot, streaming, and schema history processes.</p>
</div>
<div class="paragraph">
<p>By default, when you deploy a correctly configured connector, Debezium generates a unique MBean name for each of the different connector metrics.
To view the metrics for a connector process, you configure your observability stack to monitor its MBean.
But these default MBean names depend on the connector configuration; configuration changes can result in changes to the MBean names.
A change to the MBean name breaks the linkage between the connector instance and the MBean, disrupting monitoring activity.
In this scenario, you must reconfigure the observability stack to use the new MBean name if you want to resume monitoring.</p>
</div>
<div class="paragraph">
<p>To prevent monitoring disruptions that result from MBean name changes, you can configure custom metrics tags.
You configure custom metrics by adding the <code>custom.metric.tags</code> property to the connector configuration.
The property accepts key-value pairs in which each key represents a tag for the MBean object name, and the corresponding value represents the value of that tag.
For example: <code>k1=v1,k2=v2</code>.
Debezium appends the specified tags to the MBean name of the connector.</p>
</div>
<div class="paragraph">
<p>After you configure the <code>custom.metric.tags</code> property for a connector, you can configure the observability stack to retrieve metrics associated with the specified tags.
The observability stack then uses the specified tags, rather than the mutable MBean names to uniquely identify connectors.
Later, if Debezium redefines how it constructs MBean names, or if the <code>topic.prefix</code> in the connector configuration changes, metrics collection is uninterrupted,
because the metrics scrape task uses the specified tag patterns to identify the connector.</p>
</div>
<div class="paragraph">
<p>A further benefit of using custom tags, is that you can use tags that reflect the architecture of your data pipeline, so that metrics are organized in a way that suits you operational needs.
For example, you might specify tags with values that declare the type of connector activity, the application context, or the data source, for example, <code>db1-streaming-for-application-abc</code>.
If you specify multiple key-value pairs, all of the specified pairs are appended to the connector&#8217;s MBean name.</p>
</div>
<div class="paragraph">
<p>The following example illustrates how tags modify the default MBean name.</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. How custom tags modify the connector MBean name</div>
<div class="content">
<div class="paragraph">
<p>By default, the {connector-name} connector uses the following MBean name for streaming metrics:
<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">debezium.Cloud Spanner:type=connector-metrics,context=streaming,server=<em>&lt;topic.prefix&gt;</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you set the value of <code>custom.metric.tags</code> to <code>database=salesdb-streaming,table=inventory</code>, Debezium generates the following custom MBean name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">debezium.Cloud Spanner:type=connector-metrics,context=streaming,server=<em>&lt;topic.prefix&gt;</em>,database=salesdb-streaming,table=inventory</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="spanner-streaming-metrics"><a class="anchor" href="#spanner-streaming-metrics"></a>Streaming metrics</h4>
<div class="paragraph">
<p>The <strong>MBean</strong> is <code>debezium.Cloud Spanner:type=connector-metrics,context=streaming,server=<em>&lt;topic.prefix&gt;</em></code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 45%;">
<col style="width: 25%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attributes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-millisecondssincelastevent"></a><a href="#connectors-strm-metric-millisecondssincelastevent"><code>MilliSecondsSinceLastEvent</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of milliseconds since the connector has read and processed the most recent event.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-totalnumberofeventsseen"></a><a href="#connectors-strm-metric-totalnumberofeventsseen"><code>TotalNumberOfEventsSeen</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The total number of events that this connector has seen since last started or reset.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-numberofeventsfiltered"></a><a href="#connectors-strm-metric-numberofeventsfiltered"><code>NumberOfEventsFiltered</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of events that have been filtered by include/exclude list filtering rules configured on the connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-queuetotalcapacity"></a><a href="#connectors-strm-metric-queuetotalcapacity"><code>QueueTotalCapacity</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>int</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The length the queue used to pass events between the streamer and the main Kafka Connect loop.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-queueremainingcapacity"></a><a href="#connectors-strm-metric-queueremainingcapacity"><code>QueueRemainingCapacity</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>int</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The free capacity of the queue used to pass events between the streamer and the main Kafka Connect loop.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-connected"></a><a href="#connectors-strm-metric-connected"><code>Connected</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>boolean</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Flag that denotes whether the connector is currently connected to the database server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-millisecondsbehindsource"></a><a href="#connectors-strm-metric-millisecondsbehindsource"><code>MilliSecondsBehindSource</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of milliseconds between the last change event&#8217;s timestamp and the connector processing it.
The values will incorporate any differences between the clocks on the machines where the database server and the connector are running.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-numberofcommittedtransactions"></a><a href="#connectors-strm-metric-numberofcommittedtransactions"><code>NumberOfCommittedTransactions</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of processed transactions that were committed.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-maxqueuesizeinbytes"></a><a href="#connectors-strm-metric-maxqueuesizeinbytes"><code>MaxQueueSizeInBytes</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The maximum buffer of the queue in bytes used to pass events between the streamer and the main Kafka Connect loop.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-currentqueuesizeinbytes"></a><a href="#connectors-strm-metric-currentqueuesizeinbytes"><code>CurrentQueueSizeInBytes</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The current buffer of the queue in bytes used to pass events between the streamer and the main Kafka Connect loop.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-lowwatermark"></a><a href="#connectors-strm-metric-lowwatermark"><code>LowWatermark</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The current low watermark of the connector task. The low watermark describes the time T at which the connector is guaranteed to have streamed out all events with timestamp &lt; T.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-millisecondslowwatermark"></a><a href="#connectors-strm-metric-lowwatermark"><code>MilliSecondsLowWatermark</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The current low watermark of the connector task in milliseconds. The low watermark describes the time T at which the connector is guaranteed to have streamed out all events with timestamp &lt; T.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-millisecondslowwatermarklag"></a><a href="#connectors-strm-metric-lowwatermarklag"><code>MilliSecondsLowWatermarkLag</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The lag of the low watermark behind the current time in milliseconds. The low watermark describes the time T at which the connector is guaranteed to have streamed out all events with timestamp &lt; T.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-latencylowwatermarklag"></a><a href="#connectors-strm-metric-latencylowwatermarklag"><code>LatencyLowWatermarkLag&lt;variant&gt;MilliSeconds</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The distribution of the lag of the low watermark behind the current time in milliseconds. The variant will include P50, P95, P99, Average, Min, Max calculations.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-latencyspanner"></a><a href="#connectors-strm-metric-latencyspanner"><code>LatencySpanner&lt;variant&gt;MilliSeconds</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The distribution of the Spanner commit timestamp to connector read latency. The variant will include P50, P95, P99, Average, Min, Max calculations.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-latencyreadtoemit"></a><a href="#connectors-strm-metric-latencyreadtoemit"><code>LatencyReadToEmit&lt;variant&gt;MilliSeconds</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The distribution of the Spanner read timestamp to connector emit latency. The variant will include P50, P95, P99, Average, Min, Max calculations.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-latencycommittoemit"></a><a href="#connectors-strm-metric-latencycommittoemit"><code>LatencyCommitToEmit&lt;Variant&gt;MilliSeconds</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The distribution of the Spanner commit timestamp to connector emit latency. The variant will include P50, P95, P99, Average, Min, Max calculations.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-latencycommittopublish"></a><a href="#connectors-strm-metric-latencycommittopublish"><code>LatencyCommitToPublish&lt;variant&gt;MilliSeconds</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The distribution of the Spanner commit timestamp to Kafka publish timestamp latency. The variant will include P50, P95, P99, Average, Min, Max calculations.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-latencyemittopublish"></a><a href="#connectors-strm-metric-latencyemittopublish"><code>LatencyEmitToPublish&lt;variant&gt;MilliSeconds</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The distribution of the connector emit timestamp to Kafka publish timestamp latency. The variant will include P50, P95, P99, Average, Min, Max calculations.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-spannereventqueuecapacity"></a><a href="#connectors-strm-metric-spannereventqueuecapacity"><code>SpannerEventQueueCapacity</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The total Spanner event queue capacity. This queue indicates the total capacity of StreamEventQueue, a Spanner-specific queue that stores elements received from change stream queries.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-remainingspannereventqueuecapacity"></a><a href="#connectors-strm-metric-remainingspannereventqueuecapacity"><code>RemainingSpannerEventQueueCapacity</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The remaining Spanner event queue capacity.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-taskstatechangeeventqueuecapacity"></a><a href="#connectors-strm-metric-taskstatechangeeventqueuecapacity"><code>TaskStateChangeEventQueueCapacity</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The total task state change event queue capacity. This queue indicates the total capacity of the TaskStateChangeEventQueue, a Spanner-specific queue that stores events happening in the connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-remainingtaskstatechangeeventqueuecapacity"></a><a href="#connectors-strm-metric-remainingtaskstatechangeeventqueuecapacity"><code>RemainingTaskStateChangeEventQueueCapacity</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The remaining task state change event queue capacity.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-numberofchangestreampartitionsdetected"></a><a href="#connectors-strm-metric-numberofchangestreampartitionsdetected"><code>NumberOfChangeStreamPartitionsDetected</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The total number of partitions detected by the current task.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-numberofchangestreamqueriesissued"></a><a href="#connectors-strm-metric-numberofchangestreamqueriesissued"><code>NumberOfChangeStreamQueriesIssued</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The total number of change stream queries issued by the current task.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-numberofactivechangestreamqueries"></a><a href="#connectors-strm-metric-numberofactivechangestreamqueries"><code>NumberOfActiveChangeStreamQueries</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The active number of change stream queries detected by the current task.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="spanner-connector-properties"><a class="anchor" href="#spanner-connector-properties"></a>Connector configuration properties</h3>
<div class="paragraph">
<p>The Debezium Spanner connector has many configuration properties that you can use to achieve the right connector behavior for your application. Many properties have default values. Information about the properties is organized as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#spanner-required-configuration-properties">Required configuration properties</a></p>
</li>
<li>
<p><a href="#spanner-advanced-configuration-properties">Advanced configuration properties</a></p>
</li>
<li>
<p><a href="#spanner-pass-through-properties">Pass-through configuration properties</a></p>
</li>
</ul>
</div>
<div id="spanner-required-configuration-properties" class="paragraph">
<p>The following configuration properties are <em>required</em> unless a default value is available.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Required connector configuration properties</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 25%;">
<col style="width: 45%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-name"></a><a href="#spanner-property-name"><code>name</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No default</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Unique name for the connector. Attempting to register again with the same name will fail. This property is required by all Kafka Connect connectors.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-connector-class"></a><a href="#spanner-property-connector-class"><code>connector.class</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No default</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the Java class for the connector. Always use a value of <code>io.debezium.connector.spanner.SpannerConnector</code> for the Spanner connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-tasks-max"></a><a href="#spanner-property-tasks-max"><code>tasks.max</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>1</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The maximum number of tasks that should be created for this connector. The Spanner connector can use more than 1 tasks if you enable offset.storage.per.task mode.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-project"></a><a href="#spanner-property-project"><code>gcp.spanner.project.id</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No default</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The GCP project ID</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-instance"></a><a href="#spanner-property-instance"><code>gcp.spanner.instance.id</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No default</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The Spanner instance ID</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-database"></a><a href="#spanner-property-database"><code>gcp.spanner.database.id</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No default</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The Spanner database ID</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-changestream"></a><a href="#spanner-property-changestream"><code>gcp.spanner.change.stream</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No default</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The Spanner change stream</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-credentials"></a><a href="#spanner-property-credentials"><code>gcp.spanner.credentials.path</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No default</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The file path to the GCP service account key JSON.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-credentialsjson"></a><a href="#spanner-property-credentialsjson"><code>gcp.spanner.credentials.json</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No default</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The GCP service account key JSON. Required if gcp.spanner.credentials.path is not provided.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-schema-name-adjustment-mode"></a><a href="#spanner-property-schema-name-adjustment-mode"><code>schema.name.adjustment.mode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>none</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies how schema names should be adjusted for compatibility with the message converter used by the connector. Possible settings: <br></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>none</code> does not apply any adjustment.<br></p>
</li>
<li>
<p><code>avro</code> replaces the characters that cannot be used in the Avro type name with underscore.<br></p>
</li>
<li>
<p><code>avro_unicode</code> replaces the underscore or characters that cannot be used in the Avro type name with corresponding unicode like _uxxxx. Note: _ is an escape sequence like backslash in Java<br></p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-field-name-adjustment-mode"></a><a href="#spanner-property-field-name-adjustment-mode"><code>field.name.adjustment.mode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>none</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies how field names should be adjusted for compatibility with the message converter used by the connector. Possible settings: <br></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>none</code> does not apply any adjustment.<br></p>
</li>
<li>
<p><code>avro</code> replaces the characters that cannot be used in the Avro type name with underscore.<br></p>
</li>
<li>
<p><code>avro_unicode</code> replaces the underscore or characters that cannot be used in the Avro type name with corresponding unicode like _uxxxx. Note: _ is an escape sequence like backslash in Java<br></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="../configuration/avro.html#avro-naming" class="xref page">Avro naming</a> for more details.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div id="spanner-advanced-configuration-properties" class="paragraph">
<p>The following <em>advanced</em> configuration properties have defaults that work in most situations and therefore rarely need to be specified in the connector&#8217;s configuration.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Advanced connector configuration properties</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-lowwatermark"></a><a href="#spanner-property-lowwatermark"><code>gcp.spanner.low-watermark.enabled</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>false</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Whether or not the low watermark is enabled for the connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-lowwatermarkupdateperiod"></a><a href="#spanner-property-lowwatermarkupdateperiod"><code>gcp.spanner.low-watermark.update-period.ms</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>1000 ms</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The interval at which the low watermark is updated.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-heartbeatinterval"></a><a href="#spanner-property-heartbeatinterval"><code>heartbeat.interval.ms</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>300000</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The Spanner heartbeat interval.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-starttime"></a><a href="#spanner-property-starttime"><code>gcp.spanner.start.time</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>current time</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The connector start time.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-endtime"></a><a href="#spanner-property-endtime"><code>gcp.spanner.end.time</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>indefinite end time</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The connector end time.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-eventqueuecapacity"></a><a href="#spanner-property-eventqueuecapacity"><code>gcp.spanner.stream.event.queue.capacity</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>10000</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The Spanner event queue capacity. Increase this capacity if the remaining stream event queue capacity approaches zero during connector runtime.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-taskstatechangequeuecapacity"></a><a href="#spanner-property-taskstatechangequeuecapacity"><code>connector.spanner.task.state.change.event.queue.capacity</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>1000</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The task state change event queue capacity. Increase this capacity if the remaining task state change event queue capacity approaches zero during connector runtime.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-missedheartbeatsmax"></a><a href="#spanner-property-missedheartbeatsmax"><code>connector.spanner.max.missed.heartbeats</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>5</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The maximum number of missed heartbeats for a change stream query before an exception is thrown</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-scalermonitorenabled"></a><a href="#spanner-property-scalermonitorenabled"><code>scaler.monitor.enabled</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>false</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Whether or not task autoscaling is enabled</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-synctopicname"></a><a href="#spanner-property-synctopicname"><code>connector.spanner.sync.topic</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><em>sync_topic_spanner_connector</em>&lt;connectorname&gt;</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name for the Sync topic. The Sync topic is an internal connector topic used to store communication between tasks.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-syncpollduration"></a><a href="#spanner-property-syncpollduration"><code>connector.spanner.sync.poll.duration</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>500 ms</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The poll duration for the sync topic.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-syncrequesttimeout"></a><a href="#spanner-property-syncrequesttimeout"><code>connector.spanner.sync.request.timeout.ms</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>5000 ms</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The timeout for requests to the sync topic.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-syncdeliverytimeout"></a><a href="#spanner-property-syncdeliverytimeout"><code>connector.spanner.sync.delivery.timeout.ms</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>15000 ms</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The timeout for publishing to the sync topic.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-synccommitoffsetstimeout"></a><a href="#spanner-property-synccommitoffsetstimeout"><code>connector.spanner.sync.commit.offsets.timeout.ms</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>5000 ms</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The timeout for committing offsets for the sync topic.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-synccommitoffsetsinterval"></a><a href="#spanner-property-synccommitoffsetsinterval"><code>connector.spanner.sync.commit.offsets.interval.ms</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>60000 ms</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The interval at which offsets are committed for the sync topic.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-syncpublishwaitingtimeout"></a><a href="#spanner-property-syncpublishwaitingtimeout"><code>connector.spanner.sync.publisher.wait.timeout</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>5 ms</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The interval at which messages are published to the sync topic.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-rebalancetopicname"></a><a href="#spanner-property-rebalancetopicname"><code>connector.spanner.rebalancing.topic</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><em>rebalancing_topic_spanner_connector</em>&lt;connectorname&gt;</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name for the rebalancing topic. The rebalancing topic is an internal connector topic used to determine task aliveness.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-rebalancepollduration"></a><a href="#spanner-property-rebalancepollduration"><code>connector.spanner.rebalancing.poll.duration</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>5000</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The poll duration for the rebalancing topic.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-rebalancecommitoffsetstimeout"></a><a href="#spanner-property-rebalancecommitoffsetstimeout"><code>connector.spanner.rebalancing.commit.offsets.timeout</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>5000</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The timeout for committing offsets for the rebalance topic.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-rebalancecommitoffsetsinterval"></a><a href="#spanner-property-rebalancecommitoffsetsinterval"><code>connector.spanner.rebalancing.commit.offsets.interval.ms</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>60000 ms</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The interval at which offsets are committed for the sync topic.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-rebalancetaskwaitingtimeout"></a><a href="#spanner-property-rebalancetaskwaitingtimeout"><code>connector.spanner.rebalancing.task.waiting.timeout</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>1000 ms</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The duration of time a task waits before processing a rebalancing event.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-custom-metric-tags"></a><a href="#spanner-property-custom-metric-tags"><code>custom.metric.tags</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>No default</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Defines tags that customize MBean object names by adding metadata that provides contextual information.
Specify a comma-separated list of key-value pairs.
Each key represents a tag for the MBean object name, and the corresponding value represents a value for the key, for example, <br>
<code>k1=v1,k2=v2</code></p>
</div>
<div class="paragraph">
<p>The connector appends the specified tags to the base MBean object name.
Tags can help you to organize and categorize metrics data.
You can define tags to identify particular application instances, environments, regions, versions, and so forth.
For more information, see <a href="#customized-mbean-names">Customized MBean names</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="spanner-property-errors-max-retires"></a><a href="#spanner-property-errors-max-retires"><code>errors.max.retries</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>-1</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies how the connector responds after an operation that results in a retriable error, such as a connection error.<br>
Set one of the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-1</code></dt>
<dd>
<p>No limit. The connector always restarts automatically, and retries the operation, regardless of the number of previous failures.</p>
</dd>
<dt class="hdlist1"><code>0</code></dt>
<dd>
<p>Disabled. The connector fails immediately, and never retries the operation.
User intervention is required to restart the connector.</p>
</dd>
<dt class="hdlist1"><code>&gt; 0</code></dt>
<dd>
<p>The connector restarts automatically until it reaches the specified maximum number of retries.
After the next failure, the connector stops, and user intervention is required to restart it.</p>
</dd>
</dl>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For a more complete list of advanced configuration, see <a href="https://github.com/debezium/debezium-connector-spanner/blob/main/src/main/java/io/debezium/connector/spanner/config/BaseSpannerConnectorConfig.java">Github code</a>.</p>
</div>
<div id="spanner-pass-through-properties" class="paragraph">
<div class="title">Pass-through connector configuration properties</div>
<p>The connector also supports <em>pass-through</em> configuration properties that are used when creating the Kafka producer and consumer.</p>
</div>
<div class="paragraph">
<p>Be sure to consult the <a href="https://kafka.apache.org/documentation.html">Kafka documentation</a> for all of the configuration properties for Kafka producers and consumers. The Spanner connector does use the <a href="https://kafka.apache.org/documentation.html#consumerconfigs">new consumer configuration properties</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spanner-when-things-go-wrong"><a class="anchor" href="#spanner-when-things-go-wrong"></a>Behavior when things go wrong</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Debezium is a distributed system that captures all changes in multiple upstream databases; it never misses or loses an event. When the system is operating normally or being managed carefully then Debezium provides <em>exactly once</em> delivery of every change event record.</p>
</div>
<div class="paragraph">
<p>If a fault does happen then the system does not lose any events. However, while it is recovering from the fault, it might repeat some change events. In these abnormal situations, Debezium, like Kafka, provides <em>at least once</em> delivery of change events.</p>
</div>
<div class="paragraph">
<p>The rest of this section describes how Debezium handles various kinds of faults and problems.</p>
</div>
<div class="sect2">
<h3 id="spanner-connector-configuration-and-startup-errors"><a class="anchor" href="#spanner-connector-configuration-and-startup-errors"></a>Configuration and startup errors</h3>
<div class="paragraph">
<p>In the following situations, the connector fails when trying to start, reports an error/exception in the log, and stops running:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The connector&#8217;s configuration is invalid.</p>
</li>
<li>
<p>The connector cannot successfully connect to Spanner by using the specified connection parameters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In these cases, the error message has details about the problem and possibly a suggested workaround. After you correct the configuration or address the Spanner problem, restart the connector.</p>
</div>
</div>
<div class="sect2">
<h3 id="spanner-becomes-unavailable"><a class="anchor" href="#spanner-becomes-unavailable"></a>Spanner becomes unavailable</h3>
<div class="paragraph">
<p>When the connector is running, Spanner could become unavailable for any number of reasons. The connector will continue running and will be able to stream events once Spanner becomes available again.</p>
</div>
</div>
<div class="sect2">
<h3 id="spanner-kafka-connect-process-stops-gracefully"><a class="anchor" href="#spanner-kafka-connect-process-stops-gracefully"></a>Kafka Connect process stops gracefully</h3>
<div class="paragraph">
<p>Suppose that Kafka Connect is being run in distributed mode and a Kafka Connect process is stopped gracefully. Prior to shutting down that process, Kafka Connect migrates the process&#8217;s connector tasks to another Kafka Connect process in that group. The new connector tasks start processing exactly where the prior tasks stopped. There is a short delay in processing while the connector tasks are stopped gracefully and restarted on the new processes.</p>
</div>
</div>
<div class="sect2">
<h3 id="spanner-kafka-connect-process-crashes"><a class="anchor" href="#spanner-kafka-connect-process-crashes"></a>Kafka Connect process crashes</h3>
<div class="paragraph">
<p>If the Kafka Connector process stops unexpectedly, any connector tasks it was running terminate without recording their most recently processed offsets. When Kafka Connect is being run in distributed mode, Kafka Connect restarts those connector tasks on other processes. However, Spanner connectors resume from the last offset that was <em>recorded</em> by the earlier processes. This means that the new replacement tasks might generate some of the same change events that were processed just prior to the crash. The number of duplicate events depends on the offset flush period and the volume of data changes just before the crash.</p>
</div>
<div class="paragraph">
<p>Because there is a chance that some events might be duplicated during a recovery from failure, consumers should always anticipate some duplicate events.</p>
</div>
<div class="paragraph">
<p>In each change event record, Debezium connectors insert source-specific information about the origin of the event, such as the originating partition token, the commit timestamp, the transaction ID, the record sequence, and the mod number. Consumers could use these identifiers for deduplication.</p>
</div>
</div>
<div class="sect2">
<h3 id="spanner-kafka-becomes-unavailable"><a class="anchor" href="#spanner-kafka-becomes-unavailable"></a>Kafka becomes unavailable</h3>
<div class="paragraph">
<p>As the connector generates change events, the Kafka Connect framework records those events in Kafka by using the Kafka producer API. Periodically, at a frequency that you specify in the Kafka Connect configuration, Kafka Connect records the latest offset that appears in those change events. If the Kafka brokers become unavailable, the Kafka Connect process that is running the connectors repeatedly tries to reconnect to the Kafka brokers. In other words, the connector tasks pause until a connection can be re-established, at which point the connectors resume exactly where they left off.</p>
</div>
</div>
<div class="sect2">
<h3 id="spanner-connector-is-stopped-for-a-duration"><a class="anchor" href="#spanner-connector-is-stopped-for-a-duration"></a>Connector is stopped for a duration</h3>
<div class="paragraph">
<p>If the connector is gracefully stopped, the database can continue to be used. When the connector restarts, it resumes streaming changes where it left off. That is, it generates change event records for all database changes that were made while the connector was stopped.</p>
</div>
<div class="paragraph">
<p>A properly configured Kafka cluster is able to handle massive throughput. Kafka Connect is written according to Kafka best practices, and given enough resources a Kafka Connect connector can also handle very large numbers of database change events. Because of this, after being stopped for a while, when a Debezium connector restarts, it is very likely to catch up with the database changes that were made while it was stopped. How quickly this happens depends on the capabilities and performance of Kafka and the volume of changes being made to the data in Spanner.</p>
</div>
<div class="paragraph">
<p>Note that the current connector can only be streamed back in time by ~one hour. The Kafka connector reads the information schema at the Kafka connector&#8217;s start timestamp to retrieve schema information. By default, Spanner cannot read the information schema at read timestamps before the <a href="https://cloud.google.com/spanner/docs/reference/rest/v1/projects.instances.databases?_gl=1*1wl08s9*_ga*MTYxNjk4NDM4OS4xNjY5MDY0ODQ5*_ga_WH2QY8WWF5*MTY3MTEzNTk3Ni4yMS4wLjE2NzExMzU5NzYuMC4wLjA.#Database.FIELDS.version_retention_period">version retention period</a>, which defaults to one hour. If you wants to start the connector from earlier than one hour into the past, you will need to increase the database&#8217;s version retention period.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spanner-limitations"><a class="anchor" href="#spanner-limitations"></a>Limitations</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The connector does not support streaming <a href="https://debezium.io/blog/2021/10/07/incremental-snapshots/">snapshot events</a>.</p>
</li>
<li>
<p>If watermarking is enabled in the connector, you cannot configure <a href="https://debezium.io/documentation/reference/stable/transformations/topic-routing.html">Debezium topic
routing transformations</a>.</p>
</li>
<li>
<p>This connector currently does not support the <a href="https://cloud.google.com/spanner/docs/postgresql-interface/">PostgreSQL interface for Cloud Spanner</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</article>
</div>
<div class="article-cell2">
</div>
</div>

<div id="toc-rightbar"></div>    <footer class="footer">
        <div class="wrapper">
            <div class="copyright">Copyright &copy; 2024 Debezium Community (Rev: <span class="truncated"><a href="https://github.com/debezium/debezium/commit/c1a58d4ba2ca0bf77e29fc2fb7f9f2b95fc4f725">c1a58d4b</a></span>)
            
        </div>
    </footer>
</main></div>
<script>
    /* Make sure TOC carets are expanded if sub-elements exist */
    $("#toc").each(function(i,v) {
      $(this).closest('article').addClass('with-toc');
    });

    $("#toc ul.sectlevel1 > li").each(function(i,v) {
      $(this).has("ul").addClass("expanded");
    });

    $(function() {
        /* Expands all the documentation submenus */
        $(".nav-list > .nav-item:not(.is-active) .nav-item-toggle").click();
    });

    /**
     * This checks if a "#toc" element exists in the DOM and if so:
     *
     *  1. Appends a cloned copy of the #toc node to the #toc-rightbar div.
     *  2. Forces the #toc-rightbar div to be visible.
     *  3. Adds the .toc-right class to the #article-wrapper div to restrict the article's overall width.
     */
    var $toc = $("#toc");
    if ( $toc.length ) {
        $("#toc-rightbar").append($toc.clone());
        $("body .main").addClass("with-toc");
    }

    /**
     * In order to make CSS changes that are backward compatible with old adoc files, this applies a version
     * style to the body tag so we can use it to differentiate between CSS styles per version if needed,
     * such as tfoot rows.
     */
    var $version = $("body .nav-container").data("version");
    var $versionClass = "version-" + $version;
    $versionClass = $versionClass.replace('.','-');
    $("body").addClass($versionClass);

    /** A CSS trick to wrap long-width tables in a div that can be scrolled on smaller screens */
    $("table.tableblock").wrap("<div class='table-scroll-wrapper'></div>");

    $(function() {
        /* apply floating scrollbar to the scroll-wrapper */
        $(".table-scroll-wrapper").floatingScrollbar();
    });

</script>
<script src="../../../debezium-antora/js/site.js"></script>
<script async src="../../../debezium-antora/js/vendor/highlight.js"></script>

<script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
  try {
    var pageTracker = _gat._getTracker("UA-10656779-1");
    pageTracker._trackPageview();
  } catch(err) {}
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-76464546-1', 'auto');
  ga('send', 'pageview');
  ga('set', 'anonymizeIp', true);
  ga('require', 'linkid', 'linkid.js');
</script>
</body>
</html>