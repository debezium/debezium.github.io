<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Debezium connector for Db2 :: Debezium Documentation</title>
    <link rel="canonical" href="https://www.debezium.io/documentation/reference/connectors/db2.html">
    <meta name="generator" content="Antora 2.3.4">
<link rel="stylesheet" href="../../debezium-antora/css/site.css">
<link rel="stylesheet" href="../../debezium-antora/css/debezium-antora.css">
<link rel="stylesheet" href="../../debezium-antora/css/highlightjs-dark.css">
<link rel="stylesheet" href="https://static.jboss.org/css/rhbar.css">
<script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.js"></script>
<script src="../../debezium-antora/js/jquery.ba-floatingscrollbar.js"></script>
</head>
<body class="article">
<header class="header">
  <div id="rhbar">
      <a class="jbdevlogo" href="https://developers.redhat.com"></a>
      <a class="rhlogo" href="https://www.redhat.com"></a>
  </div>
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
          <img src="/assets/images/color_white_debezium_type_600px.svg" style="height: 32px; margin-right: 14px;"/>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="/documentation/faq">FAQ</a>
        <a class="navbar-item" href="/documentation">DOCUMENTATION</a>
        <a class="navbar-item" href="/releases">RELEASES</a>
        <a class="navbar-item" href="/community">COMMUNITY</a>
        <a class="navbar-item" href="/blog">BLOG</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="reference" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Debezium Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tutorial.html">Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../install.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../postgres-plugins.html">PostgreSQL Decoding Plugins</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../features.html">Features</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/avro.html">Avro Serialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/topic-routing.html">Topic Routing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/event-flattening.html">New Record State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/mongodb-event-flattening.html">MongoDB New Document State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/outbox-event-router.html">Outbox Event Router</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/filtering.html">Message Filtering</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/content-based-routing.html">Content-Based Routing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/applying-transformations-selectively.html">Using SMT Predicates to Selectively Apply Transformations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/topic-auto-create-config.html">Customizing Topic Auto-Creation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/signalling.html">Sending Signals to Debezium</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Connectors</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="mysql.html">MySQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="mongodb.html">MongoDB</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="postgresql.html">PostgreSQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="oracle.html">Oracle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="sqlserver.html">SQL Server</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="db2.html">Db2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cassandra.html">Cassandra</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="vitess.html">Vitess</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">API and SPI</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/engine.html">Debezium Engine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/converters.html">Custom Converters</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Integrations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/serdes.html">Change Event SerDes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/outbox.html">Outbox Quarkus Extension</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/cloudevents.html">CloudEvents</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/tracing.html">OpenTracing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/testcontainers.html">Integration Testing with Testcontainers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Operations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/debezium-server.html">Debezium Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/monitoring.html">Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/openshift.html">Running on Openshift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/embedded.html">Embedding Debezium</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Debezium Documentation</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Debezium Documentation</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
        <li class="version">
          <a href="../1.7/index.html">1.7</a>
        </li>
        <li class="version">
          <a href="../1.6/index.html">1.6</a>
        </li>
        <li class="version">
          <a href="../1.5/index.html">1.5</a>
        </li>
        <li class="version">
          <a href="../1.4/index.html">1.4</a>
        </li>
        <li class="version">
          <a href="../1.3/index.html">1.3</a>
        </li>
        <li class="version">
          <a href="../1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../1.1/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../1.0/index.html">1.0</a>
        </li>
        <li class="version">
          <a href="../0.10/index.html">0.10</a>
        </li>
        <li class="version">
          <a href="../0.9/index.html">0.9</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main" class="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Debezium Documentation</a></li>
    <li>Connectors</li>
    <li><a href="db2.html">Db2</a></li>
  </ul>
</nav>
    <div class="page-versions-container">
    Version:
    <div class="page-versions">
        <button class="version-menu-toggle versions-menu-current" title="Show other versions of page">master</button>
        <!--<button class="version-menu-toggle versions-menu-select" title="Select other versions">Select</button>-->
        <div class="version-menu">
                <a class="version is-current" href="db2.html">master</a>
                <a class="version" href="../1.7/connectors/db2.html">1.7</a>
                <a class="version" href="../1.6/connectors/db2.html">1.6</a>
                <a class="version" href="../1.5/connectors/db2.html">1.5</a>
                <a class="version" href="../1.4/connectors/db2.html">1.4</a>
                <a class="version" href="../1.3/connectors/db2.html">1.3</a>
                <a class="version" href="../1.2/connectors/db2.html">1.2</a>
                <a class="version" href="../1.1/connectors/db2.html">1.1</a>
                <a class="version is-missing" href="../1.0/index.html">1.0</a>
                <a class="version is-missing" href="../0.10/index.html">0.10</a>
                <a class="version is-missing" href="../0.9/index.html">0.9</a>
        </div>
        |
    </div>
    </div>
  <div class="edit-this-page"><a href="https://github.com/debezium/debezium/edit/master/documentation/modules/ROOT/pages/connectors/db2.adoc">Edit this Page</a></div>
  </div>
<div class="article-grid">
<div class="article-cell1">
<article class="doc">
            <div class="version-banner version-banner-development">
    You are viewing documentation for the current development version of Debezium.
    <br/>
            If you want to view the latest stable version of this page, please go <a href="../1.6/connectors/db2.html">here</a>.
            
</div>            <h1 class="page">Debezium connector for Db2</h1>
        <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#db2-overview">Overview</a></li>
<li><a href="#how-the-db2-connector-works">How the connector works</a>
<ul class="sectlevel2">
<li><a href="#db2-snapshots">Snapshots</a></li>
<li><a href="#how-debezium-db2-connectors-read-change-data-tables">Change-data tables</a></li>
<li><a href="#db2-topic-names">Topic names</a></li>
<li><a href="#about-the-debezium-db2-connector-schema-change-topic">Schema change topic</a></li>
<li><a href="#db2-transaction-metadata">Transaction metadata</a></li>
</ul>
</li>
<li><a href="#db2-events">Data change events</a>
<ul class="sectlevel2">
<li><a href="#db2-change-event-keys">Change event keys</a></li>
<li><a href="#db2-change-event-values">Change event values</a></li>
<li><a href="#db2-create-events"><em>create</em> events</a></li>
<li><a href="#db2-update-events"><em>update</em> events</a></li>
<li><a href="#db2-delete-events"><em>delete</em> events</a></li>
</ul>
</li>
<li><a href="#db2-data-types">Data type mappings</a>
<ul class="sectlevel2">
<li><a href="#db2-basic-types">Basic types</a></li>
<li><a href="#db2-temporal-types">Temporal types</a></li>
<li><a href="#db2-timestamp-types">Timestamp types</a></li>
<li><a href="#db2-decimal-types">Decimal types</a></li>
</ul>
</li>
<li><a href="#setting-up-db2">Setting up Db2</a>
<ul class="sectlevel2">
<li><a href="#_putting_tables_into_capture_mode">Putting tables into capture mode</a></li>
<li><a href="#_effect_of_db2_capture_agent_configuration_on_server_load_and_latency">Effect of Db2 capture agent configuration on server load and latency</a></li>
<li><a href="#_db2_capture_agent_configuration_parameters">Db2 capture agent configuration parameters</a></li>
</ul>
</li>
<li><a href="#db2-deploying-a-connector">Deployment</a>
<ul class="sectlevel2">
<li><a href="#db2-example-configuration">Db2 connector configuration example</a></li>
<li><a href="#db2-adding-connector-configuration">Adding connector configuration</a></li>
<li><a href="#db2-connector-properties">Connector properties</a></li>
</ul>
</li>
<li><a href="#db2-monitoring">Monitoring</a>
<ul class="sectlevel2">
<li><a href="#db2-snapshot-metrics">Snapshot metrics</a></li>
<li><a href="#db2-streaming-metrics">Streaming metrics</a></li>
<li><a href="#db2-schema-history-metrics">Schema history metrics</a></li>
</ul>
</li>
<li><a href="#db2-management">Management</a></li>
<li><a href="#db2-schema-evolution">Schema evolution</a>
<ul class="sectlevel2">
<li><a href="#db2-offline-schema-update">Offline schema update</a></li>
<li><a href="#db2-hot-schema-update">Online schema update</a></li>
</ul>
</li>
</ul>
</div>
<div class="paragraph">
<p>Debezium&#8217;s Db2 connector can capture row-level changes in the tables of a Db2 database. This connector is strongly inspired by the Debezium implementation of SQL Server, which uses a SQL-based polling model that puts tables into "capture mode". When a table is in capture mode, the Debezium Db2 connector generates and streams a change event for each row-level update to that table.</p>
</div>
<div class="paragraph">
<p>A table that is in capture mode has an associated change-data table, which Db2 creates. For each change to a table that is in capture mode, Db2 adds data about that change to the table&#8217;s associated change-data table. A change-data table contains an entry for each state of a row. It also has special entries for deletions. The Debezium Db2 connector reads change events from change-data tables and emits the events to Kafka topics.</p>
</div>
<div class="paragraph">
<p>The first time a Debezium Db2 connector connects to a Db2 database, the connector reads a consistent snapshot of the tables for which the connector is configured to capture changes. By default, this is all non-system tables. There are connector configuration properties that let you specify which tables to put into capture mode, or which tables to exclude from capture mode.</p>
</div>
<div class="paragraph">
<p>When the snapshot is complete the connector begins emitting change events for committed updates to tables that are in capture mode. By default, change events for a particular table go to a Kafka topic that has the same name as the table. Applications and services consume change events from these topics.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The connector requires the use of the abstract syntax notation (ASN) libraries, which are available as a standard part of Db2 for Linux.
To use the ASN libraries, you must have a license for IBM InfoSphere Data Replication (IIDR).
You do not have to install IIDR to use the ASN libraries.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Db2 connector has been tested with Db2 for Linux.
It is expected that the connector would also work on other platforms such as Windows,
and we&#8217;d love to get your feedback if you can confirm this to be the case.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="db2-overview"><a class="anchor" href="#db2-overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Debezium Db2 connector is based on the <a href="https://www.ibm.com/support/pages/q-replication-and-sql-replication-product-documentation-pdf-format-version-101-linux-unix-and-windows">ASN Capture/Apply agents</a>
that enable SQL Replication in Db2. A capture agent:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generates change-data tables for tables that are in capture mode.</p>
</li>
<li>
<p>Monitors tables in capture mode and stores change events for updates to those tables in their corresponding change-data tables.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Debezium connector uses a SQL interface to query change-data tables for  change events.</p>
</div>
<div class="paragraph">
<p>The database administrator must put the tables for which you want to capture changes into capture mode. For convenience and for automating testing, there are <a href="#managing-debezium-db2-connectors">Debezium user-defined functions (UDFs)</a> in C that you can compile and then use to do the following management tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Start, stop, and reinitialize the ASN agent</p>
</li>
<li>
<p>Put tables into capture mode</p>
</li>
<li>
<p>Create the replication (ASN) schemas and change-data tables</p>
</li>
<li>
<p>Remove tables from capture mode</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Alternatively, you can use Db2 control commands to accomplish these tasks.</p>
</div>
<div class="paragraph">
<p>After the tables of interest are in capture mode, the connector reads their corresponding change-data tables to obtain change events for table updates. The connector emits a change event for each row-level insert, update, and delete operation to a Kafka topic that has the same name as the changed table. This is default behavior that you can modify. Client applications read the Kafka topics that correspond to the database tables of interest and can react to each row-level change event.</p>
</div>
<div class="paragraph">
<p>Typically, the database administrator puts a table into capture mode in the middle of the life of a table. This means that the connector does not have the complete history of all changes that have been made to the table. Therefore, when the Db2 connector first connects to a particular Db2 database, it starts by performing a <em>consistent snapshot</em> of each table that is in capture mode. After the connector completes the snapshot, the connector streams change events from the point at which the snapshot was made. In this way, the connector starts with a consistent view of the tables that are in capture mode, and does not drop any changes that were made while it was performing the snapshot.</p>
</div>
<div class="paragraph">
<p>Debezium connectors are tolerant of failures. As the connector reads and produces change events, it records the log sequence number (LSN) of the change-data table entry. The LSN is the position of the change event in the database log. If the connector stops for any reason, including communication failures, network problems, or crashes, upon restarting it continues reading the change-data tables where it left off. This includes snapshots. That is, if the snapshot was not complete when the connector stopped, upon restart the connector begins a new snapshot.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-the-db2-connector-works"><a class="anchor" href="#how-the-db2-connector-works"></a>How the connector works</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To optimally configure and run a Debezium Db2 connector, it is helpful to understand how the connector performs snapshots, streams change events, determines Kafka topic names, and handles schema changes.</p>
</div>
<div class="sect2">
<h3 id="db2-snapshots"><a class="anchor" href="#db2-snapshots"></a>Snapshots</h3>
<div class="paragraph">
<p>Db2`s replication feature is not designed to store the complete history of database changes. Consequently, when a Debezium Db2 connector connects to a database for the first time, it takes a consistent snapshot of tables that are in capture mode and streams this state to Kafka. This establishes the baseline for table content.</p>
</div>
<div class="paragraph">
<p>By default, when a Db2 connector performs a snapshot, it does the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Determines which tables are in capture mode, and thus must be included in the snapshot. By default, all non-system tables are in capture mode. Connector configuration properties, such as <code>table.exclude.list</code> and <code>table.include.list</code> let you specify which tables should be in capture mode.</p>
</li>
<li>
<p>Obtains a lock on each of the tables in capture mode. This ensures that no schema changes can occur in those tables during the snapshot.
The level of the lock is determined by the <code>snapshot.isolation.mode</code> connector  configuration property.</p>
</li>
<li>
<p>Reads the highest (most recent) LSN position in the server&#8217;s transaction log.</p>
</li>
<li>
<p>Captures the schema of all tables that are in capture mode. The connector persists this information in its internal database history topic.</p>
</li>
<li>
<p>Optional, releases the locks obtained in step 2. Typically, these locks are held for only a short time.</p>
</li>
<li>
<p>At the LSN position read in step 3, the connector scans the capture mode tables as well as their schemas. During the scan, the connector:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Confirms that the table was created before the start of the snapshot. If it was not, the snapshot skips that table. After the snapshot is complete, and the connector starts emitting change events, the connector produces change events for any tables that were created during the snapshot.</p>
</li>
<li>
<p>Produces a <em>read</em> event for each row in each table that is in capture mode. All <em>read</em> events contain the same LSN position, which is the LSN position that was obtained in step 3.</p>
</li>
<li>
<p>Emits each <em>read</em> event to the Kafka topic that has the same name as the table.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Records the successful completion of the snapshot in the connector offsets.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="db2-adhoc-snapshot"></a></p>
</div>
<div class="sect3">
<h4 id="_ad_hoc_snapshot"><a class="anchor" href="#_ad_hoc_snapshot"></a>Ad-hoc snapshot</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is currently in incubating state, i.e. exact semantics, configuration options etc. may change in future revisions, based on the feedback we receive.
Please let us know if you encounter any problems while using this extension.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When the initial snapshot is completed then it is not executed again as further data are acquired via streaming.</p>
</div>
<div class="paragraph">
<p>Sometimes it would be really useful to re-execute a snapshot, either completely, or for only a subset of tables.
Examples for such use cases include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a new table was added into the list of captured tables</p>
</li>
<li>
<p>some of the topics were deleted and their content needs to be rebuilt</p>
</li>
<li>
<p>the data were corrupted due to a configuration error</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Debezium can be requested via the <a href="../configuration/signalling.html" class="page">signalling table</a> mechanism to execute a new snapshot of a defined list of tables.
The signal is named <code>execute-snapshot</code> and accepts messages in the following format:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Example of a signal record</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>incremental</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of the snapshot to be executed. Currently only <code>incremental</code> is supported.<br>
See the next section for more details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>data-collections</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>N/A</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An array of qualified names of table to be snapshotted.<br>
The format of the names is the same as for <a href="#db2-property-signal-data-collection">signal.data.collection</a> configuration option.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>An example of the signal to be triggered is this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">INSERT INTO myschema.debezium_signal VALUES('ad-hoc-1', 'execute-snapshot', '{"data-collections": ["schema1.table1", "schema1.table2"]}')</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="db2-incremental-snapshot"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_incremental_snapshot"><a class="anchor" href="#_incremental_snapshot"></a>Incremental snapshot</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is currently in incubating state, i.e. exact semantics, configuration options etc. may change in future revisions, based on the feedback we receive.
Please let us know if you encounter any problems while using this extension.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Initial snapshots are a great way to obtain a consistent set of all data stored in a database upfront.
But there are also some downsides to this approach, though:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For larger datasets it can take very long to complete; hours or even days</p>
</li>
<li>
<p>The snapshot must be completed before the start of streaming</p>
</li>
<li>
<p>Snapshots are not resumable
If a snapshot hasn&#8217;t been completed when the connector gets stopped or restarted, the snapshot must be restarted from scratch</p>
</li>
<li>
<p>New tables that are added among the captured ones later are not snapshotted.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To mitigate these issues, a new mechanism called <em>incremental snapshotting</em> has been introduced.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Incremental snapshots can be started current only as <a href="#db2-adhoc-snapshot">an ad-hoc snapshot</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Configuration option <a href="#db2-property-signal-data-collection">signal.data.collection</a> must be set.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Incremental snapshot is based on <a href="https://github.com/debezium/debezium-design-documents/blob/main/DDD-3.md">DDD-3</a> design document.
In this case the table is snapshotted in chunks and streaming and snapshot events are blended together.
The snaphot events are still denoted using operation <code>r</code> and the <code>snapshot</code> field in <code>source</code> info block is set to <code>incremental</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   "before":null,
   "after": {
      "pk":"1",
      "value":"New data"
   },
   "source": {
...
      "snapshot":"incremental"
   },
   "op":"r",
   "ts_ms":"1620393591654",
   "transaction":null
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The incremental snapshot events should be understood in a different way than events from an initial snapshot.
The <code>read</code> events should be understoold like a materialization of data in a certain period of time.
This means that event semantics differ between initial and incremental snapshots:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>update</code> and <code>delete</code> events can arrive before <code>read</code> events</p>
</li>
<li>
<p>if <code>delete</code> event arrives first then <code>read</code> event is never delivered</p>
</li>
<li>
<p>if <code>update</code> event arrives first then <code>read</code> event will either not be delivered at all or it will be delivered with the updated value</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="how-debezium-db2-connectors-read-change-data-tables"><a class="anchor" href="#how-debezium-db2-connectors-read-change-data-tables"></a>Change-data tables</h3>
<div class="paragraph">
<p>After a complete snapshot, when a Debezium Db2 connector starts for the first time, the connector identifies the change-data table for each source table that is in capture mode. The connector does the following for each change-data table:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Reads change events that were created between the last stored, highest LSN and the current, highest LSN.</p>
</li>
<li>
<p>Orders the change events according to the commit LSN and the change LSN for each event. This ensures that the connector emits the change events in the order in which the table changes occurred.</p>
</li>
<li>
<p>Passes commit and change LSNs as offsets to Kafka Connect.</p>
</li>
<li>
<p>Stores the highest LSN that the connector passed to Kafka Connect.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After a restart, the connector resumes emitting change events from the offset (commit and change LSNs) where it left off. While the connector is running and emitting change events, if you remove a table from capture mode or add a table to capture mode, the connector detects this and modifies its behavior accordingly.</p>
</div>
</div>
<div class="sect2">
<h3 id="db2-topic-names"><a class="anchor" href="#db2-topic-names"></a>Topic names</h3>
<div class="paragraph">
<p>By default, the Db2 connector writes change events for all insert, update, and delete operations on a single table to a single Kafka topic. The name of the Kafka topic has the following format:</p>
</div>
<div class="paragraph">
<p><em>databaseName</em>.<em>schemaName</em>.<em>tableName</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>databaseName</em></dt>
<dd>
<p>The logical name of the connector as specified with the <code>database.server.name</code> connector configuration property.</p>
</dd>
<dt class="hdlist1"><em>schemaName</em></dt>
<dd>
<p>The name of the schema in which the operation occurred.</p>
</dd>
<dt class="hdlist1"><em>tableName</em></dt>
<dd>
<p>The name of the table in which the operation occurred.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For example, consider a Db2 installation with the <code>mydatabase</code> database,  which contains four tables: <code>PRODUCTS</code>, <code>PRODUCTS_ON_HAND</code>, <code>CUSTOMERS</code>, and <code>ORDERS</code> that are in the <code>MYSCHEMA</code> schema. The connector would emit events to these four Kafka topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mydatabase.MYSCHEMA.PRODUCTS</code></p>
</li>
<li>
<p><code>mydatabase.MYSCHEMA.PRODUCTS_ON_HAND</code></p>
</li>
<li>
<p><code>mydatabase.MYSCHEMA.CUSTOMERS</code></p>
</li>
<li>
<p><code>mydatabase.MYSCHEMA.ORDERS</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To configure a Db2 connector to emit change events to differently-named Kafka topics, see the documentation for the <a href="../configuration/topic-routing.html#topic-routing" class="page">topic routing transformation</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="about-the-debezium-db2-connector-schema-change-topic"><a class="anchor" href="#about-the-debezium-db2-connector-schema-change-topic"></a>Schema change topic</h3>
<div class="paragraph">
<p>For a table that is in capture mode, the Debezium Db2 connector stores the history of schema changes to that table in a database history topic. This topic reflects an internal connector state and you should not use it. If your application needs to track schema changes, there is a public schema change topic. The name of the schema change topic is the same as the logical server name specified in the connector configuration.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The format of messages that a connector emits to its schema change topic is in an incubating state and can change without notice.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Debezium emits a message to the schema change topic when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A new table goes into capture mode.</p>
</li>
<li>
<p>A table is removed from capture mode.</p>
</li>
<li>
<p>During a <a href="#db2-schema-evolution">database schema update</a>, there is a change in the schema for a table that is in capture mode.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A message to the schema change topic contains a logical representation of the table schema, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "schema": {
  ...
  },
  "payload": {
    "source": {
      "version": "1.7.0.Alpha1",
      "connector": "db2",
      "name": "db2",
      "ts_ms": 1588252618953,
      "snapshot": "true",
      "db": "testdb",
      "schema": "DB2INST1",
      "table": "CUSTOMERS",
      "change_lsn": null,
      "commit_lsn": "00000025:00000d98:00a2",
      "event_serial_no": null
    },
    "databaseName": "TESTDB", <i class="conum" data-value="1"></i><b>(1)</b>
    "schemaName": "DB2INST1",
    "ddl": null, <i class="conum" data-value="2"></i><b>(2)</b>
    "tableChanges": [ <i class="conum" data-value="3"></i><b>(3)</b>
      {
        "type": "CREATE", <i class="conum" data-value="4"></i><b>(4)</b>
        "id": "\"DB2INST1\".\"CUSTOMERS\"", <i class="conum" data-value="5"></i><b>(5)</b>
        "table": { <i class="conum" data-value="6"></i><b>(6)</b>
          "defaultCharsetName": null,
          "primaryKeyColumnNames": [ <i class="conum" data-value="7"></i><b>(7)</b>
            "ID"
          ],
          "columns": [ <i class="conum" data-value="8"></i><b>(8)</b>
            {
              "name": "ID",
              "jdbcType": 4,
              "nativeType": null,
              "typeName": "int identity",
              "typeExpression": "int identity",
              "charsetName": null,
              "length": 10,
              "scale": 0,
              "position": 1,
              "optional": false,
              "autoIncremented": false,
              "generated": false
            },
            {
              "name": "FIRST_NAME",
              "jdbcType": 12,
              "nativeType": null,
              "typeName": "varchar",
              "typeExpression": "varchar",
              "charsetName": null,
              "length": 255,
              "scale": null,
              "position": 2,
              "optional": false,
              "autoIncremented": false,
              "generated": false
            },
            {
              "name": "LAST_NAME",
              "jdbcType": 12,
              "nativeType": null,
              "typeName": "varchar",
              "typeExpression": "varchar",
              "charsetName": null,
              "length": 255,
              "scale": null,
              "position": 3,
              "optional": false,
              "autoIncremented": false,
              "generated": false
            },
            {
              "name": "EMAIL",
              "jdbcType": 12,
              "nativeType": null,
              "typeName": "varchar",
              "typeExpression": "varchar",
              "charsetName": null,
              "length": 255,
              "scale": null,
              "position": 4,
              "optional": false,
              "autoIncremented": false,
              "generated": false
            }
          ]
        }
      }
    ]
  }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Descriptions of fields in messages emitted to the schema change topic</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 30%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Field name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>databaseName</code><br>
<code>schemaName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifies the database and the schema that contain the change.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ddl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always <code>null</code> for the Db2 connector. For other connectors, this field contains the DDL responsible for the schema change. This DDL is not available to Db2 connectors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tableChanges</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An array of one or more items that contain the schema changes generated by a DDL command.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Describes the kind of change. The value is one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CREATE</code> - table created</p>
</li>
<li>
<p><code>ALTER</code> - table modified</p>
</li>
<li>
<p><code>DROP</code> - table deleted</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Full identifier of the table that was created, altered, or dropped.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>table</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents table metadata after the applied change.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>primaryKeyColumnNames</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of columns that compose the table&#8217;s primary key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>columns</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metadata for each column in the changed table.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In messages to the schema change topic, the key is the name of the database that contains the schema change. In the following example, the <code>payload</code> field contains the key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "schema": {
    "type": "struct",
    "fields": [
      {
        "type": "string",
        "optional": false,
        "field": "databaseName"
      }
    ],
    "optional": false,
    "name": "io.debezium.connector.db2.SchemaChangeKey"
  },
  "payload": {
    "databaseName": "TESTDB"
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="db2-transaction-metadata"><a class="anchor" href="#db2-transaction-metadata"></a>Transaction metadata</h3>
<div class="paragraph">
<p>Debezium can generate events that represent transaction boundaries and that enrich change data event messages. For every transaction <code>BEGIN</code> and <code>END</code>, Debezium generates an event that contains the following fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>status</code> - <code>BEGIN</code> or <code>END</code></p>
</li>
<li>
<p><code>id</code> - string representation of unique transaction identifier</p>
</li>
<li>
<p><code>event_count</code> (for <code>END</code> events) - total number of events emitted by the transaction</p>
</li>
<li>
<p><code>data_collections</code> (for <code>END</code> events) - an array of pairs of <code>data_collection</code> and <code>event_count</code> that provides the number of events emitted by changes originating from the given data collection</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "status": "BEGIN",
  "id": "00000025:00000d08:0025",
  "event_count": null,
  "data_collections": null
}

{
  "status": "END",
  "id": "00000025:00000d08:0025",
  "event_count": 2,
  "data_collections": [
    {
      "data_collection": "testDB.dbo.tablea",
      "event_count": 1
    },
    {
      "data_collection": "testDB.dbo.tableb",
      "event_count": 1
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The connector emits transaction events to the <code><em>database.server.name</em>.transaction</code> topic.</p>
</div>
<div class="paragraph">
<div class="title">Data change event enrichment</div>
<p>When transaction metadata is enabled the connector enriches the change event  <code>Envelope</code> with a new <code>transaction</code> field.
This field provides information about every event in the form of a composite of fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>id</code> - string representation of unique transaction identifier</p>
</li>
<li>
<p><code>total_order</code> - absolute position of the event among all events generated by the transaction</p>
</li>
<li>
<p><code>data_collection_order</code> - the per-data collection position of the event among all events that were emitted by the transaction</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Following is an example of a message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "before": null,
  "after": {
    "pk": "2",
    "aa": "1"
  },
  "source": {
...
  },
  "op": "c",
  "ts_ms": "1580390884335",
  "transaction": {
    "id": "00000025:00000d08:0025",
    "total_order": "1",
    "data_collection_order": "1"
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="db2-events"><a class="anchor" href="#db2-events"></a>Data change events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Debezium Db2 connector generates a data change event for each row-level <code>INSERT</code>, <code>UPDATE</code>, and <code>DELETE</code> operation. Each event contains a key and a value. The structure of the key and the value depends on the table that was changed.</p>
</div>
<div class="paragraph">
<p>Debezium and Kafka Connect are designed around <em>continuous streams of event messages</em>. However, the structure of these events may change over time, which can be difficult for consumers to handle. To address this, each event contains the schema for its content or, if you are using a schema registry, a schema ID that a consumer can use to obtain the schema from the registry. This makes each event self-contained.</p>
</div>
<div class="paragraph">
<p>The following skeleton JSON shows the basic four parts of a change event. However, how you configure the Kafka Connect converter that you choose to use in your application determines the representation of these four parts in change events. A <code>schema</code> field is in a change event only when you configure the converter to produce it. Likewise, the event key and event payload are in a change event only if you configure a converter to produce it. If you use the JSON converter and you configure it to produce all four basic change event parts, change events have this structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
 "schema": { <i class="conum" data-value="1"></i><b>(1)</b>
   ...
  },
 "payload": { <i class="conum" data-value="2"></i><b>(2)</b>
   ...
 },
 "schema": { <i class="conum" data-value="3"></i><b>(3)</b>
   ...
 },
 "payload": { <i class="conum" data-value="4"></i><b>(4)</b>
   ...
 },
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Overview of change event basic content</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Field name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>schema</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The first <code>schema</code> field is part of the event key. It specifies a Kafka Connect schema that describes what is in the event key&#8217;s <code>payload</code> portion. In other words, the first <code>schema</code> field describes the structure of the primary key, or the unique key if the table does not have a primary key, for the table that was changed.<br>
<br>
It is possible to override the table&#8217;s primary key by setting the <a href="#db2-property-message-key-columns"><code>message.key.columns</code> connector configuration property</a>. In this case, the first schema field describes the structure of the the key identified by that property.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>payload</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The first <code>payload</code> field is part of the event key. It has the structure described by the previous <code>schema</code> field and it contains the key for the row that was changed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>schema</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The second <code>schema</code> field is part of the event value. It specifies the Kafka Connect schema that describes what is in the event value&#8217;s <code>payload</code> portion. In other words, the second <code>schema</code> describes the structure of the row that was changed. Typically, this schema contains nested schemas.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>payload</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The second <code>payload</code> field is part of the event value. It has the structure described by the previous <code>schema</code> field and it contains the actual data for the row that was changed.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>By default, the connector streams change event records to topics with names that are the same as the event&#8217;s originating table. See <a href="#db2-topic-names">topic names</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Debezium Db2 connector ensures that all Kafka Connect schema names adhere to the <a href="http://avro.apache.org/docs/current/spec.html#names">Avro schema name format</a>. This means that the logical server name must start with a Latin letter or an underscore, that is, a-z, A-Z, or _. Each remaining character in the logical server name and each character in the database and table names must be a Latin letter, a digit, or an underscore, that is, a-z, A-Z, 0-9, or \_. If there is an invalid character it is replaced with an underscore character.</p>
</div>
<div class="paragraph">
<p>This can lead to unexpected conflicts if the logical server name, a database name, or a table name contains invalid characters, and the only characters that distinguish names from one another are invalid and thus replaced with underscores.</p>
</div>
<div class="paragraph">
<p>Also, Db2 names for databases, schemas, and tables can be case sensitive. This means that the connector could emit event records for more than one table to the same Kafka topic.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="db2-change-event-keys"><a class="anchor" href="#db2-change-event-keys"></a>Change event keys</h3>
<div class="paragraph">
<p>A change event&#8217;s key contains the schema for the changed table&#8217;s key and the changed row&#8217;s actual key. Both the schema and its corresponding payload contain a field for each column in the changed table&#8217;s <code>PRIMARY KEY</code> (or unique constraint) at the time the connector created the event.</p>
</div>
<div class="paragraph">
<p>Consider the following <code>customers</code> table, which is followed by an example of a change event key for this table.</p>
</div>
<div class="listingblock">
<div class="title">Example table</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE TABLE customers (
 ID INTEGER IDENTITY(1001,1) NOT NULL PRIMARY KEY,
 FIRST_NAME VARCHAR(255) NOT NULL,
 LAST_NAME VARCHAR(255) NOT NULL,
 EMAIL VARCHAR(255) NOT NULL UNIQUE
);</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Example change event key</div>
<p>Every change event that captures a change to the <code>customers</code> table has the same event key schema. For as long as the <code>customers</code> table has the previous definition, every change event that captures a change to the <code>customers</code> table has the following key structure. In JSON, it looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "schema": {  <i class="conum" data-value="1"></i><b>(1)</b>
        "type": "struct",
        "fields": [  <i class="conum" data-value="2"></i><b>(2)</b>
            {
                "type": "int32",
                "optional": false,
                "field": "ID"
            }
        ],
        "optional": false,  <i class="conum" data-value="3"></i><b>(3)</b>
        "name": "mydatabase.MYSCHEMA.CUSTOMERS.Key"  <i class="conum" data-value="4"></i><b>(4)</b>
    },
    "payload": {  <i class="conum" data-value="5"></i><b>(5)</b>
        "ID": 1004
    }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Description of change event key</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Field name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>schema</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The schema portion of the key specifies a Kafka Connect schema that describes what is in the key&#8217;s <code>payload</code> portion.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fields</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies each field that is expected in the <code>payload</code>, including each field&#8217;s name, type, and whether it is required.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>optional</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether the event key must contain a value in its <code>payload</code> field. In this example, a value in the key&#8217;s payload is required. A value in the key&#8217;s payload field is optional when a table does not have a primary key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mydatabase.MYSCHEMA.CUSTOMERS.Key</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name of the schema that defines the structure of the key&#8217;s payload. This schema describes the structure of the primary key for the table that was changed. Key schema names have the format <em>connector-name</em>.<em>database-name</em>.<em>table-name</em>.<code>Key</code>. In this example:<br></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mydatabase</code> is the name of the connector that generated this event.<br></p>
</li>
<li>
<p><code>MYSCHEMA</code> is the database schema that contains the table that was changed.<br></p>
</li>
<li>
<p><code>CUSTOMERS</code> is the table that was updated.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>payload</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the key for the row for which this change event was generated. In this example, the key, contains a single <code>ID</code> field whose value is <code>1004</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="db2-change-event-values"><a class="anchor" href="#db2-change-event-values"></a>Change event values</h3>
<div class="paragraph">
<p>The value in a change event is a bit more complicated than the key. Like the key, the value has a <code>schema</code> section and a <code>payload</code> section. The <code>schema</code> section contains the schema that describes the <code>Envelope</code> structure of the <code>payload</code> section, including its nested fields. Change events for operations that create, update or delete data all have a value payload with an envelope structure.</p>
</div>
<div class="paragraph">
<p>Consider the same sample table that was used to show an example of a change event key:</p>
</div>
<div class="listingblock">
<div class="title">Example table</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE TABLE customers (
 ID INTEGER IDENTITY(1001,1) NOT NULL PRIMARY KEY,
 FIRST_NAME VARCHAR(255) NOT NULL,
 LAST_NAME VARCHAR(255) NOT NULL,
 EMAIL VARCHAR(255) NOT NULL UNIQUE
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The event value portion of every change event for the <code>customers</code> table specifies the same schema. The event value&#8217;s payload varies according to the event type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#db2-create-events"><em>create</em> events</a></p>
</li>
<li>
<p><a href="#db2-update-events"><em>update</em> events</a></p>
</li>
<li>
<p><a href="#db2-delete-events"><em>delete</em> events</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="db2-create-events"><a class="anchor" href="#db2-create-events"></a><em>create</em> events</h3>
<div class="paragraph">
<p>The following example shows the value portion of a change event that the connector generates for an operation that creates data in the <code>customers</code> table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "schema": {  <i class="conum" data-value="1"></i><b>(1)</b>
    "type": "struct",
    "fields": [
      {
        "type": "struct",
        "fields": [
          {
            "type": "int32",
            "optional": false,
            "field": "ID"
          },
          {
            "type": "string",
            "optional": false,
            "field": "FIRST_NAME"
          },
          {
            "type": "string",
            "optional": false,
            "field": "LAST_NAME"
          },
          {
            "type": "string",
            "optional": false,
            "field": "EMAIL"
          }
        ],
        "optional": true,
        "name": "mydatabase.MYSCHEMA.CUSTOMERS.Value",  <i class="conum" data-value="2"></i><b>(2)</b>
        "field": "before"
      },
      {
        "type": "struct",
        "fields": [
          {
            "type": "int32",
            "optional": false,
            "field": "ID"
          },
          {
            "type": "string",
            "optional": false,
            "field": "FIRST_NAME"
          },
          {
            "type": "string",
            "optional": false,
            "field": "LAST_NAME"
          },
          {
            "type": "string",
            "optional": false,
            "field": "EMAIL"
          }
        ],
        "optional": true,
        "name": "mydatabase.MYSCHEMA.CUSTOMERS.Value",
        "field": "after"
      },
      {
        "type": "struct",
        "fields": [
          {
            "type": "string",
            "optional": false,
            "field": "version"
          },
          {
            "type": "string",
            "optional": false,
            "field": "connector"
          },
          {
            "type": "string",
            "optional": false,
            "field": "name"
          },
          {
            "type": "int64",
            "optional": false,
            "field": "ts_ms"
          },
          {
            "type": "boolean",
            "optional": true,
            "default": false,
            "field": "snapshot"
          },
          {
            "type": "string",
            "optional": false,
            "field": "db"
          },
          {
            "type": "string",
            "optional": false,
            "field": "schema"
          },
          {
            "type": "string",
            "optional": false,
            "field": "table"
          },
          {
            "type": "string",
            "optional": true,
            "field": "change_lsn"
          },
          {
            "type": "string",
            "optional": true,
            "field": "commit_lsn"
          },
        ],
        "optional": false,
        "name": "io.debezium.connector.db2.Source",  <i class="conum" data-value="3"></i><b>(3)</b>
        "field": "source"
      },
      {
        "type": "string",
        "optional": false,
        "field": "op"
      },
      {
        "type": "int64",
        "optional": true,
        "field": "ts_ms"
      }
    ],
    "optional": false,
    "name": "mydatabase.MYSCHEMA.CUSTOMERS.Envelope"  <i class="conum" data-value="4"></i><b>(4)</b>
  },
  "payload": {  <i class="conum" data-value="5"></i><b>(5)</b>
    "before": null,  <i class="conum" data-value="6"></i><b>(6)</b>
    "after": {  <i class="conum" data-value="7"></i><b>(7)</b>
      "ID": 1005,
      "FIRST_NAME": "john",
      "LAST_NAME": "doe",
      "EMAIL": "john.doe@example.org"
    },
    "source": {  <i class="conum" data-value="8"></i><b>(8)</b>
      "version": "1.7.0.Alpha1",
      "connector": "db2",
      "name": "myconnector",
      "ts_ms": 1559729468470,
      "snapshot": false,
      "db": "mydatabase",
      "schema": "MYSCHEMA",
      "table": "CUSTOMERS",
      "change_lsn": "00000027:00000758:0003",
      "commit_lsn": "00000027:00000758:0005",
    },
    "op": "c",  <i class="conum" data-value="9"></i><b>(9)</b>
    "ts_ms": 1559729471739  <i class="conum" data-value="10"></i><b>(10)</b>
  }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Descriptions of <em>create</em> event value fields</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Field name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>schema</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value&#8217;s schema, which describes the structure of the value&#8217;s payload. A change event&#8217;s value schema is the same in every change event that the connector generates for a particular table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>In the <code>schema</code> section, each <code>name</code> field specifies the schema for a field in the value&#8217;s payload.<br>
<br>
<code>mydatabase.MYSCHEMA.CUSTOMERS.Value</code> is the schema for the payload&#8217;s <code>before</code> and <code>after</code> fields. This schema is specific to the <code>customers</code> table. The connector uses this schema for all rows in the <code>MYSCHEMA.CUSTOMERS</code> table.<br>
<br>
Names of schemas for <code>before</code> and <code>after</code> fields are of the form <code><em>logicalName</em>.<em>schemaName</em>.<em>tableName</em>.Value</code>, which ensures that the schema name is unique in the database. This means that when using the <a href="../configuration/avro.html" class="page">Avro converter</a>, the resulting Avro schema for each table in each logical source has its own evolution and history.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.connector.db2.Source</code> is the schema for the payload&#8217;s <code>source</code> field. This schema is specific to the Db2 connector. The connector uses it for all events that it generates.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>mydatabase.MYSCHEMA.CUSTOMERS.Envelope</code> is the schema for the overall structure of the payload, where <code>mydatabase</code> is the database, <code>MYSCHEMA</code> is the schema, and <code>CUSTOMERS</code> is the table.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>payload</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value&#8217;s actual data. This is the information that the change event is providing.<br>
<br>
It may appear that JSON representations of events are much larger than the rows they describe. This is because a JSON representation must include the schema portion and the payload portion of the message.
However, by using the <a href="../configuration/avro.html" class="page">Avro converter</a>, you can significantly decrease the size of the messages that the connector streams to Kafka topics.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>before</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional field that specifies the state of the row before the event occurred. When the <code>op</code> field is <code>c</code> for create, as it is in this example, the <code>before</code> field is <code>null</code> since this change event is for new content.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>after</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional field that specifies the state of the row after the event occurred. In this example, the <code>after</code> field contains the values of the new row&#8217;s <code>ID</code>, <code>FIRST_NAME</code>, <code>LAST_NAME</code>, and <code>EMAIL</code> columns.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>source</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory field that describes the source metadata for the event. The <code>source</code> structure shows Db2 information about this change, which provides traceability. It also has information you can use to compare to other events in the same topic or in other topics to know whether this event occurred before, after, or as part of the same commit as other events. The source metadata includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Debezium version</p>
</li>
<li>
<p>Connector type and name</p>
</li>
<li>
<p>Timestamp for when the change was made in the database</p>
</li>
<li>
<p>Whether the event is part of an ongoing snapshot</p>
</li>
<li>
<p>Name of the database, schema, and table that contain the new row</p>
</li>
<li>
<p>Change LSN</p>
</li>
<li>
<p>Commit LSN (omitted if this event is part of a snapshot)</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>op</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory string that describes the type of operation that caused the connector to generate the event. In this example, <code>c</code> indicates that the operation created a row. Valid values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>c</code> = create</p>
</li>
<li>
<p><code>u</code> = update</p>
</li>
<li>
<p><code>d</code> = delete</p>
</li>
<li>
<p><code>r</code> = read (applies to only snapshots)</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ts_ms</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Optional field that displays the time at which the connector processed the event. The time is based on the system clock in the JVM running the Kafka Connect task.<br>
<br>
In the <code>source</code> object, <code>ts_ms</code> indicates the time that the change was made in the database. By comparing the value for <code>payload.source.ts_ms</code> with the value for <code>payload.ts_ms</code>, you can determine the lag between the source database update and Debezium.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="db2-update-events"><a class="anchor" href="#db2-update-events"></a><em>update</em> events</h3>
<div class="paragraph">
<p>The value of a change event for an update in the sample <code>customers</code> table has the same schema as a <em>create</em> event for that table. Likewise, the <em>update</em> event value&#8217;s payload has the same structure. However, the event value payload contains different values in an <em>update</em> event. Here is an example of a change event value in an event that the connector generates for an update in the <code>customers</code> table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "schema": { ... },
  "payload": {
    "before": {  <i class="conum" data-value="1"></i><b>(1)</b>
      "ID": 1005,
      "FIRST_NAME": "john",
      "LAST_NAME": "doe",
      "EMAIL": "john.doe@example.org"
    },
    "after": {  <i class="conum" data-value="2"></i><b>(2)</b>
      "ID": 1005,
      "FIRST_NAME": "john",
      "LAST_NAME": "doe",
      "EMAIL": "noreply@example.org"
    },
    "source": {  <i class="conum" data-value="3"></i><b>(3)</b>
      "version": "1.7.0.Alpha1",
      "connector": "db2",
      "name": "myconnector",
      "ts_ms": 1559729995937,
      "snapshot": false,
      "db": "mydatabase",
      "schema": "MYSCHEMA",
      "table": "CUSTOMERS",
      "change_lsn": "00000027:00000ac0:0002",
      "commit_lsn": "00000027:00000ac0:0007",
    },
    "op": "u",  <i class="conum" data-value="4"></i><b>(4)</b>
    "ts_ms": 1559729998706  <i class="conum" data-value="5"></i><b>(5)</b>
  }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Descriptions of <em>update</em> event value fields</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Field name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>before</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional field that specifies the state of the row before the event occurred. In an <em>update</em> event value, the <code>before</code> field contains a field for each table column and the value that was in that column before the database commit. In this example, note that the <code>EMAIL</code> value is <code>john.doe@example.com</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>after</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional field that specifies the state of the row after the event occurred. You can compare the <code>before</code> and <code>after</code> structures to determine what the update to this row was. In the example, the <code>EMAIL</code> value is now <code>noreply@example.com</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>source</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory field that describes the source metadata for the event. The <code>source</code> field structure contains the same fields as in a <em>create</em> event, but some values are different, for example, the sample <em>update</em> event has different LSNs. You can use this information to compare this event to other events to know whether this event occurred before, after, or as part of the same commit as other events. The source metadata includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Debezium version</p>
</li>
<li>
<p>Connector type and name</p>
</li>
<li>
<p>Timestamp for when the change was made in the database</p>
</li>
<li>
<p>Whether the event is part of an ongoing snapshot</p>
</li>
<li>
<p>Name of the database, schema, and table that contain the new row</p>
</li>
<li>
<p>Change LSN</p>
</li>
<li>
<p>Commit LSN (omitted if this event is part of a snapshot)</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>op</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory string that describes the type of operation. In an <em>update</em> event value, the <code>op</code> field value is <code>u</code>, signifying that this row changed because of an update.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ts_ms</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Optional field that displays the time at which the connector processed the event. The time is based on the system clock in the JVM running the Kafka Connect task.<br>
<br>
In the <code>source</code> object, <code>ts_ms</code> indicates the time that the change was made in the database. By comparing the value for <code>payload.source.ts_ms</code> with the value for <code>payload.ts_ms</code>, you can determine the lag between the source database update and Debezium.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Updating the columns for a row&#8217;s primary/unique key changes the value of the row&#8217;s key. When a key changes, Debezium outputs <em>three</em> events: a <code>DELETE</code> event and a <a href="#db2-tombstone-events">tombstone event</a> with the old key for the row, followed by an event with the new key for the row.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="db2-delete-events"><a class="anchor" href="#db2-delete-events"></a><em>delete</em> events</h3>
<div class="paragraph">
<p>The value in a <em>delete</em> change event has the same <code>schema</code> portion as <em>create</em> and <em>update</em> events for the same table. The event value <code>payload</code> in a <em>delete</em> event for the sample <code>customers</code> table looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "schema": { ... },
  },
  "payload": {
    "before": {  <i class="conum" data-value="1"></i><b>(1)</b>
      "ID": 1005,
      "FIRST_NAME": "john",
      "LAST_NAME": "doe",
      "EMAIL": "noreply@example.org"
    },
    "after": null,  <i class="conum" data-value="2"></i><b>(2)</b>
    "source": {  <i class="conum" data-value="3"></i><b>(3)</b>
      "version": "1.7.0.Alpha1",
      "connector": "db2",
      "name": "myconnector",
      "ts_ms": 1559730445243,
      "snapshot": false,
      "db": "mydatabase",
      "schema": "MYSCHEMA",
      "table": "CUSTOMERS",
      "change_lsn": "00000027:00000db0:0005",
      "commit_lsn": "00000027:00000db0:0007"
    },
    "op": "d",  <i class="conum" data-value="4"></i><b>(4)</b>
    "ts_ms": 1559730450205  <i class="conum" data-value="5"></i><b>(5)</b>
  }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Descriptions of <em>delete</em> event value fields</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Field name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>before</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional field that specifies the state of the row before the event occurred. In a <em>delete</em> event value, the <code>before</code> field contains the values that were in the row before it was deleted with the database commit.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>after</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional field that specifies the state of the row after the event occurred. In a <em>delete</em> event value, the <code>after</code> field is <code>null</code>, signifying that the row no longer exists.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>source</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory field that describes the source metadata for the event. In a <em>delete</em> event value, the <code>source</code> field structure is the same as for <em>create</em> and <em>update</em> events for the same table. Many <code>source</code> field values are also the same. In a <em>delete</em> event value, the <code>ts_ms</code> and LSN field values, as well as other values, might have changed. But the <code>source</code> field in a <em>delete</em> event value provides the same metadata:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Debezium version</p>
</li>
<li>
<p>Connector type and name</p>
</li>
<li>
<p>Timestamp for when the change was made in the database</p>
</li>
<li>
<p>Whether the event is part of an ongoing snapshot</p>
</li>
<li>
<p>Name of the database, schema, and table that contain the new row</p>
</li>
<li>
<p>Change LSN</p>
</li>
<li>
<p>Commit LSN (omitted if this event is part of a snapshot)</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>op</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory string that describes the type of operation. The <code>op</code> field value is <code>d</code>, signifying that this row was deleted.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ts_ms</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Optional field that displays the time at which the connector processed the event. The time is based on the system clock in the JVM running the Kafka Connect task.<br>
<br>
In the <code>source</code> object, <code>ts_ms</code> indicates the time that the change was made in the database. By comparing the value for <code>payload.source.ts_ms</code> with the value for <code>payload.ts_ms</code>, you can determine the lag between the source database update and Debezium.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A <em>delete</em> change event record provides a consumer with the information it needs to process the removal of this row. The old values are included because some consumers might require them in order to properly handle the removal.</p>
</div>
<div class="paragraph">
<p>Db2 connector events are designed to work with <a href="https://kafka.apache.org/documentation/#compaction">Kafka log compaction</a>. Log compaction enables removal of some older messages as long as at least the most recent message for every key is kept. This lets Kafka reclaim storage space while ensuring that the topic contains a complete data set and can be used for reloading key-based state.</p>
</div>
<div id="db2-tombstone-events" class="paragraph">
<p>When a row is deleted, the <em>delete</em> event value still works with log compaction, because Kafka can remove all earlier messages that have that same key. However, for Kafka to remove all messages that have that same key, the message value must be <code>null</code>. To make this possible, after Debeziums Db2 connector emits a <em>delete</em> event, the connector emits a special tombstone event that has the same key but a <code>null</code> value.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="db2-data-types"><a class="anchor" href="#db2-data-types"></a>Data type mappings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Db2&#8217;s data types are described in <a href="https://www.ibm.com/support/knowledgecenter/en/SSEPGG_11.5.0/com.ibm.db2.luw.sql.ref.doc/doc/r0008483.html">Db2 SQL Data Types</a>.</p>
</div>
<div class="paragraph">
<p>The Db2 connector represents changes to rows with events that are structured like the table in which the row exists. The event contains a field for each column value. How that value is represented in the event depends on the Db2 data type of the column. This section describes these mappings.</p>
</div>
<div class="sect2">
<h3 id="db2-basic-types"><a class="anchor" href="#db2-basic-types"></a>Basic types</h3>
<div class="paragraph">
<p>The following table describes how the connector maps each of the Db2 data types to a <em>literal type</em> and a <em>semantic type</em> in event fields.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>literal type</em> describes how the value is represented using Kafka Connect schema types: <code>INT8</code>, <code>INT16</code>, <code>INT32</code>, <code>INT64</code>, <code>FLOAT32</code>, <code>FLOAT64</code>, <code>BOOLEAN</code>, <code>STRING</code>, <code>BYTES</code>, <code>ARRAY</code>, <code>MAP</code>, and <code>STRUCT</code>.</p>
</li>
<li>
<p><em>semantic type</em> describes how the Kafka Connect schema captures the <em>meaning</em> of the field using the name of the Kafka Connect schema for the field.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Mappings for Db2 basic data types</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 20%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Db2 data type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name) and Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BOOLEAN</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BOOLEAN</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Only snapshots can be taken from tables with BOOLEAN type columns. Currently SQL Replication on Db2 does not support BOOLEAN, so Debezium can not perform CDC on those tables. Consider using a different type.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BIGINT</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BINARY</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BLOB</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>CHAR[(N)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>CLOB</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DATE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.Date</code><br>
<br>
String representation of a timestamp without timezone information</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DECFLOAT</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Decimal</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DECIMAL</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Decimal</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DBCLOB</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DOUBLE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>FLOAT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INTEGER</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>REAL</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>FLOAT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>SMALLINT</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT16</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIME</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.Time</code><br>
<br>
String representation of a time without timezone information</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIMESTAMP</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.MicroTimestamp</code><br>
<br>
String representation of a timestamp without timezone information</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>VARBINARY</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>VARCHAR[(N)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>VARGRAPHIC</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>XML</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.Xml</code><br>
<br>
String representation of an XML document</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If present, a column&#8217;s default value is propagated to the corresponding field&#8217;s Kafka Connect schema. Change events contain the field&#8217;s default value unless an explicit column value had been given. Consequently, there is rarely a need to obtain the default value from the schema.
Passing the default value helps satisfy compatibility rules when <a href="../configuration/avro.html" class="page">using Avro</a> as the serialization format together with the Confluent schema registry.</p>
</div>
</div>
<div class="sect2">
<h3 id="db2-temporal-types"><a class="anchor" href="#db2-temporal-types"></a>Temporal types</h3>
<div class="paragraph">
<p>Other than Db2&#8217;s <code>DATETIMEOFFSET</code> data type, which contains time zone information, how temporal types are mapped depends on the value of the <code>time.precision.mode</code> connector configuration property. The following sections describe these mappings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#db2-time-precision-mode-adaptive"><code>time.precision.mode=adaptive</code></a></p>
</li>
<li>
<p><a href="#db2-time-precision-mode-connect"><code>time.precision.mode=connect</code></a></p>
</li>
</ul>
</div>
<div id="db2-time-precision-mode-adaptive" class="paragraph">
<div class="title"><code>time.precision.mode=adaptive</code></div>
<p>When the <code>time.precision.mode</code> configuration property is set to <code>adaptive</code>, the default, the connector determines the literal type and semantic type based on the column&#8217;s data type definition. This ensures that events <em>exactly</em> represent the values in the database.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Mappings when <code>time.precision.mode</code> is <code>adaptive</code></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 20%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Db2 data type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name) and Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DATE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.Date</code><br>
<br>
Represents the number of days since the epoch.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIME(0)</code>, <code>TIME(1)</code>, <code>TIME(2)</code>, <code>TIME(3)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.Time</code><br>
<br>
Represents the number of milliseconds past midnight, and does not include timezone information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIME(4)</code>, <code>TIME(5)</code>, <code>TIME(6)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.MicroTime</code><br>
<br>
Represents the number of microseconds past midnight, and does not include timezone information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIME(7)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.NanoTime</code><br>
<br>
Represents the number of nanoseconds past midnight, and does not include timezone information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DATETIME</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.Timestamp</code><br>
<br>
Represents the number of milliseconds since the epoch, and does not include timezone information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>SMALLDATETIME</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.Timestamp</code><br>
<br>
Represents the number of milliseconds since the epoch, and does not include timezone information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DATETIME2(0)</code>, <code>DATETIME2(1)</code>, <code>DATETIME2(2)</code>, <code>DATETIME2(3)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.Timestamp</code><br>
<br>
Represents the number of milliseconds since the epoch, and does not include timezone information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DATETIME2(4)</code>, <code>DATETIME2(5)</code>, <code>DATETIME2(6)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.MicroTimestamp</code><br>
<br>
Represents the number of microseconds since the epoch, and does not include timezone information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DATETIME2(7)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.NanoTimestamp</code><br>
<br>
Represents the number of nanoseconds past the epoch, and does not include timezone information.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div id="db2-time-precision-mode-connect" class="paragraph">
<div class="title"><code>time.precision.mode=connect</code></div>
<p>When the <code>time.precision.mode</code> configuration property is set to <code>connect</code>, the connector uses Kafka Connect logical types. This may be useful when consumers can handle only the built-in Kafka Connect logical types and are unable to handle variable-precision time values. However, since Db2 supports tenth of a microsecond precision, the events generated by a connector with the <code>connect</code> time precision <strong>results in a loss of precision</strong> when the database column has a <em>fractional second precision</em> value that is greater than 3.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Mappings when <code>time.precision.mode</code> is <code>connect</code></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 20%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Db2 data type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name) and Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DATE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Date</code><br>
<br>
Represents the number of days since the epoch.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIME([P])</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Time</code><br>
<br>
Represents the number of milliseconds since midnight, and does not include timezone information. Db2 allows <code>P</code> to be in the range 0-7 to store up to tenth of a microsecond precision, though this mode results in a loss of precision when <code>P</code> is greater than 3.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DATETIME</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Timestamp</code><br>
<br>
Represents the number of milliseconds since the epoch, and does not include timezone information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>SMALLDATETIME</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Timestamp</code><br>
<br>
Represents the number of milliseconds since the epoch, and does not include timezone information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DATETIME2</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Timestamp</code><br>
<br>
Represents the number of milliseconds since the epoch, and does not include timezone information. Db2 allows <code>P</code> to be in the range 0-7 to store up to tenth of a microsecond precision, though this mode results in a loss of precision when <code>P</code> is greater than 3.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="db2-timestamp-types"><a class="anchor" href="#db2-timestamp-types"></a>Timestamp types</h3>
<div class="paragraph">
<p>The <code>DATETIME</code>, <code>SMALLDATETIME</code> and <code>DATETIME2</code> types represent a timestamp without time zone information.
Such columns are converted into an equivalent Kafka Connect value based on UTC. For example, the <code>DATETIME2</code> value "2018-06-20 15:13:16.945104" is represented by an <code>io.debezium.time.MicroTimestamp</code> with the value "1529507596945104".</p>
</div>
<div class="paragraph">
<p>The timezone of the JVM running Kafka Connect and Debezium does not affect this conversion.</p>
</div>
</div>
<div class="sect2">
<h3 id="db2-decimal-types"><a class="anchor" href="#db2-decimal-types"></a>Decimal types</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 27%;">
<col style="width: 18%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Db2 data type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name) and Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>NUMERIC[(P[,S])]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Decimal</code><br>
<br>
The <code>scale</code> schema parameter contains an integer that represents how many digits the decimal point is shifted.
The <code>connect.decimal.precision</code> schema parameter contains an integer that represents the precision of the given decimal value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DECIMAL[(P[,S])]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Decimal</code><br>
<br>
The <code>scale</code> schema parameter contains an integer that represents how many digits the decimal point is shifted.
The <code>connect.decimal.precision</code> schema parameter contains an integer that  represents the precision of the given decimal value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>SMALLMONEY</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Decimal</code><br>
<br>
The <code>scale</code> schema parameter contains an integer that represents how many digits the decimal point iss shifted.
The <code>connect.decimal.precision</code> schema parameter contains an integer that represents the precision of the given decimal value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>MONEY</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Decimal</code><br>
<br>
The <code>scale</code> schema parameter contains an integer that represents how many digits the decimal point is shifted.
The <code>connect.decimal.precision</code> schema parameter contains an integer that represents the precision of the given decimal value.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setting-up-db2"><a class="anchor" href="#setting-up-db2"></a>Setting up Db2</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For Debezium to capture change events that are committed to Db2 tables, a Db2 database administrator with the necessary privileges must configure tables in the database for change data capture.
After you begin to run Debezium you can adjust the configuration of the capture agent to optimize performance.</p>
</div>
<div class="sect2">
<h3 id="_putting_tables_into_capture_mode"><a class="anchor" href="#_putting_tables_into_capture_mode"></a>Putting tables into capture mode</h3>
<div class="paragraph">
<p>To put tables into capture mode, Debezium provides a set of user-defined functions (UDFs) for your convenience.
The procedure here shows how to install and run these management UDFs.
Alternatively, you can run Db2 control commands to put tables into capture mode.
The administrator must then enable CDC for each table that you want Debezium to capture.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You are logged in to Db2 as the <code>db2instl</code> user.</p>
</li>
<li>
<p>On the Db2 host, the Debezium management UDFs are available in the $HOME/asncdctools/src directory.
UDFs are available from the <a href="https://github.com/debezium/debezium-examples/tree/master/tutorial/debezium-db2-init/db2server">Debezium examples repository</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Compile the Debezium management UDFs on the Db2 server host by using the <code>bldrtn</code>
command provided with Db2:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cd $HOME/asncdctools/src</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">./bldrtn asncdc</code></pre>
</div>
</div>
</li>
<li>
<p>Start the database if it is not already running. Replace <code>DB_NAME</code> with the name of the database that you want Debezium to connect to.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">db2 start db DB_NAME</code></pre>
</div>
</div>
</li>
<li>
<p>Ensure that JDBC can read the Db2 metadata catalog:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cd $HOME/sqllib/bnd</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">db2 bind db2schema.bnd blocking all grant public sqlerror continue</code></pre>
</div>
</div>
</li>
<li>
<p>Ensure that the database was recently backed-up. The ASN agents must have a recent starting point to read from. If you need to perform a backup, run the following commands, which prune the data so that only the most recent version is available. If you do not need to retain the older versions of the data, specify <code>dev/null</code> for the backup location.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Back up the database. Replace <code>DB_NAME</code> and <code>BACK_UP_LOCATION</code> with appropriate values:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">db2 backup db DB_NAME to BACK_UP_LOCATION</code></pre>
</div>
</div>
</li>
<li>
<p>Restart the database:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">db2 restart db DB_NAME</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Connect to the database to install the Debezium management UDFs. It is assumed that you are logged in as the <code>db2instl</code> user so the UDFs should be installed on the <code>db2inst1</code> user.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">db2 connect to DB_NAME</code></pre>
</div>
</div>
</li>
<li>
<p>Copy the Debezium management UDFs and set permissions for them:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cp $HOME/asncdctools/src/asncdc $HOME/sqllib/function</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">chmod 777 $HOME/sqllib/function</code></pre>
</div>
</div>
</li>
<li>
<p>Enable the Debezium UDF that starts and stops the ASN capture agent:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">db2 -tvmf $HOME/asncdctools/src/asncdc_UDF.sql</code></pre>
</div>
</div>
</li>
<li>
<p>Create the ASN control tables:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ db2 -tvmf $HOME/asncdctools/src/asncdctables.sql</code></pre>
</div>
</div>
</li>
<li>
<p>Enable the Debezium UDF that adds tables to capture mode and removes tables from capture mode:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ db2 -tvmf $HOME/asncdctools/src/asncdcaddremove.sql</code></pre>
</div>
</div>
<div class="paragraph">
<p>After you set up the Db2 server, use the UDFs to control Db2 replication (ASN) with SQL commands. Some of the UDFs expect a return value in which case you use the  SQL <code>VALUE</code> statement to invoke them. For other UDFs, use the SQL <code>CALL</code> statement.</p>
</div>
</li>
<li>
<p>Start the ASN agent:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">VALUES ASNCDC.ASNCDCSERVICES('start','asncdc');</code></pre>
</div>
</div>
</li>
<li>
<p>Put tables into capture mode. Invoke the following statement for each table that you want to put into capture. Replace <code>MYSCHEMA</code>  with the name of the schema that contains the table you want to put into capture mode. Likewise, replace <code>MYTABLE</code> with the name of the table to put into capture mode:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CALL ASNCDC.ADDTABLE('MYSCHEMA', 'MYTABLE');</code></pre>
</div>
</div>
</li>
<li>
<p>Reinitialize the ASN service:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">VALUES ASNCDC.ASNCDCSERVICES('reinit','asncdc');</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Additional resource</div>
<p><a href="#managing-debezium-db2-connectors">Reference table for Debezium Db2 management UDFs</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_effect_of_db2_capture_agent_configuration_on_server_load_and_latency"><a class="anchor" href="#_effect_of_db2_capture_agent_configuration_on_server_load_and_latency"></a>Effect of Db2 capture agent configuration on server load and latency</h3>
<div class="paragraph">
<p>When a database administrator enables change data capture for a source table, the capture agent begins to run.
The agent reads new change event records from the transaction log and replicates the event records to a capture table.
Between the time that a change is committed in the source table, and the time that the change appears in the corresponding change table, there is always a small latency interval.
This latency interval represents a gap between when changes occur in the source table and when they become available for Debezium to stream to Apache Kafka.</p>
</div>
<div class="paragraph">
<p>Ideally, for applications that must respond quickly to changes in data, you want to maintain close synchronization between the source and capture tables.
You might imagine that running the capture agent to continuously process change events as rapidly as possible might result in increased throughput and reduced latency&#8201;&#8212;&#8201;populating change tables with new event records as soon as possible after the events occur, in near real time.
However, this is not necessarily the case.
There is a performance penalty to pay in the pursuit of more immediate synchronization.
Each time that the change agent queries the database for new event records, it increases the CPU load on the database host.
The additional load on the server can have a negative effect on overall database performance, and potentially reduce transaction efficiency, especially during times of peak database use.</p>
</div>
<div class="paragraph">
<p>It&#8217;s important to monitor database metrics so that you know if the database reaches the point where the server can no longer support the capture agent&#8217;s level of activity.
If you experience performance issues while running the capture agent, adjust capture agent settings to reduce CPU load.</p>
</div>
</div>
<div class="sect2">
<h3 id="_db2_capture_agent_configuration_parameters"><a class="anchor" href="#_db2_capture_agent_configuration_parameters"></a>Db2 capture agent configuration parameters</h3>
<div class="paragraph">
<p>On Db2, the <code>IBMSNAP_CAPPARMS</code> table contains parameters that control the behavior of the capture agent.
You can adjust the values for these parameters to balance the configuration of the capture process to reduce CPU load and still maintain acceptable levels of latency.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Specific guidance about how to configure Db2 capture agent parameters is beyond the scope of this documentation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the <code>IBMSNAP_CAPPARMS</code> table, the following parameters have the greatest effect on reducing CPU load:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>COMMIT_INTERVAL</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Specifies the number of seconds that the capture agent waits to commit data to the change data tables.</p>
</li>
<li>
<p>A higher value reduces the load on the database host and increases latency.</p>
</li>
<li>
<p>The default value is <code>30</code>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>SLEEP_INTERVAL</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Specifies the number of seconds that the capture agent waits to start a new commit cycle after it reaches the end of the active transaction log.</p>
</li>
<li>
<p>A higher value reduces the load on the server, and increases latency.</p>
</li>
<li>
<p>The default value is <code>5</code>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about capture agent parameters, see the Db2 documentation.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="db2-deploying-a-connector"><a class="anchor" href="#db2-deploying-a-connector"></a>Deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To deploy a Debezium Db2 connector, you install the Debezium Db2 connector archive, configure the connector, and start the connector by adding its configuration to Kafka Connect.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p><a href="https://zookeeper.apache.org/">Apache ZooKeeper</a>, <a href="http://kafka.apache.org/">Apache Kafka</a>, and <a href="https://kafka.apache.org/documentation.html#connect">Kafka Connect</a> are installed.</p>
</li>
<li>
<p>Db2 is installed and <a href="#setting-up-db2">capture mode is enabled for tables</a> to prepare the database to be used with the Debezium connector.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Download the <a href="https://repo1.maven.org/maven2/io/debezium/debezium-connector-db2/1.7.0.Alpha1/debezium-connector-db2-1.7.0.Alpha1-plugin.tar.gz">connector&#8217;s plug-in archive</a>.</p>
</li>
<li>
<p>Extract the JAR files into your Kafka Connect environment.</p>
</li>
<li>
<p>Add the directory with the JAR files to <a href="https://kafka.apache.org/documentation/#connectconfigs">Kafka Connect&#8217;s <code>plugin.path</code></a>.</p>
</li>
<li>
<p>Obtain the <a href="https://www.ibm.com/support/pages/db2-jdbc-driver-versions-and-downloads">JDBC driver for Db2</a>.</p>
</li>
<li>
<p>Add the JDBC driver JAR file to the directory with the Debezium Db2 connector JARs.</p>
</li>
<li>
<p><a href="#db2-adding-connector-configuration">Configure the connector and add the configuration to your Kafka Connect cluster.</a></p>
</li>
<li>
<p>Restart your Kafka Connect process to pick up the new JAR files.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you are working with immutable containers, see <a href="https://hub.docker.com/r/debezium/">Debezium&#8217;s container images</a> for Apache ZooKeeper, Apache Kafka and Kafka Connect with the Db2 connector already installed and ready to run.</p>
</div>
<div class="paragraph">
<p>You can also <a href="../operations/openshift.html" class="page">run Debezium on Kubernetes and OpenShift</a>.</p>
</div>
<div class="sect2">
<h3 id="db2-example-configuration"><a class="anchor" href="#db2-example-configuration"></a>Db2 connector configuration example</h3>
<div class="paragraph">
<p>Following is an example of the configuration for a connector instance that captures data from a Db2 server on port 50000 at 192.168.99.100, which we logically name <code>fullfillment</code>.
Typically, you configure the Debezium Db2 connector in a JSON file by setting the configuration properties that are available for the connector.</p>
</div>
<div class="paragraph">
<p>You can choose to produce events for a subset of the schemas and tables in a database.
Optionally, you can ignore, mask, or truncate columns that contain sensitive data, that are larger than a specified size, or that you do not need.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "db2-connector",  <i class="conum" data-value="1"></i><b>(1)</b>
  "config": {
    "connector.class": "io.debezium.connector.db2.Db2Connector", <i class="conum" data-value="2"></i><b>(2)</b>
    "database.hostname": "192.168.99.100", <i class="conum" data-value="3"></i><b>(3)</b>
    "database.port": "50000", <i class="conum" data-value="4"></i><b>(4)</b>
    "database.user": "db2inst1", <i class="conum" data-value="5"></i><b>(5)</b>
    "database.password": "Password!", <i class="conum" data-value="6"></i><b>(6)</b>
    "database.dbname": "mydatabase", <i class="conum" data-value="7"></i><b>(7)</b>
    "database.server.name": "fullfillment", <i class="conum" data-value="8"></i><b>(8)</b>
    "table.include.list": "MYSCHEMA.CUSTOMERS", <i class="conum" data-value="9"></i><b>(9)</b>
    "database.history.kafka.bootstrap.servers": "kafka:9092", <i class="conum" data-value="10"></i><b>(10)</b>
    "database.history.kafka.topic": "dbhistory.fullfillment" <i class="conum" data-value="11"></i><b>(11)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The name of the connector when registered with a Kafka Connect service.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The name of this Db2 connector class.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The address of the Db2 instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The port number of the Db2 instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The name of the Db2 user.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The password for the Db2 user.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The name of the database to capture changes from.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The logical name of the Db2 instance/cluster, which forms a namespace and is used in all the names of the Kafka topics to which the connector writes, the Kafka Connect schema names, and the namespaces of the corresponding Avro schema when the <a href="../configuration/avro.html" class="page">Avro Connector</a> is used.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>A list of all tables whose changes Debezium should capture.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>The list of Kafka brokers that this connector uses to write and recover DDL statements to the database history topic.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>The name of the database history topic where the connector writes and recovers DDL statements. This topic is for internal use only and should not be used by consumers.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For the complete list of the configuration properties that you can set for the Debezium Db2 connector, see <a href="#db2-connector-properties">Db2 connector properties</a>.</p>
</div>
<div class="paragraph">
<p>You can send this configuration with a <code>POST</code> command to a running Kafka Connect service.
The service records the configuration and starts one connector task that performs the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connects to the Db2 database.</p>
</li>
<li>
<p>Reads change-data tables for tables that are in capture mode.</p>
</li>
<li>
<p>Streams change event records to Kafka topics.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="db2-adding-connector-configuration"><a class="anchor" href="#db2-adding-connector-configuration"></a>Adding connector configuration</h3>
<div class="paragraph">
<p>To start running a Db2 connector, create a connector configuration and add the configuration to your Kafka Connect cluster.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p><a href="#setting-up-db2">Db2 replication is enabled</a> to expose change data for tables that are in capture mode.</p>
</li>
<li>
<p>The Db2 connector is installed.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a configuration for the Db2 connector.</p>
</li>
<li>
<p>Use the <a href="https://kafka.apache.org/documentation/#connect_rest">Kafka Connect REST API</a> to add that connector configuration to your Kafka Connect cluster.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Results</div>
<p>When the connector starts, it <a href="#db2-snapshots">performs a consistent snapshot</a> of the Db2 database tables that the connector is configured to capture changes for.
The connector then starts generating data change events for row-level operations and streaming change event records to Kafka topics.</p>
</div>
</div>
<div class="sect2">
<h3 id="db2-connector-properties"><a class="anchor" href="#db2-connector-properties"></a>Connector properties</h3>
<div class="paragraph">
<p>The Debezium Db2 connector has numerous configuration properties that you can use to achieve the right connector behavior for your application.
Many properties have default values.
Information about the properties is organized as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#db2-required-configuration-properties">Required configuration properties</a></p>
</li>
<li>
<p><a href="#db2-advanced-configuration-properties">Advanced configuration properties</a></p>
</li>
<li>
<p><a href="#debezium-db2-connector-database-history-configuration-properties">Database history connector configuration properties</a> that control how Debezium processes events that it reads from the database history topic.</p>
<div class="ulist">
<ul>
<li>
<p><a href="#db2-pass-through-database-history-properties-for-configuring-producer-and-consumer-clients">Pass-through database history properties</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#debezium-db2-connector-pass-through-database-driver-configuration-properties">Pass-through database driver properties</a> that control the behavior of the database driver.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="db2-required-configuration-properties"><a class="anchor" href="#db2-required-configuration-properties"></a>Required Debezium Db2 connector configuration properties</h4>
<div class="paragraph">
<p>The following configuration properties are <em>required</em> unless a default value is available.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 25%;">
<col style="width: 45%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-name"></a><a href="#db2-property-name"><code>name</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Unique name for the connector. Attempting to register again with the same name will fail. This property is required by all Kafka Connect connectors.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-connector-class"></a><a href="#db2-property-connector-class"><code>connector.class</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the Java class for the connector. Always use a value of <code>io.debezium.connector.db2.Db2Connector</code> for the Db2 connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-tasks-max"></a><a href="#db2-property-tasks-max"><code>tasks.max</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>1</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The maximum number of tasks that should be created for this connector. The Db2 connector always uses a single task and therefore does not use this value, so the default is always acceptable.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-database-hostname"></a><a href="#db2-property-database-hostname"><code>database.hostname</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IP address or hostname of the Db2 database server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-database-port"></a><a href="#db2-property-database-port"><code>database.port</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>50000</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Integer port number of the Db2 database server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-database-user"></a><a href="#db2-property-database-user"><code>database.user</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name of the Db2 database user for connecting to the Db2 database server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-database-password"></a><a href="#db2-property-database-password"><code>database.password</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Password to use when connecting to the Db2 database server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-database-dbname"></a><a href="#db2-property-database-dbname"><code>database.dbname</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the Db2 database from which to stream the changes</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-database-server-name"></a><a href="#db2-property-database-server-name"><code>database.server.name</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Logical name that identifies and provides a namespace for the particular Db2 database server that hosts the database for which Debezium is capturing changes. Only alphanumeric characters, hyphens and underscores must be used in the database server logical name. The logical name should be unique across all other connectors, since it is used as a topic name prefix for all Kafka topics that receive records from this connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-table-include-list"></a><a href="#db2-property-table-include-list"><code>table.include.list</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match fully-qualified table identifiers for tables whose changes you want the connector to capture. Any table not included in the include list does not have its changes captured. Each identifier is of the form <em>schemaName</em>.<em>tableName</em>. By default, the connector captures changes in every non-system table. Do not also set the <code>table.exclude.list</code> property.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-table-exclude-list"></a><a href="#db2-property-table-exclude-list"><code>table.exclude.list</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match fully-qualified table identifiers for tables whose changes you do not want the connector to capture. The connector captures changes in each non-system table that is not included in the exclude list. Each identifier is of the form <em>schemaName</em>.<em>tableName</em>. Do not also set the <code>table.include.list</code> property.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-column-exclude-list"></a><a href="#db2-property-column-exclude-list"><code>column.exclude.list</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>empty string</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match the fully-qualified names of columns to exclude from change event values.
Fully-qualified names for columns are of the form <em>schemaName</em>.<em>tableName</em>.<em>columnName</em>.
Primary key columns are always included in the event&#8217;s key, even if they are excluded from the value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-column-mask-hash"></a><a href="#db2-property-column-mask-hash"><code>column.mask.hash.<em>hashAlgorithm</em>.with.salt.<em>salt</em></code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match the fully-qualified names of character-based columns.
Fully-qualified names for columns are of the form <em>schemaName</em>.<em>tableName</em>.<em>columnName</em>.
In the resulting change event record, the values for the specified columns are replaced with pseudonyms.<br></p>
</div>
<div class="paragraph">
<p>A pseudonym consists of the hashed value that results from applying the specified <em>hashAlgorithm</em> and <em>salt</em>.
Based on the hash function that is used, referential integrity is maintained, while column values are replaced with pseudonyms.
Supported hash functions are described in the <a href="https://docs.oracle.com/javase/7/docs/technotes/guides/security/StandardNames.html#MessageDigest">MessageDigest section</a> of the Java Cryptography Architecture Standard Algorithm Name Documentation.<br>
<br>
In the following example, <code>CzQMA0cB5K</code> is a randomly selected salt.<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre>column.mask.hash.SHA-256.with.salt.CzQMA0cB5K = inventory.orders.customerName, inventory.shipment.customerName</pre>
</div>
</div>
<div class="paragraph">
<p>If necessary, the pseudonym is automatically shortened to the length of the column.
The connector configuration can include multiple properties that specify different hash algorithms and salts.<br>
<br>
Depending on the <em>hashAlgorithm</em> used, the <em>salt</em> selected, and the actual data set, the resulting data set might not be completely masked.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-time-precision-mode"></a><a href="#db2-property-time-precision-mode"><code>time.precision.mode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>adaptive</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Time, date, and timestamps can be represented with different kinds of precision:<br>
<br>
<code>adaptive</code> captures the time and timestamp values exactly as in the database using either millisecond, microsecond, or nanosecond precision values based on the database column&#8217;s type.<br>
<br>
<code>connect</code> always represents time and timestamp values by using Kafka Connect&#8217;s built-in representations for <code>Time</code>, <code>Date</code>, and <code>Timestamp</code>, which uses millisecond precision regardless of the database columns' precision. See <a href="#db2-temporal-values">temporal values</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-tombstones-on-delete"></a><a href="#db2-property-tombstones-on-delete"><code>tombstones.on.delete</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>true</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Controls whether a <em>delete</em> event is followed by a tombstone event.<br>
<br>
<code>true</code> - a delete operation is represented by a <em>delete</em> event and a subsequent tombstone event. <br>
<br>
<code>false</code> - only a <em>delete</em> event is emitted.<br>
<br>
After a source record is deleted, emitting a tombstone event (the default behavior) allows Kafka to completely delete all events that pertain to the key of the deleted row in case <a href="https://kafka.apache.org/documentation/#compaction">log compaction</a> is enabled for the topic.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-include-schema-changes"></a><a href="#db2-property-include-schema-changes"><code>include.schema.changes</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>true</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Boolean value that specifies whether the connector should publish changes in the database schema to a Kafka topic with the same name as the database server ID. Each schema change is recorded with a key that contains the database name and a value that is a JSON structure that describes the schema update. This is independent of how the connector internally records database history.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-column-truncate-to-length-chars"></a><a href="#db2-property-column-truncate-to-length-chars"><code>column.truncate.to._length_.chars</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match the fully-qualified names of character-based columns. Fully-qualified names for columns are of the form <em>schemaName</em>.<em>tableName</em>.<em>columnName</em>. In change event records, values in these columns are truncated if they are longer than the number of characters specified by <em>length</em> in the property name. You can specify multiple properties with different lengths in a single configuration. Length must be a positive integer, for example, <code>column.truncate.to.20.chars</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-column-mask-with-length-chars"></a><a href="#db2-property-column-mask-with-length-chars"><code>column.mask.with._length_.chars</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match the fully-qualified names of character-based columns. Fully-qualified names for columns are of the form <em>schemaName</em>.<em>tableName</em>.<em>columnName</em>. In change event values, the values in the specified table columns are replaced with <em>length</em> number of asterisk (<code>*</code>) characters. You can specify multiple properties with different lengths in a single configuration. Length must be a positive integer or zero. When you specify zero, the connector replaces a value with an empty string.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-column-propagate-source-type"></a><a href="#db2-property-column-propagate-source-type"><code>column.propagate.source.type</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match the fully-qualified names of columns. Fully-qualified names for columns are of the form <em>databaseName</em>.<em>tableName</em>.<em>columnName</em>, or <em>databaseName</em>.<em>schemaName</em>.<em>tableName</em>.<em>columnName</em>.<br>
<br>
For each specified column, the connector adds the column&#8217;s original type and original length as parameters to the corresponding field schemas in the emitted change records. The following added schema parameters propagate the original type name and also the original length for variable-width types:<br>
<br>
<code>__debezium.source.column.type</code> + <code>__debezium.source.column.length</code> + <code>__debezium.source.column.scale</code><br>
<br>
This property is useful for properly sizing corresponding columns in sink databases.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-datatype-propagate-source-type"></a><a href="#db2-property-datatype-propagate-source-type"><code>datatype.propagate.source.type</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match the database-specific data type name for some columns. Fully-qualified data type names are of the form <em>databaseName</em>.<em>tableName</em>.<em>typeName</em>, or <em>databaseName</em>.<em>schemaName</em>.<em>tableName</em>.<em>typeName</em>.<br>
<br>
For these data types, the connector adds parameters to the corresponding field schemas in emitted change records. The added parameters specify the original type and length of the column:<br>
<br>
<code>__debezium.source.column.type</code> + <code>__debezium.source.column.length</code> + <code>__debezium.source.column.scale</code><br>
<br>
These parameters propagate a column&#8217;s original type name and length, for variable-width types, respectively. This property is useful for properly sizing corresponding columns in sink databases.<br>
<br>
See <a href="#db2-data-types">Db2 data types</a> for the list of Db2-specific data type names.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-message-key-columns"></a><a href="#db2-property-message-key-columns"><code>message.key.columns</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>empty string</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A semicolon separated list of tables with regular expressions that match table column names. The connector maps values in matching columns to key fields in change event records that it sends to Kafka topics. This is useful when a table does not have a primary key, or when you want to order change event records in a Kafka topic according to a field that is not a primary key.<br>
<br>
Separate entries with semicolons. Insert a colon between the fully-qualified table name and its regular expression. The format is:<br>
<br>
<em>schema-name</em>.<em>table-name</em>:_regexp_;&#8230;&#8203;<br>
<br>
For example,<br>
<br>
<code>schemaA.table_a:regex_1;schemaB.table_b:regex_2;schemaC.table_c:regex_3</code><br>
<br>
If <code>table_a</code> has a an <code>id</code> column, and <code>regex_1</code> is <code>^i</code> (matches any column that starts with <code>i</code>), the connector maps the value in <code>table_a</code>'s <code>id</code> column to a key field in change events that the connector sends to Kafka.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="db2-advanced-configuration-properties"><a class="anchor" href="#db2-advanced-configuration-properties"></a>Advanced connector configuration properties</h4>
<div class="paragraph">
<p>The following <em>advanced</em> configuration properties have defaults that work in most situations and therefore rarely need to be specified in the connector&#8217;s configuration.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 25%;">
<col style="width: 45%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-snapshot-mode"></a><a href="#db2-property-snapshot-mode"><code>snapshot.mode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>initial</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies the criteria for performing a snapshot when the connector starts:<br>
<br>
<code>initial</code> - For tables in capture mode, the connector takes a snapshot of the schema for the table and the data in the table. This is useful for populating Kafka topics with a complete representation of the data.<br>
<br>
<code>schema_only</code> - For tables in capture mode, the connector takes a snapshot of only the schema for the table. This is useful when only the changes that are happening from now on need to be emitted to Kafka topics. After the snapshot is complete, the connector continues by reading change events from the database&#8217;s redo logs.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-snapshot-isolation-mode"></a><a href="#db2-property-snapshot-isolation-mode"><code>snapshot.isolation.mode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>repeatable_read</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>During a snapshot, controls the transaction isolation level and how long the connector locks the tables that are in capture mode. The possible values are:<br>
<br>
<code>read_uncommitted</code> - Does not prevent other transactions from updating table rows during an initial snapshot. This mode has no data consistency guarantees; some data might be lost or corrupted.<br>
<br>
<code>read_committed</code> - Does not prevent other transactions from updating table rows during an initial snapshot. It is possible for a new record to appear twice: once in the initial snapshot and once in the streaming phase. However, this consistency level is appropriate for data mirroring.<br>
<br>
<code>repeatable_read</code> - Prevents other transactions from updating table rows during an initial snapshot. It is possible for a new record to appear twice: once in the initial snapshot and once in the streaming phase. However, this consistency level is appropriate for data mirroring.<br>
<br>
<code>exclusive</code> - Uses repeatable read isolation level but takes an  exclusive lock for all tables to be read. This mode prevents other transactions from updating table rows during an initial snapshot. Only <code>exclusive</code> mode guarantees full consistency; the initial snapshot and streaming logs constitute a linear history.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-event-processing-failure-handling-mode"></a><a href="#db2-property-event-processing-failure-handling-mode"><code>event.processing.failure.handling.mode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>fail</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies how the connector handles exceptions during processing of events. The possible values are:<br>
<br>
<code>fail</code> - The connector logs the offset of the problematic event and stops processing.<br>
<br>
<code>warn</code> - The connector logs the offset of the problematic event and continues processing with the next event.<br>
<br>
<code>skip</code> - The connector skips the problematic event and continues processing with the next event.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-poll-interval-ms"></a><a href="#db2-property-poll-interval-ms"><code>poll.interval.ms</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>1000</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Positive integer value that specifies the number of milliseconds the connector should wait for new change events to appear before it starts processing a batch of events. Defaults to 1000 milliseconds, or 1 second.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-max-queue-size"></a><a href="#db2-property-max-queue-size"><code>max.queue.size</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>8192</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Positive integer value for the maximum size of the blocking queue. The connector places change events that it reads from the database log into the blocking queue before writing them to Kafka. This queue can provide backpressure for reading change-data tables when, for example, writing records to Kafka is slower than it should be or Kafka is not available. Events that appear in the queue are not included in the offsets that are  periodically recorded by the connector. The <code>max.queue.size</code> value should always be larger than the value of the <code>max.batch.size</code> connector  configuration property.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-max-batch-size"></a><a href="#db2-property-max-batch-size"><code>max.batch.size</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>2048</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Positive integer value that specifies the maximum size of each batch of events that the connector processes.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-max-queue-size-in-bytes"></a><a href="#db2-property-max-queue-size-in-bytes"><code>max.queue.size.in.bytes</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>0</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Long value for the maximum size in bytes of the blocking queue. The feature is disabled by default, it will be active if it&#8217;s set with a positive long value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-heartbeat-interval-ms"></a><a href="#db2-property-heartbeat-interval-ms"><code>heartbeat.interval.ms</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>0</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Controls how frequently the connector sends heartbeat messages to a Kafka topic. The default behavior is that the connector does not send heartbeat messages.<br>
<br>
Heartbeat messages are useful for monitoring whether the connector is receiving change events from the database. Heartbeat messages might help decrease the number of change events that need to be re-sent when a connector restarts. To send heartbeat messages, set this property to a positive integer, which indicates the number of milliseconds between heartbeat messages.<br>
<br>
Heartbeat messages are useful when there are many updates in a database that is being tracked but only a tiny number of updates are in tables that are in capture mode. In this situation, the connector reads from the database transaction log as usual but rarely emits change records to Kafka. This means that the connector has few opportunities to send the latest offset to Kafka. Sending heartbeat messages enables the connector to send the latest offset to Kafka.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-heartbeat-topics-prefix"></a><a href="#db2-property-heartbeat-topics-prefix"><code>heartbeat.topics.prefix</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>__debezium-heartbeat</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies the prefix for the name of the topic to which the connector sends heartbeat messages. The format for this topic name is  <code>&lt;heartbeat.topics.prefix&gt;.&lt;server.name&gt;</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-snapshot-delay-ms"></a><a href="#db2-property-snapshot-delay-ms"><code>snapshot.delay.ms</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An interval in milliseconds that the connector should wait before performing a snapshot when the connector starts. If you are starting multiple connectors in a cluster, this property is useful for avoiding snapshot interruptions, which might cause re-balancing of connectors.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-snapshot-fetch-size"></a><a href="#db2-property-snapshot-fetch-size"><code>snapshot.fetch.size</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>2000</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>During a snapshot, the connector reads table content in batches of rows. This property specifies the maximum number of rows in a batch.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-snapshot-lock-timeout-ms"></a><a href="#db2-property-snapshot-lock-timeout-ms"><code>snapshot.lock.timeout.ms</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>10000</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Positive integer value that specifies the maximum amount of time (in milliseconds) to wait to obtain table locks when performing a snapshot. If the connector cannot acquire table locks in this interval, the snapshot fails. <a href="#db2-snapshots">How the connector performs snapshots</a> provides details. Other possible settings are:<br>
<br>
<code>0</code> -  The connector immediately fails when it cannot obtain a lock.<br>
<br>
<code>-1</code> - The connector waits infinitely.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-snapshot-select-statement-overrides"></a><a href="#db2-property-snapshot-select-statement-overrides"><code>snapshot.select.statement.overrides</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Controls which table rows are included in snapshots. This property affects snapshots only. It does not affect events that the connector reads from the log. Specify a comma-separated list of fully-qualified table names in the form <em>schemaName.tableName</em>.<br>
<br>
For each table that you specify, also specify another configuration property: <code>snapshot.select.statement.overrides.<em>SCHEMA_NAME</em>.<em>TABLE_NAME</em></code>. For example: <code>snapshot.select.statement.overrides.customers.orders</code>. Set this property to a <code>SELECT</code> statement that obtains only the rows that you want in the snapshot. When the connector performs a snapshot, it executes this <code>SELECT</code> statement to retrieve data from that table.<br>
<br>
A possible use case for setting these properties is large, append-only tables. You can specify a <code>SELECT</code> statement that sets a specific point for where to start a snapshot, or where to resume a snapshot if a previous snapshot was interrupted.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-sanitize-field-names"></a><a href="#db2-property-sanitize-field-names"><code>sanitize.field.names</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>true</code> if connector configuration sets the <code>key.converter</code> or <code>value.converter</code> property to the Avro converter.</p>
</div>
<div class="paragraph">
<p><code>false</code> if not.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Indicates whether field names are sanitized to adhere to <a href="../configuration/avro.html#avro-naming" class="page">Avro naming requirements</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-provide-transaction-metadata"></a><a href="#db2-property-provide-transaction-metadata"><code>provide.transaction.metadata</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>false</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Determines whether the connector generates events with transaction boundaries and enriches change event envelopes with transaction metadata. Specify <code>true</code> if you want the connector to do this. See  <a href="#db2-transaction-metadata">Transaction metadata</a> for details.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-skipped-operations"></a><a href="#db2-property-skipped-operations"><code>skipped.operations</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>comma-separated list of operation types that will be skipped during streaming.
The operations include: <code>c</code> for inserts/create, <code>u</code> for updates, and <code>d</code> for deletes.
By default, no operations are skipped.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-signal-data-collection"></a><a href="#db2-property-signal-data-collection"><code>signal.data.collection</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Fully-qualified name of the data collection that is used to send <a href="../configuration/signalling.html" class="page">signals</a> to the connector.
The name format is <em>schema-name.table-name</em>.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="debezium-db2-connector-database-history-configuration-properties"><a class="anchor" href="#debezium-db2-connector-database-history-configuration-properties"></a>Debezium connector database history configuration properties</h4>
<div class="paragraph">
<p>Debezium provides a set of <code>database.history.*</code> properties that control how the connector interacts with the schema history topic.</p>
</div>
<div class="paragraph">
<p>The following table describes the <code>database.history</code> properties for configuring the Debezium connector.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Connector database history configuration properties</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 17%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-database-history-kafka-topic"></a><a href="#db2-property-database-history-kafka-topic"><code>database.history.kafka.topic</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The full name of the Kafka topic where the connector stores the database schema history.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-database-history-kafka-bootstrap-servers"></a><a href="#db2-property-database-history-kafka-bootstrap-servers"><code>database.history.kafka.bootstrap.servers</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A list of host/port pairs that the connector uses for establishing an initial connection to the Kafka cluster. This connection is used for retrieving the database schema history previously stored by the connector, and for writing each DDL statement read from the source database. Each pair should point to the same Kafka cluster used by the Kafka Connect process.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-database-history-kafka-recovery-poll-interval-ms"></a><a href="#db2-property-database-history-kafka-recovery-poll-interval-ms"><code>database.history.kafka.recovery.poll.interval.ms</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>100</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An integer value that specifies the maximum number of milliseconds the connector should wait during startup/recovery while polling for persisted data. The default is 100ms.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-database-history-kafka-recovery-attempts"></a><a href="#db2-property-database-history-kafka-recovery-attempts"><code>database.history.kafka.recovery.attempts</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>4</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The maximum number of times that the connector should try to read persisted history data before the connector recovery fails with an error. The maximum amount of time to wait after receiving no data is <code>recovery.attempts</code> x <code>recovery.poll.interval.ms</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-database-history-skip-unparseable-ddl"></a><a href="#db2-property-database-history-skip-unparseable-ddl"><code>database.history.skip.unparseable.ddl</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>false</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A Boolean value that specifies whether the connector should ignore malformed or unknown database statements or stop processing so a human can fix the issue.
The safe default is <code>false</code>.
Skipping should be used only with care as it can lead to data loss or mangling when the binlog is being processed.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-database-history-store-only-monitored-tables-ddl"></a><a href="#db2-property-database-history-store-only-monitored-tables-ddl"><code>database.history.store.only.monitored.tables.ddl</code></a><br></p>
</div>
<div class="paragraph">
<p><em>Deprecated and scheduled for removal in a future release; use <a href="#db2-property-database-history-store-only-captured-tables-ddl"><code>database.history.store.only.captured.tables.ddl</code></a> instead.</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>false</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A Boolean value that specifies whether the connector should record all DDL statements<br></p>
</div>
<div class="paragraph">
<p><code>true</code> records only those DDL statements that are relevant to tables whose changes are being captured by Debezium. Set to <code>true</code> with care because missing data might become necessary if you change which tables have their changes captured.<br></p>
</div>
<div class="paragraph">
<p>The safe default is <code>false</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="db2-property-database-history-store-only-captured-tables-ddl"></a><a href="#db2-property-database-history-store-only-captured-tables-ddl"><code>database.history.store.only.captured.tables.ddl</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>false</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A Boolean value that specifies whether the connector should record all DDL statements<br></p>
</div>
<div class="paragraph">
<p><code>true</code> records only those DDL statements that are relevant to tables whose changes are being captured by Debezium. Set to <code>true</code> with care because missing data might become necessary if you change which tables have their changes captured.<br></p>
</div>
<div class="paragraph">
<p>The safe default is <code>false</code>.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div id="db2-pass-through-database-history-properties-for-configuring-producer-and-consumer-clients" class="paragraph">
<div class="title">Pass-through database history properties for configuring producer and consumer clients</div>
<p><br>
Debezium relies on a Kafka producer to write schema changes to database history topics.
Similarly, it relies on a Kafka consumer to read from database history topics when a connector starts.
You define the configuration for the Kafka producer and consumer clients by assigning values to a set of pass-through configuration properties that begin with the <code>database.history.producer.*</code> and <code>database.history.consumer.*</code> prefixes.
The pass-through producer and consumer database history properties control a range of behaviors, such as how these clients secure connections with the Kafka broker, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>database.history.producer.security.protocol=SSL
database.history.producer.ssl.keystore.location=/var/private/ssl/kafka.server.keystore.jks
database.history.producer.ssl.keystore.password=test1234
database.history.producer.ssl.truststore.location=/var/private/ssl/kafka.server.truststore.jks
database.history.producer.ssl.truststore.password=test1234
database.history.producer.ssl.key.password=test1234

database.history.consumer.security.protocol=SSL
database.history.consumer.ssl.keystore.location=/var/private/ssl/kafka.server.keystore.jks
database.history.consumer.ssl.keystore.password=test1234
database.history.consumer.ssl.truststore.location=/var/private/ssl/kafka.server.truststore.jks
database.history.consumer.ssl.truststore.password=test1234
database.history.consumer.ssl.key.password=test1234</code></pre>
</div>
</div>
<div class="paragraph">
<p>Debezium strips the prefix from the property name before it passes the property to the Kafka client.</p>
</div>
<div class="paragraph">
<p>See the Kafka documentation for more details about <a href="https://kafka.apache.org/documentation.html#producerconfigs">Kafka producer configuration properties</a> and <a href="https://kafka.apache.org/documentation.html#consumerconfigs">Kafka consumer configuration properties</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="debezium-db2-connector-pass-through-database-driver-configuration-properties"><a class="anchor" href="#debezium-db2-connector-pass-through-database-driver-configuration-properties"></a>Debezium connector pass-through database driver configuration properties</h4>
<div class="paragraph">
<p>The Debezium connector provides for pass-through configuration of the database driver.
Pass-through database properties begin with the prefix <code>database.*</code>.
For example, the connector passes properties such as <code>database.foobar=false</code> to the JDBC URL.</p>
</div>
<div class="paragraph">
<p>As is the case with the <a href="#db2-pass-through-database-history-properties-for-configuring-producer-and-consumer-clients">pass-through properties for database history clients</a>, Debezium strips the prefixes from the properties before it passes them to the database driver.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="db2-monitoring"><a class="anchor" href="#db2-monitoring"></a>Monitoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Debezium Db2 connector provides three types of metrics that are in addition to the built-in support for JMX metrics that Apache ZooKeeper, Apache Kafka, and Kafka Connect provide.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#db2-snapshot-metrics">Snapshot metrics</a> provide information about connector operation while performing a snapshot.</p>
</li>
<li>
<p><a href="#db2-streaming-metrics">Streaming metrics</a> provide information about connector operation when the connector is capturing changes and streaming change event records.</p>
</li>
<li>
<p><a href="#db2-schema-history-metrics">Schema history metrics</a> provide information about the status of the connector&#8217;s schema history.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="../operations/monitoring.html" class="page">Debezium monitoring documentation</a> provides details for how to expose these metrics by using JMX.</p>
</div>
<div class="sect2">
<h3 id="db2-snapshot-metrics"><a class="anchor" href="#db2-snapshot-metrics"></a>Snapshot metrics</h3>
<div class="paragraph">
<p>The <strong>MBean</strong> is <code>debezium.db2:type=connector-metrics,context=snapshot,server=<em>&lt;database.server.name&gt;</em></code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 45%;">
<col style="width: 25%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attributes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-lastevent_db2"></a><a href="#connectors-snaps-metric-lastevent_db2"><code>LastEvent</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>string</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The last snapshot event that the connector has read.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-millisecondssincelastevent_db2"></a><a href="#connectors-snaps-metric-millisecondssincelastevent_db2"><code>MilliSecondsSinceLastEvent</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of milliseconds since the connector has read and processed the most recent event.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-totalnumberofeventsseen_db2"></a><a href="#connectors-snaps-metric-totalnumberofeventsseen_db2"><code>TotalNumberOfEventsSeen</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The total number of events that this connector has seen since last started or reset.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-numberofeventsfiltered_db2"></a><a href="#connectors-snaps-metric-numberofeventsfiltered_db2"><code>NumberOfEventsFiltered</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of events that have been filtered by include/exclude list filtering rules configured on the connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-capturedtables_db2"></a><a href="#connectors-snaps-metric-capturedtables_db2"><code>CapturedTables</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>string[]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The list of tables that are captured by the connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-queuetotalcapacity_db2"></a><a href="#connectors-snaps-metric-queuetotalcapacity_db2"><code>QueueTotalCapacity</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>int</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The length the queue used to pass events between the snapshotter and the main Kafka Connect loop.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-queueremainingcapacity_db2"></a><a href="#connectors-snaps-metric-queueremainingcapacity_db2"><code>QueueRemainingCapacity</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>int</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The free capacity of the queue used to pass events between the snapshotter and the main Kafka Connect loop.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-totaltablecount_db2"></a><a href="#connectors-snaps-metric-totaltablecount_db2"><code>TotalTableCount</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>int</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The total number of tables that are being included in the snapshot.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-remainingtablecount_db2"></a><a href="#connectors-snaps-metric-remainingtablecount_db2"><code>RemainingTableCount</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>int</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of tables that the snapshot has yet to copy.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-snapshotrunning_db2"></a><a href="#connectors-snaps-metric-snapshotrunning_db2"><code>SnapshotRunning</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>boolean</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Whether the snapshot was started.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-snapshotaborted_db2"></a><a href="#connectors-snaps-metric-snapshotaborted_db2"><code>SnapshotAborted</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>boolean</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Whether the snapshot was aborted.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-snapshotcompleted_db2"></a><a href="#connectors-snaps-metric-snapshotcompleted_db2"><code>SnapshotCompleted</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>boolean</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Whether the snapshot completed.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-snapshotdurationinseconds_db2"></a><a href="#connectors-snaps-metric-snapshotdurationinseconds_db2"><code>SnapshotDurationInSeconds</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The total number of seconds that the snapshot has taken so far, even if not complete.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-rowsscanned_db2"></a><a href="#connectors-snaps-metric-rowsscanned_db2"><code>RowsScanned</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Map&lt;String, Long&gt;</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Map containing the number of rows scanned for each table in the snapshot.
Tables are incrementally added to the Map during processing.
Updates every 10,000 rows scanned and upon completing a table.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-maxqueuesizeinbytes_db2"></a><a href="#connectors-snaps-metric-maxqueuesizeinbytes_db2"><code>MaxQueueSizeInBytes</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The maximum buffer of the queue in bytes. It will be enabled if <code>max.queue.size.in.bytes</code> is passed with a positive long value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-currentqueuesizeinbytes_db2"></a><a href="#connectors-snaps-metric-currentqueuesizeinbytes_db2"><code>CurrentQueueSizeInBytes</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The current data of records in the queue in bytes.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="db2-streaming-metrics"><a class="anchor" href="#db2-streaming-metrics"></a>Streaming metrics</h3>
<div class="paragraph">
<p>The <strong>MBean</strong> is <code>debezium.db2:type=connector-metrics,context=streaming,server=<em>&lt;database.server.name&gt;</em></code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 45%;">
<col style="width: 25%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attributes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-lastevent_db2"></a><a href="#connectors-strm-metric-lastevent_db2"><code>LastEvent</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>string</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The last streaming event that the connector has read.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-millisecondssincelastevent_db2"></a><a href="#connectors-strm-metric-millisecondssincelastevent_db2"><code>MilliSecondsSinceLastEvent</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of milliseconds since the connector has read and processed the most recent event.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-totalnumberofeventsseen_db2"></a><a href="#connectors-strm-metric-totalnumberofeventsseen_db2"><code>TotalNumberOfEventsSeen</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The total number of events that this connector has seen since last started or reset.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-numberofeventsfiltered_db2"></a><a href="#connectors-strm-metric-numberofeventsfiltered_db2"><code>NumberOfEventsFiltered</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of events that have been filtered by include/exclude list filtering rules configured on the connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-capturedtables_db2"></a><a href="#connectors-strm-metric-capturedtables_db2"><code>CapturedTables</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>string[]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The list of tables that are captured by the connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-queuetotalcapacity_db2"></a><a href="#connectors-strm-metric-queuetotalcapacity_db2"><code>QueueTotalCapacity</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>int</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The length the queue used to pass events between the streamer and the main Kafka Connect loop.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-queueremainingcapacity_db2"></a><a href="#connectors-strm-metric-queueremainingcapacity_db2"><code>QueueRemainingCapacity</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>int</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The free capacity of the queue used to pass events between the streamer and the main Kafka Connect loop.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-connected_db2"></a><a href="#connectors-strm-metric-connected_db2"><code>Connected</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>boolean</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Flag that denotes whether the connector is currently connected to the database server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-millisecondsbehindsource_db2"></a><a href="#connectors-strm-metric-millisecondsbehindsource_db2"><code>MilliSecondsBehindSource</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of milliseconds between the last change event&#8217;s timestamp and the connector processing it.
The values will incoporate any differences between the clocks on the machines where the database server and the connector are running.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-numberofcommittedtransactions_db2"></a><a href="#connectors-strm-metric-numberofcommittedtransactions_db2"><code>NumberOfCommittedTransactions</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of processed transactions that were committed.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-sourceeventposition_db2"></a><a href="#connectors-strm-metric-sourceeventposition_db2"><code>SourceEventPosition</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Map&lt;String, String&gt;</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The coordinates of the last received event.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-lasttransactionid_db2"></a><a href="#connectors-strm-metric-lasttransactionid_db2"><code>LastTransactionId</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>string</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Transaction identifier of the last processed transaction.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-maxqueuesizeinbytes_db2"></a><a href="#connectors-strm-metric-maxqueuesizeinbytes_db2"><code>MaxQueueSizeInBytes</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The maximum buffer of the queue in bytes.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-currentqueuesizeinbytes_db2"></a><a href="#connectors-strm-metric-currentqueuesizeinbytes_db2"><code>CurrentQueueSizeInBytes</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The current data of records in the queue in bytes.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="db2-schema-history-metrics"><a class="anchor" href="#db2-schema-history-metrics"></a>Schema history metrics</h3>
<div class="paragraph">
<p>The <strong>MBean</strong> is <code>debezium.db2:type=connector-metrics,context=schema-history,server=<em>&lt;database.server.name&gt;</em></code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 45%;">
<col style="width: 25%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attributes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-shist-metric-status_db2"></a><a href="#connectors-shist-metric-status_db2"><code>Status</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>string</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>One of <code>STOPPED</code>, <code>RECOVERING</code> (recovering history from the storage), <code>RUNNING</code> describing the state of the database history.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-shist-metric-recoverystarttime_db2"></a><a href="#connectors-shist-metric-recoverystarttime_db2"><code>RecoveryStartTime</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The time in epoch seconds at what recovery has started.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-shist-metric-changesrecovered_db2"></a><a href="#connectors-shist-metric-changesrecovered_db2"><code>ChangesRecovered</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of changes that were read during recovery phase.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-shist-metric-changesapplied_db2"></a><a href="#connectors-shist-metric-changesapplied_db2"><code>ChangesApplied</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>the total number of schema changes applied during recovery and runtime.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-shist-metric-millisecondssincelastrecoveredchange_db2"></a><a href="#connectors-shist-metric-millisecondssincelastrecoveredchange_db2"><code>MilliSecondsSinceLast&#8203;RecoveredChange</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of milliseconds that elapsed since the last change was recovered from the history store.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-shist-metric-millisecondssincelastappliedchange_db2"></a><a href="#connectors-shist-metric-millisecondssincelastappliedchange_db2"><code>MilliSecondsSinceLast&#8203;AppliedChange</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of milliseconds that elapsed since the last change was applied.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-shist-metric-lastrecoveredchange_db2"></a><a href="#connectors-shist-metric-lastrecoveredchange_db2"><code>LastRecoveredChange</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>string</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The string representation of the last change recovered from the history store.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-shist-metric-lastappliedchange_db2"></a><a href="#connectors-shist-metric-lastappliedchange_db2"><code>LastAppliedChange</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>string</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The string representation of the last applied change.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="db2-management"><a class="anchor" href="#db2-management"></a>Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After you deploy a Debezium Db2 connector, use the Debezium management UDFs to control Db2 replication (ASN) with SQL commands. Some of the UDFs expect a return value in which case you use the  SQL <code>VALUE</code> statement to invoke them. For other UDFs, use the SQL <code>CALL</code> statement.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Descriptions of Debezium management UDFs</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Task</th>
<th class="tableblock halign-left valign-top">Command and notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="debezium-db2-start-asn-agent"></a><a href="#debezium-db2-start-asn-agent">Start the ASN agent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VALUES ASNCDC.ASNCDCSERVICES('start','asncdc');</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="debezium-db2-stop-asn-agent"></a><a href="#debezium-db2-stop-asn-agent">Stop the ASN agent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VALUES ASNCDC.ASNCDCSERVICES('stop','asncdc');</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="debezium-db2-check-asn-agent"></a><a href="#debezium-db2-check-asn-agent">Check the status of the ASN agent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VALUES ASNCDC.ASNCDCSERVICES('status','asncdc');</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="debezium-db2-put-capture-mode"></a><a href="#debezium-db2-put-capture-mode">Put a table into capture mode</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL ASNCDC.ADDTABLE('MYSCHEMA', 'MYTABLE');</code><br>
<br>
Replace <code>MYSCHEMA</code>  with the name of the schema that contains the table you want to put into capture mode. Likewise, replace <code>MYTABLE</code> with the name of the table to put into capture mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="debezium-db2-remove-capture-mode"></a><a href="#debezium-db2-remove-capture-mode">Remove a table from capture mode</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALL ASNCDC.REMOVETABLE('MYSCHEMA', 'MYTABLE');</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="debezium-db2-reinitialize-asn-service"></a><a href="#debezium-db2-reinitialize-asn-service">Reinitialize the ASN service</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VALUES ASNCDC.ASNCDCSERVICES('reinit','asncdc');</code><br>
<br>
Do this after you put a table into capture mode or after you remove a table from capture mode.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="db2-schema-evolution"><a class="anchor" href="#db2-schema-evolution"></a>Schema evolution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>While a Debezium Db2 connector can capture schema changes, to update a schema, you must collaborate with a database administrator to ensure that the connector continues to produce change events. This is required by the way that Db2 implements replication.</p>
</div>
<div class="paragraph">
<p>For each table in capture mode, Db2&#8217;s replication feature creates a change-data table that contains all changes to that source table. However, change-data table schemas are static. If you update the schema for a table in capture mode then you must also update the schema of its corresponding change-data table. A Debezium Db2 connector cannot do this. A database administrator with elevated privileges must update schemas for tables that are in capture mode.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is vital to execute a schema update procedure completely before there is a new schema update on the same table. Consequently, the recommendation is to execute all DDLs in a single batch so the schema update procedure is done only once.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are generally two procedures for updating table schemas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#db2-offline-schema-update">Offline - executed while Debezium is stopped</a></p>
</li>
<li>
<p><a href="#db2-online-schema-update">Online - executed while Debezium is running</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each approach has advantages and disadvantages.</p>
</div>
<div class="sect2">
<h3 id="db2-offline-schema-update"><a class="anchor" href="#db2-offline-schema-update"></a>Offline schema update</h3>
<div class="paragraph">
<p>You stop the Debezium Db2 connector before you perform an offline schema update. While this is the safer schema update procedure, it might not be feasible for applications with high-availability requirements.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>One or more tables that are in capture mode require schema updates.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Suspend the application that updates the database.</p>
</li>
<li>
<p>Wait for the Debezium connector to stream all unstreamed change event records.</p>
</li>
<li>
<p>Stop the Debezium connector.</p>
</li>
<li>
<p>Apply all changes to the source table schema.</p>
</li>
<li>
<p>In the ASN register table, mark the tables with updated schemas as <code>INACTIVE</code>.</p>
</li>
<li>
<p>xref:connectors/db2.adoc#debezium-db2-reinitialize-asn-service[Reinitialize the ASN capture service.</p>
</li>
<li>
<p>Remove the source table with the old schema from capture mode by <a href="#debezium-db2-remove-capture-mode">running the Debezium UDF for removing tables from capture mode</a>.</p>
</li>
<li>
<p>Add the source table with the new schema to capture mode by <a href="#debezium-db2-put-capture-mode">running the Debezium UDF for adding tables to capture mode</a>.</p>
</li>
<li>
<p>In the ASN register table, mark the updated source tables as <code>ACTIVE</code>.</p>
</li>
<li>
<p><a href="#debezium-db2-reinitialize-asn-service">Reinitialize the ASN capture service.</a></p>
</li>
<li>
<p>Resume the application that updates the database.</p>
</li>
<li>
<p>Restart the Debezium connector.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="db2-hot-schema-update"><a class="anchor" href="#db2-hot-schema-update"></a>Online schema update</h3>
<div class="paragraph">
<p>An online schema update does not require application and data processing downtime. That is, you do not stop the Debezium Db2 connector before you perform an online schema update. Also, an online schema update procedure is simpler than the procedure for an offline schema update.</p>
</div>
<div class="paragraph">
<p>However, when a table is in capture mode, after a change to a column name, the Db2 replication feature continues to use the old column name. The new column name does not appear in Debezium change events. You must restart the connector to see the new column name in change events.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>One or more tables that are in capture mode require schema updates.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure when adding a column to the end of a table</div>
<ol class="arabic">
<li>
<p>Lock the source tables whose schema you want to change.</p>
</li>
<li>
<p>In the ASN register table, mark the locked tables as <code>INACTIVE</code>.</p>
</li>
<li>
<p><a href="#debezium-db2-reinitialize-asn-service">Reinitialize the ASN capture service.</a></p>
</li>
<li>
<p>Apply all changes to the schemas for the source tables.</p>
</li>
<li>
<p>Apply all changes to the schemas for the corresponding change-data tables.</p>
</li>
<li>
<p>In the ASN register table, mark the source tables as <code>ACTIVE</code>.</p>
</li>
<li>
<p><a href="#debezium-db2-reinitialize-asn-service">Reinitialize the ASN capture service.</a></p>
</li>
<li>
<p>Optional. Restart the connector to see updated column names in change events.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Procedure when adding a column to the middle of a table</div>
<ol class="arabic">
<li>
<p>Lock the source table(s) to be changed.</p>
</li>
<li>
<p>In the ASN register table, mark the locked tables as <code>INACTIVE</code>.</p>
</li>
<li>
<p><a href="#debezium-db2-reinitialize-asn-service">Reinitialize the ASN capture service.</a></p>
</li>
<li>
<p>For each source table to be changed:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Export the data in the source table.</p>
</li>
<li>
<p>Truncate the source table.</p>
</li>
<li>
<p>Alter the source table and add the column.</p>
</li>
<li>
<p>Load the exported data into the altered source table.</p>
</li>
<li>
<p>Export the data in the source table&#8217;s corresponding change-data table.</p>
</li>
<li>
<p>Truncate the change-data table.</p>
</li>
<li>
<p>Alter the change-data table and add the column.</p>
</li>
<li>
<p>Load the exported data into the altered change-data table.</p>
</li>
</ol>
</div>
</li>
<li>
<p>In the ASN register table, mark the tables as <code>INACTIVE</code>. This marks the old change-data tables as inactive, which allows the data in them to remain but they are no longer updated.</p>
</li>
<li>
<p><a href="#debezium-db2-reinitialize-asn-service">Reinitialize the ASN capture service.</a></p>
</li>
<li>
<p>Optional. Restart the connector to see updated column names in change events.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</article>
</div>
<div class="article-cell2">
</div>
</div>

<div id="toc-rightbar"></div>    <footer class="footer">
        <div class="wrapper">
            <div class="copyright">Copyright &copy; 2021 Debezium Community</div>
        </div>
    </footer>
</main>
</div>
<script>
    /* Make sure TOC carets are expanded if sub-elements exist */
    $("#toc").each(function(i,v) {
      $(this).closest('article').addClass('with-toc');
    });

    $("#toc ul.sectlevel1 > li").each(function(i,v) {
      $(this).has("ul").addClass("expanded");
    });

    $(function() {
        /* Expands all the documentation submenus */
        $(".nav-list > .nav-item:not(.is-active) .nav-item-toggle").click();
    });

    /**
     * This checks if a "#toc" element exists in the DOM and if so:
     *
     *  1. Appends a cloned copy of the #toc node to the #toc-rightbar div.
     *  2. Forces the #toc-rightbar div to be visible.
     *  3. Adds the .toc-right class to the #article-wrapper div to restrict the article's overall width.
     */
    var $toc = $("#toc");
    if ( $toc.length ) {
        $("#toc-rightbar").append($toc.clone());
        $("body .main").addClass("with-toc");
    }

    /**
     * In order to make CSS changes that are backward compatible with old adoc files, this applies a version
     * style to the body tag so we can use it to differentiate between CSS styles per version if needed,
     * such as tfoot rows.
     */
    var $version = $("body .nav-container").data("version");
    var $versionClass = "version-" + $version;
    $versionClass = $versionClass.replace('.','-');
    $("body").addClass($versionClass);

    /** A CSS trick to wrap long-width tables in a div that can be scrolled on smaller screens */
    $("table.tableblock").wrap("<div class='table-scroll-wrapper'></div>");

    $(function() {
        /* apply floating scrollbar to the scroll-wrapper */
        $(".table-scroll-wrapper").floatingScrollbar();
    });

</script>
<script src="../../debezium-antora/js/site.js"></script>
<script async src="../../debezium-antora/js/vendor/highlight.js"></script>

<script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
  try {
    var pageTracker = _gat._getTracker("UA-10656779-1");
    pageTracker._trackPageview();
  } catch(err) {}
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-76464546-1', 'auto');
  ga('send', 'pageview');
  ga('set', 'anonymizeIp', true);
  ga('require', 'linkid', 'linkid.js');
</script>
</body>
</html>