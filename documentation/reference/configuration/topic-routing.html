<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Topic Routing :: Debezium Documentation</title>
    <link rel="canonical" href="https://www.debezium.io/documentation/reference/configuration/topic-routing.html">
    <meta name="generator" content="Antora 2.2.0">
<link rel="stylesheet" href="../../debezium-antora/css/site.css">
<link rel="stylesheet" href="../../debezium-antora/css/debezium-antora.css">
<link rel="stylesheet" href="../../debezium-antora/css/highlightjs-dark.css">
<link rel="stylesheet" href="https://static.jboss.org/css/rhbar.css">
<script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.js"></script>
</head>
<body class="article">
<header class="header">
  <div id="rhbar">
      <a class="jbdevlogo" href="https://www.jboss.org/projects/about"></a>
      <a class="rhlogo" href="https://www.redhat.com"></a>
  </div>
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
          <img src="/images/color_white_debezium_type_600px.svg" style="height: 32px; margin-right: 14px;"/>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="/documentation/faq">FAQ</a>
        <a class="navbar-item" href="/documentation">DOCUMENTATION</a>
        <a class="navbar-item" href="/releases">RELEASES</a>
        <a class="navbar-item" href="/community">COMMUNITY</a>
        <a class="navbar-item" href="/blog">BLOG</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="reference" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Debezium Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tutorial.html">Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../install.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../postgres-plugins.html">PostgreSQL Decoding Plugins</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../features.html">Features</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="avro.html">Avro Serialization</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="topic-routing.html">Topic Routing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="event-flattening.html">New Record State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="mongodb-event-flattening.html">MongoDB New Document State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="outbox-event-router.html">Outbox Event Router</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Connectors</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../connectors/mysql.html">MySQL</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../assemblies/cdc-mysql-connector/as_overview-of-how-the-mysql-connector-works.html">How It Works</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../assemblies/cdc-mysql-connector/as_setup-the-mysql-server.html">Setup</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../assemblies/cdc-mysql-connector/as_deploy-the-mysql-connector.html">Deployment</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../assemblies/cdc-mysql-connector/as_connector-common-issues.html">Common Issues</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/mongodb.html">MongoDB</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/postgresql.html">PostgreSQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/oracle.html">Oracle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/sqlserver.html">SQL Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/cassandra.html">Cassandra</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Integrations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/serdes.html">Change Event SerDes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/outbox.html">Outbox Quarkus Extension</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/cloudevents.html">CloudEvents</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Operations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/monitoring.html">Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/openshift.html">Running on Openshift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/embedded.html">Embedding Debezium</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Debezium Documentation</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Debezium Documentation</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
        <li class="version">
          <a href="../1.1/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../1.0/index.html">1.0</a>
        </li>
        <li class="version">
          <a href="../0.10/index.html">0.10</a>
        </li>
        <li class="version">
          <a href="../0.9/index.html">0.9</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main" class="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Debezium Documentation</a></li>
    <li>Configuration</li>
    <li><a href="topic-routing.html">Topic Routing</a></li>
  </ul>
</nav>
    <div class="page-versions-container">
    Version:
    <div class="page-versions">
        <button class="version-menu-toggle versions-menu-current" title="Show other versions of page">master</button>
        <!--<button class="version-menu-toggle versions-menu-select" title="Select other versions">Select</button>-->
        <div class="version-menu">
                <a class="version is-current" href="topic-routing.html">master</a>
                <a class="version" href="../1.1/configuration/topic-routing.html">1.1</a>
                <a class="version" href="../1.0/configuration/topic-routing.html">1.0</a>
                <a class="version" href="../0.10/configuration/topic-routing.html">0.10</a>
                <a class="version" href="../0.9/configuration/topic-routing.html">0.9</a>
        </div>
        |
    </div>
    </div>
  <div class="edit-this-page"><a href="https://github.com/debezium/debezium/edit/master/documentation/modules/ROOT/pages/configuration/topic-routing.adoc">Edit this Page</a></div>
  </div>
<article class="doc">
<h1 class="page">Topic Routing</h1>
<div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_use_cases">Use-Cases</a>
<ul class="sectlevel2">
<li><a href="#_logical_tables">Logical Tables</a></li>
</ul>
</li>
<li><a href="#_topic_names">Topic Names</a></li>
<li><a href="#_key_fields">Key Fields</a></li>
</ul>
</div>
<div class="paragraph">
<p>Debezium enables you to re-route the emitted change before the message reaches the converter using a single message transformation,
or <a href="https://kafka.apache.org/documentation/#connect_transforms">SMT</a>.
The SMT provided by Debezium enables you to rewrite the topic and the key according to a regular expression and a replacement pattern,
configurable per instance of Debezium.</p>
</div>
<div class="paragraph">
<p>The implementation does not care about the sanity of the change, this is in the responsibility of the user.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_use_cases"><a class="anchor" href="#_use_cases"></a>Use-Cases</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_logical_tables"><a class="anchor" href="#_logical_tables"></a>Logical Tables</h3>
<div class="paragraph">
<p>A logical table consists of one or more physical tables with the same table structure.
A common use case is sharding, where for example two physical tables <code>db_shard1.my_table</code> and <code>db_shard2.my_table</code> together form one logical table.</p>
</div>
<div class="paragraph">
<p>Typically the physical tables share the same schema.</p>
</div>
<div class="paragraph">
<p>Normally, Debezium connectors send each change event to a topic that is named by the database and table.
But since the sharded tables have the same schema, we&#8217;d instead like to re-route each change event to a topic named by the <em>logical</em> table name.
This way, all changes events for any of the shards all go to the same topic.</p>
</div>
<div class="paragraph">
<p>What happens if each physical table has a primary key that is only unique within that table?
In this case, a row in shard 1 can have the same primary key as a row in shard 2.
Since Debezium events are keyed by the columns that make up the primary key, the events for that row in shard 1 would have the same key as the row in shard 2,
even though globally they are different rows.
So, in addition to changing the topic name, we may also want to <em>modify the event key</em> to add a field that makes the key globally unique.</p>
</div>
<div class="paragraph">
<p>This SMT lets you specify how you want to choose the new topic name and then specify how to modify the change event key to ensure it is globally unique.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_topic_names"><a class="anchor" href="#_topic_names"></a>Topic Names</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Below is an example for a configuration which replaces a part of the table in the topic with another string, allowing two tables to emit changes to the same topic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>transforms=Reroute
transforms.Reroute.type=io.debezium.transforms.ByLogicalTableRouter
transforms.Reroute.topic.regex=(.*)customers_shard(.*)
transforms.Reroute.topic.replacement=$1customers_all_shards</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration above will match topics such as <code>myserver.mydb.customers_shard1</code>, <code>myserver.mydb.customers_shard2</code> etc. and replace it with <code>myserver.mydb.customers_all_shards.</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_key_fields"><a class="anchor" href="#_key_fields"></a>Key Fields</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To address the concern of uniqueness across all the original tables discussed above,
one more field for identifying the original (physical) table is inserted into the key structure of the change events.
By default, this field is named <code>__dbz__physicalTableIdentifier</code> and has the original topic name as its value.</p>
</div>
<div class="paragraph">
<p>If needed, another <em>field name</em> can be chosen by means of the <code>key.field.name</code> property
(obviously you&#8217;ll want to choose a field name that doesn&#8217;t clash with existing primary key fields).
For example the following configuration will use the name <code>shard_id</code> for the key field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>...
transforms.Reroute.key.field.name=shard_id
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>value</em> of the field can be adjusted via the <code>key.field.regex</code> and <code>key.field.replacement</code> properties.
The former allows you to define a regular expression that will be applied to the original topic name to capture one or more groups of characters.
The latter lets you specify an expression that defines the value for the field in terms of those captured groups.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>...
transforms.Reroute.key.field.regex=(.*)customers_shard(.*)
transforms.Reroute.key.field.replacement=$2</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will apply the given regular expression to original topic names and use the second capturing group as value for the key field.
Assuming the source topics are named <code>myserver.mydb.customers_shard1</code>, <code>myserver.mydb.customers_shard2</code> etc., the key field&#8217;s values would be <code>1</code>, <code>2</code> etc.</p>
</div>
</div>
</div>
</article>
    <footer class="footer">
        <div class="wrapper">
            <div class="copyright">Copyright &copy; 2020 Debezium Community</div>
        </div>
    </footer>
</main>
</div>
<script>
    /* Make sure TOC carets are expanded if sub-elements exist */
    $("#toc").each(function(i,v) {
      $(this).closest('article').addClass('with-toc');
    });

    $("#toc ul.sectlevel1 > li").each(function(i,v) {
      $(this).has("ul").addClass("expanded");
    });

    $(function() {
        /* Expands all the documentation submenus */
        $(".nav-list > .nav-item:not(.is-active) .nav-item-toggle").click();
    });

    /*
    $(".doc.with-toc").each(function(i,v) {
        var tocWidth = $(".toc").width();
        $(this).css("max-width", "calc(100% - " + (tocWidth+75) + "px)");
    });
    */
</script>
<script src="../../debezium-antora/js/site.js"></script>
<script async src="../../debezium-antora/js/vendor/highlight.js"></script>

<script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
  try {
    var pageTracker = _gat._getTracker("UA-10656779-1");
    pageTracker._trackPageview();
  } catch(err) {}
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-76464546-1', 'auto');
  ga('send', 'pageview');
  ga('set', 'anonymizeIp', true);
  ga('require', 'linkid', 'linkid.js');
</script>
</body>
</html>