<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Deploying the Debezium 1.0 Technology Preview with AMQ Streams :: Debezium Documentation</title>
    <link rel="canonical" href="https://www.debezium.io/documentation/reference/operations/amq-streams.html">
    <meta name="generator" content="Antora 2.2.0">
<link rel="stylesheet" href="../../../debezium-antora/css/site.css">
<link rel="stylesheet" href="../../../debezium-antora/css/debezium-antora.css">
<link rel="stylesheet" href="../../../debezium-antora/css/highlightjs-dark.css">
<link rel="stylesheet" href="https://static.jboss.org/css/rhbar.css">
<script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.js"></script>
</head>
<body class="article">
<header class="header">
  <div id="rhbar">
      <a class="jbdevlogo" href="https://www.jboss.org/projects/about"></a>
      <a class="rhlogo" href="https://www.redhat.com"></a>
  </div>
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
          <img src="/images/color_white_debezium_type_600px.svg" style="height: 32px; margin-right: 14px;"/>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="/documentation/faq">FAQ</a>
        <a class="navbar-item" href="/documentation">DOCUMENTATION</a>
        <a class="navbar-item" href="/releases">RELEASES</a>
        <a class="navbar-item" href="/community">COMMUNITY</a>
        <a class="navbar-item" href="/blog">BLOG</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="reference" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Debezium Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tutorial.html">Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../install.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../postgres-plugins.html">PostgreSQL Decoding Plugins</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../features.html">Features</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/avro.html">Avro Serialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/topic-routing.html">Topic Routing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/event-flattening.html">New Record State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/mongodb-event-flattening.html">MongoDB New Document State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/outbox-event-router.html">Outbox Event Router</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/serdes.html">Change Event SerDes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Connectors</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/mysql.html">MySQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/mongodb.html">MongoDB</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/postgresql.html">PostgreSQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/oracle.html">Oracle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/sqlserver.html">SQL Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/cassandra.html">Cassandra</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Operations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="monitoring.html">Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="openshift.html">Running on Openshift</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="amq-streams.html">Running with AMQ Streams</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="embedded.html">Embedding Debezium</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Debezium Documentation</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Debezium Documentation</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../index.html">master</a>
        </li>
        <li class="version">
          <a href="../../1.1/index.html">1.1</a>
        </li>
        <li class="version is-current">
          <a href="../index.html">1.0</a>
        </li>
        <li class="version">
          <a href="../../0.10/index.html">0.10</a>
        </li>
        <li class="version">
          <a href="../../0.9/index.html">0.9</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main" class="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Debezium Documentation</a></li>
    <li>Operations</li>
    <li><a href="amq-streams.html">Running with AMQ Streams</a></li>
  </ul>
</nav>
    <div class="page-versions-container">
    Version:
    <div class="page-versions">
        <button class="version-menu-toggle versions-menu-current" title="Show other versions of page">1.0</button>
        <!--<button class="version-menu-toggle versions-menu-select" title="Select other versions">Select</button>-->
        <div class="version-menu">
                <a class="version" href="../../operations/amq-streams.html">master</a>
                <a class="version" href="../../1.1/operations/amq-streams.html">1.1</a>
                <a class="version is-current" href="amq-streams.html">1.0</a>
                <a class="version" href="../../0.10/operations/amq-streams.html">0.10</a>
                <a class="version is-missing" href="../../0.9/index.html">0.9</a>
        </div>
        |
    </div>
    </div>
  <div class="edit-this-page"><a href="https://github.com/debezium/debezium/blob/v1.0.0.Final/documentation/modules/ROOT/pages/operations/amq-streams.adoc">Edit this Page</a></div>
  </div>
<article class="doc">
<h1 class="page">Deploying the Debezium 1.0 Technology Preview with AMQ Streams</h1>
<div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_apache_kafka_deployment">Apache Kafka Deployment</a></li>
<li><a href="#_debezium_deployment">Debezium Deployment</a>
<ul class="sectlevel2">
<li><a href="#_preparing_directory_structure">Preparing Directory Structure</a></li>
<li><a href="#_deploying_kafka_connect_with_the_debezium_technology_preview">Deploying Kafka Connect with the Debezium Technology Preview</a></li>
</ul>
</li>
<li><a href="#_verifying_the_deployment">Verifying the Deployment</a></li>
<li><a href="#_questions_and_resources">Questions and Resources</a></li>
</ul>
</div>
<div class="paragraph">
<p>The following describes how to set up the <a href="https://developers.redhat.com/products/amq/download/">Debezium 1.0.0 Technology Preview connectors</a> for change data capture on Red Hat&#8217;s <a href="https://www.openshift.com/">OpenShift</a> container platform.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This and other documentation pages mention <code><code>Debezium 1.0.0 Technology Preview</code></code>, please note that this version corresponds to version <code><code>1.0.0.Beta2</code></code> of upstream <a href="https://github.com/debezium/debezium/tree/v1.0.0.Beta2">Debezium project</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_apache_kafka_deployment"><a class="anchor" href="#_apache_kafka_deployment"></a>Apache Kafka Deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For setting up Apache Kafka and Apache Kafka Connect on OpenShift, <a href="https://access.redhat.com/products/red-hat-amq#streams">Red Hat AMQ Streams</a> can be used, which offers "Kafka as a Service".
It consists of an enterprise grade operator and images that bring Kafka to OpenShift.</p>
</div>
<div class="paragraph">
<p>Follow these steps to prepare your Kafka cluster:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install the AMQ Streams operator by following steps in <a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.5/html/using_amq_streams_on_openshift/getting-started-str#downloads-str">AMQ docs</a>.</p>
</li>
<li>
<p>Select the desired configuration and <a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.5/html/using_amq_streams_on_openshift/getting-started-str#downloads-str">deploy your Kafka Cluster</a>.</p>
</li>
<li>
<p>Deploy <a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.5/html/using_amq_streams_on_openshift/getting-started-str#using-kafka-connect-with-plug-ins-str">Kafka Connect s2i</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We now have a working <code><code>Kafka cluster</code></code> running within <code><code>OpenShift</code></code> with <code><code>Kafka Connect s2i</code></code>.</p>
</div>
<div class="paragraph">
<p>After a while and depending on your Kafka configuration, these pods should be running (assuming you used "debezium-kafka-cluster" as the AMQ Streams Kafka cluster name):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">$ oc get pods

NAME                                                      READY     STATUS      RESTARTS   AGE
debezium-kafka-cluster-entity-operator-7b6b9d4c5f-k7b92   3/3       Running     0          5m
debezium-kafka-cluster-kafka-0                            2/2       Running     0          4m
debezium-kafka-cluster-zookeeper-0                        2/2       Running     0          4m
strimzi-cluster-operator-97cd5cf7b-l58bq                  1/1       Running     0          6m</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to running pods you should have a <code><code>DeploymentConfig</code></code> associated with your Connect <code><code>s2i</code></code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Instead of utilising the <code><code>KafkaConnectS2I</code></code> you can create a new <code><code>Dockerfile</code></code> based on AMQ&#8217;s Kafka image, including the required Debezium connectors.
The precise instruction can also be found in <a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.3/html/using_amq_streams_on_openshift_container_platform/getting-started-str#using-kafka-connect-with-plug-ins-str">AMQ Streams documentation</a>.
In this case the last item in the list above can be omitted.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_debezium_deployment"><a class="anchor" href="#_debezium_deployment"></a>Debezium Deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To deploy a Kafka Cluster with the Debezium Technology Preview connectors we need to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Download the connector archives</p>
</li>
<li>
<p>Prepare the plugin directory structure</p>
</li>
<li>
<p>Start the OpenShift s2i build to deploy the final Kafka Connect cluster</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_preparing_directory_structure"><a class="anchor" href="#_preparing_directory_structure"></a>Preparing Directory Structure</h3>
<div class="paragraph">
<p>Download the connector archives from <a href="https://developers.redhat.com/products/amq/download">Red Hat Developer Portal</a>, extract the archives, and download the required driver dependencies.
Once complete you should end with the following directory structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">$ tree ./plugins
plugins
├── debezium-connector-mongodb
│   ├── CHANGELOG.md
│   ├── CONTRIBUTE.md
│   ├── COPYRIGHT.txt
│   ├── LICENSE-3rd-PARTIES.txt
│   ├── LICENSE.txt
│   ├── README.md
│   ├── bson-3.10.1.redhat-00001.jar
│   ├── debezium-connector-mongodb-1.0.0.Beta2-redhat-00001.jar
│   ├── debezium-core-1.0.0.Beta2-redhat-00001.jar
│   ├── mongodb-driver-3.10.1.redhat-00001.jar
│   ├── mongodb-driver-core-3.10.1.redhat-00001.jar
│   └── util-3.10.1.redhat-00001.jar
├── debezium-connector-mysql
│   ├── CHANGELOG.md
│   ├── CONTRIBUTE.md
│   ├── COPYRIGHT.txt
│   ├── LICENSE-3rd-PARTIES.txt
│   ├── LICENSE.txt
│   ├── README.md
│   ├── antlr4-runtime-4.7.0.redhat-00013.jar
│   ├── debezium-connector-mysql-1.0.0.Beta2-redhat-00001.jar
│   ├── debezium-core-1.0.0.Beta2-redhat-00001.jar
│   ├── debezium-ddl-parser-1.0.0.Beta2-redhat-00001.jar
│   ├── mysql-binlog-connector-java-0.19.1.redhat-00002.jar
│   └── mysql-connector-java-8.0.16.redhat-00001.jar
├── debezium-connector-postgres
│   ├── CHANGELOG.md
│   ├── CONTRIBUTE.md
│   ├── COPYRIGHT.txt
│   ├── LICENSE-3rd-PARTIES.txt
│   ├── LICENSE.txt
│   ├── README.md
│   ├── debezium-connector-postgres-1.0.0.Beta2-redhat-00001.jar
│   ├── debezium-core-1.0.0.Beta2-redhat-00001.jar
│   ├── postgresql-42.2.8.redhat-00001.jar
│   └── protobuf-java-3.8.0.redhat-00001.jar
└── debezium-connector-sqlserver
    ├── CHANGELOG.md
    ├── CONTRIBUTE.md
    ├── COPYRIGHT.txt
    ├── LICENSE-3rd-PARTIES.txt
    ├── LICENSE.txt
    ├── README.md
    ├── debezium-connector-sqlserver-1.0.0.Beta2-redhat-00001.jar
    ├── debezium-core-1.0.0.Beta2-redhat-00001.jar
    └── mssql-jdbc-7.2.2.jre8-redhat-00001.jar</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploying_kafka_connect_with_the_debezium_technology_preview"><a class="anchor" href="#_deploying_kafka_connect_with_the_debezium_technology_preview"></a>Deploying Kafka Connect with the Debezium Technology Preview</h3>
<div class="paragraph">
<p>With plugin directory structure ready, all we have to do now in order to deploy our Kafka Connect cluster is triggering the <code><code>s2i</code></code> build.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash"># Check the name of our build config
$ oc get buildconfigs

NAME                                     TYPE     FROM     LATEST
debezium-kafka-connect-cluster-connect   Source   Binary   2

# Build and deploy Kafka Connect cluster with Debezium
$ oc start-build debezium-kafka-connect-cluster-connect --from-dir=./plugins</code></pre>
</div>
</div>
<div class="paragraph">
<p>After a while all parts should be up and running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">oc get pods

NAME                                                      READY     STATUS      RESTARTS   AGE
debezium-kafka-cluster-entity-operator-7b6b9d4c5f-k7b92   3/3       Running     0          10m
debezium-kafka-cluster-kafka-0                            2/2       Running     0          9m
debezium-kafka-cluster-zookeeper-0                        2/2       Running     0          9m
debezium-kafka-connect-cluster-connect-2-jw695            1/1       Running     0          1m
debezium-kafka-connect-cluster-connect-2-deploy           0/1       Completed   0          3m
strimzi-cluster-operator-97cd5cf7b-l58bq                  1/1       Running     0          11m</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can go to the "Pods" view of your OpenShift Web Console to confirm all pods are up and running:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/images/openshift_amq_pods.png" alt="openshift amq pods" width="771">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_verifying_the_deployment"><a class="anchor" href="#_verifying_the_deployment"></a>Verifying the Deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Next we are going to verify whether the deployment is correct by emulating the <a href="../tutorial.html" class="page">Debezium Tutorial</a> and following the steps in <a href="openshift.html#verifying_the_deployment" class="page">OpenShift Installation</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You will want to change the pod names to correspond with your AMQ Streams deployment.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_questions_and_resources"><a class="anchor" href="#_questions_and_resources"></a>Questions and Resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In case of any requests or questions related to running the Debezium Technology Preview with AMQ Streams on OpenShift,
please let us know by sending an e-mail to <a href="mailto:debezium-cdc-preview@redhat.com">debezium-cdc-preview</a> mailing list.</p>
</div>
</div>
</div>
</article>
    <footer class="footer">
        <div class="wrapper">
            <div class="copyright">Copyright &copy; 2020 Debezium Community</div>
        </div>
    </footer>
</main>
</div>
<script>
    /* Make sure TOC carets are expanded if sub-elements exist */
    $("#toc").each(function(i,v) {
      $(this).closest('article').addClass('with-toc');
    });

    $("#toc ul.sectlevel1 > li").each(function(i,v) {
      $(this).has("ul").addClass("expanded");
    });

    $(function() {
        /* Expands all the documentation submenus */
        $(".nav-list > .nav-item:not(.is-active) .nav-item-toggle").click();
    });

    /*
    $(".doc.with-toc").each(function(i,v) {
        var tocWidth = $(".toc").width();
        $(this).css("max-width", "calc(100% - " + (tocWidth+75) + "px)");
    });
    */
</script>
<script src="../../../debezium-antora/js/site.js"></script>
<script async src="../../../debezium-antora/js/vendor/highlight.js"></script>

<script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
  try {
    var pageTracker = _gat._getTracker("UA-10656779-1");
    pageTracker._trackPageview();
  } catch(err) {}
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-76464546-1', 'auto');
  ga('send', 'pageview');
  ga('set', 'anonymizeIp', true);
  ga('require', 'linkid', 'linkid.js');
</script>
</body>
</html>