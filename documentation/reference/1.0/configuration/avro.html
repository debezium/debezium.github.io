<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Avro Serialization :: Debezium Documentation</title>
    <link rel="canonical" href="https://www.debezium.io/documentation/reference/configuration/avro.html">
    <meta name="generator" content="Antora 2.2.0">
<link rel="stylesheet" href="../../../debezium-antora/css/site.css">
<link rel="stylesheet" href="../../../debezium-antora/css/debezium-antora.css">
<link rel="stylesheet" href="../../../debezium-antora/css/highlightjs-dark.css">
<link rel="stylesheet" href="https://static.jboss.org/css/rhbar.css">
<script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.js"></script>
</head>
<body class="article">
<header class="header">
  <div id="rhbar">
      <a class="jbdevlogo" href="https://www.jboss.org/projects/about"></a>
      <a class="rhlogo" href="https://www.redhat.com"></a>
  </div>
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
          <img src="/images/color_white_debezium_type_600px.svg" style="height: 32px; margin-right: 14px;"/>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="/documentation/faq">FAQ</a>
        <a class="navbar-item" href="/documentation">DOCUMENTATION</a>
        <a class="navbar-item" href="/releases">RELEASES</a>
        <a class="navbar-item" href="/community">COMMUNITY</a>
        <a class="navbar-item" href="/blog">BLOG</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="reference" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Debezium Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tutorial.html">Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../install.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../postgres-plugins.html">PostgreSQL Decoding Plugins</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../features.html">Features</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Configuration</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="avro.html">Avro Serialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="topic-routing.html">Topic Routing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="event-flattening.html">New Record State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="mongodb-event-flattening.html">MongoDB New Document State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="outbox-event-router.html">Outbox Event Router</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="serdes.html">Change Event SerDes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Connectors</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/mysql.html">MySQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/mongodb.html">MongoDB</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/postgresql.html">PostgreSQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/oracle.html">Oracle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/sqlserver.html">SQL Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/cassandra.html">Cassandra</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Operations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/monitoring.html">Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/openshift.html">Running on Openshift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/embedded.html">Embedding Debezium</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Debezium Documentation</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Debezium Documentation</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../index.html">master</a>
        </li>
        <li class="version">
          <a href="../../1.1/index.html">1.1</a>
        </li>
        <li class="version is-current">
          <a href="../index.html">1.0</a>
        </li>
        <li class="version">
          <a href="../../0.10/index.html">0.10</a>
        </li>
        <li class="version">
          <a href="../../0.9/index.html">0.9</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main" class="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Debezium Documentation</a></li>
    <li>Configuration</li>
    <li><a href="avro.html">Avro Serialization</a></li>
  </ul>
</nav>
    <div class="page-versions-container">
    Version:
    <div class="page-versions">
        <button class="version-menu-toggle versions-menu-current" title="Show other versions of page">1.0</button>
        <!--<button class="version-menu-toggle versions-menu-select" title="Select other versions">Select</button>-->
        <div class="version-menu">
                <a class="version" href="../../configuration/avro.html">master</a>
                <a class="version" href="../../1.1/configuration/avro.html">1.1</a>
                <a class="version is-current" href="avro.html">1.0</a>
                <a class="version" href="../../0.10/configuration/avro.html">0.10</a>
                <a class="version" href="../../0.9/configuration/avro.html">0.9</a>
        </div>
        |
    </div>
    </div>
  <div class="edit-this-page"><a href="https://github.com/debezium/debezium/edit/1.0/documentation/modules/ROOT/pages/configuration/avro.adoc">Edit this Page</a></div>
  </div>
<article class="doc">
<h1 class="page">Avro Serialization</h1>
<div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_technical_information">Technical Information</a></li>
<li><a href="#_debezium_docker_images">Debezium Docker Images</a></li>
<li><a href="#names">Naming</a></li>
<li><a href="#_getting_more_information">Getting More Information</a></li>
</ul>
</div>
<div class="paragraph">
<p>Debezium connectors are used with the Kafka Connect framework to capture changes in databases and generate change events.
The Kafka Connect workers then apply to each of the messages generated by the connector the transformations configured for the connector,
serialize each message key and value into a binary form using the worker&#8217;s <a href="http://docs.confluent.io/current/connect/concepts.html#connect-converters"><em>converters</em></a>,
and finally write each messages into the correct Kafka topic.</p>
</div>
<div class="paragraph">
<p>The converters are specified in the Kafka Connect worker configuration, and the same converters are used for all connectors deployed to that worker&#8217;s cluster.
Kafka Connect comes with a <em>JSON converter</em> that serializes the message keys and values into JSON documents.
The JSON converter can be configured to include or exclude the message schema using the (<code>key.converter.schemas.enable</code> and <code>value.converter.schemas.enable</code>) properties.
Our <a href="../tutorial.html" class="page">tutorial</a> shows what the messages look like when both payload and schemas are included, but the schemas make the messages very verbose.
If you want your messages serialized with JSON, consider setting these properties to <code>false</code> to exclude the verbose schema information.</p>
</div>
<div class="paragraph">
<p>Another option is to serialize the message keys and values using <a href="https://avro.apache.org/">Apache Avro</a>.
The Avro binary format is extremely compact and efficient, and Avro schemas make it possible to ensure that the messages have the correct structure.
Avro&#8217;s schema evolution mechanism makes it possible to evolve the schemas over time,
which is essential for Debezium connectors that dynamically generate the message schemas to match the structure of the database tables.
Over time, the change events captured by Debezium connectors and written by Kafka Connect into a topic may have different versions of the same schema,
and Avro serialization makes it far easier for consumers to adapt to the changing schema.</p>
</div>
<div class="paragraph">
<p>Confluent provides <a href="http://docs.confluent.io/current/schema-registry/docs/index.html">several components</a> that work with Avro:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An Avro Converter that can be used in Kafka Connect workers to map the Kafka Connect schemas into Avro schemas and to then use those Avro schemas to serialize the message keys and values into the very compact Avro binary form.</p>
</li>
<li>
<p>A Schema Registry that tracks all of the Avro schemas used in Kafka topics, and where the Avro Converter sends the generated Avro schemas.
Since the Avro schemas are stored in this registry, each message need only include a tiny <em>schema identifier</em>.
This makes each message even smaller, and for an I/O bound system like Kafka this means more total throughput of the producers and consumers.</p>
</li>
<li>
<p>Avro <em>Serdes</em> (serializers and deserializers) for Kafka producers and consumers.
Any Kafka consumer applications you write to consume change events can use the Avro serdes to deserialize the changes events.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These Confluent components are open source, and you can install them into any Kafka distribution and use them with Kafka Connect.
However, Confluent also provides a <a href="https://www.confluent.io/product/confluent-open-source/">Confluent Open Source Platform</a> that includes the standard Kafka distribution as well as these and other Confluent open source components, including several source and sink connectors.
Some Docker images for Kafka Connect also contain the Avro converter. This includes recent <a href="../docker.html" class="page">Debezium Docker images</a> that include the Debezium connectors, Kafka Connect, and the Avro converter.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_technical_information"><a class="anchor" href="#_technical_information"></a>Technical Information</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A system that wants to use Avro serialization needs to complete two steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deploy a <a href="https://github.com/confluentinc/schema-registry">Schema Registry</a> instance</p>
</li>
<li>
<p>Use these properties to configure Apache Connect instance</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>key.converter=io.confluent.connect.avro.AvroConverter
key.converter.schema.registry.url=http://localhost:8081
value.converter=io.confluent.connect.avro.AvroConverter
value.converter.schema.registry.url=http://localhost:8081</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: In addition to setting key/value converters,it is <strong>strongly recommended</strong> to set internal key/value converters to use JSON converters for easier analysis of stored configuration and offsets.
If you would still prefer to use Avro converter it is not possible now due to a <a href="https://issues.apache.org/jira/browse/KAFKA-3988">known issue</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>internal.key.converter=org.apache.kafka.connect.json.JsonConverter
internal.value.converter=org.apache.kafka.connect.json.JsonConverter</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_debezium_docker_images"><a class="anchor" href="#_debezium_docker_images"></a>Debezium Docker Images</h2>
<div class="sectionbody">
<div class="paragraph">
<p>See the <a href="https://github.com/debezium/debezium-examples/tree/master/tutorial#using-mysql-and-the-avro-message-format">MySQL and the Avro message format</a> tutorial example for a quickstart with MySQL.</p>
</div>
<div class="paragraph">
<p>Deploy a Schema Registry instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>docker run -it --rm --name schema-registry \
    --link zookeeper \
    -e SCHEMA_REGISTRY_KAFKASTORE_CONNECTION_URL=zookeeper:2181 \
    -e SCHEMA_REGISTRY_HOST_NAME=schema-registry \
    -e SCHEMA_REGISTRY_LISTENERS=http://schema-registry:8081 \
    -p 8181:8181 confluentinc/cp-schema-registry</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run a Kafka Connect image configured to use Avro:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>docker run -it --rm --name connect \
    --link zookeeper:zookeeper \
    --link kafka:kafka \
    --link mysql:mysql \
    --link schema-registry:schema-registry \
    -e GROUP_ID=1 \
    -e CONFIG_STORAGE_TOPIC=my_connect_configs \
    -e OFFSET_STORAGE_TOPIC=my_connect_offsets \
    -e KEY_CONVERTER=io.confluent.connect.avro.AvroConverter \
    -e VALUE_CONVERTER=io.confluent.connect.avro.AvroConverter \
    -e INTERNAL_KEY_CONVERTER=org.apache.kafka.connect.json.JsonConverter \
    -e INTERNAL_VALUE_CONVERTER=org.apache.kafka.connect.json.JsonConverter \
    -e CONNECT_KEY_CONVERTER_SCHEMA_REGISTRY_URL=http://schema-registry:8081 \
    -e CONNECT_VALUE_CONVERTER_SCHEMA_REGISTRY_URL=http://schema-registry:8081 \
    -p 8083:8083 debezium/connect:1.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run a console consumer which reads new Avro messages from the <code>db.myschema.mytable</code> topic and decodes to JSON:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>docker run -it --rm --name avro-consumer \
    --link zookeeper:zookeeper \
    --link kafka:kafka \
    --link mysql:mysql \
    --link schema-registry:schema-registry \
    debezium/connect:1.0 \
    /kafka/bin/kafka-console-consumer.sh \
      --bootstrap-server kafka:9092 \
      --property print.key=true \
      --formatter io.confluent.kafka.formatter.AvroMessageFormatter \
      --property schema.registry.url=http://schema-registry:8081 \
      --topic db.myschema.mytable</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="names"><a class="anchor" href="#names"></a>Naming</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As stated in the Avro <a href="https://avro.apache.org/docs/current/spec.html#names">documentation</a>, names must adhere to the following rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Start with <code>[A-Za-z_]</code></p>
</li>
<li>
<p>Subsequently contain only <code>[A-Za-z0-9_]</code> characters</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Debezium uses the column&#8217;s name as the basis for the Avro field.
This can lead to problems during serialization if the column name does not also adhere to the Avro naming rules above.
Debezium provides a configuration option, <code>sanitize.field.names</code> that can be set to <code>true</code> if you have columns that do not adhere to the rule-set above, allowing those fields to be serialized without having to actually modify your schema.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_more_information"><a class="anchor" href="#_getting_more_information"></a>Getting More Information</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="/blog/2016/09/19/Serializing-Debezium-events-with-Avro/">This post</a> from the Debezium blog
describes the concepts of serializers, converters etc. and discusses the advantages of using Avro.</p>
</div>
<div class="paragraph">
<p>For first steps with Kafka Connect, there&#8217;s a helpful <a href="http://docs.confluent.io/current/connect/quickstart.html#goal-of-this-quickstart">quickstart</a> in Confluent&#8217;s documentation.</p>
</div>
</div>
</div>
</article>
    <footer class="footer">
        <div class="wrapper">
            <div class="copyright">Copyright &copy; 2020 Debezium Community</div>
        </div>
    </footer>
</main>
</div>
<script>
    /* Make sure TOC carets are expanded if sub-elements exist */
    $("#toc").each(function(i,v) {
      $(this).closest('article').addClass('with-toc');
    });

    $("#toc ul.sectlevel1 > li").each(function(i,v) {
      $(this).has("ul").addClass("expanded");
    });

    $(function() {
        /* Expands all the documentation submenus */
        $(".nav-list > .nav-item:not(.is-active) .nav-item-toggle").click();
    });

    /*
    $(".doc.with-toc").each(function(i,v) {
        var tocWidth = $(".toc").width();
        $(this).css("max-width", "calc(100% - " + (tocWidth+75) + "px)");
    });
    */
</script>
<script src="../../../debezium-antora/js/site.js"></script>
<script async src="../../../debezium-antora/js/vendor/highlight.js"></script>

<script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
  try {
    var pageTracker = _gat._getTracker("UA-10656779-1");
    pageTracker._trackPageview();
  } catch(err) {}
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-76464546-1', 'auto');
  ga('send', 'pageview');
  ga('set', 'anonymizeIp', true);
  ga('require', 'linkid', 'linkid.js');
</script>
</body>
</html>