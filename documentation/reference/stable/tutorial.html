<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tutorial :: Debezium Documentation</title>
    <link rel="canonical" href="https://debezium.io/documentation/reference/stable/tutorial.html">
    <meta name="generator" content="Antora 3.0.0-alpha.9">
<link rel="stylesheet" href="../../debezium-antora/css/site.css">
<link rel="stylesheet" href="../../debezium-antora/css/debezium-antora.css">
<link rel="stylesheet" href="../../debezium-antora/css/highlightjs-dark.css">
<link rel="stylesheet" href="https://static.jboss.org/css/rhbar.css">
<script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.js"></script>
<script src="../../debezium-antora/js/jquery.ba-floatingscrollbar.js"></script>
</head>
<body class="article">
<header class="header">
  <div id="rhbar">
      <a class="jbdevlogo" href="https://developers.redhat.com"></a>
      <a class="rhlogo" href="https://www.redhat.com"></a>
  </div>
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
          <img src="/assets/images/color_white_debezium_type_600px.svg" style="height: 32px; margin-right: 14px;"/>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="/documentation/faq">FAQ</a>
        <a class="navbar-item" href="/documentation">DOCUMENTATION</a>
        <a class="navbar-item" href="/releases">RELEASES</a>
        <a class="navbar-item" href="/community">COMMUNITY</a>
        <a class="navbar-item" href="/blog">BLOG</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="reference" data-version="stable">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Debezium 1.9 Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="tutorial.html">Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="install.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="postgres-plugins.html">PostgreSQL Decoding Plugins</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="features.html">Features</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuration/avro.html">Avro Serialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuration/topic-auto-create-config.html">Customizing Topic Auto-Creation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuration/signalling.html">Sending Signals to Debezium</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Connectors</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="connectors/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="connectors/mysql.html">MySQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="connectors/mongodb.html">MongoDB</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="connectors/postgresql.html">PostgreSQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="connectors/oracle.html">Oracle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="connectors/sqlserver.html">SQL Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="connectors/db2.html">Db2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="connectors/cassandra.html">Cassandra</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="connectors/vitess.html">Vitess</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Transformations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="transformations/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="transformations/topic-routing.html">Topic Routing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="transformations/event-flattening.html">New Record State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="transformations/mongodb-event-flattening.html">MongoDB New Document State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="transformations/outbox-event-router.html">Outbox Event Router</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="transformations/mongodb-outbox-event-router.html">MongoDB Outbox Event Router</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="transformations/filtering.html">Message Filtering</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="transformations/content-based-routing.html">Content-Based Routing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="transformations/applying-transformations-selectively.html">Using SMT Predicates to Selectively Apply Transformations</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">API and SPI</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="development/engine.html">Debezium Engine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="development/converters.html">Custom Converters</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Integrations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="integrations/serdes.html">Change Event SerDes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="integrations/outbox.html">Outbox Quarkus Extension</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="integrations/cloudevents.html">CloudEvents</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="integrations/tracing.html">OpenTracing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="integrations/testcontainers.html">Integration Testing with Testcontainers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Operations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="operations/debezium-server.html">Debezium Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="operations/logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="operations/monitoring.html">Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="operations/kubernetes.html">Running on Kubernetes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="operations/openshift.html">Running on Openshift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="operations/embedded.html">Embedding Debezium</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="operations/debezium-ui.html">Debezium UI</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Debezium Documentation</span>
    <span class="version">1.9</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Debezium Documentation</span>
      <ul class="versions">
        <li class="version">
          <a href="/documentation/reference/nightly/index.html">nightly</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/2.0/index.html">2.0</a>
        </li>
        <li class="version is-current">
          <a href="/documentation/reference/1.9/index.html">1.9</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/1.8/index.html">1.8</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/1.7/index.html">1.7</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/1.6/index.html">1.6</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/1.5/index.html">1.5</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/1.4/index.html">1.4</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/1.3/index.html">1.3</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/1.1/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/1.0/index.html">1.0</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/0.10/index.html">0.10</a>
        </li>
        <li class="version">
          <a href="/documentation/reference/0.9/index.html">0.9</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main" class="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Debezium Documentation</a></li>
    <li>Getting Started</li>
    <li><a href="tutorial.html">Tutorial</a></li>
  </ul>
</nav>
    <div class="page-versions-container">
    Version:
    <div class="page-versions">
        <button class="version-menu-toggle versions-menu-current" title="Show other versions of page">1.9</button>
        <div class="version-menu">
                <a class="version" href="/documentation/reference/nightly/index.html">nightly</a>
                <a class="version" href="/documentation/reference/2.0/index.html">2.0</a>
                <a class="version is-current" href="/documentation/reference/1.9/index.html">1.9</a>
                <a class="version" href="/documentation/reference/1.8/index.html">1.8</a>
                <a class="version" href="/documentation/reference/1.7/index.html">1.7</a>
                <a class="version" href="/documentation/reference/1.6/index.html">1.6</a>
                <a class="version" href="/documentation/reference/1.5/index.html">1.5</a>
                <a class="version" href="/documentation/reference/1.4/index.html">1.4</a>
                <a class="version" href="/documentation/reference/1.3/index.html">1.3</a>
                <a class="version" href="/documentation/reference/1.2/index.html">1.2</a>
                <a class="version" href="/documentation/reference/1.1/index.html">1.1</a>
                <a class="version" href="/documentation/reference/1.0/index.html">1.0</a>
                <a class="version" href="/documentation/reference/0.10/index.html">0.10</a>
                <a class="version" href="/documentation/reference/0.9/index.html">0.9</a>
        </div>
        |
    </div>
    </div>
  <div class="edit-this-page"><a href="https://github.com/debezium/debezium/edit/1.9/documentation/modules/ROOT/pages/tutorial.adoc">Edit this Page</a></div>
  </div>
<div class="article-grid">
<div class="article-cell1">
<article class="doc">
        
    <!-- This partial is a placeholder -->            <h1 class="page">Tutorial</h1>
        <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction-debezium">Introduction to Debezium</a></li>
<li><a href="#starting-services">Starting the services</a>
<ul class="sectlevel2">
<li><a href="#considerations-running-debezium-docker">Considerations for running Debezium with Docker</a></li>
<li><a href="#starting-zookeeper">Starting Zookeeper</a></li>
<li><a href="#starting-kafka">Starting Kafka</a></li>
<li><a href="#starting-mysql-database">Starting a MySQL database</a></li>
<li><a href="#starting-mysql-command-line-client">Starting a MySQL command line client</a></li>
<li><a href="#starting-kafka-connect">Starting Kafka Connect</a></li>
</ul>
</li>
<li><a href="#deploying-mysql-connector">Deploying the MySQL connector</a>
<ul class="sectlevel2">
<li><a href="#registering-connector-monitor-inventory-database">Registering a connector to monitor the <code>inventory</code> database</a></li>
<li><a href="#watching-connector-start-up">Watching the connector start</a></li>
</ul>
</li>
<li><a href="#viewing-change-events">Viewing change events</a>
<ul class="sectlevel2">
<li><a href="#viewing-create-event">Viewing a <em>create</em> event</a></li>
<li><a href="#updating-database-viewing-update-event">Updating the database and viewing the <em>update</em> event</a></li>
<li><a href="#deleting-record-database-viewing-delete-event">Deleting a record in the database and viewing the <em>delete</em> event</a></li>
<li><a href="#restarting-kafka-connect-service">Restarting the Kafka Connect service</a></li>
</ul>
</li>
<li><a href="#cleaning-up">Cleaning up</a></li>
<li><a href="#next-steps">Next steps</a></li>
</ul>
</div>
<div class="paragraph">
<p>This tutorial demonstrates how to use Debezium to monitor a MySQL database.
As the data in the database changes, you will see the resulting event streams.</p>
</div>
<div class="paragraph">
<p>In this tutorial you will start the Debezium services,
run a MySQL database server with a simple example database,
and use Debezium to monitor the database for changes.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Docker is installed and running.</p>
<div class="paragraph">
<p>This tutorial uses Docker and the Debezium container images to run the required services.
You should use the latest version of Docker.
For more information, see <a href="https://docs.docker.com/engine/installation/">the Docker Engine installation documentation</a>.</p>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This example can also be run using Podman. For more information see <a href="https://podman.io/">Podman</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction-debezium"><a class="anchor" href="#introduction-debezium"></a>Introduction to Debezium</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Debezium is a distributed platform that turns your existing databases into event streams,
so applications can see and respond immediately to each row-level change in the databases.</p>
</div>
<div class="paragraph">
<p>Debezium is built on top of <a href="http://kafka.apache.org">Apache Kafka</a> and provides <a href="https://kafka.apache.org/documentation.html#connect">Kafka Connect</a> compatible connectors that monitor specific database management systems.
Debezium records the history of data changes in Kafka logs, from where your application consumes them.
This makes it possible for your application to easily consume all of the events correctly and completely.
Even if your application stops unexpectedly,
it will not miss anything:
when the application restarts, it will resume consuming the events where it left off.</p>
</div>
<div class="paragraph">
<p>Debezium includes multiple connectors.
In this tutorial, you will use the <a href="connectors/mysql.html" class="page">MySQL connector</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="starting-services"><a class="anchor" href="#starting-services"></a>Starting the services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using Debezium requires three separate services:
<a href="http://zookeeper.apache.org">ZooKeeper</a>, Kafka, and the Debezium connector service.
In this tutorial,
you will set up a single instance of each service using <a href="http://docker.com">Docker</a> and <a href="https://quay.io/organization/debezium">the Debezium container images</a>.</p>
</div>
<div class="paragraph">
<p>To start the services needed for this tutorial, you must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#starting-zookeeper">Start Zookeeper</a></p>
</li>
<li>
<p><a href="#starting-kafka">Start Kafka</a></p>
</li>
<li>
<p><a href="#starting-mysql-database">Start a MySQL database</a></p>
</li>
<li>
<p><a href="#starting-mysql-command-line-client">Start a MySQL command line client</a></p>
</li>
<li>
<p><a href="#starting-kafka-connect">Start Kafka Connect</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="considerations-running-debezium-docker"><a class="anchor" href="#considerations-running-debezium-docker"></a>Considerations for running Debezium with Docker</h3>
<div class="paragraph">
<p>This tutorial uses <a href="http://docker.com">Docker</a> and the <a href="https://hub.docker.com/u/debezium/">Debezium container images</a> to run the ZooKeeper, Kafka, Debezium, and MySQL services.
Running each service in a separate container simplifies the setup so that you can see Debezium in action.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In a production environment,
you would run multiple instances of each service to provide performance, reliability, replication, and fault tolerance.
Typically, you would either deploy these services on a platform like <a href="https://www.openshift.com">OpenShift</a> or <a href="http://kubernetes.io">Kubernetes</a> that manages multiple Docker containers running on multiple hosts and machines,
or you would install on dedicated hardware.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You should be aware of the following considerations for running Debezium with Docker:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The containers for ZooKeeper and Kafka are ephemeral.</p>
<div class="paragraph">
<p>ZooKeeper and Kafka would typically store their data locally inside the containers,
which would require you to mount directories on the host machine as volumes.
That way, when the containers are stopped,
the persisted data remains.
However, this tutorial skips this setup -
when a container is stopped, all persisted data is lost.
This way, cleanup is simple when you complete the tutorial.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more information about storing persistent data,
see the documentation for the <a href="https://quay.io/organization/debezium">container images</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>This tutorial requires you to run each service in a different container.</p>
<div class="paragraph">
<p>To avoid confusion, you will run each container in the foreground in a separate terminal.
This way, all of the output of a container will be displayed in the terminal used to run it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Docker also allows you to run a container in <em>detached</em> mode (with the <code>-d</code> option),
where the container is started and the <code>docker</code> command returns immediately.
However, detached mode containers do not display their output in the terminal.
To see the output,
you would need to use the <code>docker logs --follow --name <em>&lt;container-name&gt;</em></code> command.
For more information, see the Docker documentation.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="starting-zookeeper"><a class="anchor" href="#starting-zookeeper"></a>Starting Zookeeper</h3>
<div class="paragraph">
<p>ZooKeeper is the first service you must start.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open a terminal and use it to start ZooKeeper in a container.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>This command runs a new container using version 1.9 of the <code>quay.io/debezium/zookeeper</code> image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">$ docker run -it --rm --name zookeeper -p 2181:2181 -p 2888:2888 -p 3888:3888 quay.io/debezium/zookeeper:1.9</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-it</code></dt>
<dd>
<p>The container is interactive,
which means the terminal&#8217;s standard input and output are attached to the container.</p>
</dd>
<dt class="hdlist1"><code>--rm</code></dt>
<dd>
<p>The container will be removed when it is stopped.</p>
</dd>
<dt class="hdlist1"><code>--name zookeeper</code></dt>
<dd>
<p>The name of the container.</p>
</dd>
<dt class="hdlist1"><code>-p 2181:2181 -p 2888:2888 -p 3888:3888</code></dt>
<dd>
<p>Maps three of the container&#8217;s ports to the same ports on the Docker host.
This enables other containers (and applications outside of the container) to communicate with ZooKeeper.</p>
</dd>
</dl>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use Podman, run the following command:s</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">$ sudo podman pod create --name=dbz --publish "9092,3306,8083"
$ sudo podman run -it --rm --name zookeeper --pod dbz quay.io/debezium/zookeeper:1.9</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify that ZooKeeper started and is listening on port <code>2181</code>.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>You should see output similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">Starting up in standalone mode
ZooKeeper JMX enabled by default
Using config: /zookeeper/conf/zoo.cfg
2017-09-21 07:15:55,417 - INFO  [main:QuorumPeerConfig@134] - Reading configuration from: /zookeeper/conf/zoo.cfg
2017-09-21 07:15:55,419 - INFO  [main:DatadirCleanupManager@78] - autopurge.snapRetainCount set to 3
2017-09-21 07:15:55,419 - INFO  [main:DatadirCleanupManager@79] - autopurge.purgeInterval set to 1
...
port 0.0.0.0/0.0.0.0:2181  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This line indicates that ZooKeeper is ready and listening on port 2181. The terminal will continue to show additional output as ZooKeeper generates it.</td>
</tr>
</table>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="starting-kafka"><a class="anchor" href="#starting-kafka"></a>Starting Kafka</h3>
<div class="paragraph">
<p>After starting ZooKeeper, you can start Kafka in a new container.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Debezium 1.9.2.Final has been tested against multiple versions of Kafka Connect.
Please refer to the <a href="https://debezium.io/releases">Debezium Test Matrix</a> to determine compatibility between Debezium and Kafka Connect.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open a new terminal and use it to start Kafka in a container.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>This command runs a new container using version 1.9 of the <code>quay.io/debezium/kafka</code> image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">$ docker run -it --rm --name kafka -p 9092:9092 --link zookeeper:zookeeper quay.io/debezium/kafka:1.9</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-it</code></dt>
<dd>
<p>The container is interactive,
which means the terminal&#8217;s standard input and output are attached to the container.</p>
</dd>
<dt class="hdlist1"><code>--rm</code></dt>
<dd>
<p>The container will be removed when it is stopped.</p>
</dd>
<dt class="hdlist1"><code>--name kafka</code></dt>
<dd>
<p>The name of the container.</p>
</dd>
<dt class="hdlist1"><code>-p 9092:9092</code></dt>
<dd>
<p>Maps port <code>9092</code> in the container to the same port on the Docker host so that applications outside of the container can communicate with Kafka.</p>
</dd>
<dt class="hdlist1"><code>--link zookeeper:zookeeper</code></dt>
<dd>
<p>Tells the container that it can find ZooKeeper in the <code>zookeeper</code> container,
which is running on the same Docker host.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use Podman, run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">$ sudo podman run -it --rm --name kafka --pod dbz quay.io/debezium/kafka:1.9</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In this tutorial, you will always connect to Kafka from within a Docker container.
Any of these containers can communicate with the <code>kafka</code> container by linking to it.
If you needed to connect to Kafka from <em>outside</em> of a Docker container,
you would have to set the <code>-e</code> option to advertise the Kafka address through the Docker host
(<code>-e ADVERTISED_HOST_NAME=</code> followed by either the IP address or resolvable host name of the Docker host).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Verify that Kafka started.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>You should see output similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">...
2017-09-21 07:16:59,085 - INFO  [main-EventThread:ZkClient@713] - zookeeper state changed (SyncConnected)
2017-09-21 07:16:59,218 - INFO  [main:Logging$class@70] - Cluster ID = LPtcBFxzRvOzDSXhc6AamA
...
2017-09-21 07:16:59,649 - INFO  [main:Logging$class@70] - [Kafka Server 1], started  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The Kafka broker has successfully started and is ready for client connections. The terminal will continue to show additional output as Kafka generates it.</td>
</tr>
</table>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="starting-mysql-database"><a class="anchor" href="#starting-mysql-database"></a>Starting a MySQL database</h3>
<div class="paragraph">
<p>At this point, you have started ZooKeeper and Kafka,
but you still need a database server from which Debezium can capture changes.
In this procedure, you will start a MySQL server with an example database.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open a new terminal, and use it to start a new container that runs a MySQL database server preconfigured with an <code>inventory</code> database.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>This command runs a new container using version 1.9 of the <code>quay.io/debezium/example-mysql</code> image, which is <a href="https://github.com/debezium/docker-images/blob/main/examples/mysql/1.9/Dockerfile">based on</a> the <a href="https://hub.docker.com/r/_/mysql/">mysql:8.0</a> image.
It also defines and populates a sample <code>inventory</code> database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">$ docker run -it --rm --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=debezium -e MYSQL_USER=mysqluser -e MYSQL_PASSWORD=mysqlpw quay.io/debezium/example-mysql:1.9</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-it</code></dt>
<dd>
<p>The container is interactive,
which means the terminal&#8217;s standard input and output are attached to the container.</p>
</dd>
<dt class="hdlist1"><code>--rm</code></dt>
<dd>
<p>The container will be removed when it is stopped.</p>
</dd>
<dt class="hdlist1"><code>--name mysql</code></dt>
<dd>
<p>The name of the container.</p>
</dd>
<dt class="hdlist1"><code>-p 3306:3306</code></dt>
<dd>
<p>Maps port <code>3306</code> (the default MySQL port) in the container to the same port on the Docker host so that applications outside of the container can connect to the database server.</p>
</dd>
<dt class="hdlist1"><code>-e MYSQL_ROOT_PASSWORD=debezium -e MYSQL_USER=mysqluser -e MYSQL_PASSWORD=mysqlpw</code></dt>
<dd>
<p>Creates a user and password that has the minimum privileges required by the Debezium MySQL connector.</p>
</dd>
</dl>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use Podman, run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">$ sudo podman run -it --rm --name mysql --pod dbz -e MYSQL_ROOT_PASSWORD=debezium -e MYSQL_USER=mysqluser -e MYSQL_PASSWORD=mysqlpw quay.io/debezium/example-mysql:1.9</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify that the MySQL server starts.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The MySQL server starts and stops a few times as the configuration is modified.
You should see output similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">...
[System] [MY-010931] [Server] /usr/sbin/mysqld: ready for connections. Version: '8.0.27'  socket: '/var/run/mysqld/mysqld.sock'  port: 3306  MySQL Community Server - GPL.
[System] [MY-011323] [Server] X Plugin ready for connections. Bind-address: '::' port: 33060, socket: /var/run/mysqld/mysqlx.sock</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="starting-mysql-command-line-client"><a class="anchor" href="#starting-mysql-command-line-client"></a>Starting a MySQL command line client</h3>
<div class="paragraph">
<p>After starting MySQL, you start a MySQL command line client so that you access the sample <code>inventory</code> database.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open a new terminal, and use it to start the MySQL command line client in a container.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>This command runs a new container using the <a href="https://hub.docker.com/r/_/mysql/">mysql:8.0</a> image,
and defines a shell command to run the MySQL command line client with the correct options:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">$ docker run -it --rm --name mysqlterm --link mysql --rm mysql:8.0 sh -c 'exec mysql -h"$MYSQL_PORT_3306_TCP_ADDR" -P"$MYSQL_PORT_3306_TCP_PORT" -uroot -p"$MYSQL_ENV_MYSQL_ROOT_PASSWORD"'</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-it</code></dt>
<dd>
<p>The container is interactive,
which means the terminal&#8217;s standard input and output are attached to the container.</p>
</dd>
<dt class="hdlist1"><code>--rm</code></dt>
<dd>
<p>The container will be removed when it is stopped.</p>
</dd>
<dt class="hdlist1"><code>--name mysqlterm</code></dt>
<dd>
<p>The name of the container.</p>
</dd>
<dt class="hdlist1"><code>--link mysql</code></dt>
<dd>
<p>Links the container to the <code>mysql</code> container.</p>
</dd>
</dl>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use Podman, run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">$ sudo podman run -it --rm --name mysqlterm --pod dbz --rm mysql:5.7 sh -c 'exec mysql -h 0.0.0.0 -uroot -pdebezium'</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify that the MySQL command line client started.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>You should see output similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-mysql hljs" data-lang="mysql">mysql: [Warning] Using a password on the command line interface can be insecure.
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 9
Server version: 8.0.27 MySQL Community Server - GPL

Copyright (c) 2000, 2021, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt;</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>At the <code>mysql&gt;</code> command prompt, switch to the inventory database:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-sql hljs" data-lang="sql">mysql&gt; use inventory;</code></pre>
</div>
</div>
</li>
<li>
<p>List the tables in the database:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-sql hljs" data-lang="sql">mysql&gt; show tables;
+---------------------+
| Tables_in_inventory |
+---------------------+
| addresses           |
| customers           |
| geom                |
| orders              |
| products            |
| products_on_hand    |
+---------------------+
6 rows in set (0.00 sec)</code></pre>
</div>
</div>
</li>
<li>
<p>Use the MySQL command line client to explore the database and view the pre-loaded data in the database.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-sql hljs" data-lang="sql">mysql&gt; SELECT * FROM customers;
+------+------------+-----------+-----------------------+
| id   | first_name | last_name | email                 |
+------+------------+-----------+-----------------------+
| 1001 | Sally      | Thomas    | sally.thomas@acme.com |
| 1002 | George     | Bailey    | gbailey@foobar.com    |
| 1003 | Edward     | Walker    | ed@walker.com         |
| 1004 | Anne       | Kretchmar | annek@noanswer.org    |
+------+------------+-----------+-----------------------+
4 rows in set (0.00 sec)</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="starting-kafka-connect"><a class="anchor" href="#starting-kafka-connect"></a>Starting Kafka Connect</h3>
<div class="paragraph">
<p>After starting MySQL and connecting to the <code>inventory</code> database with the MySQL command line client,
you start the Kafka Connect service.
This service exposes a REST API to manage the Debezium MySQL connector.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open a new terminal, and use it to start the Kafka Connect service in a container.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>This command runs a new container using the 1.9 version of the <code>quay.io/debezium/connect</code> image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">$ docker run -it --rm --name connect -p 8083:8083 -e GROUP_ID=1 -e CONFIG_STORAGE_TOPIC=my_connect_configs -e OFFSET_STORAGE_TOPIC=my_connect_offsets -e STATUS_STORAGE_TOPIC=my_connect_statuses --link zookeeper:zookeeper --link kafka:kafka --link mysql:mysql quay.io/debezium/connect:1.9</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-it</code></dt>
<dd>
<p>The container is interactive,
which means the terminal&#8217;s standard input and output are attached to the container.</p>
</dd>
<dt class="hdlist1"><code>--rm</code></dt>
<dd>
<p>The container will be removed when it is stopped.</p>
</dd>
<dt class="hdlist1"><code>--name connect</code></dt>
<dd>
<p>The name of the container.</p>
</dd>
<dt class="hdlist1"><code>-p 8083:8083</code></dt>
<dd>
<p>Maps port <code>8083</code> in the container to the same port on the Docker host.
This enables applications outside of the container to use Kafka Connect&#8217;s REST API to set up and manage new container instances.</p>
</dd>
<dt class="hdlist1"><code>-e CONFIG_STORAGE_TOPIC=my_connect_configs -e OFFSET_STORAGE_TOPIC=my_connect_offsets -e STATUS_STORAGE_TOPIC=my_connect_statuses</code></dt>
<dd>
<p>Sets environment variables required by the Debezium image.</p>
</dd>
<dt class="hdlist1"><code>--link zookeeper:zookeeper --link kafka:kafka --link mysql:mysql</code></dt>
<dd>
<p>Links the container to the containers that are running ZooKeeper, Kafka, and the MySQL server.</p>
</dd>
</dl>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use Podman, run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">$ sudo podman run -it --rm --name connect --pod dbz -e GROUP_ID=1 -e CONFIG_STORAGE_TOPIC=my_connect_configs -e OFFSET_STORAGE_TOPIC=my_connect_offsets -e STATUS_STORAGE_TOPIC=my_connect_statuses quay.io/debezium/connect:1.9</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you provide a <code>--hostname</code> command option then Kafka Connect REST API will <strong>not</strong> listen on the <code>localhost</code> interface.
This can cause issues when the REST port is being exposed.</p>
</div>
<div class="paragraph">
<p>If this is a problem then set environment variable <code>REST_HOST_NAME=0.0.0.0</code> which will ensure that REST API will be accessible from all interfaces.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify that Kafka Connect started and is ready to accept connections.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>You should see output similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">...
2020-02-06 15:48:33,939 INFO   ||  Kafka version: 3.0.0   [org.apache.kafka.common.utils.AppInfoParser]
...
2020-02-06 15:48:34,485 INFO   ||  [Worker clientId=connect-1, groupId=1] Starting connectors and tasks using config offset -1   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]
2020-02-06 15:48:34,485 INFO   ||  [Worker clientId=connect-1, groupId=1] Finished starting connectors and tasks   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Use the Kafka Connect REST API to check the status of the Kafka Connect service.</p>
<div class="paragraph">
<p>Kafka Connect exposes a REST API to manage Debezium connectors.
To communicate with the Kafka Connect service,
you can use the <code>curl</code> command to send API requests to port 8083 of the Docker host (which you mapped to port 8083 in the <code>connect</code> container when you started Kafka Connect).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>These commands use <code>localhost</code>.
If you are using a non-native Docker platform (such as Docker Toolbox),
replace <code>localhost</code> with the IP address of your Docker host.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Open a new terminal and check the status of the Kafka Connect service:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">$ curl -H "Accept:application/json" localhost:8083/
{"version":"3.1.0","commit":"cb8625948210849f"}  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The response shows that Kafka Connect version 3.1.0 is running.</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Check the list of connectors registered with Kafka Connect:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">$ curl -H "Accept:application/json" localhost:8083/connectors/
[]  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>No connectors are currently registered with Kafka Connect.</td>
</tr>
</table>
</div>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploying-mysql-connector"><a class="anchor" href="#deploying-mysql-connector"></a>Deploying the MySQL connector</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After starting the Debezium and MySQL services,
you are ready to deploy the Debezium MySQL connector so that it can start monitoring the sample MySQL database (<code>inventory</code>).</p>
</div>
<div class="paragraph">
<p>At this point, you are running the Debezium services,
a MySQL database server with a sample <code>inventory</code> database,
and the MySQL command line client that is connected to the database.
To deploy the MySQL connector,
you must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#registering-connector-monitor-inventory-database">Register the MySQL connector to monitor the <code>inventory</code> database</a></p>
<div class="paragraph">
<p>After the connector is registered,
it will start monitoring the database server&#8217;s <code>binlog</code> and it will generate change events for each row that changes.</p>
</div>
</li>
<li>
<p><a href="#watching-connector-start-up">Watch the MySQL connector start</a></p>
<div class="paragraph">
<p>Reviewing the Kafka Connect log output as the connector starts helps you to better understand each task it must complete before it can start monitoring the <code>binlog</code>.</p>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="registering-connector-monitor-inventory-database"><a class="anchor" href="#registering-connector-monitor-inventory-database"></a>Registering a connector to monitor the <code>inventory</code> database</h3>
<div class="paragraph">
<p>By registering the Debezium MySQL connector,
the connector will start monitoring the MySQL database server&#8217;s <code>binlog</code>.
The <code>binlog</code> records all of the database&#8217;s transactions (such as changes to individual rows and changes to the schemas).
When a row in the database changes,
Debezium generates a change event.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In a production environment, you would typically either use the Kafka tools to manually create the necessary topics,
including specifying the number of replicas,
or you&#8217;d use the Kafka Connect mechanism for customizing the settings of <a href="configuration/topic-auto-create-config.html" class="page">auto-created</a> topics.
However, for this tutorial, Kafka is configured to automatically create the topics with just one replica.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Review the configuration of the Debezium MySQL connector that you will register.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Before registering the connector,
you should be familiar with its configuration.
In the next step,
you will register the following connector:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "name": "inventory-connector",  <i class="conum" data-value="1"></i><b>(1)</b>
  "config": {  <i class="conum" data-value="2"></i><b>(2)</b>
    "connector.class": "io.debezium.connector.mysql.MySqlConnector",
    "tasks.max": "1",  <i class="conum" data-value="3"></i><b>(3)</b>
    "database.hostname": "mysql",  <i class="conum" data-value="4"></i><b>(4)</b>
    "database.port": "3306",
    "database.user": "debezium",
    "database.password": "dbz",
    "database.server.id": "184054",  <i class="conum" data-value="5"></i><b>(5)</b>
    "database.server.name": "dbserver1",  <i class="conum" data-value="5"></i><b>(5)</b>
    "database.include.list": "inventory",  <i class="conum" data-value="6"></i><b>(6)</b>
    "database.history.kafka.bootstrap.servers": "kafka:9092",  <i class="conum" data-value="7"></i><b>(7)</b>
    "database.history.kafka.topic": "schema-changes.inventory"  <i class="conum" data-value="7"></i><b>(7)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The name of the connector.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The connector&#8217;s configuration.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Only one task should operate at any one time.
Because the MySQL connector reads the MySQL server&#8217;s <code>binlog</code>,
using a single connector task ensures proper order and event handling.
The Kafka Connect service uses connectors to start one or more tasks that do the work,
and it automatically distributes the running tasks across the cluster of Kafka Connect services.
If any of the services stop or crash, those tasks will be redistributed to running services.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The database host,
which is the name of the Docker container running the MySQL server (<code>mysql</code>).
Docker manipulates the network stack within the containers so that each linked container can be resolved with <code>/etc/hosts</code> using the container name for the host name.
If MySQL were running on a normal network, you would specify the IP address or resolvable host name for this value.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>A unique server ID and name. The server name is the logical identifier for the MySQL server or cluster of servers.
This name will be used as the prefix for all Kafka topics.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Only changes in the <code>inventory</code> database will be detected.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The connector will store the history of the database schemas in Kafka using this broker (the same broker to which you are sending events) and topic name.
Upon restart, the connector will recover the schemas of the database that existed at the point in time in the <code>binlog</code> when the connector should begin reading.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information, see <a href="connectors/mysql.html#mysql-connector-properties" class="page">MySQL connector configuration properties</a>.</p>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For security reasons, you shouldn&#8217;t put passwords or other secrets in plain text into connector configurations.
Instead, any secrets should be externalized via the mechanism defined in <a href="https://cwiki.apache.org/confluence/display/KAFKA/KIP-297%3A+Externalizing+Secrets+for+Connect+Configurations">KIP-297</a>("Externalizing Secrets for Connect Configurations").</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a new terminal, and use the <code>curl</code> command to register the Debezium MySQL connector.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>This command uses the Kafka Connect service&#8217;s API to submit a <code>POST</code> request against the <code>/connectors</code> resource with a JSON document that describes the new connector (called <code>inventory-connector</code>).</p>
</div>
<div class="paragraph">
<p>This command uses <code>localhost</code> to connect to the Docker host.
If you are using a non-native Docker platform,
replace <code>localhost</code> with the IP address of of your Docker host.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">$ curl -i -X POST -H "Accept:application/json" -H "Content-Type:application/json" localhost:8083/connectors/ -d '{ "name": "inventory-connector", "config": { "connector.class": "io.debezium.connector.mysql.MySqlConnector", "tasks.max": "1", "database.hostname": "mysql", "database.port": "3306", "database.user": "debezium", "database.password": "dbz", "database.server.id": "184054", "database.server.name": "dbserver1", "database.include.list": "inventory", "database.history.kafka.bootstrap.servers": "kafka:9092", "database.history.kafka.topic": "dbhistory.inventory" } }'</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Windows users may need to escape the double-quotes.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">$ curl -i -X POST -H "Accept:application/json" -H "Content-Type:application/json" localhost:8083/connectors/ -d '{ \"name\": \"inventory-connector\", \"config\": { \"connector.class\": \"io.debezium.connector.mysql.MySqlConnector\", \"tasks.max\": \"1\", \"database.hostname\": \"mysql\", \"database.port\": \"3306\", \"database.user\": \"debezium\", \"database.password\": \"dbz\", \"database.server.id\": \"184054\", \"database.server.name\": \"dbserver1\", \"database.include.list\": \"inventory\", \"database.history.kafka.bootstrap.servers\": \"kafka:9092\", \"database.history.kafka.topic\": \"dbhistory.inventory\" } }'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Otherwise, you might see an error like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{"error_code":500,"message":"Unexpected character ('n' (code 110)): was expecting double-quote to start field name\n at [Source: (org.glassfish.jersey.message.internal.ReaderInterceptorExecutor$UnCloseableInputStream); line: 1, column: 4]"}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use Podman, run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">$ curl -i -X POST -H "Accept:application/json" -H "Content-Type:application/json" localhost:8083/connectors/ -d '{ "name": "inventory-connector", "config": { "connector.class": "io.debezium.connector.mysql.MySqlConnector", "tasks.max": "1", "database.hostname": "0.0.0.0", "database.port": "3306", "database.user": "debezium", "database.password": "dbz", "database.server.id": "184054", "database.server.name": "dbserver1", "database.include.list": "inventory", "database.history.kafka.bootstrap.servers": "0.0.0.0:9092", "database.history.kafka.topic": "dbhistory.inventory" } }'</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify that <code>inventory-connector</code> is included in the list of connectors:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">$ curl -H "Accept:application/json" localhost:8083/connectors/
["inventory-connector"]</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Review the connector&#8217;s tasks:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">$ curl -i -X GET -H "Accept:application/json" localhost:8083/connectors/inventory-connector</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see a response similar to the following (formatted for readability):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">HTTP/1.1 200 OK
Date: Thu, 06 Feb 2020 22:12:03 GMT
Content-Type: application/json
Content-Length: 531
Server: Jetty(9.4.20.v20190813)

{
  "name": "inventory-connector",
  ...
  "tasks": [
    {
      "connector": "inventory-connector",  <i class="conum" data-value="1"></i><b>(1)</b>
      "task": 0
    }
  ]
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The connector is running a single task (task <code>0</code>) to do its work.
The connector only supports a single task,
because MySQL records all of its activities in one sequential <code>binlog</code>.
This means the connector only needs one reader to get a consistent, ordered view of all of the events.</td>
</tr>
</table>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="watching-connector-start-up"><a class="anchor" href="#watching-connector-start-up"></a>Watching the connector start</h3>
<div class="paragraph">
<p>When you register a connector,
it generates a large amount of log output in the Kafka Connect container.
By reviewing this output,
you can better understand the process that the connector goes through from the time it is created until it begins reading the MySQL server&#8217;s <code>binlog</code>.</p>
</div>
<div class="paragraph">
<p>After registering the <code>inventory-connector</code> connector,
you can review the log output in the Kafka Connect container (<code>connect</code>) to track the connector&#8217;s status.</p>
</div>
<div class="paragraph">
<p>The first few lines show the connector (<code>inventory-connector</code>) being created and started:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">...
2021-11-30 01:38:44,223 INFO   ||  [Worker clientId=connect-1, groupId=1] Tasks [inventory-connector-0] configs updated   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]
2021-11-30 01:38:44,224 INFO   ||  [Worker clientId=connect-1, groupId=1] Handling task config update by restarting tasks []   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]
2021-11-30 01:38:44,224 INFO   ||  [Worker clientId=connect-1, groupId=1] Rebalance started   [org.apache.kafka.connect.runtime.distributed.WorkerCoordinator]
2021-11-30 01:38:44,224 INFO   ||  [Worker clientId=connect-1, groupId=1] (Re-)joining group   [org.apache.kafka.connect.runtime.distributed.WorkerCoordinator]
2021-11-30 01:38:44,227 INFO   ||  [Worker clientId=connect-1, groupId=1] Successfully joined group with generation Generation{generationId=3, memberId='connect-1-7b087c69-8ac5-4c56-9e6b-ec5adabf27e8', protocol='sessioned'}   [org.apache.kafka.connect.runtime.distributed.WorkerCoordinator]
2021-11-30 01:38:44,230 INFO   ||  [Worker clientId=connect-1, groupId=1] Successfully synced group in generation Generation{generationId=3, memberId='connect-1-7b087c69-8ac5-4c56-9e6b-ec5adabf27e8', protocol='sessioned'}   [org.apache.kafka.connect.runtime.distributed.WorkerCoordinator]
2021-11-30 01:38:44,231 INFO   ||  [Worker clientId=connect-1, groupId=1] Joined group at generation 3 with protocol version 2 and got assignment: Assignment{error=0, leader='connect-1-7b087c69-8ac5-4c56-9e6b-ec5adabf27e8', leaderUrl='http://172.17.0.7:8083/', offset=4, connectorIds=[inventory-connector], taskIds=[inventory-connector-0], revokedConnectorIds=[], revokedTaskIds=[], delay=0} with rebalance delay: 0   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]
2021-11-30 01:38:44,232 INFO   ||  [Worker clientId=connect-1, groupId=1] Starting connectors and tasks using config offset 4   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]
2021-11-30 01:38:44,232 INFO   ||  [Worker clientId=connect-1, groupId=1] Starting task inventory-connector-0   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Further down, you should see output like the following from the connector:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">...
2021-11-30 01:38:44,406 INFO   ||  Kafka version: 3.0.0   [org.apache.kafka.common.utils.AppInfoParser]
2021-11-30 01:38:44,406 INFO   ||  Kafka commitId: 8cb0a5e9d3441962   [org.apache.kafka.common.utils.AppInfoParser]
2021-11-30 01:38:44,407 INFO   ||  Kafka startTimeMs: 1638236324406   [org.apache.kafka.common.utils.AppInfoParser]
2021-11-30 01:38:44,437 INFO   ||  Database history topic '(name=dbhistory.inventory, numPartitions=1, replicationFactor=1, replicasAssignments=null, configs={cleanup.policy=delete, retention.ms=9223372036854775807, retention.bytes=-1})' created   [io.debezium.relational.history.KafkaDatabaseHistory]
2021-11-30 01:38:44,497 INFO   ||  App info kafka.admin.client for dbserver1-dbhistory unregistered   [org.apache.kafka.common.utils.AppInfoParser]
2021-11-30 01:38:44,499 INFO   ||  Metrics scheduler closed   [org.apache.kafka.common.metrics.Metrics]
2021-11-30 01:38:44,499 INFO   ||  Closing reporter org.apache.kafka.common.metrics.JmxReporter   [org.apache.kafka.common.metrics.Metrics]
2021-11-30 01:38:44,499 INFO   ||  Metrics reporters closed   [org.apache.kafka.common.metrics.Metrics]
2021-11-30 01:38:44,499 INFO   ||  Reconnecting after finishing schema recovery   [io.debezium.connector.mysql.MySqlConnectorTask]
2021-11-30 01:38:44,524 INFO   ||  Requested thread factory for connector MySqlConnector, id = dbserver1 named = change-event-source-coordinator   [io.debezium.util.Threads]
2021-11-30 01:38:44,525 INFO   ||  Creating thread debezium-mysqlconnector-dbserver1-change-event-source-coordinator   [io.debezium.util.Threads]
2021-11-30 01:38:44,526 INFO   ||  WorkerSourceTask{id=inventory-connector-0} Source task finished initialization and start   [org.apache.kafka.connect.runtime.WorkerSourceTask]
2021-11-30 01:38:44,529 INFO   MySQL|dbserver1|snapshot  Metrics registered   [io.debezium.pipeline.ChangeEventSourceCoordinator]
2021-11-30 01:38:44,529 INFO   MySQL|dbserver1|snapshot  Context created   [io.debezium.pipeline.ChangeEventSourceCoordinator]
2021-11-30 01:38:44,534 INFO   MySQL|dbserver1|snapshot  No previous offset has been found   [io.debezium.connector.mysql.MySqlSnapshotChangeEventSource]
2021-11-30 01:38:44,534 INFO   MySQL|dbserver1|snapshot  According to the connector configuration both schema and data will be snapshotted   [io.debezium.connector.mysql.MySqlSnapshotChangeEventSource]
2021-11-30 01:38:44,534 INFO   MySQL|dbserver1|snapshot  Snapshot step 1 - Preparing   [io.debezium.relational.RelationalSnapshotChangeEventSource]
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Debezium log output uses <em>mapped diagnostic contexts</em> (MDC) to provide thread-specific information in the log output,
and make it easier to understand what is happening in the multi-threaded Kafka Connect service.
This includes the connector type (<code>MySQL</code> in the above log messages),
the logical name of the connector (<code>dbserver1</code> above),
and the connector&#8217;s activity (<code>task</code>, <code>snapshot</code> and <code>binlog</code>).</p>
</div>
<div class="paragraph">
<p>In the log output above,
the first few lines involve the <code>task</code> activity of the connector,
and report some bookkeeping information (in this case, that the connector was started with no prior offset).
The next three lines involve the <code>snapshot</code> activity of the connector,
and report that a snapshot is being started using the <code>debezium</code> MySQL user along with the MySQL grants associated with that user.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the connector is not able to connect,
or if it does not see any tables or the <code>binlog</code>,
check these grants to ensure that all of those listed above are included.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, the connector reports the steps that make up the snapshot operation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">...
2021-11-30 01:38:44,534 INFO   MySQL|dbserver1|snapshot  Snapshot step 1 - Preparing   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:44,535 INFO   MySQL|dbserver1|snapshot  Snapshot step 2 - Determining captured tables   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:44,535 INFO   MySQL|dbserver1|snapshot  Read list of available databases   [io.debezium.connector.mysql.MySqlSnapshotChangeEventSource]
2021-11-30 01:38:44,537 INFO   MySQL|dbserver1|snapshot  	 list of available databases is: [information_schema, inventory, mysql, performance_schema, sys]   [io.debezium.connector.mysql.MySqlSnapshotChangeEventSource]
2021-11-30 01:38:44,537 INFO   MySQL|dbserver1|snapshot  Read list of available tables in each database   [io.debezium.connector.mysql.MySqlSnapshotChangeEventSource]
2021-11-30 01:38:44,548 INFO   MySQL|dbserver1|snapshot  	snapshot continuing with database(s): [inventory]   [io.debezium.connector.mysql.MySqlSnapshotChangeEventSource]
2021-11-30 01:38:44,551 INFO   MySQL|dbserver1|snapshot  Snapshot step 3 - Locking captured tables [inventory.addresses, inventory.customers, inventory.geom, inventory.orders, inventory.products, inventory.products_on_hand]   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:44,552 INFO   MySQL|dbserver1|snapshot  Flush and obtain global read lock to prevent writes to database   [io.debezium.connector.mysql.MySqlSnapshotChangeEventSource]
2021-11-30 01:38:44,557 INFO   MySQL|dbserver1|snapshot  Snapshot step 4 - Determining snapshot offset   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:44,560 INFO   MySQL|dbserver1|snapshot  Read binlog position of MySQL primary server   [io.debezium.connector.mysql.MySqlSnapshotChangeEventSource]
2021-11-30 01:38:44,562 INFO   MySQL|dbserver1|snapshot  	 using binlog 'mysql-bin.000003' at position '156' and gtid ''   [io.debezium.connector.mysql.MySqlSnapshotChangeEventSource]
2021-11-30 01:38:44,562 INFO   MySQL|dbserver1|snapshot  Snapshot step 5 - Reading structure of captured tables   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:44,562 INFO   MySQL|dbserver1|snapshot  All eligible tables schema should be captured, capturing: [inventory.addresses, inventory.customers, inventory.geom, inventory.orders, inventory.products, inventory.products_on_hand]   [io.debezium.connector.mysql.MySqlSnapshotChangeEventSource]
2021-11-30 01:38:45,058 INFO   MySQL|dbserver1|snapshot  Reading structure of database 'inventory'   [io.debezium.connector.mysql.MySqlSnapshotChangeEventSource]
2021-11-30 01:38:45,187 INFO   MySQL|dbserver1|snapshot  Snapshot step 6 - Persisting schema history   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:45,273 INFO   MySQL|dbserver1|snapshot  Releasing global read lock to enable MySQL writes   [io.debezium.connector.mysql.MySqlSnapshotChangeEventSource]
2021-11-30 01:38:45,274 INFO   MySQL|dbserver1|snapshot  Writes to MySQL tables prevented for a total of 00:00:00.717   [io.debezium.connector.mysql.MySqlSnapshotChangeEventSource]
2021-11-30 01:38:45,274 INFO   MySQL|dbserver1|snapshot  Snapshot step 7 - Snapshotting data   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:45,275 INFO   MySQL|dbserver1|snapshot  Snapshotting contents of 6 tables while still in transaction   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:45,275 INFO   MySQL|dbserver1|snapshot  Exporting data from table 'inventory.addresses' (1 of 6 tables)   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:45,276 INFO   MySQL|dbserver1|snapshot  	 For table 'inventory.addresses' using select statement: 'SELECT `id`, `customer_id`, `street`, `city`, `state`, `zip`, `type` FROM `inventory`.`addresses`'   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:45,295 INFO   MySQL|dbserver1|snapshot  	 Finished exporting 7 records for table 'inventory.addresses'; total duration '00:00:00.02'   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:45,296 INFO   MySQL|dbserver1|snapshot  Exporting data from table 'inventory.customers' (2 of 6 tables)   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:45,296 INFO   MySQL|dbserver1|snapshot  	 For table 'inventory.customers' using select statement: 'SELECT `id`, `first_name`, `last_name`, `email` FROM `inventory`.`customers`'   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:45,304 INFO   MySQL|dbserver1|snapshot  	 Finished exporting 4 records for table 'inventory.customers'; total duration '00:00:00.008'   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:45,304 INFO   MySQL|dbserver1|snapshot  Exporting data from table 'inventory.geom' (3 of 6 tables)   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:45,305 INFO   MySQL|dbserver1|snapshot  	 For table 'inventory.geom' using select statement: 'SELECT `id`, `g`, `h` FROM `inventory`.`geom`'   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:45,316 INFO   MySQL|dbserver1|snapshot  	 Finished exporting 3 records for table 'inventory.geom'; total duration '00:00:00.011'   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:45,316 INFO   MySQL|dbserver1|snapshot  Exporting data from table 'inventory.orders' (4 of 6 tables)   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:45,316 INFO   MySQL|dbserver1|snapshot  	 For table 'inventory.orders' using select statement: 'SELECT `order_number`, `order_date`, `purchaser`, `quantity`, `product_id` FROM `inventory`.`orders`'   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:45,325 INFO   MySQL|dbserver1|snapshot  	 Finished exporting 4 records for table 'inventory.orders'; total duration '00:00:00.008'   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:45,325 INFO   MySQL|dbserver1|snapshot  Exporting data from table 'inventory.products' (5 of 6 tables)   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:45,325 INFO   MySQL|dbserver1|snapshot  	 For table 'inventory.products' using select statement: 'SELECT `id`, `name`, `description`, `weight` FROM `inventory`.`products`'   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:45,343 INFO   MySQL|dbserver1|snapshot  	 Finished exporting 9 records for table 'inventory.products'; total duration '00:00:00.017'   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:45,344 INFO   MySQL|dbserver1|snapshot  Exporting data from table 'inventory.products_on_hand' (6 of 6 tables)   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:45,344 INFO   MySQL|dbserver1|snapshot  	 For table 'inventory.products_on_hand' using select statement: 'SELECT `product_id`, `quantity` FROM `inventory`.`products_on_hand`'   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:45,353 INFO   MySQL|dbserver1|snapshot  	 Finished exporting 9 records for table 'inventory.products_on_hand'; total duration '00:00:00.009'   [io.debezium.relational.RelationalSnapshotChangeEventSource]
2021-11-30 01:38:45,355 INFO   MySQL|dbserver1|snapshot  Snapshot - Final stage   [io.debezium.pipeline.source.AbstractSnapshotChangeEventSource]
2021-11-30 01:38:45,356 INFO   MySQL|dbserver1|snapshot  Snapshot ended with SnapshotResult [status=COMPLETED, offset=MySqlOffsetContext [sourceInfoSchema=Schema{io.debezium.connector.mysql.Source:STRUCT}, sourceInfo=SourceInfo [currentGtid=null, currentBinlogFilename=mysql-bin.000003, currentBinlogPosition=156, currentRowNumber=0, serverId=0, sourceTime=2021-11-30T01:38:45.352Z, threadId=-1, currentQuery=null, tableIds=[inventory.products_on_hand], databaseName=inventory], snapshotCompleted=true, transactionContext=TransactionContext [currentTransactionId=null, perTableEventCount={}, totalEventCount=0], restartGtidSet=null, currentGtidSet=null, restartBinlogFilename=mysql-bin.000003, restartBinlogPosition=156, restartRowsToSkip=0, restartEventsToSkip=0, currentEventLengthInBytes=0, inTransaction=false, transactionId=null, incrementalSnapshotContext =IncrementalSnapshotContext [windowOpened=false, chunkEndPosition=null, dataCollectionsToSnapshot=[], lastEventKeySent=null, maximumKey=null]]]   [io.debezium.pipeline.ChangeEventSourceCoordinator]
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each of these steps reports what the connector is doing to perform the consistent snapshot.
For example, Step 6 involves reverse engineering the DDL <code>create</code> statements for the tables that are being captured
and the global write lock just 1 second after acquiring it,
and Step 7 reads all of the rows in each of the tables and reports the time taken and number of rows found.
In this case, the connector completed its consistent snapshot in just under 1 second.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The snapshot process will take longer with your databases,
but the connector outputs enough log messages that you can track what it is working on,
even when the tables have a large number of rows.
And although an exclusive write lock is used at the beginning of the snapshot process,
it should not last very long even for large databases.
This is because the lock is released before any data is copied.
For more information, see the <a href="connectors/mysql.html#debezium-connector-for-mysql" class="page">MySQL connector documentation</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, Kafka Connect reports some "errors".
However, you can safely ignore these warnings:
these messages just mean that <em>new</em> Kafka topics were created and that Kafka had to assign a new leader for each one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">...
2021-11-30 01:38:45,555 WARN   ||  [Producer clientId=connector-producer-inventory-connector-0] Error while fetching metadata with correlation id 3 : {dbserver1=LEADER_NOT_AVAILABLE}   [org.apache.kafka.clients.NetworkClient]
2021-11-30 01:38:45,691 WARN   ||  [Producer clientId=connector-producer-inventory-connector-0] Error while fetching metadata with correlation id 9 : {dbserver1.inventory.addresses=LEADER_NOT_AVAILABLE}   [org.apache.kafka.clients.NetworkClient]
2021-11-30 01:38:45,813 WARN   ||  [Producer clientId=connector-producer-inventory-connector-0] Error while fetching metadata with correlation id 13 : {dbserver1.inventory.customers=LEADER_NOT_AVAILABLE}   [org.apache.kafka.clients.NetworkClient]
2021-11-30 01:38:45,927 WARN   ||  [Producer clientId=connector-producer-inventory-connector-0] Error while fetching metadata with correlation id 18 : {dbserver1.inventory.geom=LEADER_NOT_AVAILABLE}   [org.apache.kafka.clients.NetworkClient]
2021-11-30 01:38:46,043 WARN   ||  [Producer clientId=connector-producer-inventory-connector-0] Error while fetching metadata with correlation id 22 : {dbserver1.inventory.orders=LEADER_NOT_AVAILABLE}   [org.apache.kafka.clients.NetworkClient]
2021-11-30 01:38:46,153 WARN   ||  [Producer clientId=connector-producer-inventory-connector-0] Error while fetching metadata with correlation id 26 : {dbserver1.inventory.products=LEADER_NOT_AVAILABLE}   [org.apache.kafka.clients.NetworkClient]
2021-11-30 01:38:46,269 WARN   ||  [Producer clientId=connector-producer-inventory-connector-0] Error while fetching metadata with correlation id 31 : {dbserver1.inventory.products_on_hand=LEADER_NOT_AVAILABLE}   [org.apache.kafka.clients.NetworkClient]
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, the log output shows that the connector has transitioned from its snapshot mode into continuously reading the MySQL server&#8217;s <code>binlog</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">...
2021-11-30 01:38:45,362 INFO   MySQL|dbserver1|streaming  Starting streaming   [io.debezium.pipeline.ChangeEventSourceCoordinator]
...
Nov 30, 2021 1:38:45 AM com.github.shyiko.mysql.binlog.BinaryLogClient connect
INFO: Connected to mysql:3306 at mysql-bin.000003/156 (sid:184054, cid:13)
2021-11-30 01:38:45,392 INFO   MySQL|dbserver1|binlog  Connected to MySQL binlog at mysql:3306, starting at MySqlOffsetContext [sourceInfoSchema=Schema{io.debezium.connector.mysql.Source:STRUCT}, sourceInfo=SourceInfo [currentGtid=null, currentBinlogFilename=mysql-bin.000003, currentBinlogPosition=156, currentRowNumber=0, serverId=0, sourceTime=2021-11-30T01:38:45.352Z, threadId=-1, currentQuery=null, tableIds=[inventory.products_on_hand], databaseName=inventory], snapshotCompleted=true, transactionContext=TransactionContext [currentTransactionId=null, perTableEventCount={}, totalEventCount=0], restartGtidSet=null, currentGtidSet=null, restartBinlogFilename=mysql-bin.000003, restartBinlogPosition=156, restartRowsToSkip=0, restartEventsToSkip=0, currentEventLengthInBytes=0, inTransaction=false, transactionId=null, incrementalSnapshotContext =IncrementalSnapshotContext [windowOpened=false, chunkEndPosition=null, dataCollectionsToSnapshot=[], lastEventKeySent=null, maximumKey=null]]   [io.debezium.connector.mysql.MySqlStreamingChangeEventSource]
2021-11-30 01:38:45,392 INFO   MySQL|dbserver1|streaming  Waiting for keepalive thread to start   [io.debezium.connector.mysql.MySqlStreamingChangeEventSource]
2021-11-30 01:38:45,393 INFO   MySQL|dbserver1|binlog  Creating thread debezium-mysqlconnector-dbserver1-binlog-client   [io.debezium.util.Threads]
...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="viewing-change-events"><a class="anchor" href="#viewing-change-events"></a>Viewing change events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After deploying the Debezium MySQL connector,
it starts monitoring the <code>inventory</code> database for data change events.</p>
</div>
<div class="paragraph">
<p>When you watched the connector start up,
you saw that events were written to the following topics with the <code>dbserver1</code> prefix (the name of the connector):</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>dbserver1</code></dt>
<dd>
<p>The <a href="connectors/mysql.html#mysql-schema-change-topic" class="page">schema change topic</a> to which all of the DDL statements are written.</p>
</dd>
<dt class="hdlist1"><code>dbserver1.inventory.products</code></dt>
<dd>
<p>Captures change events for the <code>products</code> table in the <code>inventory</code> database.</p>
</dd>
<dt class="hdlist1"><code>dbserver1.inventory.products_on_hand</code></dt>
<dd>
<p>Captures change events for the <code>products_on_hand</code> table in the <code>inventory</code> database.</p>
</dd>
<dt class="hdlist1"><code>dbserver1.inventory.customers</code></dt>
<dd>
<p>Captures change events for the <code>customers</code> table in the <code>inventory</code> database.</p>
</dd>
<dt class="hdlist1"><code>dbserver1.inventory.orders</code></dt>
<dd>
<p>Captures change events for the <code>orders</code> table in the <code>inventory</code> database.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For this tutorial, you will explore the <code>dbserver1.inventory.customers</code> topic.
In this topic, you will see different types of change events to see how the connector captured them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#viewing-create-event">Viewing a <em>create</em> event</a></p>
</li>
<li>
<p><a href="#updating-database-viewing-update-event">Updating the database and viewing the <em>update</em> event</a></p>
</li>
<li>
<p><a href="#deleting-record-database-viewing-delete-event">Deleting a record in the database and viewing the <em>delete</em> event</a></p>
</li>
<li>
<p><a href="#restarting-kafka-connect-service">Restarting Kafka Connect and changing the database</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="viewing-create-event"><a class="anchor" href="#viewing-create-event"></a>Viewing a <em>create</em> event</h3>
<div class="paragraph">
<p>By viewing the <code>dbserver1.inventory.customers</code> topic,
you can see how the MySQL connector captured <em>create</em> events in the <code>inventory</code> database.
In this case, the <em>create</em> events capture new customers being added to the database.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open a new terminal, and use it to start the <code>watch-topic</code> utility to watch the <code>dbserver1.inventory.customers</code> topic from the beginning of the topic.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>watch-topic</code> utility is very simple and limited in functionality.
It is not intended to be used by an application to consume events.
In that scenario, you would instead use Kafka consumers and the applicable consumer libraries that offer full functionality and flexibility.</p>
</div>
<div class="paragraph">
<p>This command runs the <code>watch-topic</code> utility in a new container using the 1.9 version of the <code>debezium/kafka</code> image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">$ docker run -it --rm --name watcher --link zookeeper:zookeeper --link kafka:kafka quay.io/debezium/kafka:1.9 watch-topic -a -k dbserver1.inventory.customers</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-a</code></dt>
<dd>
<p>Watches all events since the topic was created.
Without this option, <code>watch-topic</code> would only show the events recorded after you start watching.</p>
</dd>
<dt class="hdlist1"><code>-k</code></dt>
<dd>
<p>Specifies that the output should include the event&#8217;s key.
In this case, this contains the row&#8217;s primary key.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use Podman, run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">$ sudo podman run -it --rm --name watcher --pod dbz quay.io/debezium/kafka:1.9 watch-topic -a -k dbserver1.inventory.customers</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>watch-topic</code> utility returns the event records from the <code>customers</code> table.
There are four events, one for each row in the table.
Each event is formatted in JSON, because that is how you configured the Kafka Connect service.
There are two JSON documents for each event:
one for the key, and one for the value.</p>
</div>
<div class="paragraph">
<p>You should see output similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">Using ZOOKEEPER_CONNECT=172.17.0.2:2181
Using KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://172.17.0.7:9092
Using KAFKA_BROKER=172.17.0.3:9092
Contents of topic dbserver1.inventory.customers:
{"schema":{"type":"struct","fields":[{"type":"int32","optional":false,"field":"id"}],"optional":false,"name":"dbserver1.inventory.customers.Key"},"payload":{"id":1001}}
...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This utility keeps watching the topic, so any new events will automatically appear as long as the utility is running.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>For the last event, review the details of the <em>key</em>.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Here are the details of the <em>key</em> of the last event (formatted for readability):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "schema":{
    "type":"struct",
      "fields":[
        {
          "type":"int32",
          "optional":false,
          "field":"id"
        }
      ],
    "optional":false,
    "name":"dbserver1.inventory.customers.Key"
  },
  "payload":{
    "id":1004
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The event has two parts: a <code>schema</code> and a <code>payload</code>.
The <code>schema</code> contains a Kafka Connect schema describing what is in the payload.
In this case, the payload is a <code>struct</code> named <code>dbserver1.inventory.customers.Key</code> that is not optional and has one required field (<code>id</code> of type <code>int32</code>).</p>
</div>
<div class="paragraph">
<p>The <code>payload</code> has a single <code>id</code> field, with a value of <code>1004</code>.</p>
</div>
<div class="paragraph">
<p>By reviewing the <em>key</em> of the event,
you can see that this event applies to the row in the <code>inventory.customers</code> table whose <code>id</code> primary key column had a value of <code>1004</code>.</p>
</div>
</div>
</div>
</li>
<li>
<p>Review the details of the same event&#8217;s <em>value</em>.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The event&#8217;s <em>value</em> shows that the row was created,
and describes what it contains (in this case, the <code>id</code>, <code>first_name</code>, <code>last_name</code>, and <code>email</code> of the inserted row).</p>
</div>
<div class="paragraph">
<p>Here are the details of the <em>value</em> of the last event (formatted for readability):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "schema": {
    "type": "struct",
    "fields": [
      {
        "type": "struct",
        "fields": [
          {
            "type": "int32",
            "optional": false,
            "field": "id"
          },
          {
            "type": "string",
            "optional": false,
            "field": "first_name"
          },
          {
            "type": "string",
            "optional": false,
            "field": "last_name"
          },
          {
            "type": "string",
            "optional": false,
            "field": "email"
          }
        ],
        "optional": true,
        "name": "dbserver1.inventory.customers.Value",
        "field": "before"
      },
      {
        "type": "struct",
        "fields": [
          {
            "type": "int32",
            "optional": false,
            "field": "id"
          },
          {
            "type": "string",
            "optional": false,
            "field": "first_name"
          },
          {
            "type": "string",
            "optional": false,
            "field": "last_name"
          },
          {
            "type": "string",
            "optional": false,
            "field": "email"
          }
        ],
        "optional": true,
        "name": "dbserver1.inventory.customers.Value",
        "field": "after"
      },
      {
        "type": "struct",
        "fields": [
          {
            "type": "string",
            "optional": true,
            "field": "version"
          },
          {
            "type": "string",
            "optional": false,
            "field": "name"
          },
          {
            "type": "int64",
            "optional": false,
            "field": "server_id"
          },
          {
            "type": "int64",
            "optional": false,
            "field": "ts_sec"
          },
          {
            "type": "string",
            "optional": true,
            "field": "gtid"
          },
          {
            "type": "string",
            "optional": false,
            "field": "file"
          },
          {
            "type": "int64",
            "optional": false,
            "field": "pos"
          },
          {
            "type": "int32",
            "optional": false,
            "field": "row"
          },
          {
            "type": "boolean",
            "optional": true,
            "field": "snapshot"
          },
          {
            "type": "int64",
            "optional": true,
            "field": "thread"
          },
          {
            "type": "string",
            "optional": true,
            "field": "db"
          },
          {
            "type": "string",
            "optional": true,
            "field": "table"
          }
        ],
        "optional": false,
        "name": "io.debezium.connector.mysql.Source",
        "field": "source"
      },
      {
        "type": "string",
        "optional": false,
        "field": "op"
      },
      {
        "type": "int64",
        "optional": true,
        "field": "ts_ms"
      }
    ],
    "optional": false,
    "name": "dbserver1.inventory.customers.Envelope",
    "version": 1
  },
  "payload": {
    "before": null,
    "after": {
      "id": 1004,
      "first_name": "Anne",
      "last_name": "Kretchmar",
      "email": "annek@noanswer.org"
    },
    "source": {
      "version": "1.9.2.Final",
      "name": "dbserver1",
      "server_id": 0,
      "ts_sec": 0,
      "gtid": null,
      "file": "mysql-bin.000003",
      "pos": 154,
      "row": 0,
      "snapshot": true,
      "thread": null,
      "db": "inventory",
      "table": "customers"
    },
    "op": "r",
    "ts_ms": 1486500577691
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This portion of the event is much longer,
but like the event&#8217;s <em>key</em>, it also has a <code>schema</code> and a <code>payload</code>.
The <code>schema</code> contains a Kafka Connect schema named <code>dbserver1.inventory.customers.Envelope</code> (version 1) that can contain five fields:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>op</code></dt>
<dd>
<p>A required field that contains a string value describing the type of operation.
Values for the MySQL connector are <code>c</code> for create (or insert), <code>u</code> for update, <code>d</code> for delete, and <code>r</code> for read (in the case of a snapshot).</p>
</dd>
<dt class="hdlist1"><code>before</code></dt>
<dd>
<p>An optional field that, if present, contains the state of the row <em>before</em> the event occurred.
The structure will be described by the <code>dbserver1.inventory.customers.Value</code> Kafka Connect schema,
which the <code>dbserver1</code> connector uses for all rows in the <code>inventory.customers</code> table.</p>
</dd>
<dt class="hdlist1"><code>after</code></dt>
<dd>
<p>An optional field that, if present, contains the state of the row <em>after</em> the event occurred.
The structure is described by the same <code>dbserver1.inventory.customers.Value</code> Kafka Connect schema used in <code>before</code>.</p>
</dd>
<dt class="hdlist1"><code>source</code></dt>
<dd>
<p>A required field that contains a structure describing the source metadata for the event,
which in the case of MySQL, contains several fields:
the connector name, the name of the <code>binlog</code> file where the event was recorded, the position in that <code>binlog</code> file where the event appeared, the row within the event (if there is more than one), the names of the affected database and table, the MySQL thread ID that made the change, whether this event was part of a snapshot, and, if available, the MySQL server ID, and the timestamp in seconds.</p>
</dd>
<dt class="hdlist1"><code>ts_ms</code></dt>
<dd>
<p>An optional field that, if present, contains the time (using the system clock in the JVM running the Kafka Connect task) at which the connector processed the event.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The JSON representations of the events are much longer than the rows they describe.
This is because, with every event key and value, Kafka Connect ships the <em>schema</em> that describes the <em>payload</em>.
Over time, this structure may change.
However, having the schemas for the key and the value in the event itself makes it much easier for consuming applications to understand the messages, especially as they evolve over time.</p>
</div>
<div class="paragraph">
<p>The Debezium MySQL connector constructs these schemas based upon the structure of the database tables.
If you use DDL statements to alter the table definitions in the MySQL databases,
the connector reads these DDL statements and updates its Kafka Connect schemas.
This is the only way that each event is structured exactly like the table from where it originated at the time the event occurred.
However, the Kafka topic containing all of the events for a single table might have events that correspond to each state of the table definition.</p>
</div>
<div class="paragraph">
<p>The JSON converter includes the key and value schemas in every message,
so it does produce very verbose events.
Alternatively, you can use <a href="configuration/avro.html" class="page">Apache Avro</a> as a serialization format, which results in far smaller event messages.
This is because it transforms each Kafka Connect schema into an Avro schema and stores the Avro schemas in a separate Schema Registry service.
Thus, when the Avro converter serializes an event message,
it places only a unique identifier for the schema along with an Avro-encoded binary representation of the value.
As a result, the serialized messages that are transferred over the wire and stored in Kafka are far smaller than what you have seen here.
In fact, the Avro Converter is able to use Avro schema evolution techniques to maintain the history of each schema in the Schema Registry.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Compare the event&#8217;s <em>key</em> and <em>value</em> schemas to the state of the <code>inventory</code> database.
In the terminal that is running the MySQL command line client, run the following statement:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-sql hljs" data-lang="sql">mysql&gt; SELECT * FROM customers;
+------+------------+-----------+-----------------------+
| id   | first_name | last_name | email                 |
+------+------------+-----------+-----------------------+
| 1001 | Sally      | Thomas    | sally.thomas@acme.com |
| 1002 | George     | Bailey    | gbailey@foobar.com    |
| 1003 | Edward     | Walker    | ed@walker.com         |
| 1004 | Anne       | Kretchmar | annek@noanswer.org    |
+------+------------+-----------+-----------------------+
4 rows in set (0.00 sec)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This shows that the event records you reviewed match the records in the database.</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="updating-database-viewing-update-event"><a class="anchor" href="#updating-database-viewing-update-event"></a>Updating the database and viewing the <em>update</em> event</h3>
<div class="paragraph">
<p>Now that you have seen how the Debezium MySQL connector captured the <em>create</em> events in the <code>inventory</code> database,
you will now change one of the records and see how the connector captures it.</p>
</div>
<div class="paragraph">
<p>By completing this procedure, you will learn how to find details about what changed in a database commit,
and how you can compare change events to determine when the change occurred in relation to other changes.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the terminal that is running the MySQL command line client, run the following statement:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-sql hljs" data-lang="sql">mysql&gt; UPDATE customers SET first_name='Anne Marie' WHERE id=1004;
Query OK, 1 row affected (0.05 sec)
Rows matched: 1  Changed: 1  Warnings: 0</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>View the updated <code>customers</code> table:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-sql hljs" data-lang="sql">mysql&gt; SELECT * FROM customers;
+------+------------+-----------+-----------------------+
| id   | first_name | last_name | email                 |
+------+------------+-----------+-----------------------+
| 1001 | Sally      | Thomas    | sally.thomas@acme.com |
| 1002 | George     | Bailey    | gbailey@foobar.com    |
| 1003 | Edward     | Walker    | ed@walker.com         |
| 1004 | Anne Marie | Kretchmar | annek@noanswer.org    |
+------+------------+-----------+-----------------------+
4 rows in set (0.00 sec)</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Switch to the terminal running <code>watch-topic</code> to see a <em>new</em> fifth event.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>By changing a record in the <code>customers</code> table, the Debezium MySQL connector generated a new event.
You should see two new JSON documents: one for the event&#8217;s <em>key</em>,
and one for the new event&#8217;s <em>value</em>.</p>
</div>
<div class="paragraph">
<p>Here are the details of the <em>key</em> for the <em>update</em> event (formatted for readability):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">  {
    "schema": {
      "type": "struct",
      "name": "dbserver1.inventory.customers.Key"
      "optional": false,
      "fields": [
        {
          "field": "id",
          "type": "int32",
          "optional": false
        }
      ]
    },
    "payload": {
      "id": 1004
    }
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <em>key</em> is the same as the <em>key</em> for the previous events.</p>
</div>
<div class="paragraph">
<p>Here is that new event&#8217;s <em>value</em>.
There are no changes in the <code>schema</code> section, so only the <code>payload</code> section is shown (formatted for readability):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "schema": {...},
  "payload": {
    "before": {  <i class="conum" data-value="1"></i><b>(1)</b>
      "id": 1004,
      "first_name": "Anne",
      "last_name": "Kretchmar",
      "email": "annek@noanswer.org"
    },
    "after": {  <i class="conum" data-value="2"></i><b>(2)</b>
      "id": 1004,
      "first_name": "Anne Marie",
      "last_name": "Kretchmar",
      "email": "annek@noanswer.org"
    },
    "source": {  <i class="conum" data-value="3"></i><b>(3)</b>
      "name": "1.9.2.Final",
      "name": "dbserver1",
      "server_id": 223344,
      "ts_sec": 1486501486,
      "gtid": null,
      "file": "mysql-bin.000003",
      "pos": 364,
      "row": 0,
      "snapshot": null,
      "thread": 3,
      "db": "inventory",
      "table": "customers"
    },
    "op": "u",  <i class="conum" data-value="4"></i><b>(4)</b>
    "ts_ms": 1486501486308  <i class="conum" data-value="5"></i><b>(5)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>before</code> field now has the state of the row with the values before the database commit.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>after</code> field now has the updated state of the row,
and the <code>first_name</code> value is now <code>Anne Marie</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>source</code> field structure has many of the same values as before,
except that the <code>ts_sec</code> and <code>pos</code> fields have changed
(the <code>file</code> might have changed in other circumstances).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>op</code> field value is now <code>u</code>,
signifying that this row changed because of an update.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <code>ts_ms</code> field shows the time stamp for when Debezium processed this event.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By viewing the <code>payload</code> section, you can learn several important things about the <em>update</em> event:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By comparing the <code>before</code> and <code>after</code> structures, you can determine what actually changed in the affected row because of the commit.</p>
</li>
<li>
<p>By reviewing the <code>source</code> structure, you can find information about MySQL&#8217;s record of the change (providing traceability).</p>
</li>
<li>
<p>By comparing the <code>payload</code> section of an event to other events in the same topic (or a different topic), you can determine whether the event occurred before, after, or as part of the same MySQL commit as another event.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="deleting-record-database-viewing-delete-event"><a class="anchor" href="#deleting-record-database-viewing-delete-event"></a>Deleting a record in the database and viewing the <em>delete</em> event</h3>
<div class="paragraph">
<p>Now that you have seen how the Debezium MySQL connector captured the <em>create</em> and <em>update</em> events in the <code>inventory</code> database,
you will now delete one of the records and see how the connector captures it.</p>
</div>
<div class="paragraph">
<p>By completing this procedure, you will learn how to find details about <em>delete</em> events,
and how Kafka uses <em>log compaction</em> to reduce the number of <em>delete</em> events while still enabling consumers to get all of the events.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the terminal that is running the MySQL command line client, run the following statement:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-sql hljs" data-lang="sql">mysql&gt; DELETE FROM customers WHERE id=1004;
Query OK, 1 row affected (0.00 sec)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the above command fails with a foreign key constraint violation,
then you must remove the reference of the customer address from the <em>addresses</em> table using the following statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-sql hljs" data-lang="sql">mysql&gt; DELETE FROM addresses WHERE customer_id=1004;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Switch to the terminal running <code>watch-topic</code> to see <em>two</em> new events.</p>
<div class="paragraph">
<p>By deleting a row in the <code>customers</code> table, the Debezium MySQL connector generated two new events.</p>
</div>
</li>
<li>
<p>Review the <em>key</em> and <em>value</em> for the first new event.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Here are the details of the <em>key</em> for the first new event (formatted for readability):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "schema": {
    "type": "struct",
    "name": "dbserver1.inventory.customers.Key"
    "optional": false,
    "fields": [
      {
        "field": "id",
        "type": "int32",
        "optional": false
      }
    ]
  },
  "payload": {
    "id": 1004
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <em>key</em> is the same as the <em>key</em> in the previous two events you looked at.</p>
</div>
<div class="paragraph">
<p>Here is the <em>value</em> of the first new event (formatted for readability):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "schema": {...},
  "payload": {
    "before": {  <i class="conum" data-value="1"></i><b>(1)</b>
      "id": 1004,
      "first_name": "Anne Marie",
      "last_name": "Kretchmar",
      "email": "annek@noanswer.org"
    },
    "after": null,  <i class="conum" data-value="2"></i><b>(2)</b>
    "source": {  <i class="conum" data-value="3"></i><b>(3)</b>
      "name": "1.9.2.Final",
      "name": "dbserver1",
      "server_id": 223344,
      "ts_sec": 1486501558,
      "gtid": null,
      "file": "mysql-bin.000003",
      "pos": 725,
      "row": 0,
      "snapshot": null,
      "thread": 3,
      "db": "inventory",
      "table": "customers"
    },
    "op": "d",  <i class="conum" data-value="4"></i><b>(4)</b>
    "ts_ms": 1486501558315  <i class="conum" data-value="5"></i><b>(5)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>before</code> field now has the state of the row that was deleted with the database commit.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>after</code> field is <code>null</code> because the row no longer exists.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>source</code> field structure has many of the same values as before,
except the <code>ts_sec</code> and <code>pos</code> fields have changed
(the <code>file</code> might have changed in other circumstances).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>op</code> field value is now <code>d</code>,
signifying that this row was deleted.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <code>ts_ms</code> field shows the time stamp for when Debezium processes this event.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Thus, this event provides a consumer with the information that it needs to process the removal of the row.
The old values are also provided, because some consumers might require them to properly handle the removal.</p>
</div>
</div>
</div>
</li>
<li>
<p>Review the <em>key</em> and <em>value</em> for the second new event.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Here is the <em>key</em> for the second new event (formatted for readability):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">  {
    "schema": {
      "type": "struct",
      "name": "dbserver1.inventory.customers.Key"
      "optional": false,
      "fields": [
        {
          "field": "id",
          "type": "int32",
          "optional": false
        }
      ]
    },
    "payload": {
      "id": 1004
    }
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once again, this <em>key</em> is exactly the same key as in the previous three events you looked at.</p>
</div>
<div class="paragraph">
<p>Here is the <em>value</em> of that same event (formatted for readability):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "schema": null,
  "payload": null
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If Kafka is set up to be <em>log compacted</em>,
it will remove older messages from the topic if there is at least one message later in the topic with same key.
This last event is called a <em>tombstone</em> event,
because it has a key and an empty value.
This means that Kafka will remove all prior messages with the same key.
Even though the prior messages will be removed,
the tombstone event means that consumers can still read the topic from the beginning and not miss any events.</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="restarting-kafka-connect-service"><a class="anchor" href="#restarting-kafka-connect-service"></a>Restarting the Kafka Connect service</h3>
<div class="paragraph">
<p>Now that you have seen how the Debezium MySQL connector captures <em>create</em>, <em>update</em>, and <em>delete</em> events,
you will now see how it can capture change events even when it is not running.</p>
</div>
<div class="paragraph">
<p>The Kafka Connect service automatically manages tasks for its registered connectors.
Therefore, if it goes offline, when it restarts, it will start any non-running tasks.
This means that even if Debezium is not running,
it can still report changes in a database.</p>
</div>
<div class="paragraph">
<p>In this procedure, you will stop Kafka Connect,
change some data in the database,
and then restart Kafka Connect to see the change events.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open a new terminal and use it to stop the <code>connect</code> container that is running the Kafka Connect service:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">$ docker stop connect</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>connect</code> container is stopped, and the Kafka Connect service gracefully shuts down.</p>
</div>
<div class="paragraph">
<p>Because you ran the container with the <code>--rm</code> option, Docker removes the container once it stops.</p>
</div>
</div>
</div>
</li>
<li>
<p>While the service is down, switch to the terminal for the MySQL command line client, and add a few records:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-sql hljs" data-lang="sql">mysql&gt; INSERT INTO customers VALUES (default, "Sarah", "Thompson", "kitt@acme.com");
mysql&gt; INSERT INTO customers VALUES (default, "Kenneth", "Anderson", "kander@acme.com");</code></pre>
</div>
</div>
<div class="paragraph">
<p>The records are added to the database.
However, because Kafka Connect is not running,
<code>watch-topic</code> does not record any updates.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In a production system, you would have enough brokers to handle the producers and consumers,
and to maintain a minimum number of in-sync replicas for each topic.
Therefore, if enough brokers failed such that there were no longer the minimum number of ISRs,
Kafka would become unavailable.
In this scenario, producers (like the Debezium connectors) and consumers will wait for the Kafka cluster or network to recover.
This means that, temporarily, your consumers might not see any change events as data is changed in the databases.
This is because no change events are being produced.
As soon as the Kafka cluster is restarted or the network recovers,
Debezium will resume producing change events, and your consumers will resume consuming events where they left off.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Open a new terminal, and use it to restart the Kafka Connect service in a container.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>This command starts Kafka Connect using the same options you used when you initially started it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">$ docker run -it --rm --name connect -p 8083:8083 -e GROUP_ID=1 -e CONFIG_STORAGE_TOPIC=my_connect_configs -e OFFSET_STORAGE_TOPIC=my_connect_offsets -e STATUS_STORAGE_TOPIC=my_connect_statuses --link zookeeper:zookeeper --link kafka:kafka --link mysql:mysql quay.io/debezium/connect:1.9</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Kafka Connect service starts, connects to Kafka, reads the previous service&#8217;s configuration, and starts the registered connectors that will resume where they last left off.</p>
</div>
<div class="paragraph">
<p>Here are the last few lines from this restarted service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">...
2021-11-30 01:49:07,938 INFO   ||  Get all known binlogs from MySQL   [io.debezium.connector.mysql.MySqlConnection]
2021-11-30 01:49:07,941 INFO   ||  MySQL has the binlog file 'mysql-bin.000003' required by the connector   [io.debezium.connector.mysql.MySqlConnectorTask]
2021-11-30 01:49:07,967 INFO   ||  Requested thread factory for connector MySqlConnector, id = dbserver1 named = change-event-source-coordinator   [io.debezium.util.Threads]
2021-11-30 01:49:07,968 INFO   ||  Creating thread debezium-mysqlconnector-dbserver1-change-event-source-coordinator   [io.debezium.util.Threads]
2021-11-30 01:49:07,968 INFO   ||  WorkerSourceTask{id=inventory-connector-0} Source task finished initialization and start   [org.apache.kafka.connect.runtime.WorkerSourceTask]
2021-11-30 01:49:07,971 INFO   MySQL|dbserver1|snapshot  Metrics registered   [io.debezium.pipeline.ChangeEventSourceCoordinator]
2021-11-30 01:49:07,971 INFO   MySQL|dbserver1|snapshot  Context created   [io.debezium.pipeline.ChangeEventSourceCoordinator]
2021-11-30 01:49:07,976 INFO   MySQL|dbserver1|snapshot  A previous offset indicating a completed snapshot has been found. Neither schema nor data will be snapshotted.   [io.debezium.connector.mysql.MySqlSnapshotChangeEventSource]
2021-11-30 01:49:07,977 INFO   MySQL|dbserver1|snapshot  Snapshot ended with SnapshotResult [status=SKIPPED, offset=MySqlOffsetContext [sourceInfoSchema=Schema{io.debezium.connector.mysql.Source:STRUCT}, sourceInfo=SourceInfo [currentGtid=null, currentBinlogFilename=mysql-bin.000003, currentBinlogPosition=156, currentRowNumber=0, serverId=0, sourceTime=null, threadId=-1, currentQuery=null, tableIds=[], databaseName=null], snapshotCompleted=false, transactionContext=TransactionContext [currentTransactionId=null, perTableEventCount={}, totalEventCount=0], restartGtidSet=null, currentGtidSet=null, restartBinlogFilename=mysql-bin.000003, restartBinlogPosition=156, restartRowsToSkip=0, restartEventsToSkip=0, currentEventLengthInBytes=0, inTransaction=false, transactionId=null, incrementalSnapshotContext =IncrementalSnapshotContext [windowOpened=false, chunkEndPosition=null, dataCollectionsToSnapshot=[], lastEventKeySent=null, maximumKey=null]]]   [io.debezium.pipeline.ChangeEventSourceCoordinator]
2021-11-30 01:49:07,981 INFO   MySQL|dbserver1|streaming  Requested thread factory for connector MySqlConnector, id = dbserver1 named = binlog-client   [io.debezium.util.Threads]
2021-11-30 01:49:07,983 INFO   MySQL|dbserver1|streaming  Starting streaming   [io.debezium.pipeline.ChangeEventSourceCoordinator]
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>These lines show that the service found the offsets previously recorded by the last task before it was shut down,
connected to the MySQL database,
started reading the <code>binlog</code> from that position,
and generated events from any changes in the MySQL database since that point in time.</p>
</div>
</div>
</div>
</li>
<li>
<p>Switch to the terminal running <code>watch-topic</code> to see events for the two new records you created when Kafka Connect was offline:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{"schema":{"type":"struct","fields":[{"type":"int32","optional":false,"field":"id"}],"optional":false,"name":"dbserver1.inventory.customers.Key"},"payload":{"id":1005}}	{"schema":{"type":"struct","fields":[{"type":"struct","fields":[{"type":"int32","optional":false,"field":"id"},{"type":"string","optional":false,"field":"first_name"},{"type":"string","optional":false,"field":"last_name"},{"type":"string","optional":false,"field":"email"}],"optional":true,"name":"dbserver1.inventory.customers.Value","field":"before"},{"type":"struct","fields":[{"type":"int32","optional":false,"field":"id"},{"type":"string","optional":false,"field":"first_name"},{"type":"string","optional":false,"field":"last_name"},{"type":"string","optional":false,"field":"email"}],"optional":true,"name":"dbserver1.inventory.customers.Value","field":"after"},{"type":"struct","fields":[{"type":"string","optional":true,"field":"version"},{"type":"string","optional":false,"field":"name"},{"type":"int64","optional":false,"field":"server_id"},{"type":"int64","optional":false,"field":"ts_sec"},{"type":"string","optional":true,"field":"gtid"},{"type":"string","optional":false,"field":"file"},{"type":"int64","optional":false,"field":"pos"},{"type":"int32","optional":false,"field":"row"},{"type":"boolean","optional":true,"field":"snapshot"},{"type":"int64","optional":true,"field":"thread"},{"type":"string","optional":true,"field":"db"},{"type":"string","optional":true,"field":"table"}],"optional":false,"name":"io.debezium.connector.mysql.Source","field":"source"},{"type":"string","optional":false,"field":"op"},{"type":"int64","optional":true,"field":"ts_ms"}],"optional":false,"name":"dbserver1.inventory.customers.Envelope","version":1},"payload":{"before":null,"after":{"id":1005,"first_name":"Sarah","last_name":"Thompson","email":"kitt@acme.com"},"source":{"version":"1.9.2.Final","name":"dbserver1","server_id":223344,"ts_sec":1490635153,"gtid":null,"file":"mysql-bin.000003","pos":1046,"row":0,"snapshot":null,"thread":3,"db":"inventory","table":"customers"},"op":"c","ts_ms":1490635181455}}
{"schema":{"type":"struct","fields":[{"type":"int32","optional":false,"field":"id"}],"optional":false,"name":"dbserver1.inventory.customers.Key"},"payload":{"id":1006}}	{"schema":{"type":"struct","fields":[{"type":"struct","fields":[{"type":"int32","optional":false,"field":"id"},{"type":"string","optional":false,"field":"first_name"},{"type":"string","optional":false,"field":"last_name"},{"type":"string","optional":false,"field":"email"}],"optional":true,"name":"dbserver1.inventory.customers.Value","field":"before"},{"type":"struct","fields":[{"type":"int32","optional":false,"field":"id"},{"type":"string","optional":false,"field":"first_name"},{"type":"string","optional":false,"field":"last_name"},{"type":"string","optional":false,"field":"email"}],"optional":true,"name":"dbserver1.inventory.customers.Value","field":"after"},{"type":"struct","fields":[{"type":"string","optional":true,"field":"version"},{"type":"string","optional":false,"field":"name"},{"type":"int64","optional":false,"field":"server_id"},{"type":"int64","optional":false,"field":"ts_sec"},{"type":"string","optional":true,"field":"gtid"},{"type":"string","optional":false,"field":"file"},{"type":"int64","optional":false,"field":"pos"},{"type":"int32","optional":false,"field":"row"},{"type":"boolean","optional":true,"field":"snapshot"},{"type":"int64","optional":true,"field":"thread"},{"type":"string","optional":true,"field":"db"},{"type":"string","optional":true,"field":"table"}],"optional":false,"name":"io.debezium.connector.mysql.Source","field":"source"},{"type":"string","optional":false,"field":"op"},{"type":"int64","optional":true,"field":"ts_ms"}],"optional":false,"name":"dbserver1.inventory.customers.Envelope","version":1},"payload":{"before":null,"after":{"id":1006,"first_name":"Kenneth","last_name":"Anderson","email":"kander@acme.com"},"source":{"version":"1.9.2.Final","name":"dbserver1","server_id":223344,"ts_sec":1490635160,"gtid":null,"file":"mysql-bin.000003","pos":1356,"row":0,"snapshot":null,"thread":3,"db":"inventory","table":"customers"},"op":"c","ts_ms":1490635181456}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These events are <em>create</em> events that are similar to what you saw previously.
As you see, Debezium still reports all of the changes in a database even when it is not running
(as long as it is restarted before the MySQL database purges from its <code>binlog</code> the commits that were missed).</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cleaning-up"><a class="anchor" href="#cleaning-up"></a>Cleaning up</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After you are finished with the tutorial,
you can use Docker to stop all of the running containers.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Stop each of the containers:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">$ docker stop mysqlterm watcher connect mysql kafka zookeeper</code></pre>
</div>
</div>
<div class="paragraph">
<p>Docker stops each container.
Because you used the <code>--rm</code> option when you started them, Docker also removes them.</p>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use Podman, run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">$ sudo podman pod kill dbz
$ sudo podman pod rm dbz</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify that all of the processes have stopped and have been removed:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">$ docker ps -a</code></pre>
</div>
</div>
<div class="paragraph">
<p>If any of the processes are still running,
stop them using <code>docker stop <em>&lt;process-name&gt;</em></code> or <code>docker stop <em>&lt;containerId&gt;</em></code>.</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="next-steps"><a class="anchor" href="#next-steps"></a>Next steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After completing the tutorial, consider the following next steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Explore the tutorial further.</p>
<div class="paragraph">
<p>Use the MySQL command line client to add, modify, and remove rows in the database tables, and see the effect on the topics.
You may need to run a separate <code>watch-topic</code> command for each topic.
Keep in mind that you cannot remove a row that is referenced by a foreign key.</p>
</div>
</li>
<li>
<p>Try running the tutorial with Debezium connectors for Postgres, MongoDB, SQL Server, and Oracle.</p>
<div class="paragraph">
<p>You can use the <a href="https://docs.docker.com/compose/">Docker Compose</a> version of this tutorial located in the <a href="https://github.com/debezium/debezium-examples/tree/main/tutorial">Debezium examples repository</a>.
Docker Compose files are provided for running the tutorial with MySQL, Postgres, MongoDB, SQL Server, and Oracle.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</article>
</div>
<div class="article-cell2">
</div>
</div>

<div id="toc-rightbar"></div>    <footer class="footer">
        <div class="wrapper">
            <div class="copyright">Copyright &copy; 2022 Debezium Community (Rev: <span class="truncated"><a href="https://github.com/debezium/debezium/commit/f7ed81f67ef9a00577e226bdd607e60ab9c906e8">f7ed81f6</a></span>)
            
        </div>
    </footer>
</main></div>
<script>
    /* Make sure TOC carets are expanded if sub-elements exist */
    $("#toc").each(function(i,v) {
      $(this).closest('article').addClass('with-toc');
    });

    $("#toc ul.sectlevel1 > li").each(function(i,v) {
      $(this).has("ul").addClass("expanded");
    });

    $(function() {
        /* Expands all the documentation submenus */
        $(".nav-list > .nav-item:not(.is-active) .nav-item-toggle").click();
    });

    /**
     * This checks if a "#toc" element exists in the DOM and if so:
     *
     *  1. Appends a cloned copy of the #toc node to the #toc-rightbar div.
     *  2. Forces the #toc-rightbar div to be visible.
     *  3. Adds the .toc-right class to the #article-wrapper div to restrict the article's overall width.
     */
    var $toc = $("#toc");
    if ( $toc.length ) {
        $("#toc-rightbar").append($toc.clone());
        $("body .main").addClass("with-toc");
    }

    /**
     * In order to make CSS changes that are backward compatible with old adoc files, this applies a version
     * style to the body tag so we can use it to differentiate between CSS styles per version if needed,
     * such as tfoot rows.
     */
    var $version = $("body .nav-container").data("version");
    var $versionClass = "version-" + $version;
    $versionClass = $versionClass.replace('.','-');
    $("body").addClass($versionClass);

    /** A CSS trick to wrap long-width tables in a div that can be scrolled on smaller screens */
    $("table.tableblock").wrap("<div class='table-scroll-wrapper'></div>");

    $(function() {
        /* apply floating scrollbar to the scroll-wrapper */
        $(".table-scroll-wrapper").floatingScrollbar();
    });

</script>
<script src="../../debezium-antora/js/site.js"></script>
<script async src="../../debezium-antora/js/vendor/highlight.js"></script>

<script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
  try {
    var pageTracker = _gat._getTracker("UA-10656779-1");
    pageTracker._trackPageview();
  } catch(err) {}
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-76464546-1', 'auto');
  ga('send', 'pageview');
  ga('set', 'anonymizeIp', true);
  ga('require', 'linkid', 'linkid.js');
</script>
</body>
</html>