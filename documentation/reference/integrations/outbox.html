<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Outbox Quarkus Extension :: Debezium Documentation</title>
    <link rel="canonical" href="https://www.debezium.io/documentation/reference/integrations/outbox.html">
    <meta name="generator" content="Antora 2.2.0">
<link rel="stylesheet" href="../../debezium-antora/css/site.css">
<link rel="stylesheet" href="../../debezium-antora/css/debezium-antora.css">
<link rel="stylesheet" href="../../debezium-antora/css/highlightjs-dark.css">
<link rel="stylesheet" href="https://static.jboss.org/css/rhbar.css">
<script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.js"></script>
</head>
<body class="article">
<header class="header">
  <div id="rhbar">
      <a class="jbdevlogo" href="https://www.jboss.org/projects/about"></a>
      <a class="rhlogo" href="https://www.redhat.com"></a>
  </div>
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
          <img src="/images/color_white_debezium_type_600px.svg" style="height: 32px; margin-right: 14px;"/>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="/documentation/faq">FAQ</a>
        <a class="navbar-item" href="/documentation">DOCUMENTATION</a>
        <a class="navbar-item" href="/releases">RELEASES</a>
        <a class="navbar-item" href="/community">COMMUNITY</a>
        <a class="navbar-item" href="/blog">BLOG</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="reference" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Debezium Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tutorial.html">Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../install.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../postgres-plugins.html">PostgreSQL Decoding Plugins</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../features.html">Features</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/avro.html">Avro Serialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/topic-routing.html">Topic Routing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/event-flattening.html">New Record State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/mongodb-event-flattening.html">MongoDB New Document State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/outbox-event-router.html">Outbox Event Router</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Connectors</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../connectors/mysql.html">MySQL</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../assemblies/cdc-mysql-connector/as_overview-of-how-the-mysql-connector-works.html">How It Works</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../assemblies/cdc-mysql-connector/as_setup-the-mysql-server.html">Setup</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../assemblies/cdc-mysql-connector/as_deploy-the-mysql-connector.html">Deployment</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../assemblies/cdc-mysql-connector/as_connector-common-issues.html">Common Issues</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/mongodb.html">MongoDB</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/postgresql.html">PostgreSQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/oracle.html">Oracle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/sqlserver.html">SQL Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/cassandra.html">Cassandra</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Integrations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="serdes.html">Change Event SerDes</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="outbox.html">Outbox Quarkus Extension</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cloudevents.html">CloudEvents</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Operations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/monitoring.html">Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/openshift.html">Running on Openshift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/embedded.html">Embedding Debezium</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Debezium Documentation</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Debezium Documentation</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
        <li class="version">
          <a href="../1.1/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../1.0/index.html">1.0</a>
        </li>
        <li class="version">
          <a href="../0.10/index.html">0.10</a>
        </li>
        <li class="version">
          <a href="../0.9/index.html">0.9</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main" class="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Debezium Documentation</a></li>
    <li>Integrations</li>
    <li><a href="outbox.html">Outbox Quarkus Extension</a></li>
  </ul>
</nav>
    <div class="page-versions-container">
    Version:
    <div class="page-versions">
        <button class="version-menu-toggle versions-menu-current" title="Show other versions of page">master</button>
        <!--<button class="version-menu-toggle versions-menu-select" title="Select other versions">Select</button>-->
        <div class="version-menu">
                <a class="version is-current" href="outbox.html">master</a>
                <a class="version" href="../1.1/integrations/outbox.html">1.1</a>
                <a class="version is-missing" href="../1.0/index.html">1.0</a>
                <a class="version is-missing" href="../0.10/index.html">0.10</a>
                <a class="version is-missing" href="../0.9/index.html">0.9</a>
        </div>
        |
    </div>
    </div>
  <div class="edit-this-page"><a href="https://github.com/debezium/debezium/edit/master/documentation/modules/ROOT/pages/integrations/outbox.adoc">Edit this Page</a></div>
  </div>
<article class="doc">
<h1 class="page">Outbox Quarkus Extension</h1>
<div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">Overview</a></li>
<li><a href="#_getting_started">Getting Started</a></li>
<li><a href="#_example">Example</a></li>
<li><a href="#_configuration">Configuration</a>
<ul class="sectlevel2">
<li><a href="#_build_time_configuration_options">Build time configuration options</a></li>
<li><a href="#_runtime_configuration_options">Runtime configuration options</a></li>
</ul>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is currently in incubating state, i.e. exact semantics, configuration options etc. may change in future revisions, based on the feedback we receive. Please let us know if you encounter any problems while using this extension.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This extension is inspired by the <a href="../configuration/outbox-event-router.html" class="page">Outbox Event Router</a> single message transformation (SMT).
As discussed in the blog post <a href="/blog/2019/02/19/reliable-microservices-data-exchange-with-the-outbox-pattern/">Reliable Microservices Data Exchange with the Outbox Pattern</a>, microservices often need to exchange information with one another and an excellent way to deal with that is using the Outbox pattern combined with Debezium&#8217;s Outbox Event Router SMT.</p>
</div>
<div class="paragraph">
<p>The following image shows the overall architecture of this pattern:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/outbox_pattern.png" alt="Outbox Pattern"></span></p>
</div>
<div class="paragraph">
<p>The Outbox extension&#8217;s goal is to provide a <a href="https://quarkus.io/">Quarkus</a> application with a reusable, highly configurable component that facilitates the use of the Outbox pattern paired with Debezium&#8217;s CDC connector pipeline to reliably and asynchronously share data with any consumer of said data.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started"><a class="anchor" href="#_getting_started"></a>Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to start using the Debezium Outbox Quarkus extension, the extension needs to be added as a part of the Quarkus application as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;io.debezium.quarkus&lt;/groupId&gt;
  &lt;artfiactId&gt;debezium-quarkus-outbox&lt;/artfiactId&gt;
  &lt;version&gt;{debezium-version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The extension provides the application with the <code>io.debezium.outbox.quarkus.ExportedEvent</code> interface.
It&#8217;s expected that an application class will implement this interface and that the event will be emitted using the <code>javax.enterprise.event.Event</code> class.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>ExportedEvent</code> interface is parameterized to allow the application to designate the Java types used by several attributes emitted by the event.
It&#8217;s important that for a given Quarkus application, <strong>all</strong> implementations of the <code>ExportedEvent</code> interface must use the same parameter types or a build failure will be thrown since all events will use the same underlying database table.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example"><a class="anchor" href="#_example"></a>Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following illustrates an implementation of the <code>ExportedEvent</code> interface representing an order that has been created:</p>
</div>
<div class="listingblock">
<div class="title">OrderCreatedEvent.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class OrderCreatedEvent implements ExportedEvent&lt;String, JsonNode&gt; {

    private static final String TYPE = "Order";
    private static final String EVENT_TYPE = "OrderCreated";

    private final long orderId;
    private final JsonNode jsonNode;
    private final Instant timestamp;

    public OrderCreatedEvent(Instant createdAt, Order order) {
        this.orderId = order.getId();
        this.timestamp = createdAt;
        this.jsonNode = convertToJson(order);
    }

    @Override
    public String getAggregateId() {
        return String.valeuOf(orderId);
    }

    @Override
    public String getAggregateType() {
        return TYPE;
    }

    @Override
    public JsonNode getPayload() {
        return jsonNode;
    }

    @Override
    public String getType() {
        return EVENT_TYPE;
    }

    @Override
    public Instant getTimestamp() {
        return timestamp;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example illustrates an <code>OrderService</code> that emits the <code>OrderCreatedEvent</code>:</p>
</div>
<div class="listingblock">
<div class="title">OrderService.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
public class OrderService {
    @Inject
    Event&lt;ExportedEvent&lt;?, ?&gt;&gt; event;

    @Transactional
    public Order addOrder(Order order) {
        order = orderRepository.save(order);
        event.fire(new OrderCreatedEvent(Instant.now(), order));
        return order;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the application code fires the event by calling <code>Event#fire()</code>, the Outbox extension will be notified that the event occurred and persists the contents of the event into an outbox event table within the scope of the current transaction.
The Debezium CDC connector in conjunction with the Outbox Event Router will be monitoring this table and will be responsible for relaying that data using CDC events.</p>
</div>
<div class="paragraph">
<p>To see a full end-to-end demo, the <a href="https://github.com/debezium/debezium-examples/tree/master/outbox">Outbox</a> example illustrates two Quarkus microservice applications using the outbox pattern to share data between them when orders are placed or cancelled.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Outbox extension can be configured by setting options in the Quarkus <code>application.properties</code> file.
The extension works out-of-the-box with a default configuration, but this configuration may not be ideal for every situation.</p>
</div>
<div class="sect2">
<h3 id="_build_time_configuration_options"><a class="anchor" href="#_build_time_configuration_options"></a>Build time configuration options</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 65%;">
<col style="width: 15%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration property</th>
<th class="tableblock halign-right valign-top">Type</th>
<th class="tableblock halign-right valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1"><code>quarkus.debezium-outbox.table-name</code></dt>
<dd>
<p>The table name to be used when creating the outbox table.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-right valign-top"><div class="content"><div class="paragraph">
<p>string</p>
</div></div></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">OutboxEvent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1"><code>quarkus.debezium-outbox.id-column-name</code></dt>
<dd>
<p>The column name for the event id column.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-right valign-top"><div class="content"><div class="paragraph">
<p>string</p>
</div></div></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>id</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1"><code>quarkus.debezium-outbox.aggregate-id-column.name</code></dt>
<dd>
<p>The column name for the event key column.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-right valign-top"><div class="content"><div class="paragraph">
<p>string</p>
</div></div></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>aggregateid</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1"><code>quarkus.debezium-outbox.type-column-name</code></dt>
<dd>
<p>The column name for the event type column.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-right valign-top"><div class="content"><div class="paragraph">
<p>string</p>
</div></div></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>type</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1"><code>quarkus.debezium-outbox.timestamp-column-name</code></dt>
<dd>
<p>The column name for the event timestamp column.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-right valign-top"><div class="content"><div class="paragraph">
<p>string</p>
</div></div></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>timestamp</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1"><code>quarkus.debezium-outbox.payload-column-name</code></dt>
<dd>
<p>The column name for the event payload column.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-right valign-top"><div class="content"><div class="paragraph">
<p>string</p>
</div></div></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>payload</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1"><code>quarkus.debezium-outbox.aggregate-type-column-name</code></dt>
<dd>
<p>The column name for the event aggregate type column.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-right valign-top"><div class="content"><div class="paragraph">
<p>string</p>
</div></div></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>aggregatetype</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The build time configuration defaults will work with the Outbox Event Router SMT out of the box.
When not using the default values, be sure that the SMT configuration matches.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_runtime_configuration_options"><a class="anchor" href="#_runtime_configuration_options"></a>Runtime configuration options</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 65%;">
<col style="width: 15%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration property</th>
<th class="tableblock halign-right valign-top">Type</th>
<th class="tableblock halign-right valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1"><code>quarkus.debezium-outbox.remove-after-insert</code></dt>
<dd>
<p>Whether the outbox entry is removed after having been inserted.<br></p>
<div class="paragraph">
<p><em>The removal of the entry does not impact the Debezium connector from being able to emit CDC events.
This is used as a way to keep the table&#8217;s underlying storage from growing over time.</em></p>
</div>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-right valign-top"><div class="content"><div class="paragraph">
<p>boolean</p>
</div></div></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</article>
    <footer class="footer">
        <div class="wrapper">
            <div class="copyright">Copyright &copy; 2020 Debezium Community</div>
        </div>
    </footer>
</main>
</div>
<script>
    /* Make sure TOC carets are expanded if sub-elements exist */
    $("#toc").each(function(i,v) {
      $(this).closest('article').addClass('with-toc');
    });

    $("#toc ul.sectlevel1 > li").each(function(i,v) {
      $(this).has("ul").addClass("expanded");
    });

    $(function() {
        /* Expands all the documentation submenus */
        $(".nav-list > .nav-item:not(.is-active) .nav-item-toggle").click();
    });

    /*
    $(".doc.with-toc").each(function(i,v) {
        var tocWidth = $(".toc").width();
        $(this).css("max-width", "calc(100% - " + (tocWidth+75) + "px)");
    });
    */
</script>
<script src="../../debezium-antora/js/site.js"></script>
<script async src="../../debezium-antora/js/vendor/highlight.js"></script>

<script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
  try {
    var pageTracker = _gat._getTracker("UA-10656779-1");
    pageTracker._trackPageview();
  } catch(err) {}
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-76464546-1', 'auto');
  ga('send', 'pageview');
  ga('set', 'anonymizeIp', true);
  ga('require', 'linkid', 'linkid.js');
</script>
</body>
</html>