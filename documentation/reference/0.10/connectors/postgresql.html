<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Debezium Connector for PostgreSQL :: Debezium Documentation</title>
    <link rel="canonical" href="https://www.debezium.io/documentation/reference/connectors/postgresql.html">
    <meta name="generator" content="Antora 2.2.0">
<link rel="stylesheet" href="../../../debezium-antora/css/site.css">
<link rel="stylesheet" href="../../../debezium-antora/css/debezium-antora.css">
<link rel="stylesheet" href="../../../debezium-antora/css/highlightjs-dark.css">
<link rel="stylesheet" href="https://static.jboss.org/css/rhbar.css">
<script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.js"></script>
</head>
<body class="article">
<header class="header">
  <div id="rhbar">
      <a class="jbdevlogo" href="https://www.jboss.org/projects/about"></a>
      <a class="rhlogo" href="https://www.redhat.com"></a>
  </div>
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
          <img src="/images/color_white_debezium_type_600px.svg" style="height: 32px; margin-right: 14px;"/>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="/documentation/faq">FAQ</a>
        <a class="navbar-item" href="/documentation">DOCUMENTATION</a>
        <a class="navbar-item" href="/releases">RELEASES</a>
        <a class="navbar-item" href="/community">COMMUNITY</a>
        <a class="navbar-item" href="/blog">BLOG</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="reference" data-version="0.10">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Debezium Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tutorial.html">Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../install.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../postgres-plugins.html">PostgreSQL Decoding Plugins</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../features.html">Features</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/avro.html">Avro Serialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/topic-routing.html">Topic Routing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/event-flattening.html">New Record State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/mongodb-event-flattening.html">MongoDB New Document State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/outbox-event-router.html">Outbox Event Router</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Connectors</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="mysql.html">MySQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="mongodb.html">MongoDB</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="postgresql.html">PostgreSQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="oracle.html">Oracle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="sqlserver.html">SQL Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cassandra.html">Cassandra</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Operations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/monitoring.html">Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/openshift.html">Running on Openshift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/embedded.html">Embedding Debezium</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Debezium Documentation</span>
    <span class="version">0.10</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Debezium Documentation</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../index.html">master</a>
        </li>
        <li class="version">
          <a href="../../1.1/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../../1.0/index.html">1.0</a>
        </li>
        <li class="version is-current">
          <a href="../index.html">0.10</a>
        </li>
        <li class="version">
          <a href="../../0.9/index.html">0.9</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main" class="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Debezium Documentation</a></li>
    <li>Connectors</li>
    <li><a href="postgresql.html">PostgreSQL</a></li>
  </ul>
</nav>
    <div class="page-versions-container">
    Version:
    <div class="page-versions">
        <button class="version-menu-toggle versions-menu-current" title="Show other versions of page">0.10</button>
        <!--<button class="version-menu-toggle versions-menu-select" title="Select other versions">Select</button>-->
        <div class="version-menu">
                <a class="version" href="../../connectors/postgresql.html">master</a>
                <a class="version" href="../../1.1/connectors/postgresql.html">1.1</a>
                <a class="version" href="../../1.0/connectors/postgresql.html">1.0</a>
                <a class="version is-current" href="postgresql.html">0.10</a>
                <a class="version" href="../../0.9/connectors/postgresql.html">0.9</a>
        </div>
        |
    </div>
    </div>
  <div class="edit-this-page"><a href="https://github.com/debezium/debezium/edit/0.10/documentation/modules/ROOT/pages/connectors/postgresql.adoc">Edit this Page</a></div>
  </div>
<article class="doc">
<h1 class="page">Debezium Connector for PostgreSQL</h1>
<div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#overview">Overview</a></li>
<li><a href="#setting-up-PostgreSQL">Setting up PostgreSQL</a>
<ul class="sectlevel2">
<li><a href="#amazon-rds">PostgreSQL on Amazon RDS</a></li>
<li><a href="#output-plugin">Installing the Logical Decoding Output Plug-in</a></li>
<li><a href="#PostgreSQL-permissions">Setting up Permissions</a></li>
</ul>
</li>
<li><a href="#supported-PostgreSQL-topologies">Supported PostgreSQL Topologies</a></li>
<li><a href="#how-the-postgresql-connector-works">How the PostgreSQL connector works</a>
<ul class="sectlevel2">
<li><a href="#snapshots">Snapshots</a></li>
<li><a href="#custom-snapshot">Custom Snapshotter SPI</a></li>
<li><a href="#streaming-changes">Streaming Changes</a></li>
<li><a href="#pgoutput">PostgreSQL 10+ Logical Decoding Support (pgoutput)</a></li>
<li><a href="#topic-names">Topics Names</a></li>
<li><a href="#meta-info">Meta Information</a></li>
<li><a href="#events">Events</a></li>
<li><a href="#data-types">Data Types</a></li>
<li><a href="#when-things-go-wrong">When Things Go Wrong</a></li>
</ul>
</li>
<li><a href="#deploying-a-connector">Deploying a Connector</a>
<ul class="sectlevel2">
<li><a href="#example-configuration">Example Configuration</a></li>
<li><a href="#connector-properties">Connector Properties</a></li>
</ul>
</li>
</ul>
</div>
<div class="paragraph">
<p>Debezium&#8217;s PostgreSQL Connector can monitor and record the row-level changes in the schemas of a PostgreSQL database. This connector was added in Debezium 0.4.0.</p>
</div>
<div class="paragraph">
<p>The first time it connects to a PostgreSQL server/cluster, it reads a consistent snapshot of all of the schemas. When that snapshot is complete, the connector continuously streams the changes that were committed to PostgreSQL 9.6 or later and generates corresponding insert, update and delete events. All of the events for each table are recorded in a separate Kafka topic, where they can be easily consumed by applications and services.</p>
</div>
<div class="paragraph">
<p>The connector works with Postgres 9.6, 10 and 11 (support for the latter has been added in Debezium 0.9).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>PostgreSQL&#8217;s <a href="https://www.postgresql.org/docs/current/static/logicaldecoding-explanation.html"><em>logical decoding</em></a> feature was first introduced in version 9.4 and is a mechanism which allows the extraction of the changes which were committed to the transaction log and the processing of these changes in a user-friendly manner via the help of an <a href="https://www.postgresql.org/docs/current/static/logicaldecoding-output-plugin.html"><em>output plugin</em></a>. This output plugin must be installed prior to running the PostgreSQL server and enabled together with a replication slot in order for clients to be able to consume the changes.</p>
</div>
<div class="paragraph">
<p>Debezium&#8217;s PostgreSQL connector contains two different parts which work together in order to be able to read and process server changes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a logical decoding output plugin which has to be installed and configured in the PostgreSQL server, one of</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/debezium/postgres-decoderbufs">decoderbufs</a> (maintained by the Debezium community, based on ProtoBuf)</p>
</li>
<li>
<p><a href="https://github.com/eulerto/wal2json">wal2json</a> (maintained by the wal2json community, based on JSON)</p>
</li>
<li>
<p>pgoutput, the standard logical decoding plug-in in PostgreSQL 10+ (maintained by the Postgres community, used by Postgres itself for <a href="https://www.postgresql.org/docs/current/logical-replication-architecture.html">logical replication</a>);
this plug-in is always present, meaning that no additional libraries must be installed,
and the Debezium connector will interpret the raw replication event stream into change events directly.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Java code (the actual Kafka Connect connector) which reads the changes produced by the chosen plugin, using PostgreSQL&#8217;s <a href="https://www.postgresql.org/docs/current/static/logicaldecoding-walsender.html"><em>streaming replication protocol</em></a>, via the PostgreSQL <a href="https://github.com/pgjdbc/pgjdbc"><em>JDBC driver</em></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The connector then produces a <em>change event</em> for every row-level insert, update, and delete operation that was received, recording all the change events for each table in a separate Kafka topic. Your client applications read the Kafka topics that correspond to the database tables they&#8217;re interested in following, and react to every row-level event it sees in those topics.</p>
</div>
<div class="paragraph">
<p>PostgreSQL normally purges WAL segments after some period of time. This means that the connector won&#8217;t have the complete history of all changes that have been made to the database. Therefore, when the PostgreSQL connector first connects to a particular PostgreSQL database, it starts by performing a <em>consistent snapshot</em> of each of the database schemas. After the connector completes the snapshot, it continues streaming changes from the exact point at which the snapshot was made. This way, we start with a consistent view of all of the data, yet continue reading without having lost any of the changes made while the snapshot was taking place.</p>
</div>
<div class="paragraph">
<p>The connector is also tolerant of failures. As the connector reads changes and produces events, it records the position in the write-ahead log with each event. If the connector stops for any reason (including communication failures, network problems, or crashes), upon restart it simply continues reading the WAL where it last left off. This includes snapshots: if the snapshot was not completed when the connector is stopped, upon restart it will begin a new snapshot.</p>
</div>
<div id="limitations" class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The connector&#8217;s functionality relies on PostgreSQL&#8217;s logical decoding feature.
Since this is a relatively new feature, it has some limitations which are also reflected by the connector:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Logical Decoding does not support DDL changes: this means that the connector is unable to report DDL change events back to consumers.</p>
</li>
<li>
<p>Logical Decoding replication slots are only supported on <code>primary</code> servers: this means that when there is a cluster of PostgreSQL servers, the connector can only run on the active <code>primary</code> server. It cannot run on <code>hot</code> or <code>warm</code> standby replicas. If the <code>primary</code> server fails or is demoted, the connector will stop. Once the <code>primary</code> has recovered the connector can simply be restarted. If a different PostgreSQL server has been promoted to <code>primary</code>, the connector configuration must be adjusted before the connector is restarted. Make sure you read more about how the connector behaves <a href="#when-things-go-wrong">when things go wrong</a>.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Debezium currently supports only database with UTF-8 character encoding.
With a single byte character encoding it is not possible to correctly process strings containing extended ASCII code characters.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setting-up-PostgreSQL"><a class="anchor" href="#setting-up-PostgreSQL"></a>Setting up PostgreSQL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before using the Debezium PostgreSQL connector to monitor the changes committed on a PostgreSQL server,
first decide which logical decoder method you intend to use.
If you plan <strong>not</strong> to use the native pgoutput logical replication stream support,
then you will need to install the logical decoding plugin into the PostgreSQL server.
Afterward enable a replication slot, and configure a user with sufficient privileges to perform the replication.</p>
</div>
<div class="paragraph">
<p>Note that <strong>if your database is hosted by a service</strong> such as <a href="https://www.heroku.com/postgres">Heroku Postgres</a> you may be unable to install the plugin.
If so, and if you&#8217;re using PostgreSQL 10+, you can use the pgoutput decoder support to monitor your database.
If that isn&#8217;t an option, you&#8217;ll be unable to monitor your database with Debezium.</p>
</div>
<div class="sect2">
<h3 id="amazon-rds"><a class="anchor" href="#amazon-rds"></a>PostgreSQL on Amazon RDS</h3>
<div class="paragraph">
<p>It is possible to monitor PostgreSQL database running in <a href="https://aws.amazon.com/rds/">Amazon RDS</a>. To get it running you must fulfill the following conditions</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The instance parameter <code>rds.logical_replication</code> is set to <code>1</code>.</p>
</li>
<li>
<p>Verify that <code>wal_level</code> parameter is set to <code>logical</code> by running the query <code>SHOW wal_level</code> as DB master user; this might not be the case in multi-zone replication setups.
You cannot set this option manually, it&#8217;s (<a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithParamGroups.html">automatically changed</a>) when the <code>rds.logical_replication</code> is set to <code>1</code>.
If the <code>wal_level</code> is not <code>logical</code> after the change above, it&#8217;s probably because the instance has to be restarted due to the parameter group change, it&#8217;ll happen accordingly to your maintenance window or can be done manually.</p>
</li>
<li>
<p>Set <code>plugin.name</code> Debezium parameter to <code>wal2json</code>.  You can skip this on PostgreSQL 10+ if you wish to use pgoutput logical replication stream support.</p>
</li>
<li>
<p>Use database master account for replication as RDS currently does not support setting of <code>REPLICATION</code> privilege for another account.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You should make sure to use the latest versions of Postgres 9.6, 10 or 11 on Amazon RDS.
Otherwise, older versions of the wal2json plug-in may be installed
(see <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_PostgreSQL.html">the official documentation</a> for the exact wal2json versions installed on Amazon RDS).
In that case, replication messages received from the database may not carry complete information about type constraints like length or scale or <code>NULL</code>/<code>NOT NULL</code>,
which in turn might cause creation of messages with an inconsistent schema for a short period of time in case of changes to a column&#8217;s definition.</p>
</div>
<div class="paragraph">
<p>As of January 2019, the following Postgres versions on RDS come with an up-to-date version of wal2json and thus should be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Postgres 9.6: 9.6.10 and newer</p>
</li>
<li>
<p>Postgres 10: 10.5 and newer</p>
</li>
<li>
<p>Postgres 11: any version</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="output-plugin"><a class="anchor" href="#output-plugin"></a>Installing the Logical Decoding Output Plug-in</h3>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Also see <a href="../postgres-plugins.html" class="page">Logical Decoding Output Plug-in Installation for PostgreSQL</a> for more detailed instructions of setting up and testing logical decoding plug-ins.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As of Debezium 0.10, the connector supports PostgreSQL 10+ logical replication streaming using <em>pgoutput</em>.
This means that a logical decoding output plug-in is no longer necessary and changes can be emitted directly from the replication stream by the connector.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As of PostgreSQL 9.4, the only way to read changes to the write-ahead-log is to first install a logical decoding output plugin. Plugins are written in C, compiled, and installed on the machine which runs the PostgreSQL server. Plugins use  a number of PostgreSQL specific APIs, as described by the <a href="https://www.postgresql.org/docs/current/static/logicaldecoding-output-plugin.html"><em>PostgreSQL documentation</em></a>.</p>
</div>
<div class="paragraph">
<p>Debezium&#8217;s PostgreSQL connector works with one of Debezium&#8217;s supported logical decoding plugin to encode the changes in either <a href="https://github.com/google/protobuf"><em>Protobuf format</em></a> or <a href="http://www.json.org/"><em>JSON</em></a> format.
See the documentation of your chosen plugin (<a href="https://github.com/debezium/postgres-decoderbufs/blob/master/README.md"><em>protobuf</em></a>, <a href="https://github.com/eulerto/wal2json/blob/master/README.md"><em>wal2json</em></a>) to learn more about the plugin&#8217;s requirements, limitations, and how to compile it.</p>
</div>
<div class="paragraph">
<p>For simplicity, Debezium also provides a Docker image based on a vanilla PostgreSQL server image on top of which it compiles and installs the plugins. We recommend <a href="https://github.com/debezium/docker-images/tree/master/postgres/9.6"><em>using this image</em></a> as an example of the detailed steps required for the installation.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Debezium logical decoding plugins have only been installed and tested on <em>Linux</em> machines.
For Windows and other operating systems it may require different installation steps.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="discrepance-between-plugins"><a class="anchor" href="#discrepance-between-plugins"></a>Differences Between Plug-ins</h4>
<div class="paragraph">
<p>The plugins' behaviour is not completely same for all cases.
So far these differences have been identified:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>wal2json plug-in is not able to process quoted identifiers (<a href="https://github.com/eulerto/wal2json/issues/35">issue</a>)</p>
</li>
<li>
<p>wal2json plug-in does not emit events for tables without primary keys</p>
</li>
<li>
<p>wal2json plug-in does not support special values (<code>NaN</code> or <code>infinity</code>) for floating point types</p>
</li>
<li>
<p>wal2json should be used with setting the <code>schema.refresh.mode</code> connector option to <code>columns_diff_exclude_unchanged_toast</code>;
otherwise, when receiving a change event for a row containing an unchanged TOAST column, no field for that column will be contained in the emitted change event&#8217;s <code>after</code> structure.
This is because wal2json&#8217;s messages won&#8217;t contain a field for such column.
The requirement for adding this is tracked under the wal2json <a href="https://github.com/eulerto/wal2json/issues/98">issue 98</a>.
See the documentation of <code>columns_diff_exclude_unchanged_toast</code> further below for implications of using it.</p>
</li>
<li>
<p>pgoutput plug-in does not emit events for tables without primary keys</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All up-to-date differences are tracked in a test suite <a href="https://github.com/debezium/debezium/blob/master/debezium-connector-postgres/src/test/java/io/debezium/connector/postgresql/DecoderDifferences.java">Java class</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="server-configuration"><a class="anchor" href="#server-configuration"></a>Configuring the PostgreSQL Server</h4>
<div class="paragraph">
<p>If you are using one of the supported <a href="#output-plugin">logical decoding plug-ins</a> (i.e. not pgoutput) and it has been installed,
configure the server to load the plugin at startup:</p>
</div>
<div class="paragraph">
<p><strong>postgresql.conf</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># MODULES
shared_preload_libraries = 'decoderbufs,wal2json' <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>tells the server that it should load at startup the <code>decoderbufs</code> and <code>wal2json</code> logical decoding plugins (the names of the plugins are set in <a href="https://github.com/debezium/postgres-decoderbufs/blob/v0.3.0/Makefile"><em>Protobuf</em></a> and <a href="https://github.com/eulerto/wal2json/blob/master/Makefile"><em>wal2json</em></a> Makefiles)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next is to configure the replication slot regardless of the decoder being used:</p>
</div>
<div class="paragraph">
<p><strong>postgresql.conf</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># REPLICATION
wal_level = logical             <i class="conum" data-value="1"></i><b>(1)</b>
max_wal_senders = 1             <i class="conum" data-value="2"></i><b>(2)</b>
max_replication_slots = 1       <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>tells the server that it should use logical decoding with the write-ahead log</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>tells the server that it should use a maximum of <code>1</code> separate processes for processing WAL changes</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>tells the server that it should allow a maximum of <code>1</code> replication slots to be created for streaming WAL changes</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Debezium needs a PostgreSQL&#8217;s WAL to be kept during Debezium outages.
If your WAL retention is too small and outages too long then Debezium will not be able to recover after restart as it will miss part of the data changes.
The usual indicator is an error similar to this thrown during the startup: <code>ERROR: requested WAL segment 000000010000000000000001 has already been removed</code>.</p>
</div>
<div class="paragraph">
<p>When this happens then it is necessary to re-execute the snapshot of the database.
We also recommend to set parameter <code>wal_keep_segments = 0</code>. Please follow PostgreSQL official documentation for fine-tuning of WAL retention.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We strongly recommend reading and understanding <a href="https://www.postgresql.org/docs/current/static/wal-configuration.html">the official documentation</a> regarding the mechanics and configuration of the PostgreSQL write-ahead log</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="PostgreSQL-permissions"><a class="anchor" href="#PostgreSQL-permissions"></a>Setting up Permissions</h3>
<div class="paragraph">
<p>Replication can only be performed by a database user that has appropriate permissions and only for a configured number of hosts.</p>
</div>
<div class="paragraph">
<p>In order to give a user replication permissions, define a PostgreSQL role that has <em>at least</em> the <code>REPLICATION</code> and <code>LOGIN</code> permissions. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>CREATE ROLE name REPLICATION LOGIN;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Superusers have by default both of the above roles.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, configure the PostgreSQL server to allow replication to take place between the server machine and the host on which the Debezium PostgreSQL connector is running:</p>
</div>
<div class="paragraph">
<p><strong>pg_hba.conf</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>local   replication     &lt;youruser&gt;                          trust   <i class="conum" data-value="1"></i><b>(1)</b>
host    replication     &lt;youruser&gt;  127.0.0.1/32            trust   <i class="conum" data-value="2"></i><b>(2)</b>
host    replication     &lt;youruser&gt;  ::1/128                 trust   <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>tells the server to allow replication for <code>&lt;youruser&gt;</code> locally (i.e. on the server machine)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>tells the server to allow <code>&lt;youruser&gt;</code> on <code>localhost</code> to receive replication changes using <code>IPV4</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>tells the server to allow <code>&lt;youruser&gt;</code> on <code>localhost</code> to receive replication changes using <code>IPV6</code></td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>See <a href="https://www.postgresql.org/docs/current/static/datatype-net-types.html"><em>the PostgreSQL documentation</em></a> for more information on network masks.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="supported-PostgreSQL-topologies"><a class="anchor" href="#supported-PostgreSQL-topologies"></a>Supported PostgreSQL Topologies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The PostgreSQL connector can be used with a standalone PostgreSQL server or with a cluster of PostgreSQL servers.</p>
</div>
<div class="paragraph">
<p>As mentioned <a href="#limitations">in the beginning</a>, PostgreSQL 9.6 only supports logical replication slots on <code>primary</code> servers. This means that a replica in a PostgreSQL cluster cannot be configured for logical replication, and consequently that the Debezium PostgreSQL Connector can only connect and communicate with the primary server. Should this server fail, the connector will stop. When the cluster is repaired, if the original primary server is once again promoted to <code>primary</code>, the connector can simply be restarted. However, if a different PostgreSQL server <em>with the plugin and proper configuration</em> is promoted to <code>primary</code>, the connector configuration must be changed to point to the new <code>primary</code> server and then can be restarted.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-the-postgresql-connector-works"><a class="anchor" href="#how-the-postgresql-connector-works"></a>How the PostgreSQL connector works</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="snapshots"><a class="anchor" href="#snapshots"></a>Snapshots</h3>
<div class="paragraph">
<p>Most PostgreSQL servers are configured to not retain the complete history of the database in the WAL segments, so the PostgreSQL connector would be unable to see the entire history of the database by simply reading the WAL. So, by default the connector will upon first startup perform an initial <em>consistent snapshot</em> of the database. Each snapshot consists of the following steps (when using the builtin snapshot modes, <strong>custom</strong> snapshot modes may override this):</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start a transaction with a <a href="https://www.postgresql.org/docs/current/static/sql-set-transaction.html">SERIALIZABLE, READ ONLY, DEFERRABLE</a> isolation level to ensure that all subsequent reads within this transaction are done against a single consistent version of the data. Any changes to the data due to subsequent <code>INSERT</code>, <code>UPDATE</code>, and <code>DELETE</code> operations by other clients will not be visible to this transaction.</p>
</li>
<li>
<p>Obtain a <code>SHARE UPDATE EXCLUSIVE MODE</code> lock on each of the monitored tables to ensure that no structural changes can occur to any of the tables while the snapshot is taking place. Note that these locks do not prevent table <code>INSERTS</code>, <code>UPDATES</code> and <code>DELETES</code> from taking place during the operation.  <em>This step is omitted when using the exported snapshot mode to allow for a lock-free snapshots</em>.</p>
</li>
<li>
<p>Read the current position in the server&#8217;s transaction log.</p>
</li>
<li>
<p>Scan all of the database tables and schemas, and generate a <code>READ</code> event for each row and write that event to the appropriate table-specific Kafka topic.</p>
</li>
<li>
<p>Commit the transaction.</p>
</li>
<li>
<p>Record the successful completion of the snapshot in the connector offsets.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the connector fails, is rebalanced, or stops after Step 1 begins but before Step 6 completes, upon restart the connector will begin a new snapshot. Once the connector does complete its initial snapshot, the PostgreSQL connector then continues streaming from the position read during step 3, ensuring that it does not miss any updates. If the connector stops again for any reason, upon restart it will simply continue streaming changes from where it previously left off. However, if the connector remains stopped for long enough, PostgreSQL might purge older WAL segments and the connector&#8217;s last known position may be lost. In this case, when the connector configured with <strong>initial</strong> snapshot mode (the default) is finally restarted, the PostgreSQL server will no longer have the starting point and the connector will not be able to relay the changes that are not available in the write ahead log.</p>
</div>
<div class="paragraph">
<p>A second snapshot mode allows the connector to perform snapshots <strong>always</strong>. This behavior tells the connector to <em>always</em> perform a snapshot when it starts up, and after the snapshot completes to continue streaming changes from step 3 in the above sequence. This mode can be used in cases when it&#8217;s known that some WAL segments have been deleted and are no longer available, or in case of a cluster failure after a new primary has been promoted so that the connector doesn&#8217;t miss out on any potential changes that could&#8217;ve taken place after the new primary had been promoted but before the connector was restarted on the new primary.</p>
</div>
<div class="paragraph">
<p>The third snapshot mode instructs the connector to <strong>never</strong> performs snapshots. When a new connector is configured this way, if will either continue streaming changes from a previous stored offset or it will start from the point in time when the PostgreSQL logical replication slot was first created on the server. Note that this mode is useful only when you know all data of interest is still reflected in the WAL.</p>
</div>
<div class="paragraph">
<p>The fourth snapshot mode, <strong>initial only</strong>, will perform a database snapshot and then stop before streaming any other changes. If the connector had started but did not complete a snapshot before stopping, the connector will restart the snapshot process and stop once the snapshot completes.</p>
</div>
<div class="paragraph">
<p>The fifth snapshot mode, <strong>exported</strong>, will perform a database snapshot based on the point in time when the replication slot was created.  This mode is an excellent way to perform a snapshot in a lock-free way.</p>
</div>
<div class="paragraph">
<p>The final snapshot mode, <strong>custom</strong>, allows the user to inject their own implementation of the <code>io.debezium.connector.postgresql.spi.Snapshotter</code> interface via the <code>snapshot.custom.class</code> configuration property, with the class on the classpath of your Kafka Connect cluster (or included in the JAR if using the <code>EmbeddedEngine</code>). For more details, see the <a href="#custom-snapshot">Custom Snapshot</a> section.</p>
</div>
</div>
<div class="sect2">
<h3 id="custom-snapshot"><a class="anchor" href="#custom-snapshot"></a>Custom Snapshotter SPI</h3>
<div class="paragraph">
<p>For more advanced usages, the user can provide an implementation of the <code>io.debezium.connector.postgresql.spi.Snapshotter</code> interface. This interfaces allows control of most of the aspects of how snapshots operate, such as whether to take a snapshot or not and the way the options used to open the snapshot transaction or take locks.</p>
</div>
<div class="paragraph">
<p>The full API of the interface can be seen here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">**
 * This interface is used to determine details about the snapshot process:
 *
 * Namely:
 * - Should a snapshot occur at all
 * - Should streaming occur
 * - What queries should be used to snapshot
 *
 * While many default snapshot modes are provided with debezium (see documentation for details)
 * a custom implementation of this interface can be provided by the implementor which
 * can provide more advanced functionality, such as partial snapshots
 *
 * Implementor's must return true for either {@link #shouldSnapshot()} or {@link #shouldStream()}
 * or true for both.
 */
@Incubating
public interface Snapshotter {

    void init(PostgresConnectorConfig config, OffsetState sourceInfo,
              SlotState slotState);

    /**
     * @return true if the snapshotter should take a snapshot
     */
    boolean shouldSnapshot();
    /**
     * @return true if the snapshotter should stream after taking a snapshot
     */
    boolean shouldStream();

    /**
     * @return true if when creating a slot, a snapshot should be exported, which
     * can be used as an alternative to taking a lock
     */
    default boolean exportSnapshot() {
        return false;
    }

    /**
     * Generate a valid postgres query string for the specified table, or an empty {@link Optional}
     * to skip snapshotting this table (but that table will still be streamed from)
     *
     * @param tableId the table to generate a query for
     * @return a valid query string, or none to skip snapshotting this table
     */
    Optional&lt;String&gt; buildSnapshotQuery(TableId tableId);

    /**
     * Return a new string that set up the transaction for snapshotting
     *
     * @param newSlotInfo if a new slow was created for snapshotting, this contains information from
     *                    the `create_replication_slot` command
     */
    default String snapshotTransactionIsolationLevelStatement(SlotCreationResult newSlotInfo) {
        // we're using the same isolation level that pg_backup uses
        return "SET TRANSACTION ISOLATION LEVEL SERIALIZABLE, READ ONLY, DEFERRABLE;";
    }

    /**
     * Returns a SQL statement for locking the given tables during snapshotting, if required by the specific snapshotter
     * implementation.
     */
    default Optional&lt;String&gt; snapshotTableLockingStatement(Duration lockTimeout, Set&lt;TableId&gt; tableIds) {
        String lineSeparator = System.lineSeparator();
        StringBuilder statements = new StringBuilder();
        statements.append("SET lock_timeout = ").append(lockTimeout.toMillis()).append(";").append(lineSeparator);
        // we're locking in SHARE UPDATE EXCLUSIVE MODE to avoid concurrent schema changes while we're taking the snapshot
        // this does not prevent writes to the table, but prevents changes to the table's schema....
        // DBZ-298 Quoting name in case it has been quoted originally; it doesn't do harm if it hasn't been quoted
        tableIds.forEach(tableId -&gt; statements.append("LOCK TABLE ")
                .append(tableId.toDoubleQuotedString())
                .append(" IN SHARE UPDATE EXCLUSIVE MODE;")
                .append(lineSeparator));
        return Optional.of(statements.toString());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All of the builtin snapshot modes are implemented in terms of this interface as well.</p>
</div>
</div>
<div class="sect2">
<h3 id="streaming-changes"><a class="anchor" href="#streaming-changes"></a>Streaming Changes</h3>
<div class="paragraph">
<p>The PostgreSQL connector will typically spend the vast majority of its time streaming changes from the PostgreSQL server to which it is connected. This mechanism relies on <a href="https://www.postgresql.org/docs/current/static/protocol-replication.html"><em>PostgreSQL&#8217;s replication protocol</em></a> where the client can receive changes from the server as they are committed in the server&#8217;s transaction log at certain positions (also known as <code>Log Sequence Numbers</code> or in short LSNs).</p>
</div>
<div class="paragraph">
<p>Whenever the server commits a transaction, a separate server process invokes a callback function from the <a href="#output-plugin">logical decoding plugin</a>. This function processes the changes from the transaction, converts them to a specific  format (Protobuf or JSON in the case of Debezium plugin) and writes them on an output stream which can then be consumed by clients.</p>
</div>
<div class="paragraph">
<p>The PostgreSQL connector acts as a PostgreSQL client, and when it receives these changes it transforms the events into Debezium <em>create</em>, <em>update</em>, or <em>delete</em> events that include the LSN position of the event. The PostgreSQL connector forwards these change events to the Kafka Connect framework (running in the same process), which then asynchronously writes them in the same order to the appropriate Kafka topic. Kafka Connect uses the term <em>offset</em> for the source-specific position information that Debezium includes with each event, and Kafka Connect periodically records the most recent offset in another Kafka topic.</p>
</div>
<div class="paragraph">
<p>When Kafka Connect gracefully shuts down, it stops the connectors, flushes all events to Kafka, and records the last offset received from each connector. Upon restart, Kafka Connect reads the last recorded offset for each connector, and starts the connector from that point. The PostgreSQL connector uses the LSN recorded in each change event as the offset, so that upon restart the connector requests the PostgreSQL server send it the events starting just after that position.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The PostgreSQL connector retrieves the schema information as part of the events sent by the logical decoder plug-in.
The only exception is the information about which columns compose the primary key, as this information is obtained from the JDBC metadata (side channel).
If the primary key definition of a table changes (by adding, removing or renaming PK columns),
then there exists a slight risk of an unfortunate timing when the primary key information from JDBC
will not be synchronized with the change data in the logical decoding event and a small amount of messages will be created with an inconsistent key structure.
If this happens then a restart of the connector and a reprocessing of the messages will fix the issue.
To prevent the issue completely it is recommended to synchronize updates to the primary key structure with Debezium roughly using following sequence of operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Put the database or an application into a read-only mode</p>
</li>
<li>
<p>Let Debezium process all remaining events</p>
</li>
<li>
<p>Stop Debezium</p>
</li>
<li>
<p>Update the primary key definition</p>
</li>
<li>
<p>Put the database or the application into read/write state and start Debezium again</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="pgoutput"><a class="anchor" href="#pgoutput"></a>PostgreSQL 10+ Logical Decoding Support (pgoutput)</h3>
<div class="paragraph">
<p>As of PostgreSQL 10+, a new logical replication stream mode was introduced, called <em>pgoutput</em>.  This logical replication stream mode is natively supported by PostgreSQL,
which means that this connector can consume that replication stream
without the need for additional plug-ins being installed.
This is particularly valuable for environments where installation of plug-ins isn&#8217;t supported or allowed.</p>
</div>
<div class="paragraph">
<p>See <a href="#setting-up-PostgreSQL">Setting up PostgreSQL</a> for more details.</p>
</div>
</div>
<div class="sect2">
<h3 id="topic-names"><a class="anchor" href="#topic-names"></a>Topics Names</h3>
<div class="paragraph">
<p>The PostgreSQL connector writes events for all insert, update, and delete operations on a single table to a single Kafka topic. By default, the Kafka topic name is <em>serverName</em>.<em>schemaName</em>.<em>tableName</em> where <em>serverName</em> is the logical name of the connector as specified with the <code>database.server.name</code> configuration property, <em>schemaName</em> is the name of the database schema where the operation occurred, and <em>tableName</em> is the name of the database table on which the operation occurred.</p>
</div>
<div class="paragraph">
<p>For example, consider a PostgreSQL installation with a <code>postgres</code> database and an <code>inventory</code> schema that contains four tables: <code>products</code>, <code>products_on_hand</code>, <code>customers</code>, and <code>orders</code>. If the connector monitoring this database were given a logical server name of <code>fulfillment</code>, then the connector would produce events on these four Kafka topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fulfillment.inventory.products</code></p>
</li>
<li>
<p><code>fulfillment.inventory.products_on_hand</code></p>
</li>
<li>
<p><code>fulfillment.inventory.customers</code></p>
</li>
<li>
<p><code>fulfillment.inventory.orders</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If on the other hand the tables were not part of a specific schema but rather created in the default <code>public</code> PostgreSQL schema, then the name of the Kafka topics would be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fulfillment.public.products</code></p>
</li>
<li>
<p><code>fulfillment.public.products_on_hand</code></p>
</li>
<li>
<p><code>fulfillment.public.customers</code></p>
</li>
<li>
<p><code>fulfillment.public.orders</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="meta-info"><a class="anchor" href="#meta-info"></a>Meta Information</h3>
<div class="paragraph">
<p>Each <code>record</code> produced by the PostgreSQL connector has, in addition to the <a href="#events"><em>database event</em></a>, some meta-information about where the event occurred on the server, the name of the source partition and the name of the Kafka topic and partition where the event should be placed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"sourcePartition": {
     "server": "fulfillment"
 },
 "sourceOffset": {
     "lsn": "24023128",
     "txId": "555",
     "ts_usec": "1482918357011699"
 },
 "kafkaPartition": null</code></pre>
</div>
</div>
<div class="paragraph">
<p>The PostgreSQL connector uses only 1 Kafka Connect <em>partition</em> and it places the generated events into 1 Kafka partition. Therefore, the name of the <code>sourcePartition</code> will always default to the name of the <code>database.server.name</code> configuration property, while the <code>kafkaPartition</code> has the value <code>null</code> which means that the connector does not use a specific Kafka partition.</p>
</div>
<div class="paragraph">
<p>The <code>sourceOffset</code> portion of the message contains information about the location of the server where the event occurred:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>lsn</code> represents the PostgreSQL <a href="https://www.postgresql.org/docs/current/static/datatype-pg-lsn.html"><em>log sequence number</em></a> or <code>offset</code> in the transaction log</p>
</li>
<li>
<p><code>txId</code> represents the identifier of the server transaction which caused the event</p>
</li>
<li>
<p><code>ts_usec</code> represents the number of microseconds since Unix Epoch as the server time at which the transaction was committed</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="events"><a class="anchor" href="#events"></a>Events</h3>
<div class="paragraph">
<p>All data change events produced by the PostgreSQL connector have a key and a value, although the structure of the key and value depend on the table from which the change events originated (see <a href="#topic-names">Topic names</a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Starting with Kafka 0.10, Kafka can optionally record with the message key and value the <a href="http://kafka.apache.org/documentation.html#upgrade_10_performance_impact"><em>timestamp</em></a> at which the message was created (recorded by the producer) or written to the log by Kafka.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Debezium PostgreSQL connector ensures that all Kafka Connect <em>schema names</em> are <a href="http://avro.apache.org/docs/current/spec.html#names">valid Avro schema names</a>. This means that the logical server name must start with Latin letters or an underscore (e.g., [a-z,A-Z,_]), and the remaining characters in the logical server name and all characters in the schema and table names must be Latin letters, digits, or an underscore (e.g., [a-z,A-Z,0-9,\_]). If not, then all invalid characters will automatically be replaced with an underscore character.</p>
</div>
<div class="paragraph">
<p>This can lead to unexpected conflicts when the logical server name, schema names, and table names contain other characters, and the only distinguishing characters between table full names are invalid and thus replaced with underscores.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Debezium and Kafka Connect are designed around <em>continuous streams of event messages</em>, and the structure of these events may change over time. This could be difficult for consumers to deal with, so to make it easy Kafka Connect makes each event self-contained. Every message key and value has two parts: a <em>schema</em> and <em>payload</em>. The schema describes the structure of the payload, while the payload contains the actual data.</p>
</div>
<div class="sect3">
<h4 id="change-events-key"><a class="anchor" href="#change-events-key"></a>Change Event&#8217;s Key</h4>
<div class="paragraph">
<p>For a given table, the change event&#8217;s key will have a structure that contains a field for each column in the primary key (or unique key constraint) of the table at the time the event was created.</p>
</div>
<div class="paragraph">
<p>Consider a <code>customers</code> table defined in the <code>public</code> database schema:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE TABLE customers (
  id SERIAL,
  first_name VARCHAR(255) NOT NULL,
  last_name VARCHAR(255) NOT NULL,
  email VARCHAR(255) NOT NULL,
  PRIMARY KEY(id)
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>database.server.name</code> configuration property has the value <code>PostgreSQL_server</code>, every change event for the <code>customers</code> table while it has this definition will feature the same key structure, which in JSON looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "schema": {
    "type": "struct",
    "name": "PostgreSQL_server.public.customers.Key",
    "optional": false,
    "fields": [
          {
              "name": "id",
              "index": "0",
              "schema": {
                  "type": "INT32",
                  "optional": "false"
              }
          }
      ]
  },
  "payload": {
      "id": "1"
  },
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>schema</code> portion of the key contains a Kafka Connect schema describing what is in the key portion, and in our case that means that the <code>payload</code> value is not optional, is a structure defined by a schema named <code>PostgreSQL_server.public.customers.Key</code>, and has one required field named <code>id</code> of type <code>int32</code>. If we look at the value of the key&#8217;s <code>payload</code> field, we&#8217;ll see that it is indeed a structure (which in JSON is just an object) with a single <code>id</code> field, whose value is <code>1</code>.</p>
</div>
<div class="paragraph">
<p>Therefore, we interpret this key as describing the row in the <code>public.customers</code> table (output from the connector named <code>PostgreSQL_server</code>) whose <code>id</code> primary key column had a value of <code>1</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Although the <code>column.blacklist</code> configuration property allows you to remove columns from the event values, all columns in a primary or unique key are always included in the event&#8217;s key.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the table does not have a primary or unique key, then the change event&#8217;s key will be null. This makes sense since the rows in a table without a primary or unique key constraint cannot be uniquely identified.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="change-events-value"><a class="anchor" href="#change-events-value"></a>Change Event&#8217;s Value</h4>
<div class="paragraph">
<p>The value of the change event message is a bit more complicated. Like the message key, it has a <em>schema</em> section and <em>payload</em> section. The payload section of every change event value produced by the PostgreSQL connector has an <em>envelope</em> structure with the following fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>op</code> is a mandatory field that contains a string value describing the type of operation. Values for the PostgreSQL connector are <code>c</code> for create (or insert), <code>u</code> for update, <code>d</code> for delete, and <code>r</code> for read (in the case of a snapshot).</p>
</li>
<li>
<p><code>before</code> is an optional field that if present contains the state of the row <em>before</em> the event occurred. The structure will  be described by the <code>PostgreSQL_server.public.customers.Value</code> Kafka Connect schema, which the <code>PostgreSQL_server</code> connector uses for all rows in the <code>public.customers</code> table.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Whether or not this field is available is highly dependent on the <a href="#replica-identity"><em>REPLICA IDENTITY</em></a> setting for each table</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><code>after</code> is an optional field that if present contains the state of the row <em>after</em> the event occurred. The structure is described by the same <code>PostgreSQL_server.public.customers.Value</code> Kafka Connect schema used in <code>before</code>.</p>
</li>
<li>
<p><code>source</code> is a mandatory field that contains a structure describing the source metadata for the event, which in the case of PostgreSQL contains several fields: the Debezium version, the connector name, the name of the affected database, schema and table, whether the event is part of an ongoing snapshot or not and the same fields from the record&#8217;s <a href="#meta-info"><em>meta information</em></a> section</p>
</li>
<li>
<p><code>ts_ms</code> is optional and if present contains the time (using the system clock in the JVM running the Kafka Connect task) at which the connector processed the event.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And of course, the <em>schema</em> portion of the event message&#8217;s value contains a schema that describes this envelope structure and the nested fields within it.</p>
</div>
<div class="sect4">
<h5 id="replica-identity"><a class="anchor" href="#replica-identity"></a>Replica Identity</h5>
<div class="paragraph">
<p><a href="https://www.postgresql.org/docs/current/static/sql-altertable.html#SQL-CREATETABLE-REPLICA-IDENTITY">REPLICA IDENTITY</a> is a PostgreSQL specific table-level setting which determines the amount of information that is available to <code>logical decoding</code> in case of <code>UPDATE</code> and <code>DELETE</code> events. More specifically, this controls what (if any) information is available regarding the previous values of the table columns involved, whenever one of the aforementioned events occur.</p>
</div>
<div class="paragraph">
<p>There are 4 possible values for <code>REPLICA IDENTITY</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DEFAULT - <code>UPDATE</code> and <code>DELETE</code> events will only contain the previous values for the primary key columns of a table</p>
</li>
<li>
<p>NOTHING - <code>UPDATE</code> and <code>DELETE</code> events will not contain any information about the previous value on any of the table columns</p>
</li>
<li>
<p>FULL - <code>UPDATE</code> and <code>DELETE</code> events will contain the previous values of all the table&#8217;s columns</p>
</li>
<li>
<p>INDEX <code>index name</code> - <code>UPDATE</code> and <code>DELETE</code> events will contain the previous values of the columns contained in the index definition named <code>index name</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="create-events"><a class="anchor" href="#create-events"></a>Create Events</h5>
<div class="paragraph">
<p>Let&#8217;s look at what a <em>create</em> event value might look like for our <code>customers</code> table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "schema": {
        "type": "struct",
        "fields": [
            {
                "type": "struct",
                "fields": [
                    {
                        "type": "int32",
                        "optional": false,
                        "field": "id"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "first_name"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "last_name"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "email"
                    }
                ],
                "optional": true,
                "name": "PostgreSQL_server.inventory.customers.Value",
                "field": "before"
            },
            {
                "type": "struct",
                "fields": [
                    {
                        "type": "int32",
                        "optional": false,
                        "field": "id"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "first_name"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "last_name"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "email"
                    }
                ],
                "optional": true,
                "name": "PostgreSQL_server.inventory.customers.Value",
                "field": "after"
            },
            {
                "type": "struct",
                "fields": [
                    {
                        "type": "string",
                        "optional": false,
                        "field": "version"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "connector"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "name"
                    },
                    {
                        "type": "int64",
                        "optional": false,
                        "field": "ts_ms"
                    },
                    {
                        "type": "boolean",
                        "optional": true,
                        "default": false,
                        "field": "snapshot"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "db"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "schema"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "table"
                    },
                    {
                        "type": "int64",
                        "optional": true,
                        "field": "txId"
                    },
                    {
                        "type": "int64",
                        "optional": true,
                        "field": "lsn"
                    },
                    {
                        "type": "int64",
                        "optional": true,
                        "field": "xmin"
                    }
                ],
                "optional": false,
                "name": "io.debezium.connector.postgresql.Source",
                "field": "source"
            },
            {
                "type": "string",
                "optional": false,
                "field": "op"
            },
            {
                "type": "int64",
                "optional": true,
                "field": "ts_ms"
            }
        ],
        "optional": false,
        "name": "PostgreSQL_server.inventory.customers.Envelope"
    },
    "payload": {
        "before": null,
        "after": {
            "id": 1,
            "first_name": "Anne",
            "last_name": "Kretchmar",
            "email": "annek@noanswer.org"
        },
        "source": {
            "version": "0.10.0.Final",
            "connector": "postgresql",
            "name": "PostgreSQL_server",
            "ts_ms": 1559033904863,
            "snapshot": true,
            "db": "postgres",
            "schema": "public",
            "table": "customers",
            "txId": 555,
            "lsn": 24023128,
            "xmin": null
        },
        "op": "c",
        "ts_ms": 1559033904863
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we look at the <code>schema</code> portion of this event&#8217;s <em>value</em>, we can see the schema for the <em>envelope</em>, the schema for the <code>source</code> structure (which is specific to the PostgreSQL connector and reused across all events), and the table-specific schemas for the <code>before</code> and <code>after</code> fields.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The names of the schemas for the <code>before</code> and <code>after</code> fields are of the form <em>logicalName</em>.<em>schemaName</em>.<em>tableName</em>.Value, and thus are entirely independent from all other schemas for all other tables. This means that when using the <a href="/docs/faq/#avro-converter">Avro Converter</a>, the resulting Avro schemas for <em>each table</em> in each <em>logical source</em> have their own evolution and history.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If we look at the <code>payload</code> portion of this event&#8217;s <em>value</em>, we can see the information in the event, namely that it is describing that the row was created (since <code>op=c</code>), and that the <code>after</code> field value contains the values of the new inserted row&#8217;s' <code>id</code>, <code>first_name</code>, <code>last_name</code>, and <code>email</code> columns.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It may appear that the JSON representations of the events are much larger than the rows they describe. This is true, because the JSON representation must include the <em>schema</em> and the <em>payload</em> portions of the message. It is possible and even recommended to use the <a href="/docs/faq/#avro-converter">Avro Converter</a> to dramatically decrease the size of the actual messages written to the Kafka topics.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="update-events"><a class="anchor" href="#update-events"></a>Update Events</h5>
<div class="paragraph">
<p>The value of an <em>update</em> change event on this table will actually have the exact same <em>schema</em>, and its payload will be structured the same but will hold different values. Here&#8217;s an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "schema": { ... },
    "payload": {
        "before": {
            "id": 1
        },
        "after": {
            "id": 1,
            "first_name": "Anne Marie",
            "last_name": "Kretchmar",
            "email": "annek@noanswer.org"
        },
        "source": {
            "version": "0.10.0.Final",
            "connector": "postgresql",
            "name": "PostgreSQL_server",
            "ts_ms": 1559033904863,
            "snapshot": null,
            "db": "postgres",
            "schema": "public",
            "table": "customers",
            "txId": 556,
            "lsn": 24023128,
            "xmin": null
        },
        "op": "u",
        "ts_ms": 1465584025523
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we compare this to the value in the <em>insert</em> event, we see a couple of differences in the <code>payload</code> section:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>op</code> field value is now <code>u</code>, signifying that this row changed because of an update</p>
</li>
<li>
<p>The <code>before</code> field now has the state of the row with the values before the database commit, but only for the primary key column <code>id</code>. This is because the  <a href="#replica-identity"><em>REPLICA IDENTITY</em></a> which is by default <code>DEFAULT</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Should we want to see the previous values of all the columns for the row, we would have to change the <code>customers</code> table first by running
<code>ALTER TABLE customers REPLICA IDENTITY FULL</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>after</code> field now has the updated state of the row, and here was can see that the <code>first_name</code> value is now <code>Anne Marie</code>.</p>
</li>
<li>
<p>The <code>source</code> field structure has the same fields as before, but the values are different since this event is from a different position in the WAL.</p>
</li>
<li>
<p>The <code>ts_ms</code> shows the timestamp that Debezium processed this event.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are several things we can learn by just looking at this <code>payload</code> section. We can compare the <code>before</code> and <code>after</code> structures to determine what actually changed in this row because of the commit. The <code>source</code> structure tells us information about PostgreSQL&#8217;s record of this change (providing traceability), but more importantly this has information we can compare to other events in this and other topics to know whether this event occurred before, after, or as part of the same PostgreSQL commit as other events.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When the columns for a row&#8217;s primary/unique key are updated, the value of the row&#8217;s key has changed so Debezium will output <em>three</em> events: a <code>DELETE</code> event and <a href="#tombstone-events">tombstone event</a> with the old key for the row, followed by an <code>INSERT</code> event with the new key for the row.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="delete-events"><a class="anchor" href="#delete-events"></a>Delete Events</h5>
<div class="paragraph">
<p>So far we&#8217;ve seen samples of <em>create</em> and <em>update</em> events. Now, let&#8217;s look at the value of a <em>delete</em> event for the same table. Once again, the <code>schema</code> portion of the value will be exactly the same as with the <em>create</em> and <em>update</em> events:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "schema": { ... },
    "payload": {
        "before": {
            "id": 1
        },
        "after": null,
        "source": {
            "version": "0.10.0.Final",
            "connector": "postgresql",
            "name": "PostgreSQL_server",
            "ts_ms": 1559033904863,
            "snapshot": null,
            "db": "postgres",
            "schema": "public",
            "table": "customers",
            "txId": 556,
            "lsn": 46523128,
            "xmin": null
        },
        "op": "d",
        "ts_ms": 1465581902461
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we look at the <code>payload</code> portion, we see a number of differences compared with the <em>create</em> or <em>update</em> event payloads:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>op</code> field value is now <code>d</code>, signifying that this row was deleted</p>
</li>
<li>
<p>The <code>before</code> field now has the state of the row that was deleted with the database commit. Again this only contains the primary key column due to the <a href="#replica-identity"><em>REPLICA IDENTITY</em></a> setting</p>
</li>
<li>
<p>The <code>after</code> field is null, signifying that the row no longer exists</p>
</li>
<li>
<p>The <code>source</code> field structure has many of the same values as before, except the <code>ts_usec</code>, <code>lsn</code> and <code>txId</code> fields have changed</p>
</li>
<li>
<p>The <code>ts_ms</code> shows the timestamp that Debezium processed this event.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This event gives a consumer all kinds of information that it can use to process the removal of this row.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Please pay attention to the tables without PK, any delete messages from such table with REPLICA IDENTITY DEFAULT will have no <code>before</code> part (because they have no PK which is the only field for the default identity level) and therefore will be skipped as totally empty.
To be able to process messages from tables without PK set REPLICA IDENTITY to FULL level.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The PostgreSQL connector&#8217;s events are designed to work with <a href="https://cwiki.apache.org/confluence/display/KAFKA/Log+Compaction">Kafka log compaction</a>, which allows for the removal of some older messages as long as at least the most recent message for every key is kept. This allows Kafka to reclaim storage space while ensuring the topic contains a complete dataset and can be used for reloading key-based state.</p>
</div>
<div id="tombstone-events" class="paragraph">
<p>When a row is deleted, the <em>delete</em> event value listed above still works with log compaction, since Kafka can still remove all earlier messages with that same key. But only if the message value is <code>null</code> will Kafka know that it can remove <em>all messages</em> with that same key. To make this possible, Debezium&#8217;s PostgreSQL connector always follows the <em>delete</em> event with a special <em>tombstone</em> event that has the same key but <code>null</code> value.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="data-types"><a class="anchor" href="#data-types"></a>Data Types</h3>
<div class="paragraph">
<p>As described above, the PostgreSQL connector represents the changes to rows with events that are structured like the table in which the row exist. The event contains a field for each column value, and how that value is represented in the event depends on the PostgreSQL data type of the column. This section describes this mapping.</p>
</div>
<div class="paragraph">
<p>The following table describes how the connector maps each of the PostgreSQL data types to a <em>literal type</em> and <em>semantic type</em> within the events' fields.</p>
</div>
<div class="paragraph">
<p>Here, the <em>literal type</em> describes how the value is literally represented using Kafka Connect schema types, namely <code>INT8</code>, <code>INT16</code>, <code>INT32</code>, <code>INT64</code>, <code>FLOAT32</code>, <code>FLOAT64</code>, <code>BOOLEAN</code>, <code>STRING</code>, <code>BYTES</code>, <code>ARRAY</code>, <code>MAP</code>, and <code>STRUCT</code>.</p>
</div>
<div class="paragraph">
<p>The <em>semantic type</em> describes how the Kafka Connect schema captures the <em>meaning</em> of the field using the name of the Kafka Connect schema for the field.</p>
</div>
<table class="tableblock frame-all grid-all stretch table table-bordered table-striped">
<colgroup>
<col style="width: 20%;">
<col style="width: 15%;">
<col style="width: 30%;">
<col style="width: 35%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PostgreSQL Data Type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name)</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BOOLEAN</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BOOLEAN</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BIT(1)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BOOLEAN</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BIT( &gt; 1)</code>, <code>BIT VARYING[(M)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.Bits</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The <code>length</code> schema parameter contains an integer representing the number of bits. The resulting <code>byte[]</code> will contain the bits in little-endian form and will be sized to contain at least the specified number of bits (e.g., <code>numBytes = n/8 + (n%8== 0 ? 0 : 1)</code> where <code>n</code> is the number of bits).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>SMALLINT</code>, <code>SMALLSERIAL</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT16</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INTEGER</code>, <code>SERIAL</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BIGINT</code>, <code>BIGSERIAL</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>REAL</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>FLOAT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DOUBLE PRECISION</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>FLOAT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>CHAR[(M)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>VARCHAR[(M)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>CHARACTER[(M)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>CHARACTER VARYING[(M)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIMESTAMPTZ</code>, <code>TIMESTAMP WITH TIME ZONE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.ZonedTimestamp</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A string representation of a timestamp with timezone information, where the timezone is GMT</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIMETZ</code>, <code>TIME WITH TIME ZONE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.ZonedTime</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A string representation of a time value with timezone information, where the timezone is GMT</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INTERVAL [P]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.MicroDuration</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The approximate number of microseconds for a time interval using the <code>365.25 / 12.0</code> formula for days per month average</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTEA</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>JSON</code>, <code>JSONB</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.Json</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Contains the string representation of a JSON document, array, or scalar.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>XML</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.Xml</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Contains the string representation of an XML document</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>UUID</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.Uuid</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Contains the string representation of a PostgreSQL UUID value</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>POINT</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRUCT</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.geometry.Point</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Contains a structure with 2 <code>FLOAT64</code> fields - <code>(x,y)</code> - each representing the coordinates of a geometric point</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>CITEXT</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INET</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT4RANGE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Range of integer</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT8RANGE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Range of bigint</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>NUMRANGE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Range of numeric</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TSRANGE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Contains the string representation of timestamp range without time zone.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TSTZRANGE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Contains the string representation of a timestamp range with (local system) time zone.</p>
</div></div></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DATERANGE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Contains the string representation of a date range. It always has an exclusive upper-bound.</p>
</div></div></td>
</tr>
</tfoot>
</table>
<div class="paragraph">
<p>Other data type mappings are described in the following sections.</p>
</div>
<div class="sect3">
<h4 id="temporal-values"><a class="anchor" href="#temporal-values"></a>Temporal Values</h4>
<div class="paragraph">
<p>Other than PostgreSQL&#8217;s <code>TIMESTAMPTZ</code> and <code>TIMETZ</code> data types (which contain time zone information), the other temporal types depend on the value of the <code>time.precision.mode</code> configuration property.  When the <code>time.precision.mode</code> configuration property is set to <code>adaptive</code> (the default), then the connector will determine the literal type and semantic type for the temporal types based on the column&#8217;s data type definition so that events <em>exactly</em> represent the values in the database:</p>
</div>
<table class="tableblock frame-all grid-all stretch table table-bordered table-striped">
<colgroup>
<col style="width: 20%;">
<col style="width: 15%;">
<col style="width: 30%;">
<col style="width: 35%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PostgreSQL Data Type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name)</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DATE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.Date</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Represents the number of days since epoch.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIME(1)</code>, <code>TIME(2)</code>, <code>TIME(3)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.Time</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Represents the number of milliseconds past midnight, and does not include timezone information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIME(4)</code>, <code>TIME(5)</code>, <code>TIME(6)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.MicroTime</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Represents the number of microseconds past midnight, and does not include timezone information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIMESTAMP(1)</code>, <code>TIMESTAMP(2)</code>, <code>TIMESTAMP(3)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.Timestamp</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Represents the number of milliseconds past epoch, and does not include timezone information.</p>
</div></div></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIMESTAMP(4)</code>, <code>TIMESTAMP(5)</code>, <code>TIMESTAMP(6)</code>, <code>TIMESTAMP</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.MicroTimestamp</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Represents the number of microseconds past epoch, and does not include timezone information.</p>
</div></div></td>
</tr>
</tfoot>
</table>
<div class="paragraph">
<p>When the <code>time.precision.mode</code> configuration property is set to <code>adaptive_time_microseconds</code>, then the connector will determine the literal type and semantic type for the temporal types based on the column&#8217;s data type definition so that events <em>exactly</em> represent the values in the database, except that all TIME fields will be captured as microseconds:</p>
</div>
<table class="tableblock frame-all grid-all stretch table table-bordered table-striped">
<colgroup>
<col style="width: 20%;">
<col style="width: 15%;">
<col style="width: 30%;">
<col style="width: 35%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PostgreSQL Data Type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name)</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DATE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.Date</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Represents the number of days since epoch.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIME([P])</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.MicroTime</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Represents the time value in microseconds and does not include timezone information. PostgreSQL allows precision <code>P</code> to be in the range 0-6 to store up to microsecond precision.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIMESTAMP(1)</code> , <code>TIMESTAMP(2)</code>, <code>TIMESTAMP(3)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.Timestamp</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Represents the number of milliseconds past epoch, and does not include timezone information.</p>
</div></div></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIMESTAMP(4)</code> , <code>TIMESTAMP(5)</code>, <code>TIMESTAMP(6)</code>, <code>TIMESTAMP</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.MicroTimestamp</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Represents the number of microseconds past epoch, and does not include timezone information.</p>
</div></div></td>
</tr>
</tfoot>
</table>
<div class="paragraph">
<p>When the <code>time.precision.mode</code> configuration property is set to <code>connect</code>, then the connector will use the predefined Kafka Connect logical types. This may be useful when consumers only know about the built-in Kafka Connect logical types and are unable to handle variable-precision time values. On the other hand, since PostgreSQL supports microsecond precision, the events generated by a connector with the <code>connect</code> time precision mode will <strong>result in a loss of precision</strong> when the database column has a <em>fractional second precision</em> value greater than 3:</p>
</div>
<table class="tableblock frame-all grid-all stretch table table-bordered table-striped">
<colgroup>
<col style="width: 20%;">
<col style="width: 15%;">
<col style="width: 30%;">
<col style="width: 35%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PostgreSQL Data Type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name)</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DATE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Date</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Represents the number of days since epoch.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIME([P])</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Time</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Represents the number of milliseconds since midnight, and does not include timezone information. PostgreSQL allows <code>P</code> to be in the range 0-6 to store up to microsecond precision, though this mode results in a loss of precision when <code>P</code> &gt; 3.</p>
</div></div></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIMESTAMP([P])</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Timestamp</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Represents the number of milliseconds since epoch, and does not include timezone information. PostgreSQL allows <code>P</code> to be in the range 0-6 to store up to microsecond precision, though this mode results in a loss of precision when <code>P</code> &gt; 3.</p>
</div></div></td>
</tr>
</tfoot>
</table>
<div class="sect4">
<h5 id="timestamp-values"><a class="anchor" href="#timestamp-values"></a><code>TIMESTAMP</code> values</h5>
<div class="paragraph">
<p>The <code>TIMESTAMP</code> type represents a timestamp without time zone information.
Such columns are converted into an equivalent Kafka Connect value based on UTC.
So for instance the <code>TIMESTAMP</code> value "2018-06-20 15:13:16.945104" will be represented by a <code>io.debezium.time.MicroTimestamp</code> with the value "1529507596945104"
(assuming <code>time.precision.mode</code> is not set to <code>connect</code>).</p>
</div>
<div class="paragraph">
<p>Note that the timezone of the JVM running Kafka Connect and Debezium does not affect this conversion.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="decimal-values"><a class="anchor" href="#decimal-values"></a>Decimal Values</h4>
<div class="paragraph">
<p>When <code>decimal.handling.mode</code> configuration property is set to <code>precise</code>, then the connector will use the predefined Kafka Connect <code>org.apache.kafka.connect.data.Decimal</code> logical type for all <code>DECIMAL</code> and <code>NUMERIC</code> columns. This is the default mode.</p>
</div>
<table class="tableblock frame-all grid-all stretch table table-bordered table-striped">
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 35%;">
<col style="width: 35%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PostgreSQL Data Type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name)</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>NUMERIC[(M[,D])]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Decimal</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The <code>scaled</code> schema parameter contains an integer representing how many digits the decimal point was shifted.</p>
</div></div></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DECIMAL[(M[,D])]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Decimal</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The <code>scaled</code> schema parameter contains an integer representing how many digits the decimal point was shifted.</p>
</div></div></td>
</tr>
</tfoot>
</table>
<div class="paragraph">
<p>There is an exception to this rule.
When the <code>NUMERIC</code> or <code>DECIMAL</code> types are used without any scale constraints then it means that the values coming from the database have a different (variable) scale for each value.
In this case a type <code>io.debezium.data.VariableScaleDecimal</code> is used and it contains both value and scale of the transferred value.</p>
</div>
<table class="tableblock frame-all grid-all stretch table table-bordered table-striped">
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 35%;">
<col style="width: 35%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PostgreSQL Data Type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name)</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>NUMERIC</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRUCT</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.VariableScaleDecimal</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Contains a structure with two fields: <code>scale</code> of type <code>INT32</code> that contains the scale of the transferred value and <code>value</code> of type <code>BYTES</code> containing the original value in an unscaled form.</p>
</div></div></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DECIMAL</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRUCT</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.VariableScaleDecimal</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Contains a structure with two fields: <code>scale</code> of type <code>INT32</code> that contains the scale of the transferred value and <code>value</code> of type <code>BYTES</code> containing the original value in an unscaled form.</p>
</div></div></td>
</tr>
</tfoot>
</table>
<div class="paragraph">
<p>However, when <code>decimal.handling.mode</code> configuration property is set to <code>double</code>, then the connector will represent all <code>DECIMAL</code> and <code>NUMERIC</code> values as Java double values and encodes them as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch table table-bordered table-striped">
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 35%;">
<col style="width: 35%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PostgreSQL Data Type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name)</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>NUMERIC[(M[,D])]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>FLOAT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DECIMAL[(M[,D])]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>FLOAT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
</tfoot>
</table>
<div class="paragraph">
<p>The last option for <code>decimal.handling.mode</code> configuration property is <code>string</code>. In this case the connector will represent all <code>DECIMAL</code> and <code>NUMERIC</code> values as their formatted string representation and encodes them as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch table table-bordered table-striped">
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 35%;">
<col style="width: 35%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PostgreSQL Data Type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name)</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>NUMERIC[(M[,D])]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DECIMAL[(M[,D])]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
</tfoot>
</table>
<div class="paragraph">
<p>PostgreSQL supports <code>NaN</code> (not a number) special value to be stored in the <code>DECIMAL</code>/<code>NUMERIC</code> values. Only <code>string</code> and <code>double</code> modes are able to handle such values encoding them as either <code>Double.NaN</code> or string constant <code>NAN</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="hstore-values"><a class="anchor" href="#hstore-values"></a>HStore Values</h4>
<div class="paragraph">
<p>When <code>hstore.handling.mode</code> configuration property is set to <code>map</code>, then the connector will use the <code>java.util.Map&lt;String,String&gt;</code> logical type, <code>MAP</code> schema type for all <code>HSTORE</code> columns. This is the default mode.</p>
</div>
<table class="tableblock frame-all grid-all stretch table table-bordered table-striped">
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 35%;">
<col style="width: 35%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PostgreSQL Data Type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name)</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>HSTORE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>MAP</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
</tfoot>
</table>
<div class="paragraph">
<p>However, when <code>hstore.handling.mode</code> configuration property is set to <code>json</code>, then the connector will represent all <code>HSTORE</code> values as JSON String values and encodes them as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch table table-bordered table-striped">
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 35%;">
<col style="width: 35%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PostgreSQL Data Type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name)</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>HSTORE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.Json</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Example: Output representation is "{"key":"val"}"</p>
</div></div></td>
</tr>
</tfoot>
</table>
</div>
<div class="sect3">
<h4 id="network-address-types"><a class="anchor" href="#network-address-types"></a>Network Address Types</h4>
<div class="paragraph">
<p>PostgreSQL also have data types that can store IPv4, IPv6, and MAC addresses. It is better to use these instead of plain text types to store network addresses, because these types offer input error checking and specialized operators and functions.</p>
</div>
<table class="tableblock frame-all grid-all stretch table table-bordered table-striped">
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 35%;">
<col style="width: 35%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PostgreSQL Data Type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name)</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INET</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IPv4 and IPv6 networks</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>CIDR</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IPv4 and IPv6 hosts and networks</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>MACADDR</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>MAC addresses</p>
</div></div></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>MACADDR8</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>MAC addresses in EUI-64 format</p>
</div></div></td>
</tr>
</tfoot>
</table>
</div>
<div class="sect3">
<h4 id="_postgis_types"><a class="anchor" href="#_postgis_types"></a>PostGIS Types</h4>
<div class="paragraph">
<p>The PostgreSQL connector also has full support for all of the <a href="http://postgis.net">PostGIS data types</a></p>
</div>
<table class="tableblock frame-all grid-all stretch table table-bordered table-striped">
<colgroup>
<col style="width: 20%;">
<col style="width: 15%;">
<col style="width: 30%;">
<col style="width: 35%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PostGIS Data Type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name)</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>GEOMETRY</code><br>
(planar)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRUCT</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.geometry.Geometry</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Contains a structure with 2 fields<br></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>srid (INT32)</code> - Spatial Reference System Identifier defining what type of geometry object is stored in the structure</p>
</li>
<li>
<p><code>wkb (BYTES)</code> - a binary representation of the geometry object encoded in the Well-Known-Binary format.
Please see <a href="http://www.opengeospatial.org/standards/sfa">Open Geospatial Consortium Simple Features Access specification</a> for the format details.</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>GEOGRAPHY</code><br>
(spherical)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRUCT</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.geometry.Geography</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Contains a structure with 2 fields<br></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>srid (INT32)</code> - Spatial Reference System Identifier defining what type of geography object is stored in the structure</p>
</li>
<li>
<p><code>wkb (BYTES)</code> - a binary representation of the geometry object encoded in the Well-Known-Binary format.
Please see <a href="http://www.opengeospatial.org/standards/sfa">Open Geospatial Consortium Simple Features Access specification</a> for the format details.</p>
</li>
</ul>
</div></div></td>
</tr>
</tfoot>
</table>
</div>
<div class="sect3">
<h4 id="toasted-values"><a class="anchor" href="#toasted-values"></a>Toasted values</h4>
<div class="paragraph">
<p>PostgreSQL has a hard limit on the page size.
This means that values larger than ca. 8 KB need to be stored using <a href="https://www.postgresql.org/docs/current/storage-toast.html">TOAST storage</a>.
This impacts replication messages coming from database, as the values that were stored using the TOAST mechanism and have not been changed are not included in the message, unless they are part of the table&#8217;s replica identity.
There is no safe way for Debezium to read the missing value out-of-bands directly from database, as this would lead into race conditions potentially.
Debezium thus follows these rules to handle the toasted values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>tables with <code>REPLICA IDENTITY FULL</code>: TOAST column values are part of the <code>before</code> and <code>after</code> blocks of change events as any other column</p>
</li>
<li>
<p>tables with <code>REPLICA IDENTITY DEFAULT</code>: when receiving an <code>UPDATE</code> event from the database,
any unchanged TOAST column value which is not part of the replica identity will not be part of that event;
similarly, when receiving a <code>DELETE</code> event, any such TOAST column will not be part of the <code>before</code> block.
As Debezium cannot safely provide the column value in this case, it returns a placeholder value defined in configuration option <code>toasted.value.placeholder</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There is a specific problem related to Amazon RDS instances.
<code>wal2json</code> plugin has evolved over the time and there were releases that provided out-of-band toasted values.
Amazon supports different versions of the plugin for different PostgreSQL versions.
Please consult Amazon&#8217;s <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_PostgreSQL.html">documentation</a> to obtain version to version mapping.
For consistent toasted values handling we recommend to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>use <code>pgoutput</code> plugin for PostgreSQL 10+ instances</p>
</li>
<li>
<p>set <code>include-unchanged-toast=0</code> for older versions of <code>wal2json</code> plugin using <code>slot.stream.params</code> configuration option</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="when-things-go-wrong"><a class="anchor" href="#when-things-go-wrong"></a>When Things Go Wrong</h3>
<div class="paragraph">
<p>Debezium is a distributed system that captures all changes in multiple upstream databases, and will never miss or lose an event. Of course, when the system is operating nominally or being administered carefully, then Debezium provides <em>exactly once</em> delivery of every change event. However, if a fault does happen then the system will still not lose any events, although while it is recovering from the fault it may repeat some change events. Thus, in these abnormal situations Debezium (like Kafka) provides <em>at least once</em> delivery of change events.</p>
</div>
<div class="paragraph">
<p>The rest of this section describes how Debezium handles various kinds of faults and problems.</p>
</div>
<div class="sect3">
<h4 id="_configuration_and_startup_errors"><a class="anchor" href="#_configuration_and_startup_errors"></a>Configuration and Startup Errors</h4>
<div class="paragraph">
<p>The connector will fail upon startup, report an error/exception in the log, and stop running when the connector&#8217;s configuration is invalid, when the connector cannot successfully connect to PostgreSQL using the specified connectivity parameters, or when the connector is restarting from a previously-recorded position in the PostgreSQL WAL (via the LSN value) and PostgreSQL no longer has that history available.</p>
</div>
<div class="paragraph">
<p>In these cases, the error will have more details about the problem and possibly a suggested work around. The connector can be restarted when the configuration has been corrected or the PostgreSQL problem has been addressed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_postgresql_becomes_unavailable"><a class="anchor" href="#_postgresql_becomes_unavailable"></a>PostgreSQL Becomes Unavailable</h4>
<div class="paragraph">
<p>Once the connector is running, if the PostgreSQL server it has been connected to becomes unavailable for any reason, the connector will fail with an error and the connector will stop. Simply restart the connector when the server is available.</p>
</div>
<div class="paragraph">
<p>The PostgreSQL connector stores externally the last processed offset (in the form of a PostgreSQL <code>log sequence number</code> value). Once a connector is restarted and connects to a server instance, if it has a previously stored offset it will ask the server to continue streaming from that particular offset. However, depending on the server configuration, this particular offset may or may not be available in the server&#8217;s write-ahead log segments. If it is available, then the connector will simply resume streaming changes without missing anything. If however this information is not available, the connector cannot relay back the changes that occurred while it was not online.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cluster_failures"><a class="anchor" href="#_cluster_failures"></a>Cluster Failures</h4>
<div class="paragraph">
<p>As of <code>9.6</code>, PostgreSQL allows logical replication slots <em>only on primary servers</em>, which means that a PostgreSQL connector can only be pointed to the active <code>primary</code> of a database cluster. If this machine goes down, only after a new <code>primary</code> has been promoted (with the <a href="#output-plugin">logical decoding plugin</a> installed) can the connector be restarted and pointed to the new server.</p>
</div>
<div class="paragraph">
<p>One potential issue with this is that if there&#8217;s a <em>large enough delay</em> between the new server&#8217;s promotion and the installation of the plugin together with the restart of the connector, the PostgreSQL server may have removed some WAL information. If this happens, the connector will miss out on all the changes that took place <em>after the election of the new primary</em> and <em>before the restart of the connector</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There are discussions in the PostgreSQL community around a feature called <code>failover slots</code> which would help mitigate this problem, but as of <code>9.6</code> they have not been implemented yet. You can find out more about this particular issue from <a href="http://blog.2ndquadrant.com/failover-slots-postgresql">this blog post</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_kafka_connect_process_stops_gracefully"><a class="anchor" href="#_kafka_connect_process_stops_gracefully"></a>Kafka Connect Process Stops Gracefully</h4>
<div class="paragraph">
<p>If Kafka Connect is being run in distributed mode, and a Kafka Connect process is stopped gracefully, then prior to shutdown of that processes Kafka Connect will migrate all of the process' connector tasks to another Kafka Connect process in that group, and the new connector tasks will pick up exactly where the prior tasks left off. There will be a short delay in processing while the connector tasks are stopped gracefully and restarted on the new processes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kafka_connect_process_crashes"><a class="anchor" href="#_kafka_connect_process_crashes"></a>Kafka Connect Process Crashes</h4>
<div class="paragraph">
<p>If the Kafka Connector process stops unexpectedly, then any connector tasks it was running will obviously terminate without recording their most recently-processed offsets. When Kafka Connect is being run in distributed mode, it will restart those connector tasks on other processes. However, the PostgreSQL connectors will resume from the last offset <em>recorded</em> by the earlier processes, which means that the new replacement tasks may generate some of the same change events that were processed just prior to the crash. The number of duplicate events will depend on the offset flush period and the volume of data changes just before the crash.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because there is a chance that some events may be duplicated during a recovery from failure, consumers should always anticipate some events may be duplicated. Debezium change are idempotent, so a sequence of events always results in the same state.</p>
</div>
<div class="paragraph">
<p>Debezium also includes with each change event message the source-specific information about the origin of the event, including the PostgreSQL server&#8217;s time of the event, the id of the server transaction and the position in the write-ahead log where the transaction changes were written. Consumers can keep track of this information (especially the LSN position) to know whether they have already seen a particular event.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_kafka_becomes_unavailable"><a class="anchor" href="#_kafka_becomes_unavailable"></a>Kafka Becomes Unavailable</h4>
<div class="paragraph">
<p>As the connector generates change events, the Kafka Connect framework records those events in Kafka using the Kafka producer API. Kafka Connect will also periodically record the latest offset that appears in those change events, at a frequency you&#8217;ve specified in the Kafka Connect worker configuration. If the Kafka brokers become unavailable, the Kafka Connect worker process running the connectors will simply repeatedly attempt to reconnect to the Kafka brokers. In other words, the connector tasks will simply pause until a connection can be re-established, at which point the connectors will resume exactly where they left off.</p>
</div>
</div>
<div class="sect3">
<h4 id="_connector_is_stopped_for_a_duration"><a class="anchor" href="#_connector_is_stopped_for_a_duration"></a>Connector Is Stopped for a Duration</h4>
<div class="paragraph">
<p>If the connector is gracefully stopped, the database can continue to be used and any new changes will be recorded in the PostgreSQL WAL. When the connector is restarted, it will resume streaming changes where it last left off, recording change events for all of the changes that were made while the connector was stopped.</p>
</div>
<div class="paragraph">
<p>A properly configured Kafka cluster is able to <a href="https://engineering.linkedin.com/kafka/benchmarking-apache-kafka-2-million-writes-second-three-cheap-machines">massive throughput</a>. Kafka Connect is written with Kafka best practices, and given enough resources will also be able to handle very large numbers of database change events. Because of this, when a connector has been restarted after a while, it is very likely to catch up with the database, though how quickly will depend upon the capabilities and performance of Kafka and the volume of changes being made to the data in PostgreSQL.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the connector remains stopped for long enough, PostgreSQL might purge older WAL segments and the connector&#8217;s last known position may be lost. In this case, when the connector configured with <em>initial</em> snapshot mode (the default) is finally restarted, the PostgreSQL server will no longer have the starting point and the connector will perform an initial snapshot. On the other hand, if the connector&#8217;s snapshot mode is disabled, then the connector will fail with an error.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploying-a-connector"><a class="anchor" href="#deploying-a-connector"></a>Deploying a Connector</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you&#8217;ve already installed <a href="https://zookeeper.apache.org">Zookeeper</a>, <a href="http://kafka.apache.org/">Kafka</a>, and <a href="http://kafka.apache.org/documentation.html#connect">Kafka Connect</a>, then using Debezium&#8217;s PostgreSQL connector is easy. Simply download the <a href="https://repo1.maven.org/maven2/io/debezium/debezium-connector-postgres/0.10.0.Final/debezium-connector-postgres-0.10.0.Final-plugin.tar.gz">connector&#8217;s plugin archive</a>, extract the JARs into your Kafka Connect environment, and add the directory with the JARs to <a href="http://docs.confluent.io/5.1.2/connect/userguide.html#installing-plugins">Kafka Connect&#8217;s classpath</a>. Restart your Kafka Connect process to pick up the new JARs.</p>
</div>
<div class="paragraph">
<p>If immutable containers are your thing, then check out <a href="https://hub.docker.com/r/debezium/">Debezium&#8217;s Docker images</a> for Zookeeper, Kafka, PostgreSQL and Kafka Connect with the PostgreSQL connector already pre-installed and ready to go.  You can even <a href="/blog/2016/05/31/Debezium-on-Kubernetes/">run Debezium on Kubernetes and OpenShift</a>.</p>
</div>
<div class="paragraph">
<p>To use the connector to produce change events for a particular PostgreSQL server or cluster:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>install the <a href="#output-plugin">logical decoding plugin</a></p>
</li>
<li>
<p>configure the <a href="#server-configuration">PostgreSQL server</a> to support logical replication</p>
</li>
<li>
<p>create a <a href="#example-configuration">configuration file for the PostgreSQL Connector</a> and use the <a href="https://docs.confluent.io/5.1.2/connect/restapi.html">Kafka Connect REST API</a> to add that connector to your Kafka Connect cluster.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the connector starts, it will grab a consistent snapshot of the databases in your PostgreSQL server and start streaming changes, producing events for every inserted, updated, and deleted row. You can also choose to produce events for a subset of the schemas and tables. Optionally ignore, mask, or truncate columns that are sensitive, too large, or not needed.</p>
</div>
<div class="sect2">
<h3 id="example-configuration"><a class="anchor" href="#example-configuration"></a>Example Configuration</h3>
<div class="paragraph">
<p>Using the PostgreSQL connector is straightforward. Here is an example of the configuration for a PostgreSQL connector that monitors a PostgreSQL server at port 5432 on 192.168.99.100, which we logically name <code>fullfillment</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "inventory-connector",  <i class="conum" data-value="1"></i><b>(1)</b>
  "config": {
    "connector.class": "io.debezium.connector.postgresql.PostgresConnector", <i class="conum" data-value="2"></i><b>(2)</b>
    "database.hostname": "192.168.99.100", <i class="conum" data-value="3"></i><b>(3)</b>
    "database.port": "5432", <i class="conum" data-value="4"></i><b>(4)</b>
    "database.user": "postgres", <i class="conum" data-value="5"></i><b>(5)</b>
    "database.password": "postgres", <i class="conum" data-value="6"></i><b>(6)</b>
    "database.dbname" : "postgres", <i class="conum" data-value="7"></i><b>(7)</b>
    "database.server.name": "fullfillment", <i class="conum" data-value="8"></i><b>(8)</b>
    "table.whitelist": "public.inventory" <i class="conum" data-value="9"></i><b>(9)</b>

  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The name of our connector when we register it with a Kafka Connect service.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The name of this PostgreSQL connector class.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The address of the PostgreSQL server.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The port number of the PostgreSQL server.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The name of the PostgreSQL user that has the <a href="#PostgreSQL-permissions">required privileges</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The password for the PostgreSQL user that has the <a href="#PostgreSQL-permissions">required privileges</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The name of the PostgreSQL database to connect to</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The logical name of the PostgreSQL server/cluster, which forms a namespace and is used in all the names of the Kafka topics to which the connector writes, the Kafka Connect schema names, and the namespaces of the corresponding Avro schema when the <a href="#avro-converter">Avro Connector</a> is used.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>A list of all tables hosted by this server that this connector will monitor. This is optional, and there are other properties for listing the schemas and tables to include or exclude from monitoring.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See the <a href="#connector-properties">complete list of connector properties</a> that can be specified in these configurations.</p>
</div>
<div class="paragraph">
<p>This configuration can be sent via POST to a running Kafka Connect service, which will then record the configuration and start up the one connector task that will connect to the PostgreSQL database and record events to Kafka topics.</p>
</div>
</div>
<div class="sect2">
<h3 id="connector-properties"><a class="anchor" href="#connector-properties"></a>Connector Properties</h3>
<div class="paragraph">
<p>The following configuration properties are <em>required</em> unless a default value is available.</p>
</div>
<table class="tableblock frame-all grid-all stretch table table-bordered table-striped">
<colgroup>
<col style="width: 35%;">
<col style="width: 10%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>name</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Unique name for the connector. Attempting to register again with the same name will fail. (This property is required by all Kafka Connect connectors.)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>connector.class</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the Java class for the connector. Always use a value of <code>io.debezium.connector.postgresql.PostgresConnector</code> for the PostgreSQL connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>tasks.max</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>1</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The maximum number of tasks that should be created for this connector. The PostgreSQL connector always uses a single task and therefore does not use this value, so the default is always acceptable.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>plugin.name</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>decoderbufs</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the Postgres <a href="#output-plugin">logical decoding plugin</a> installed on the server. Supported values are <code>decoderbufs</code>, <code>wal2json</code>, <code>wal2json_rds</code>, <code>wal2json_streaming</code> (added in 0.8.0.Beta1), <code>wal2json_rds_streaming</code> (added in 0.8.0.Beta1) and <code>pgoutput</code> (added in 0.10.0.Beta3)</p>
</div>
<div class="paragraph">
<p>When the processed transactions are very large it is possible that the <code>JSON</code> batch event with all changes in the transaction will not fit into the hard-coded memory buffer of size 1 GB.
In such cases it is possible to switch to so-called <strong>streaming</strong> mode when every change in transactions is sent as a separate message from PostgreSQL into Debezium.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>slot.name</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>debezium</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the Postgres logical decoding slot created for streaming changes from a plugin and database instance. Values must conform to <a href="https://www.postgresql.org/docs/current/static/warm-standby.html#STREAMING-REPLICATION-SLOTS-MANIPULATION">Postgres replication slot naming rules</a> which state: <em>"Each replication slot has a name, which can contain lower-case letters, numbers, and the underscore character."</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>slot.drop_on_stop</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>false</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Whether or not to drop the logical replication slot when the connector finishes orderly. Should only be set to <code>true</code> in testing or development environments. Dropping the slot allows WAL segments to be discarded by the database, so it may happen that after a restart the connector cannot resume from the WAL position where it left off before.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>publication.name</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>dbz_publication</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the PostgreSQL publication created created for streaming changes when using <code>pgoutput</code>.</p>
</div>
<div class="paragraph">
<p>This publication is created at start-up if it does not already exist to include <em>all tables</em>.
Debezium will then use its own white-/blacklist filtering capabilities to limit change events to the specific tables of interest if configured.
Note the connector user must have superuser permissions in order to create this publication,
so it is usually preferable to create the publication upfront.</p>
</div>
<div class="paragraph">
<p>If the publication already exists (either for all tables or configured with a subset of tables),
Debezium will instead use the publication as defined.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>database.hostname</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IP address or hostname of the PostgreSQL database server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>database.port</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>5432</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Integer port number of the PostgreSQL database server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>database.user</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name of the PostgreSQL database to use when connecting to the PostgreSQL database server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>database.password</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Password to use when connecting to the PostgreSQL database server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>database.dbname</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the PostgreSQL database from which to stream the changes</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>database.server.name</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Logical name that identifies and provides a namespace for the particular PostgreSQL database server/cluster being monitored. The logical name should be unique across all other connectors, since it is used as a prefix for all Kafka topic names coming from this connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>schema.whitelist</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional comma-separated list of regular expressions that match schema names to be monitored; any schema name not included in the whitelist will be excluded from monitoring. By default all non-system schemas will be monitored. May not be used with <code>schema.blacklist</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>schema.blacklist</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional comma-separated list of regular expressions that match schema names to be excluded from monitoring; any schema name not included in the blacklist will be monitored, with the exception of system schemas. May not be used with <code>schema.whitelist</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>table.whitelist</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional comma-separated list of regular expressions that match fully-qualified table identifiers for tables to be monitored; any table not included in the whitelist will be excluded from monitoring. Each identifier is of the form <em>schemaName</em>.<em>tableName</em>. By default the connector will monitor every non-system table in each monitored schema. May not be used with <code>table.blacklist</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>table.blacklist</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional comma-separated list of regular expressions that match fully-qualified table identifiers for tables to be excluded from monitoring; any table not included in the blacklist will be monitored. Each identifier is of the form <em>schemaName</em>.<em>tableName</em>. May not be used with <code>table.whitelist</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>column.blacklist</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional comma-separated list of regular expressions that match the fully-qualified names of columns that should be excluded from change event message values. Fully-qualified names for columns are of the form <em>schemaName</em>.<em>tableName</em>.<em>columnName</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>time.precision.mode</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>adaptive</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Time, date, and timestamps can be represented with different kinds of precision, including: <code>adaptive</code> (the default) captures the time and timestamp values exactly as in the database using either millisecond, microsecond, or nanosecond precision values based on the database column&#8217;s type; <code>adaptive_time_microseconds</code> captures the date, datetime and timestamp values exactly as in the database using either millisecond, microsecond, or nanosecond precision values based on the database column&#8217;s type, with the exception of TIME type fields, which are always captured as microseconds; or <code>connect</code> always represents time and timestamp values using Kafka Connect&#8217;s built-in representations for Time, Date, and Timestamp, which uses millisecond precision regardless of the database columns' precision. See <a href="#temporal-values">temporal values</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>decimal.handling.mode</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>precise</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies how the connector should handle values for <code>DECIMAL</code> and <code>NUMERIC</code> columns: <code>precise</code> (the default) represents them precisely using <code>java.math.BigDecimal</code> values represented in change events in a binary form; or <code>double</code> represents them using <code>double</code> values, which may result in a loss of precision but will be far easier to use. <code>string</code> option encodes values as formatted string which is easy to consume but a semantic information about the real type is lost. See <a href="#decimal-values">Decimal Values</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>hstore.handling.mode</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>map</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies how the connector should handle values for <code>hstore</code> columns: <code>map</code> (the default) represents using <code>MAP</code>; or <code>json</code> represents them using <code>json string</code>.<code>json</code> option encodes values as formatted string such as <code>{"key" : "val"}</code>. See <a href="#hstore-values">HStore Values</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>database.sslmode</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>disable</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Whether to use an encrypted connection to the PostgreSQL server. Options include: <strong>disable</strong> (the default) to use an unencrypted connection ; <strong>require</strong> to use a secure (encrypted) connection, and fail if one cannot be established; <strong>verify-ca</strong> like <code>require</code> but additionally verify the server TLS certificate against the configured Certificate Authority (CA) certificates, or fail if no valid matching CA certificates are found; <strong>verify-full</strong> like <code>verify-ca</code> but additionally verify that the server certificate matches the host to which the connection is attempted. See <a href="https://www.postgresql.org/docs/current/static/libpq-connect.html">the PostgreSQL documentation</a> for more information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>database.sslcert</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The path to the file containing the SSL Certificate for the client. See <a href="https://www.postgresql.org/docs/current/static/libpq-connect.html">the PostgreSQL documentation</a> for more information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>database.sslkey</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The path to the file containing the SSL private key of the client. See <a href="https://www.postgresql.org/docs/current/static/libpq-connect.html">the PostgreSQL documentation</a> for more information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>database.sslpassword</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The password to access the client private key from the file specified by <code>database.sslkey</code>. See <a href="https://www.postgresql.org/docs/current/static/libpq-connect.html">the PostgreSQL documentation</a> for more information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>database.sslrootcert</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The path to the file containing the root certificate(s) against which the server is validated. See <a href="https://www.postgresql.org/docs/current/static/libpq-connect.html">the PostgreSQL documentation</a> for more information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>database.tcpKeepAlive</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Enable TCP keep-alive probe to verify that database connection is still alive. (enabled by default). See <a href="https://www.postgresql.org/docs/current/static/libpq-connect.html">the PostgreSQL documentation</a> for more information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>tombstones.on.delete</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>true</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Controls whether a tombstone event should be generated after a delete event.<br>
When <code>true</code> the delete operations are represented by a delete event and a subsequent tombstone event. When <code>false</code> only a delete event is sent.<br>
Emitting the tombstone event (the default behavior) allows Kafka to completely delete all events pertaining to the given key once the source record got deleted.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>column.propagate.source.type</code> 0.8.0 and later</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional comma-separated list of regular expressions that match the fully-qualified names of columns whose original type and length should be added as a parameter to the corresponding field schemas in the emitted change messages.
The schema parameters <code>__debezium.source.column.type</code>, <code>__debezium.source.column.length</code> and <code>__debezium.source.column.scale</code> will be used to propagate the original type name and length (for variable-width types), respectively.
Useful to properly size corresponding columns in sink databases.
Fully-qualified names for columns are of the form <em>databaseName</em>.<em>tableName</em>.<em>columnName</em>, or <em>databaseName</em>.<em>schemaName</em>.<em>tableName</em>.<em>columnName</em>.</p>
</div></div></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>message.key.columns</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>empty string</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A semi-colon list of regular expressions that match fully-qualified tables and columns to map a primary key.<br>
Each item (regular expression) must match the fully-qualified <code>&lt;fully-qualified table&gt;:&lt;a comma-separated list of columns&gt;</code> representing the custom key.<br>
Fully-qualified tables could be defined as <code>DB_NAME.TABLE_NAME</code> or <code>SCHEMA_NAME.TABLE_NAME</code>, depending on the specific connector.</p>
</div></div></td>
</tr>
</tfoot>
</table>
<div class="paragraph">
<p>The following <em>advanced</em> configuration properties have good defaults that will work in most situations and therefore rarely need to be specified in the connector&#8217;s configuration.</p>
</div>
<table class="tableblock frame-all grid-all stretch table table-bordered table-striped">
<colgroup>
<col style="width: 35%;">
<col style="width: 10%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>snapshot.mode</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>initial</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies the criteria for running a snapshot upon startup of the connector. The default is <strong>initial</strong>, and specifies the connector can run a snapshot only when no offsets have been recorded for the logical server name. The <strong>always</strong> option specifies that the connector run a snapshot each time on startup. The <strong>never</strong> option specifies that the connect should never use snapshots and that upon first startup with a logical server name the connector should read from either from where it last left off (last LSN position) or start from the beginning from the point of the view of the logical replication slot. The <strong>initial_only</strong> option specifies that the connector should only take an initial snapshot and then stop, without processing any subsequent changes. The <strong>exported</strong> option specifies that the database snapshot will be based on the point in time when the replication slot was created and is an excellent way to perform the snapshot in a lock-free way. Finally, if set to <strong>custom</strong> then the user must also set <code>snapshot.custom.class</code> which is a custom implementation of the <code>io.debezium.connector.postgresql.spi.Snapshotter</code> interface. See <a href="#snapshots">snapshots</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>snapshot.custom.class</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A full java class name that must be an implementation of the <code>io.debezium.connector.postgresql.spi.Snapshotter</code> interface. Only used when <code>snapshot.mode</code> is <strong>custom</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>snapshot.lock.timeout.ms</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>10000</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Positive integer value that specifies the maximum amount of time (in milliseconds) to wait to obtain table locks when performing a snapshot. If table locks cannot be acquired in this time interval, the snapshot will fail See <a href="#snapshots">snapshosts</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>snapshot.select.statement.overrides</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Controls which rows from tables will be included in snapshot.<br>
This property contains a comma-separated list of fully-qualified tables <em>(DB_NAME.TABLE_NAME)</em>. Select statements for the individual tables are specified in further configuration properties, one for each table, identified by the id <code>snapshot.select.statement.overrides.[DB_NAME].[TABLE_NAME]</code>. The value of those properties is the SELECT statement to use when retrieving data from the specific table during snapshotting. <em>A possible use case for large append-only tables is setting a specific point where to start (resume) snapshotting, in case a previous snapshotting was interrupted.</em><br>
<strong>Note</strong>: This setting has impact on snapshots only. Events generated by logical decoder are not affected by it at all.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>max.queue.size</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>20240</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Positive integer value that specifies the maximum size of the blocking queue into which change events received via streaming replication are placed before they are written to Kafka. This queue can provide backpressure when, for example, writes to Kafka are slower or if Kafka is not available.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>max.batch.size</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>10240</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Positive integer value that specifies the maximum size of each batch of events that should be processed during each iteration of this connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>poll.interval.ms</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>1000</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Positive integer value that specifies the number of milliseconds the connector should wait during each iteration for new change events to appear. Defaults to 1000 milliseconds, or 1 second.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>include.unknown.datatypes</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>false</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When Debezium meets a field whose data type is unknown, then by default the field is omitted from the change event and a warning is logged.
In some cases it may be preferable though to include the field and send it downstream to clients in the opaque binary representation so the clients will decode it themselves.
Set to <code>false</code> to filter unknown data out of events and <code>true</code> to keep them in binary format.</p>
</div>
<div class="paragraph">
<p><em>Note: The clients risk backward compatibility issues. Not only may the database specific binary representation change between releases, but also when the datatype is supported by Debezium eventually, it will be sent downstream in a logical type, requiring adjustments by consumers. In general, when encountering unsupported data types, please file a feature request so that support can be added.</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>database.initial.statements</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A semicolon separated list of SQL statements to be executed when a JDBC connection (not the transaction log reading connection) to the database is established.
Use doubled semicolon (';;') to use a semicolon as a character and not as a delimiter.</p>
</div>
<div class="paragraph">
<p><em>Note: The connector may establish JDBC connections at its own discretion, so this should typically be used for configuration of session parameters only, but not for executing DML statements.</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>heartbeat.interval.ms</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>0</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Controls how frequently heartbeat messages are sent.<br>
This property contains an interval in milli-seconds that defines how frequently the connector sends messages into a heartbeat topic.
This can be used to monitor whether the connector is still receiving change events from the database.
You also should leverage heartbeat messages in cases where only records in non-captured tables are changed for a longer period of time.
In such situation the connector would proceed to read the log from the database but never emit any change messages into Kafka,
which in turn means that no offset updates will be committed to Kafka.
This will cause the WAL files to be retained by the database longer than needed
(as the connector actually has processed them already but never got a chance to flush the latest retrieved LSN to the database)
and also may result in more change events to be re-sent after a connector restart.
Set this parameter to <code>0</code> to not send heartbeat messages at all.<br>
Disabled by default.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>heartbeat.topics.prefix</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>__debezium-heartbeat</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Controls the naming of the topic to which heartbeat messages are sent.<br>
The topic is named according to the pattern <code>&lt;heartbeat.topics.prefix&gt;.&lt;server.name&gt;</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>schema.refresh.mode</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>columns_diff</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specify the conditions that trigger a refresh of the in-memory schema for a table.</p>
</div>
<div class="paragraph">
<p><code>columns_diff</code> (the default) is the safest mode, ensuring the in-memory schema stays in-sync with the database table&#8217;s schema at all times.</p>
</div>
<div class="paragraph">
<p><code>columns_diff_exclude_unchanged_toast</code> instructs the connector to refresh the in-memory schema cache if there is a discrepancy between it
and the schema derived from the incoming message, unless unchanged TOASTable data fully accounts for the discrepancy.</p>
</div>
<div class="paragraph">
<p>This setting can improve connector performance significantly if there are frequently-updated tables that
have TOASTed data that are rarely part of these updates. However, it is possible for the in-memory schema to
become outdated if TOASTable columns are dropped from the table.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>snapshot.delay.ms</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An interval in milli-seconds that the connector should wait before taking a snapshot after starting up;<br>
Can be used to avoid snapshot interruptions when starting multiple connectors in a cluster, which may cause re-balancing of connectors.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>snapshot.fetch.size</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>10240</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies the maximum number of rows that should be read in one go from each table while taking a snapshot.
The connector will read the table contents in multiple batches of this size. Defaults to 10240.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>slot.stream.params</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Optional list of parameters to be passed to the configured logical decoding plug-in;
can for instance be used to enable server-side table filtering when using the wal2json plug-in.
Allowed values depend on the chosen plug-in are separated by semicolon,
e.g. <code>add-tables=public.table,public.table2;include-lsn=true</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>sanitize.field.names</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>true</code> when connector configuration explicitly specifies the <code>key.converter</code> or <code>value.converter</code> parameters to use Avro, otherwise defaults to <code>false</code>.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Whether field names will be sanitized to adhere to Avro naming requirements.
See <a href="../configuration/avro.html#names" class="page">Avro naming</a> for more details.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>slot.max.retries</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>6</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>How many times to retry connecting to a replication slot when an attempt fails.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>slot.retry.delay.ms</code><br></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>10000 (10 seconds)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of milli-seconds to wait between retry attempts when the connector fails to connect to a replication slot.</p>
</div></div></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>toasted.value.placeholder</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>__debezium_unavailable_value</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specify the constant that will be provided by Debezium to indicate that the original value is a toasted value not provided by the database.
If starts with <code>hex:</code> prefix it is expected that the rest of the string repesents hexadecimally encoded octets.
See <a href="#toasted-values">section</a> with additional details.</p>
</div></div></td>
</tr>
</tfoot>
</table>
<div class="paragraph">
<p>The connector also supports <em>pass-through</em> configuration properties that are used when creating the Kafka producer and consumer.</p>
</div>
<div class="paragraph">
<p>Be sure to consult the <a href="http://kafka.apache.org/documentation.html">Kafka documentation</a> for all of the configuration properties for Kafka producers and consumers. (The PostgreSQL connector does use the <a href="http://kafka.apache.org/documentation.html#newconsumerconfigs">new consumer</a>.)</p>
</div>
</div>
</div>
</div>
</article>
    <footer class="footer">
        <div class="wrapper">
            <div class="copyright">Copyright &copy; 2020 Debezium Community</div>
        </div>
    </footer>
</main>
</div>
<script>
    /* Make sure TOC carets are expanded if sub-elements exist */
    $("#toc").each(function(i,v) {
      $(this).closest('article').addClass('with-toc');
    });

    $("#toc ul.sectlevel1 > li").each(function(i,v) {
      $(this).has("ul").addClass("expanded");
    });

    $(function() {
        /* Expands all the documentation submenus */
        $(".nav-list > .nav-item:not(.is-active) .nav-item-toggle").click();
    });

    /*
    $(".doc.with-toc").each(function(i,v) {
        var tocWidth = $(".toc").width();
        $(this).css("max-width", "calc(100% - " + (tocWidth+75) + "px)");
    });
    */
</script>
<script src="../../../debezium-antora/js/site.js"></script>
<script async src="../../../debezium-antora/js/vendor/highlight.js"></script>

<script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
  try {
    var pageTracker = _gat._getTracker("UA-10656779-1");
    pageTracker._trackPageview();
  } catch(err) {}
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-76464546-1', 'auto');
  ga('send', 'pageview');
  ga('set', 'anonymizeIp', true);
  ga('require', 'linkid', 'linkid.js');
</script>
</body>
</html>