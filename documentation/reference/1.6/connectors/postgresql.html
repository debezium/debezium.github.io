<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Debezium connector for PostgreSQL :: Debezium Documentation</title>
    <link rel="canonical" href="https://www.debezium.io/documentation/reference/connectors/postgresql.html">
    <meta name="generator" content="Antora 2.3.4">
<link rel="stylesheet" href="../../../debezium-antora/css/site.css">
<link rel="stylesheet" href="../../../debezium-antora/css/debezium-antora.css">
<link rel="stylesheet" href="../../../debezium-antora/css/highlightjs-dark.css">
<link rel="stylesheet" href="https://static.jboss.org/css/rhbar.css">
<script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.js"></script>
<script src="../../../debezium-antora/js/jquery.ba-floatingscrollbar.js"></script>
</head>
<body class="article">
<header class="header">
  <div id="rhbar">
      <a class="jbdevlogo" href="https://developers.redhat.com"></a>
      <a class="rhlogo" href="https://www.redhat.com"></a>
  </div>
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
          <img src="/assets/images/color_white_debezium_type_600px.svg" style="height: 32px; margin-right: 14px;"/>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="/documentation/faq">FAQ</a>
        <a class="navbar-item" href="/documentation">DOCUMENTATION</a>
        <a class="navbar-item" href="/releases">RELEASES</a>
        <a class="navbar-item" href="/community">COMMUNITY</a>
        <a class="navbar-item" href="/blog">BLOG</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="reference" data-version="1.6">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Debezium Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tutorial.html">Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../install.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../postgres-plugins.html">PostgreSQL Decoding Plugins</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../features.html">Features</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/avro.html">Avro Serialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/topic-routing.html">Topic Routing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/event-flattening.html">New Record State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/mongodb-event-flattening.html">MongoDB New Document State Extraction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/outbox-event-router.html">Outbox Event Router</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/filtering.html">Message Filtering</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/content-based-routing.html">Content-Based Routing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/topic-auto-create-config.html">Customizing Topic Auto-Creation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/signalling.html">Sending Signals to Debezium</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Connectors</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="mysql.html">MySQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="mongodb.html">MongoDB</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="postgresql.html">PostgreSQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="oracle.html">Oracle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="sqlserver.html">SQL Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="db2.html">Db2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cassandra.html">Cassandra</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="vitess.html">Vitess</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">API and SPI</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/engine.html">Debezium Engine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/converters.html">Custom Converters</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Integrations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/serdes.html">Change Event SerDes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/outbox.html">Outbox Quarkus Extension</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/cloudevents.html">CloudEvents</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/tracing.html">OpenTracing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/testcontainers.html">Integration Testing with Testcontainers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Operations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/debezium-server.html">Debezium Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/monitoring.html">Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/openshift.html">Running on Openshift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operations/embedded.html">Embedding Debezium</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Debezium Documentation</span>
    <span class="version">1.6</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Debezium Documentation</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../index.html">master</a>
        </li>
        <li class="version is-current">
          <a href="../index.html">1.6</a>
        </li>
        <li class="version">
          <a href="../../1.5/index.html">1.5</a>
        </li>
        <li class="version">
          <a href="../../1.4/index.html">1.4</a>
        </li>
        <li class="version">
          <a href="../../1.3/index.html">1.3</a>
        </li>
        <li class="version">
          <a href="../../1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../1.1/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../../1.0/index.html">1.0</a>
        </li>
        <li class="version">
          <a href="../../0.10/index.html">0.10</a>
        </li>
        <li class="version">
          <a href="../../0.9/index.html">0.9</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main" class="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Debezium Documentation</a></li>
    <li>Connectors</li>
    <li><a href="postgresql.html">PostgreSQL</a></li>
  </ul>
</nav>
    <div class="page-versions-container">
    Version:
    <div class="page-versions">
        <button class="version-menu-toggle versions-menu-current" title="Show other versions of page">1.6</button>
        <!--<button class="version-menu-toggle versions-menu-select" title="Select other versions">Select</button>-->
        <div class="version-menu">
                <a class="version" href="../../connectors/postgresql.html">master</a>
                <a class="version is-current" href="postgresql.html">1.6</a>
                <a class="version" href="../../1.5/connectors/postgresql.html">1.5</a>
                <a class="version" href="../../1.4/connectors/postgresql.html">1.4</a>
                <a class="version" href="../../1.3/connectors/postgresql.html">1.3</a>
                <a class="version" href="../../1.2/connectors/postgresql.html">1.2</a>
                <a class="version" href="../../1.1/connectors/postgresql.html">1.1</a>
                <a class="version" href="../../1.0/connectors/postgresql.html">1.0</a>
                <a class="version" href="../../0.10/connectors/postgresql.html">0.10</a>
                <a class="version" href="../../0.9/connectors/postgresql.html">0.9</a>
        </div>
        |
    </div>
    </div>
  <div class="edit-this-page"><a href="https://github.com/debezium/debezium/edit/1.6/documentation/modules/ROOT/pages/connectors/postgresql.adoc">Edit this Page</a></div>
  </div>
<div class="article-grid">
<div class="article-cell1">
<article class="doc">
            <div class="version-banner version-banner-development">
    You are viewing documentation for the current development version of Debezium.
    <br/>
            If you want to view the latest stable version of this page, please go <a href="../../1.5/connectors/postgresql.html">here</a>.
            
</div>            <h1 class="page">Debezium connector for PostgreSQL</h1>
        <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#postgresql-overview">Overview</a></li>
<li><a href="#how-the-postgresql-connector-works">How the connector works</a>
<ul class="sectlevel2">
<li><a href="#postgresql-security">Security</a></li>
<li><a href="#postgresql-snapshots">Snapshots</a></li>
<li><a href="#postgresql-custom-snapshot">Custom snapshotter SPI</a></li>
<li><a href="#postgresql-streaming-changes">Streaming changes</a></li>
<li><a href="#postgresql-pgoutput">PostgreSQL 10+ logical decoding support (<code>pgoutput</code>)</a></li>
<li><a href="#postgresql-topic-names">Topics names</a></li>
<li><a href="#postgresql-meta-information">Meta information</a></li>
<li><a href="#postgresql-transaction-metadata">Transaction metadata</a></li>
</ul>
</li>
<li><a href="#postgresql-events">Data change events</a>
<ul class="sectlevel2">
<li><a href="#postgresql-change-events-key">Change event keys</a></li>
<li><a href="#postgresql-change-events-value">Change event values</a></li>
<li><a href="#postgresql-replica-identity">Replica identity</a></li>
<li><a href="#postgresql-create-events"><em>create</em> events</a></li>
<li><a href="#postgresql-update-events"><em>update</em> events</a></li>
<li><a href="#postgresql-primary-key-updates">Primary key updates</a></li>
<li><a href="#postgresql-delete-events"><em>delete</em> events</a></li>
<li><a href="#postgresql-truncate-events"><em>truncate</em> events</a></li>
</ul>
</li>
<li><a href="#postgresql-data-types">Data type mappings</a>
<ul class="sectlevel2">
<li><a href="#postgresql-basic-types">Basic types</a></li>
<li><a href="#postgresql-temporal-types">Temporal types</a></li>
<li><a href="#postgresql-timestamp-type">TIMESTAMP type</a></li>
<li><a href="#postgresql-decimal-types">Decimal types</a></li>
<li><a href="#postgresql-hstore-type">HSTORE type</a></li>
<li><a href="#postgresql-domain-types">Domain types</a></li>
<li><a href="#postgresql-network-address-types">Network address types</a></li>
<li><a href="#postgresql-postgis-types">PostGIS types</a></li>
<li><a href="#postgresql-toasted-values">Toasted values</a></li>
</ul>
</li>
<li><a href="#setting-up-postgresql">Set up</a>
<ul class="sectlevel2">
<li><a href="#postgresql-in-the-cloud">PostgreSQL in the Cloud</a></li>
<li><a href="#installing-postgresql-output-plugin">Installing the logical decoding output plug-in</a></li>
<li><a href="#postgresql-differences-between-plugins">Plug-in differences</a></li>
<li><a href="#postgresql-server-configuration">Configuring the PostgreSQL server</a></li>
<li><a href="#postgresql-permissions">Setting up permissions</a></li>
<li><a href="#postgresql-replication-user-privileges">Setting privileges to enable Debezium to create PostgreSQL publications when you use <code>pgoutput</code></a></li>
<li><a href="#postgresql-host-replication-permissions">Configuring PostgreSQL to allow replication with the Debezium connector host</a></li>
<li><a href="#supported-postgresql-topologies">Supported PostgreSQL topologies</a></li>
<li><a href="#postgresql-wal-disk-space">WAL disk space consumption</a></li>
</ul>
</li>
<li><a href="#postgresql-deployment">Deployment</a>
<ul class="sectlevel2">
<li><a href="#postgresql-example-configuration">Connector configuration example</a></li>
<li><a href="#postgresql-adding-connector-configuration">Adding connector configuration</a></li>
<li><a href="#postgresql-connector-properties">Connector configuration properties</a></li>
</ul>
</li>
<li><a href="#postgresql-monitoring">Monitoring</a>
<ul class="sectlevel2">
<li><a href="#postgresql-snapshot-metrics">Snapshot metrics</a></li>
<li><a href="#postgresql-streaming-metrics">Streaming metrics</a></li>
</ul>
</li>
<li><a href="#postgresql-when-things-go-wrong">Behavior when things go wrong</a>
<ul class="sectlevel2">
<li><a href="#postgresql-connector-configuration-and-startup-errors">Configuration and startup errors</a></li>
<li><a href="#postgresql-becomes-unavailable">PostgreSQL becomes unavailable</a></li>
<li><a href="#postgresql-cluster-failures">Cluster failures</a></li>
<li><a href="#postgresql-kafka-connect-process-stops-gracefully">Kafka Connect process stops gracefully</a></li>
<li><a href="#postgresql-kafka-connect-process-crashes">Kafka Connect process crashes</a></li>
<li><a href="#postgresql-kafka-becomes-unavailable">Kafka becomes unavailable</a></li>
<li><a href="#postgresql-connector-is-stopped-for-a-duration">Connector is stopped for a duration</a></li>
</ul>
</li>
</ul>
</div>
<div class="paragraph">
<p>Debezium&#8217;s PostgreSQL connector captures row-level changes in the schemas of a PostgreSQL database. PostgreSQL versions 9.6, 10, 11, 12 and 13 are supported.</p>
</div>
<div class="paragraph">
<p>The first time it connects to a PostgreSQL server or cluster, the connector takes a consistent snapshot of all schemas. After that snapshot is complete, the connector continuously captures row-level changes that insert, update, and delete database content and that were committed to a PostgreSQL database. The connector generates data change event records and streams them to Kafka topics. For each table, the default behavior is that the connector streams all generated events to a separate Kafka topic for that table. Applications and services consume data change event records from that topic.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="postgresql-overview"><a class="anchor" href="#postgresql-overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>PostgreSQL&#8217;s <a href="https://www.postgresql.org/docs/current/static/logicaldecoding-explanation.html"><em>logical decoding</em></a> feature was introduced in version 9.4. It is a mechanism that allows the extraction of the changes that were committed to the transaction log and the processing of these changes in a user-friendly manner with the help of an <a href="https://www.postgresql.org/docs/current/static/logicaldecoding-output-plugin.html"><em>output plug-in</em></a>. The output plug-in enables clients to consume the changes.</p>
</div>
<div class="paragraph">
<p>The PostgreSQL connector contains two main parts that work together to read and process database changes:</p>
</div>
<div id="postgresql-output-plugin" class="ulist">
<ul>
<li>
<p>A logical decoding output plug-in. You might need to install the output plug-in that you choose to use. You must configure a replication slot that uses your chosen output plug-in before running the PostgreSQL server. The plug-in can be one of the following:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/debezium/postgres-decoderbufs"><code>decoderbufs</code></a> is based on Protobuf and maintained by the Debezium community.</p>
</li>
<li>
<p><a href="https://github.com/eulerto/wal2json"><code>wal2json</code></a> is based on JSON and maintained by the wal2json community.</p>
</li>
<li>
<p><code>pgoutput</code> is the standard logical decoding output plug-in in PostgreSQL 10+. It is maintained by the PostgreSQL community, and used by PostgreSQL itself for <a href="https://www.postgresql.org/docs/current/logical-replication-architecture.html">logical replication</a>. This plug-in is always present so no additional libraries need to be installed. The Debezium connector interprets the raw replication event stream directly into change events.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Java code (the actual Kafka Connect connector) that reads the changes produced by the chosen logical decoding output plug-in. It uses PostgreSQL&#8217;s <a href="https://www.postgresql.org/docs/current/static/logicaldecoding-walsender.html"><em>streaming replication protocol</em></a>, by means of the PostgreSQL <a href="https://github.com/pgjdbc/pgjdbc"><em>JDBC driver</em></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The connector produces a <em>change event</em> for every row-level insert, update, and delete operation that was captured and sends change event records for each table in a separate Kafka topic. Client applications read the Kafka topics that correspond to the database tables of interest, and can react to every row-level event they receive from those topics.</p>
</div>
<div class="paragraph">
<p>PostgreSQL normally purges write-ahead log (WAL) segments after some period of time. This means that the connector does not have the complete history of all changes that have been made to the database. Therefore, when the PostgreSQL connector first connects to a particular PostgreSQL database, it starts by performing a <em>consistent snapshot</em> of each of the database schemas. After the connector completes the snapshot, it continues streaming changes from the exact point at which the snapshot was made. This way, the connector starts with a consistent view of all of the data, and does not omit any changes that were made while the snapshot was being taken.</p>
</div>
<div class="paragraph">
<p>The connector is tolerant of failures. As the connector reads changes and produces events, it records the WAL position for each event. If the connector stops for any reason (including communication failures, network problems, or crashes), upon restart the connector continues reading the WAL where it last left off. This includes snapshots. If the connector stops during a snapshot, the connector begins a new snapshot when it restarts.</p>
</div>
<div id="postgresql-limitations" class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The connector relies on and reflects the PostgreSQL logical decoding feature, which has the following limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Logical decoding does not support DDL changes. This means that the connector is unable to report DDL change events back to consumers.</p>
</li>
<li>
<p>Logical decoding replication slots are supported on only <code>primary</code> servers. When there is a cluster of PostgreSQL servers, the connector can run on only the active <code>primary</code> server. It cannot run on <code>hot</code> or <code>warm</code> standby replicas. If the <code>primary</code> server fails or is demoted, the connector stops. After the <code>primary</code> server has recovered, you can restart the connector. If a different PostgreSQL server has been promoted to <code>primary</code>, adjust the connector configuration before restarting the connector.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#postgresql-when-things-go-wrong"> Behavior when things go wrong</a> describes what the connector does when there is a problem.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Debezium currently supports databases with UTF-8 character encoding only.
With a single byte character encoding, it is not possible to correctly process strings that contain extended ASCII code characters.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-the-postgresql-connector-works"><a class="anchor" href="#how-the-postgresql-connector-works"></a>How the connector works</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To optimally configure and run a Debezium PostgreSQL connector, it is helpful to understand how the connector performs snapshots, streams change events, determines Kafka topic names, and uses metadata.</p>
</div>
<div class="sect2">
<h3 id="postgresql-security"><a class="anchor" href="#postgresql-security"></a>Security</h3>
<div class="paragraph">
<p>To use the Debezium connector to stream changes from a PostgreSQL database, the connector must operate with specific privileges in the database.
Although one way to grant the necessary privileges is to provide the user with <code>superuser</code> privileges, doing so potentially exposes your PostgreSQL data to unauthorized access.
Rather than granting excessive privileges to the Debezium user, it is best to create a dedicated Debezium replication user to which you grant specific privileges.</p>
</div>
<div class="paragraph">
<p>For more information about configuring privileges for the Debezium PostgreSQL user, see <a href="#postgresql-permissions">Setting up permissions</a>.
For more information about PostgreSQL logical replication security, see the <a href="https://www.postgresql.org/docs/current/logical-replication-security.html">PostgreSQL documentation</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-snapshots"><a class="anchor" href="#postgresql-snapshots"></a>Snapshots</h3>
<div class="paragraph">
<p>Most PostgreSQL servers are configured to not retain the complete history of the database in the WAL segments. This means that the PostgreSQL connector would be unable to see the entire history of the database by reading only the WAL. Consequently, the first time that the connector starts, it performs an initial <em>consistent snapshot</em> of the database. The default behavior for performing a snapshot consists of the following steps. You can change this behavior by setting the <a href="#postgresql-property-snapshot-mode"><code>snapshot.mode</code> connector configuration property</a> to a value other than <code>initial</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start a transaction with a <a href="https://www.postgresql.org/docs/current/static/sql-set-transaction.html">SERIALIZABLE, READ ONLY, DEFERRABLE</a> isolation level to ensure that subsequent reads in this transaction are against a single consistent version of the data. Any changes to the data due to subsequent <code>INSERT</code>, <code>UPDATE</code>, and <code>DELETE</code> operations by other clients are not visible to this transaction.</p>
</li>
<li>
<p>Obtain an <code>ACCESS SHARE MODE</code> lock on each of the tables being tracked to ensure that no structural changes can occur to any of the tables while the snapshot is taking place. These locks do not prevent table <code>INSERT</code>, <code>UPDATE</code> and <code>DELETE</code> operations from taking place during the snapshot.</p>
<div class="paragraph">
<p><em>This step is omitted when <code>snapshot.mode</code> is set to <code>exported</code>, which allows the connector to perform a lock-free snapshot</em>.</p>
</div>
</li>
<li>
<p>Read the current position in the server&#8217;s transaction log.</p>
</li>
<li>
<p>Scan the database tables and schemas, generate a <code>READ</code> event for each row and write that event to the appropriate table-specific Kafka topic.</p>
</li>
<li>
<p>Commit the transaction.</p>
</li>
<li>
<p>Record the successful completion of the snapshot in the connector offsets.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the connector fails, is rebalanced, or stops after Step 1 begins but before Step 6 completes, upon restart the connector begins a new snapshot. After the connector completes its initial snapshot, the PostgreSQL connector continues streaming from the position that it read in step 3. This ensures that the connector does not miss any updates. If the connector stops again for any reason, upon restart, the connector continues streaming changes from where it previously left off.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is strongly recommended that you configure a PostgreSQL connector to set <code>snapshot.mode</code> to <code>exported</code>. The <code>initial</code>, <code>initial only</code> and <code>always</code> modes can lose a few events while a connector switches from performing the snapshot to streaming change event records when a database is under heavy load.
This is a known issue and the affected snapshot modes will be reworked to use <code>exported</code> mode internally (<a href="https://issues.redhat.com/browse/DBZ-2337">DBZ-2337</a>).</p>
</div>
</td>
</tr>
</table>
</div>
<table id="snapshot-mode-settings" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Settings for <code>snapshot.mode</code> connector configuration property</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>always</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The connector always performs a snapshot when it starts. After the snapshot completes, the connector continues streaming changes from step 3 in the above sequence. This mode is useful in these situations:<br></p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is known that some WAL segments have been deleted and are no longer available.<br></p>
</li>
<li>
<p>After a cluster failure, a new primary has been promoted. The <code>always</code> snapshot mode ensures that the connector does not miss any changes that were made after the new primary had been promoted but before the connector was restarted on the new primary.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>never</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The connector never performs snapshots. When a connector is configured this way, its behavior when it starts is as follows. If there is a previously stored LSN in the Kafka offsets topic, the connector continues streaming changes from that position. If no LSN has been stored, the connector starts streaming changes from the point in time when the PostgreSQL logical replication slot was created on the server. The <code>never</code> snapshot mode is useful only when you know all data of interest is still reflected in the WAL.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>initial_only</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The connector performs a database snapshot and stops before streaming any change event records. If the connector had started but did not complete a snapshot before stopping, the connector restarts the snapshot process and stops when the snapshot completes.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>exported</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The connector performs a database snapshot based on the point in time when the replication slot was created. This mode is an excellent way to perform a snapshot in a lock-free way.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>custom</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The <code>custom</code> snapshot mode lets you inject your own implementation of the <code>io.debezium.connector.postgresql.spi.Snapshotter</code> interface. Set the <code>snapshot.custom.class</code> configuration property to the class on the classpath of your Kafka Connect cluster or included in the JAR if using the <code>EmbeddedEngine</code>. For more details, see <a href="#postgresql-custom-snapshot">custom snapshotter SPI</a>.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="postgresql-custom-snapshot"><a class="anchor" href="#postgresql-custom-snapshot"></a>Custom snapshotter SPI</h3>
<div class="paragraph">
<p>For more advanced uses, you can provide an implementation of the <code>io.debezium.connector.postgresql.spi.Snapshotter</code> interface. This interface allows control of most of the aspects of how the connector performs snapshots. This includes whether or not to take a snapshot, the options for opening the snapshot transaction, and whether to take locks.</p>
</div>
<div class="paragraph">
<p>Following is the full API for the interface. All built-in snapshot modes implement this interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * This interface is used to determine details about the snapshot process:
 *
 * Namely:
 * - Should a snapshot occur at all
 * - Should streaming occur
 * - What queries should be used to snapshot
 *
 * While many default snapshot modes are provided with Debezium,
 * a custom implementation of this interface can be provided by the implementor, which
 * can provide more advanced functionality, such as partial snapshots.
 *
 * Implementations must return true for either {@link #shouldSnapshot()} or {@link #shouldStream()}
 * or true for both.
 */
@Incubating
public interface Snapshotter {

    void init(PostgresConnectorConfig config, OffsetState sourceInfo,
              SlotState slotState);

    /**
     * @return true if the snapshotter should take a snapshot
     */
    boolean shouldSnapshot();

    /**
     * @return true if the snapshotter should stream after taking a snapshot
     */
    boolean shouldStream();

    /**
     *
     * @return true if streaming should resume from the start of the snapshot
     * transaction, or false for when a connector resumes and takes a snapshot,
     * streaming should resume from where streaming previously left off.
     */
    default boolean shouldStreamEventsStartingFromSnapshot() {
        return true;
    }

    /**
     * @return true if when creating a slot, a snapshot should be exported, which
     * can be used as an alternative to taking a lock
     */
    default boolean exportSnapshot() {
        return false;
    }

    /**
     * Generate a valid postgres query string for the specified table, or an empty {@link Optional}
     * to skip snapshotting this table (but that table will still be streamed from)
     *
     * @param tableId the table to generate a query for
     * @return a valid query string, or none to skip snapshotting this table
     */
    Optional&lt;String&gt; buildSnapshotQuery(TableId tableId);

    /**
     * Return a new string that set up the transaction for snapshotting
     *
     * @param newSlotInfo if a new slow was created for snapshotting, this contains information from
     *                    the `create_replication_slot` command
     */
    default String snapshotTransactionIsolationLevelStatement(SlotCreationResult newSlotInfo) {
        // we're using the same isolation level that pg_backup uses
        return "SET TRANSACTION ISOLATION LEVEL SERIALIZABLE, READ ONLY, DEFERRABLE;";
    }

    /**
     * Returns a SQL statement for locking the given tables during snapshotting, if required by the specific snapshotter
     * implementation.
     */
    default Optional&lt;String&gt; snapshotTableLockingStatement(Duration lockTimeout, Set&lt;TableId&gt; tableIds) {
        String lineSeparator = System.lineSeparator();
        StringBuilder statements = new StringBuilder();
        statements.append("SET lock_timeout = ").append(lockTimeout.toMillis()).append(";").append(lineSeparator);
        // we're locking in ACCESS SHARE MODE to avoid concurrent schema changes while we're taking the snapshot
        // this does not prevent writes to the table, but prevents changes to the table's schema....
        // DBZ-298 Quoting name in case it has been quoted originally; it doesn't do harm if it hasn't been quoted
        tableIds.forEach(tableId -&gt; statements.append("LOCK TABLE ")
                .append(tableId.toDoubleQuotedString())
                .append(" IN ACCESS SHARE MODE;")
                .append(lineSeparator));
        return Optional.of(statements.toString());
    }

    /**
     * Lifecycle hook called once the snapshot phase is finished.
     */
    default void snapshotCompleted() {
        // no operation
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-streaming-changes"><a class="anchor" href="#postgresql-streaming-changes"></a>Streaming changes</h3>
<div class="paragraph">
<p>The PostgreSQL connector typically spends the vast majority of its time streaming changes from the PostgreSQL server to which it is connected. This mechanism relies on <a href="https://www.postgresql.org/docs/current/static/protocol-replication.html"><em>PostgreSQL&#8217;s replication protocol</em></a>. This protocol enables clients to receive changes from the server as they are committed in the server&#8217;s transaction log at certain positions, which are referred to as Log Sequence Numbers (LSNs).</p>
</div>
<div class="paragraph">
<p>Whenever the server commits a transaction, a separate server process invokes a callback function from the <a href="#postgresql-output-plugin">logical decoding plug-in</a>. This function processes the changes from the transaction, converts them to a specific format (Protobuf or JSON in the case of Debezium plug-in) and writes them on an output stream, which can then be consumed by clients.</p>
</div>
<div class="paragraph">
<p>The Debezium PostgreSQL connector acts as a PostgreSQL client. When the connector receives changes it transforms the events into Debezium <em>create</em>, <em>update</em>, or <em>delete</em> events that include the LSN of the event. The PostgreSQL connector forwards these change events in records to the Kafka Connect framework, which is running in the same process. The Kafka Connect process asynchronously writes the change event records in the same order in which they were generated to the appropriate Kafka topic.</p>
</div>
<div class="paragraph">
<p>Periodically, Kafka Connect records the most recent <em>offset</em> in another Kafka topic. The offset indicates source-specific position information that Debezium includes with each event. For the PostgreSQL connector, the LSN recorded in each change event is the offset.</p>
</div>
<div class="paragraph">
<p>When Kafka Connect gracefully shuts down, it stops the connectors, flushes all event records to Kafka, and records the last offset received from each connector. When Kafka Connect restarts, it reads the last recorded offset for each connector, and starts each connector at its last recorded offset. When the connector restarts, it sends a request to the PostgreSQL server to send the events starting just after that position.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The PostgreSQL connector retrieves schema information as part of the events sent by the logical decoding plug-in. However, the connector does not retrieve information about which columns compose the primary key. The connector obtains this information from the JDBC metadata (side channel). If the primary key definition of a table changes (by adding, removing or renaming primary key columns), there is a tiny period of time when the primary key information from JDBC is not synchronized with the change event that the logical decoding plug-in generates. During this tiny period, a message could be created with an inconsistent key structure. To prevent this inconsistency, update primary key structures as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Put the database or an application into a read-only mode.</p>
</li>
<li>
<p>Let Debezium process all remaining events.</p>
</li>
<li>
<p>Stop Debezium.</p>
</li>
<li>
<p>Update the primary key definition in the relevant table.</p>
</li>
<li>
<p>Put the database or the application into read/write mode.</p>
</li>
<li>
<p>Restart Debezium.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-pgoutput"><a class="anchor" href="#postgresql-pgoutput"></a>PostgreSQL 10+ logical decoding support (<code>pgoutput</code>)</h3>
<div class="paragraph">
<p>As of PostgreSQL 10+, there is a logical replication stream mode, called <code>pgoutput</code> that is natively supported by PostgreSQL. This means that a Debezium PostgreSQL connector can consume that replication stream
without the need for additional plug-ins.
This is particularly valuable for environments where installation of plug-ins is not supported or not allowed.</p>
</div>
<div class="paragraph">
<p>See <a href="#setting-up-postgresql">Setting up PostgreSQL</a> for more details.</p>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-topic-names"><a class="anchor" href="#postgresql-topic-names"></a>Topics names</h3>
<div class="paragraph">
<p>The PostgreSQL connector writes events for all insert, update, and delete operations on a single table to a single Kafka topic. By default, the Kafka topic name is <em>serverName</em>.<em>schemaName</em>.<em>tableName</em> where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>serverName</em> is the logical name of the connector as specified with the <code>database.server.name</code> connector configuration property.</p>
</li>
<li>
<p><em>schemaName</em> is the name of the database schema where the operation occurred.</p>
</li>
<li>
<p><em>tableName</em> is the name of the database table in which the operation occurred.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, suppose that <code>fulfillment</code> is the logical server name in the configuration for a connector that is capturing changes in a PostgreSQL installation that has a <code>postgres</code> database and an <code>inventory</code> schema that contains four tables: <code>products</code>, <code>products_on_hand</code>, <code>customers</code>, and <code>orders</code>. The connector would stream records to these four Kafka topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fulfillment.inventory.products</code></p>
</li>
<li>
<p><code>fulfillment.inventory.products_on_hand</code></p>
</li>
<li>
<p><code>fulfillment.inventory.customers</code></p>
</li>
<li>
<p><code>fulfillment.inventory.orders</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now suppose that the tables are not part of a specific schema but were created in the default <code>public</code> PostgreSQL schema. The names of the Kafka topics would be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fulfillment.public.products</code></p>
</li>
<li>
<p><code>fulfillment.public.products_on_hand</code></p>
</li>
<li>
<p><code>fulfillment.public.customers</code></p>
</li>
<li>
<p><code>fulfillment.public.orders</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-meta-information"><a class="anchor" href="#postgresql-meta-information"></a>Meta information</h3>
<div class="paragraph">
<p>In addition to a <a href="#postgresql-events"><em>database change event</em></a>, each record produced by a PostgreSQL connector contains some metadata. Metadata includes where the event occurred on the server, the name of the source partition and the name of the Kafka topic and partition where the event should go, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"sourcePartition": {
     "server": "fulfillment"
 },
 "sourceOffset": {
     "lsn": "24023128",
     "txId": "555",
     "ts_ms": "1482918357011"
 },
 "kafkaPartition": null</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sourcePartition</code> always defaults to the setting of the <code>database.server.name</code> connector configuration property.</p>
</li>
<li>
<p><code>sourceOffset</code> contains information about the location of the server where the event occurred:</p>
<div class="ulist">
<ul>
<li>
<p><code>lsn</code> represents the PostgreSQL <a href="https://www.postgresql.org/docs/current/static/datatype-pg-lsn.html">Log Sequence Number</a> or <code>offset</code> in the transaction log.</p>
</li>
<li>
<p><code>txId</code> represents the identifier of the server transaction that caused the event.</p>
</li>
<li>
<p><code>ts_ms</code> represents the server time at which the transaction was committed in the form of the number of milliseconds since the epoch.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>kafkaPartition</code> with a setting of <code>null</code> means that the connector does not use a specific Kafka partition. The PostgreSQL connector uses only one Kafka Connect partition and it places the generated events into one Kafka partition.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-transaction-metadata"><a class="anchor" href="#postgresql-transaction-metadata"></a>Transaction metadata</h3>
<div class="paragraph">
<p>Debezium can generate events that represent transaction boundaries and that enrich data change event messages. For every transaction <code>BEGIN</code> and <code>END</code>, Debezium generates an event that contains the following fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>status</code> - <code>BEGIN</code> or <code>END</code></p>
</li>
<li>
<p><code>id</code> - string representation of unique transaction identifier</p>
</li>
<li>
<p><code>event_count</code> (for <code>END</code> events) - total number of events emitted by the transaction</p>
</li>
<li>
<p><code>data_collections</code> (for <code>END</code> events) - an array of pairs of <code>data_collection</code> and <code>event_count</code> that provides the number of events emitted by changes originating from given data collection</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "status": "BEGIN",
  "id": "571",
  "event_count": null,
  "data_collections": null
}

{
  "status": "END",
  "id": "571",
  "event_count": 2,
  "data_collections": [
    {
      "data_collection": "s1.a",
      "event_count": 1
    },
    {
      "data_collection": "s2.a",
      "event_count": 1
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Transaction events are written to the topic named <code><em>database.server.name</em>.transaction</code>.</p>
</div>
<div class="paragraph">
<div class="title">Change data event enrichment</div>
<p>When transaction metadata is enabled the data message <code>Envelope</code> is enriched with a new <code>transaction</code> field.
This field provides information about every event in the form of a composite of fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>id</code> - string representation of unique transaction identifier</p>
</li>
<li>
<p><code>total_order</code> - absolute position of the event among all events generated by the transaction</p>
</li>
<li>
<p><code>data_collection_order</code> - the per-data collection position of the event among all events that were emitted by the transaction</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Following is an example of a message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "before": null,
  "after": {
    "pk": "2",
    "aa": "1"
  },
  "source": {
...
  },
  "op": "c",
  "ts_ms": "1580390884335",
  "transaction": {
    "id": "571",
    "total_order": "1",
    "data_collection_order": "1"
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="postgresql-events"><a class="anchor" href="#postgresql-events"></a>Data change events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Debezium PostgreSQL connector generates a data change event for each row-level <code>INSERT</code>, <code>UPDATE</code>, and <code>DELETE</code> operation. Each event contains a key and a value. The structure of the key and the value depends on the table that was changed.</p>
</div>
<div class="paragraph">
<p>Debezium and Kafka Connect are designed around <em>continuous streams of event messages</em>. However, the structure of these events may change over time, which can be difficult for consumers to handle. To address this, each event contains the schema for its content or, if you are using a schema registry, a schema ID that a consumer can use to obtain the schema from the registry. This makes each event self-contained.</p>
</div>
<div class="paragraph">
<p>The following skeleton JSON shows the basic four parts of a change event. However, how you configure the Kafka Connect converter that you choose to use in your application determines the representation of these four parts in change events. A <code>schema</code> field is in a change event only when you configure the converter to produce it. Likewise, the event key and event payload are in a change event only if you configure a converter to produce it. If you use the JSON converter and you configure it to produce all four basic change event parts, change events have this structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
 "schema": { <i class="conum" data-value="1"></i><b>(1)</b>
   ...
  },
 "payload": { <i class="conum" data-value="2"></i><b>(2)</b>
   ...
 },
 "schema": { <i class="conum" data-value="3"></i><b>(3)</b>
   ...
 },
 "payload": { <i class="conum" data-value="4"></i><b>(4)</b>
   ...
 },
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Overview of change event basic content</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Field name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>schema</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The first <code>schema</code> field is part of the event key. It specifies a Kafka Connect schema that describes what is in the event key&#8217;s <code>payload</code> portion. In other words, the first <code>schema</code> field describes the structure of the primary key, or the unique key if the table does not have a primary key, for the table that was changed.<br>
<br>
It is possible to override the table&#8217;s primary key by setting the <a href="#postgresql-property-message-key-columns"><code>message.key.columns</code> connector configuration property</a>. In this case, the first schema field describes the structure of the key identified by that property.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>payload</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The first <code>payload</code> field is part of the event key. It has the structure described by the previous <code>schema</code> field and it contains the key for the row that was changed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>schema</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The second <code>schema</code> field is part of the event value. It specifies the Kafka Connect schema that describes what is in the event value&#8217;s <code>payload</code> portion. In other words, the second <code>schema</code> describes the structure of the row that was changed. Typically, this schema contains nested schemas.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>payload</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The second <code>payload</code> field is part of the event value. It has the structure described by the previous <code>schema</code> field and it contains the actual data for the row that was changed.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>By default behavior is that the connector streams change event records to <a href="#postgresql-topic-names">topics with names that are the same as the event&#8217;s originating table</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Starting with Kafka 0.10, Kafka can optionally record the event key and value with the <a href="https://kafka.apache.org/documentation.html#upgrade_10_performance_impact"><em>timestamp</em></a> at which the message was created (recorded by the producer) or written to the log by Kafka.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The PostgreSQL connector ensures that all Kafka Connect schema names adhere to the <a href="http://avro.apache.org/docs/current/spec.html#names">Avro schema name format</a>. This means that the logical server name must start with a Latin letter or an underscore, that is, a-z, A-Z, or _. Each remaining character in the logical server name and each character in the schema and table names must be a Latin letter, a digit, or an underscore, that is, a-z, A-Z, 0-9, or \_. If there is an invalid character it is replaced with an underscore character.</p>
</div>
<div class="paragraph">
<p>This can lead to unexpected conflicts if the logical server name, a schema name, or a table name contains invalid characters, and the only characters that distinguish names from one another are invalid and thus replaced with underscores.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="postgresql-change-events-key"><a class="anchor" href="#postgresql-change-events-key"></a>Change event keys</h3>
<div class="paragraph">
<p>For a given table, the change event&#8217;s key has a structure that contains a field for each column in the primary key of the table at the time the event was created. Alternatively, if the table has <code>REPLICA IDENTITY</code> set to <code>FULL</code> or <code>USING INDEX</code> there is a field for each unique key constraint.</p>
</div>
<div class="paragraph">
<p>Consider a <code>customers</code> table defined in the <code>public</code> database schema and the example of a change event key for that table.</p>
</div>
<div class="listingblock">
<div class="title">Example table</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE TABLE customers (
  id SERIAL,
  first_name VARCHAR(255) NOT NULL,
  last_name VARCHAR(255) NOT NULL,
  email VARCHAR(255) NOT NULL,
  PRIMARY KEY(id)
);</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Example change event key</div>
<p>If the <code>database.server.name</code> connector configuration property has the value <code>PostgreSQL_server</code>, every change event for the <code>customers</code> table while it has this definition has the same key structure, which in JSON looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "schema": { <i class="conum" data-value="1"></i><b>(1)</b>
    "type": "struct",
    "name": "PostgreSQL_server.public.customers.Key", <i class="conum" data-value="2"></i><b>(2)</b>
    "optional": false, <i class="conum" data-value="3"></i><b>(3)</b>
    "fields": [ <i class="conum" data-value="4"></i><b>(4)</b>
          {
              "name": "id",
              "index": "0",
              "schema": {
                  "type": "INT32",
                  "optional": "false"
              }
          }
      ]
  },
  "payload": { <i class="conum" data-value="5"></i><b>(5)</b>
      "id": "1"
  },
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Description of change event key</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Field name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>schema</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The schema portion of the key specifies a Kafka Connect schema that describes what is in the key&#8217;s <code>payload</code> portion.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PostgreSQL_server.inventory.customers.Key</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name of the schema that defines the structure of the key&#8217;s payload. This schema describes the structure of the primary key for the table that was changed. Key schema names have the format <em>connector-name</em>.<em>database-name</em>.<em>table-name</em>.<code>Key</code>. In this example:<br></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PostgreSQL_server</code> is the name of the connector that generated this event.<br></p>
</li>
<li>
<p><code>inventory</code> is the database that contains the table that was changed.<br></p>
</li>
<li>
<p><code>customers</code> is the table that was updated.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>optional</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether the event key must contain a value in its <code>payload</code> field. In this example, a value in the key&#8217;s payload is required. A value in the key&#8217;s payload field is optional when a table does not have a primary key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fields</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies each field that is expected in the <code>payload</code>, including each field&#8217;s name, index, and schema.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>payload</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the key for the row for which this change event was generated. In this example, the key, contains a single <code>id</code> field whose value is <code>1</code>.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Although the <code>column.exclude.list</code> and <code>column.include.list</code> connector configuration properties allow you to capture only a subset of table columns, all columns in a primary or unique key are always included in the event&#8217;s key.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the table does not have a primary or unique key, then the change event&#8217;s key is null. The rows in a table without a primary or unique key constraint cannot be uniquely identified.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-change-events-value"><a class="anchor" href="#postgresql-change-events-value"></a>Change event values</h3>
<div class="paragraph">
<p>The value in a change event is a bit more complicated than the key. Like the key, the value has a <code>schema</code> section and a <code>payload</code> section. The <code>schema</code> section contains the schema that describes the <code>Envelope</code> structure of the <code>payload</code> section, including its nested fields. Change events for operations that create, update or delete data all have a value payload with an envelope structure.</p>
</div>
<div class="paragraph">
<p>Consider the same sample table that was used to show an example of a change event key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE TABLE customers (
  id SERIAL,
  first_name VARCHAR(255) NOT NULL,
  last_name VARCHAR(255) NOT NULL,
  email VARCHAR(255) NOT NULL,
  PRIMARY KEY(id)
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The value portion of a change event for a change to this table varies according to the <code>REPLICA IDENTITY</code> setting and the operation that the event is for.</p>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-replica-identity"><a class="anchor" href="#postgresql-replica-identity"></a>Replica identity</h3>
<div class="paragraph">
<p><a href="https://www.postgresql.org/docs/current/static/sql-altertable.html#SQL-CREATETABLE-REPLICA-IDENTITY">REPLICA IDENTITY</a> is a PostgreSQL-specific table-level setting that determines the amount of information that is available to the logical decoding plug-in for <code>UPDATE</code> and <code>DELETE</code> events. More specifically, the setting of <code>REPLICA IDENTITY</code> controls what (if any) information is available for the previous values of the table columns involved, whenever an <code>UPDATE</code> or <code>DELETE</code> event occurs.</p>
</div>
<div class="paragraph">
<p>There are 4 possible values for <code>REPLICA IDENTITY</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DEFAULT</code> - The default behavior is that <code>UPDATE</code> and <code>DELETE</code> events contain the previous values for the primary key columns of a table if that table has a primary key. For an <code>UPDATE</code> event, only the primary key columns with changed values are present.</p>
<div class="paragraph">
<p>If a table does not have a primary key, the connector does not emit <code>UPDATE</code> or <code>DELETE</code> events for that table. For a table without a primary key, the connector emits only <em>create</em> events. Typically, a table without a primary key is used for appending messages to the end of the table, which means that <code>UPDATE</code> and <code>DELETE</code> events are not useful.</p>
</div>
</li>
<li>
<p><code>NOTHING</code> - Emitted events for <code>UPDATE</code> and <code>DELETE</code> operations do not contain any information about the previous value of any table column.</p>
</li>
<li>
<p><code>FULL</code> - Emitted events for <code>UPDATE</code> and <code>DELETE</code> operations contain the previous values of all columns in the table.</p>
</li>
<li>
<p><code>INDEX</code> <em>index-name</em> - Emitted events for <code>UPDATE</code> and <code>DELETE</code> operations contain the previous values of the columns contained in the specified index. <code>UPDATE</code> events also contain the indexed columns with the updated values.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-create-events"><a class="anchor" href="#postgresql-create-events"></a><em>create</em> events</h3>
<div class="paragraph">
<p>The following example shows the value portion of a change event that the connector generates for an operation that creates data in the <code>customers</code> table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
    "schema": { <i class="conum" data-value="1"></i><b>(1)</b>
        "type": "struct",
        "fields": [
            {
                "type": "struct",
                "fields": [
                    {
                        "type": "int32",
                        "optional": false,
                        "field": "id"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "first_name"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "last_name"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "email"
                    }
                ],
                "optional": true,
                "name": "PostgreSQL_server.inventory.customers.Value", <i class="conum" data-value="2"></i><b>(2)</b>
                "field": "before"
            },
            {
                "type": "struct",
                "fields": [
                    {
                        "type": "int32",
                        "optional": false,
                        "field": "id"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "first_name"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "last_name"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "email"
                    }
                ],
                "optional": true,
                "name": "PostgreSQL_server.inventory.customers.Value",
                "field": "after"
            },
            {
                "type": "struct",
                "fields": [
                    {
                        "type": "string",
                        "optional": false,
                        "field": "version"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "connector"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "name"
                    },
                    {
                        "type": "int64",
                        "optional": false,
                        "field": "ts_ms"
                    },
                    {
                        "type": "boolean",
                        "optional": true,
                        "default": false,
                        "field": "snapshot"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "db"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "schema"
                    },
                    {
                        "type": "string",
                        "optional": false,
                        "field": "table"
                    },
                    {
                        "type": "int64",
                        "optional": true,
                        "field": "txId"
                    },
                    {
                        "type": "int64",
                        "optional": true,
                        "field": "lsn"
                    },
                    {
                        "type": "int64",
                        "optional": true,
                        "field": "xmin"
                    }
                ],
                "optional": false,
                "name": "io.debezium.connector.postgresql.Source", <i class="conum" data-value="3"></i><b>(3)</b>
                "field": "source"
            },
            {
                "type": "string",
                "optional": false,
                "field": "op"
            },
            {
                "type": "int64",
                "optional": true,
                "field": "ts_ms"
            }
        ],
        "optional": false,
        "name": "PostgreSQL_server.inventory.customers.Envelope" <i class="conum" data-value="4"></i><b>(4)</b>
    },
    "payload": { <i class="conum" data-value="5"></i><b>(5)</b>
        "before": null, <i class="conum" data-value="6"></i><b>(6)</b>
        "after": { <i class="conum" data-value="7"></i><b>(7)</b>
            "id": 1,
            "first_name": "Anne",
            "last_name": "Kretchmar",
            "email": "annek@noanswer.org"
        },
        "source": { <i class="conum" data-value="8"></i><b>(8)</b>
            "version": "1.6.0.Alpha1",
            "connector": "postgresql",
            "name": "PostgreSQL_server",
            "ts_ms": 1559033904863,
            "snapshot": true,
            "db": "postgres",
            "sequence": "[\"24023119\",\"24023128\"]"
            "schema": "public",
            "table": "customers",
            "txId": 555,
            "lsn": 24023128,
            "xmin": null
        },
        "op": "c", <i class="conum" data-value="9"></i><b>(9)</b>
        "ts_ms": 1559033904863 <i class="conum" data-value="10"></i><b>(10)</b>
    }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Descriptions of <em>create</em> event value fields</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Field name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>schema</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value&#8217;s schema, which describes the structure of the value&#8217;s payload. A change event&#8217;s value schema is the same in every change event that the connector generates for a particular table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>In the <code>schema</code> section, each <code>name</code> field specifies the schema for a field in the value&#8217;s payload.<br>
<br>
<code>PostgreSQL_server.inventory.customers.Value</code> is the schema for the payload&#8217;s <code>before</code> and <code>after</code> fields. This schema is specific to the <code>customers</code> table.<br>
<br>
Names of schemas for <code>before</code> and <code>after</code> fields are of the form <code><em>logicalName</em>.<em>tableName</em>.Value</code>, which ensures that the schema name is unique in the database. This means that when using the <a href="../configuration/avro.html" class="page">Avro converter</a>, the resulting Avro schema for each table in each logical source has its own evolution and history.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.connector.postgresql.Source</code> is the schema for the payload&#8217;s <code>source</code> field. This schema is specific to the PostgreSQL connector. The connector uses it for all events that it generates.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>PostgreSQL_server.inventory.customers.Envelope</code> is the schema for the overall structure of the payload, where <code>PostgreSQL_server</code> is the connector name, <code>inventory</code> is the database, and <code>customers</code> is the table.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>payload</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value&#8217;s actual data. This is the information that the change event is providing.<br>
<br>
It may appear that the JSON representations of the events are much larger than the rows they describe. This is because the JSON representation must include the schema and the payload portions of the message.
However, by using the <a href="../configuration/avro.html" class="page">Avro converter</a>, you can significantly decrease the size of the messages that the connector streams to Kafka topics.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>before</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional field that specifies the state of the row before the event occurred. When the <code>op</code> field is <code>c</code> for create, as it is in this example, the <code>before</code> field is <code>null</code> since this change event is for new content. <br>
<br></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Whether or not this field is available is dependent on the <a href="#postgresql-replica-identity"><code>REPLICA IDENTITY</code></a> setting for each table.</p>
</div>
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>after</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional field that specifies the state of the row after the event occurred. In this example, the <code>after</code> field contains the values of the new row&#8217;s <code>id</code>, <code>first_name</code>, <code>last_name</code>, and <code>email</code> columns.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>source</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory field that describes the source metadata for the event. This field contains information that you can use to compare this event with other events, with regard to the origin of the events, the order in which the events occurred, and whether events were part of the same transaction. The source metadata includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Debezium version</p>
</li>
<li>
<p>Connector type and name</p>
</li>
<li>
<p>Database and table that contains the new row</p>
</li>
<li>
<p>Stringified JSON array of additional offset information. The first value is always the last committed LSN, the second value is always the current LSN. Either value may be <code>null</code>.</p>
</li>
<li>
<p>Schema name</p>
</li>
<li>
<p>If the event was part of a snapshot</p>
</li>
<li>
<p>ID of the transaction in which the operation was performed</p>
</li>
<li>
<p>Offset of the operation in the database log</p>
</li>
<li>
<p>Timestamp for when the change was made in the database</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>op</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory string that describes the type of operation that caused the connector to generate the event. In this example, <code>c</code> indicates that the operation created a row. Valid values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>c</code> = create</p>
</li>
<li>
<p><code>u</code> = update</p>
</li>
<li>
<p><code>d</code> = delete</p>
</li>
<li>
<p><code>r</code> = read (applies to only snapshots)</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ts_ms</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Optional field that displays the time at which the connector processed the event. The time is based on the system clock in the JVM running the Kafka Connect task. <br>
<br>
In the <code>source</code> object, <code>ts_ms</code> indicates the time that the change was made in the database. By comparing the value for <code>payload.source.ts_ms</code> with the value for <code>payload.ts_ms</code>, you can determine the lag between the source database update and Debezium.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="postgresql-update-events"><a class="anchor" href="#postgresql-update-events"></a><em>update</em> events</h3>
<div class="paragraph">
<p>The value of a change event for an update in the sample <code>customers</code> table has the same schema as a <em>create</em> event for that table. Likewise, the event value&#8217;s payload has the same structure. However, the event value payload contains different values in an <em>update</em> event. Here is an example of a change event value in an event that the connector generates for an update in the <code>customers</code> table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
    "schema": { ... },
    "payload": {
        "before": { <i class="conum" data-value="1"></i><b>(1)</b>
            "id": 1
        },
        "after": { <i class="conum" data-value="2"></i><b>(2)</b>
            "id": 1,
            "first_name": "Anne Marie",
            "last_name": "Kretchmar",
            "email": "annek@noanswer.org"
        },
        "source": { <i class="conum" data-value="3"></i><b>(3)</b>
            "version": "1.6.0.Alpha1",
            "connector": "postgresql",
            "name": "PostgreSQL_server",
            "ts_ms": 1559033904863,
            "snapshot": false,
            "db": "postgres",
            "schema": "public",
            "table": "customers",
            "txId": 556,
            "lsn": 24023128,
            "xmin": null
        },
        "op": "u", <i class="conum" data-value="4"></i><b>(4)</b>
        "ts_ms": 1465584025523  <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Descriptions of <em>update</em> event value fields</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Field name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>before</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional field that contains values that were in the row before the database commit. In this example, only the primary key column, <code>id</code>, is present because the table&#8217;s <a href="#postgresql-replica-identity"><code>REPLICA IDENTITY</code></a> setting is, by default, <code>DEFAULT</code>.
+
For an <em>update</em> event to contain the previous values of all columns in the row, you would have to change the <code>customers</code> table by running <code>ALTER TABLE customers REPLICA IDENTITY FULL</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>after</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional field that specifies the state of the row after the event occurred. In this example, the <code>first_name</code> value is now <code>Anne Marie</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>source</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory field that describes the source metadata for the event. The <code>source</code> field structure has the same fields as in a <em>create</em> event, but some values are different. The source metadata includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Debezium version</p>
</li>
<li>
<p>Connector type and name</p>
</li>
<li>
<p>Database and table that contains the new row</p>
</li>
<li>
<p>Schema name</p>
</li>
<li>
<p>If the event was part of a snapshot (alwas <code>false</code> for <em>update</em> events)</p>
</li>
<li>
<p>ID of the transaction in which the operation was performed</p>
</li>
<li>
<p>Offset of the operation in the database log</p>
</li>
<li>
<p>Timestamp for when the change was made in the database</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>op</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory string that describes the type of operation. In an <em>update</em> event value, the <code>op</code> field value is <code>u</code>, signifying that this row changed because of an update.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ts_ms</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Optional field that displays the time at which the connector processed the event. The time is based on the system clock in the JVM running the Kafka Connect task. <br>
<br>
In the <code>source</code> object, <code>ts_ms</code> indicates the time that the change was made in the database. By comparing the value for <code>payload.source.ts_ms</code> with the value for <code>payload.ts_ms</code>, you can determine the lag between the source database update and Debezium.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Updating the columns for a row&#8217;s primary/unique key changes the value of the row&#8217;s key. When a key changes, Debezium outputs <em>three</em> events: a <code>DELETE</code> event and a <a href="#postgresql-tombstone-events">tombstone event</a> with the old key for the row, followed by an event with the new key for the row. Details are in the next section.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-primary-key-updates"><a class="anchor" href="#postgresql-primary-key-updates"></a>Primary key updates</h3>
<div class="paragraph">
<p>An <code>UPDATE</code> operation that changes a row&#8217;s primary key field(s) is known
as a primary key change. For a primary key change, in place of sending an <code>UPDATE</code> event record, the connector sends a <code>DELETE</code> event record for the old key and a <code>CREATE</code> event record for the new (updated) key. These events have the usual structure and content, and in addition, each one has a message header related to the primary key change:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>DELETE</code> event record has <code>__debezium.newkey</code> as a message header. The value of this header is the new primary key for the updated row.</p>
</li>
<li>
<p>The <code>CREATE</code> event record has <code>__debezium.oldkey</code> as a message header. The value of this header is the previous (old) primary key that the updated row had.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-delete-events"><a class="anchor" href="#postgresql-delete-events"></a><em>delete</em> events</h3>
<div class="paragraph">
<p>The value in a <em>delete</em> change event has the same <code>schema</code> portion as <em>create</em> and <em>update</em> events for the same table. The <code>payload</code> portion in a <em>delete</em> event for the sample <code>customers</code> table looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "schema": { ... },
    "payload": {
        "before": { <i class="conum" data-value="1"></i><b>(1)</b>
            "id": 1
        },
        "after": null, <i class="conum" data-value="2"></i><b>(2)</b>
        "source": { <i class="conum" data-value="3"></i><b>(3)</b>
            "version": "1.6.0.Alpha1",
            "connector": "postgresql",
            "name": "PostgreSQL_server",
            "ts_ms": 1559033904863,
            "snapshot": false,
            "db": "postgres",
            "schema": "public",
            "table": "customers",
            "txId": 556,
            "lsn": 46523128,
            "xmin": null
        },
        "op": "d", <i class="conum" data-value="4"></i><b>(4)</b>
        "ts_ms": 1465581902461 <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Descriptions of <em>delete</em> event value fields</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Field name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>before</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional field that specifies the state of the row before the event occurred. In a <em>delete</em> event value, the <code>before</code> field contains the values that were in the row before it was deleted with the database commit.<br>
<br>
In this example, the <code>before</code> field contains only the primary key column because the table&#8217;s <a href="#postgresql-replica-identity"><code>REPLICA IDENTITY</code></a> setting is <code>DEFAULT</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>after</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional field that specifies the state of the row after the event occurred. In a <em>delete</em> event value, the <code>after</code> field is <code>null</code>, signifying that the row no longer exists.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>source</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory field that describes the source metadata for the event. In a <em>delete</em> event value, the <code>source</code> field structure is the same as for <em>create</em> and <em>update</em> events for the same table. Many <code>source</code> field values are also the same. In a <em>delete</em> event value, the <code>ts_ms</code> and <code>lsn</code> field values, as well as other values, might have changed. But the <code>source</code> field in a <em>delete</em> event value provides the same metadata:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Debezium version</p>
</li>
<li>
<p>Connector type and name</p>
</li>
<li>
<p>Database and table that contained the deleted row</p>
</li>
<li>
<p>Schema name</p>
</li>
<li>
<p>If the event was part of a snapshot (alwas <code>false</code> for <em>delete</em> events)</p>
</li>
<li>
<p>ID of the transaction in which the operation was performed</p>
</li>
<li>
<p>Offset of the operation in the database log</p>
</li>
<li>
<p>Timestamp for when the change was made in the database</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>op</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory string that describes the type of operation. The <code>op</code> field value is <code>d</code>, signifying that this row was deleted.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ts_ms</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Optional field that displays the time at which the connector processed the event. The time is based on the system clock in the JVM running the Kafka Connect task. <br>
<br>
In the <code>source</code> object, <code>ts_ms</code> indicates the time that the change was made in the database. By comparing the value for <code>payload.source.ts_ms</code> with the value for <code>payload.ts_ms</code>, you can determine the lag between the source database update and Debezium.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A <em>delete</em> change event record provides a consumer with the information it needs to process the removal of this row.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For a consumer to be able to process a <em>delete</em> event generated for a table that does not have a primary key, set the table&#8217;s <code>REPLICA IDENTITY</code> to <code>FULL</code>. When a table does not have a primary key and the table&#8217;s <code>REPLICA IDENTITY</code> is set to <code>DEFAULT</code> or <code>NOTHING</code>, a <em>delete</em> event has no <code>before</code> field.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>PostgreSQL connector events are designed to work with <a href="https://kafka.apache.org/documentation#compaction">Kafka log compaction</a>. Log compaction enables removal of some older messages as long as at least the most recent message for every key is kept. This lets Kafka reclaim storage space while ensuring that the topic contains a complete data set and can be used for reloading key-based state.</p>
</div>
<div id="postgresql-tombstone-events" class="paragraph">
<div class="title">Tombstone events</div>
<p>When a row is deleted, the <em>delete</em> event value still works with log compaction, because Kafka can remove all earlier messages that have that same key. However, for Kafka to remove all messages that have that same key, the message value must be <code>null</code>. To make this possible, the PostgreSQL connector follows a <em>delete</em> event with a special <em>tombstone</em> event that has the same key but a <code>null</code> value.</p>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-truncate-events"><a class="anchor" href="#postgresql-truncate-events"></a><em>truncate</em> events</h3>
<div class="paragraph">
<p>A  <em>truncate</em> change event signals that a table has been truncated.
The message key is <code>null</code> in this case, the message value looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "schema": { ... },
    "payload": {
        "source": { <i class="conum" data-value="1"></i><b>(1)</b>
            "version": "1.6.0.Alpha1",
            "connector": "postgresql",
            "name": "PostgreSQL_server",
            "ts_ms": 1559033904863,
            "snapshot": false,
            "db": "postgres",
            "schema": "public",
            "table": "customers",
            "txId": 556,
            "lsn": 46523128,
            "xmin": null
        },
        "op": "t", <i class="conum" data-value="2"></i><b>(2)</b>
        "ts_ms": 1559033904961 <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Descriptions of <em>truncate</em> event value fields</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Field name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>source</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory field that describes the source metadata for the event. In a <em>truncate</em> event value, the <code>source</code> field structure is the same as for <em>create</em>, <em>update</em>, and <em>delete</em> events for the same table, provides this metadata:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Debezium version</p>
</li>
<li>
<p>Connector type and name</p>
</li>
<li>
<p>Database and table that contains the new row</p>
</li>
<li>
<p>Schema name</p>
</li>
<li>
<p>If the event was part of a snapshot (alwas <code>false</code> for <em>delete</em> events)</p>
</li>
<li>
<p>ID of the transaction in which the operation was performed</p>
</li>
<li>
<p>Offset of the operation in the database log</p>
</li>
<li>
<p>Timestamp for when the change was made in the database</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>op</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mandatory string that describes the type of operation. The <code>op</code> field value is <code>t</code>, signifying that this table was truncated.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ts_ms</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Optional field that displays the time at which the connector processed the event. The time is based on the system clock in the JVM running the Kafka Connect task. <br>
<br>
In the <code>source</code> object, <code>ts_ms</code> indicates the time that the change was made in the database. By comparing the value for <code>payload.source.ts_ms</code> with the value for <code>payload.ts_ms</code>, you can determine the lag between the source database update and Debezium.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In case a single <code>TRUNCATE</code> statement applies to multiple tables,
one <em>truncate</em> change event record for each truncated table will be emitted.</p>
</div>
<div class="paragraph">
<p>Note that since <em>truncate</em> events represent a change made to an entire table and don&#8217;t have a message key,
unless you&#8217;re working with topics with a single partition,
there are no ordering guarantees for the change events pertaining to a table (<em>create</em>, <em>update</em>, etc.) and <em>truncate</em> events for that table.
For instance a consumer may receive an <em>update</em> event only after a <em>truncate</em> event for that table,
when those events are read from different partitions.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="postgresql-data-types"><a class="anchor" href="#postgresql-data-types"></a>Data type mappings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The PostgreSQL connector represents changes to rows with events that are structured like the table in which the row exists. The event contains a field for each column value. How that value is represented in the event depends on the PostgreSQL data type of the column. The following sections describe how the connector maps PostgreSQL data types to a <em>literal type</em> and a <em>semantic type</em> in event fields.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>literal type</em> describes how the value is literally represented using Kafka Connect schema types: <code>INT8</code>, <code>INT16</code>, <code>INT32</code>, <code>INT64</code>, <code>FLOAT32</code>, <code>FLOAT64</code>, <code>BOOLEAN</code>, <code>STRING</code>, <code>BYTES</code>, <code>ARRAY</code>, <code>MAP</code>, and <code>STRUCT</code>.</p>
</li>
<li>
<p><em>semantic type</em> describes how the Kafka Connect schema captures the <em>meaning</em> of the field using the name of the Kafka Connect schema for the field.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="postgresql-basic-types"><a class="anchor" href="#postgresql-basic-types"></a>Basic types</h3>
<div class="paragraph">
<p>The following table describes how the connector maps basic types.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Mappings for PostgreSQL basic data types</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 20%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PostgreSQL data type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name) and Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BOOLEAN</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BOOLEAN</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BIT(1)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BOOLEAN</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BIT( &gt; 1)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.Bits</code><br>
<br>
The <code>length</code> schema parameter contains an integer that represents the number of bits. The resulting <code>byte[]</code> contains the bits in little-endian form and is sized to contain the specified number of bits. For example, <code>numBytes = n/8 + (n % 8 == 0 ? 0 : 1)</code> where <code>n</code> is the number of bits.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BIT VARYING[(M)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.Bits</code><br>
<br>
The <code>length</code> schema parameter contains an integer that represents the number of bits (2^31 - 1 in case no length is given for the column). The resulting <code>byte[]</code> contains the bits in little-endian form and is sized based on the content. The specified size <code>(M)</code> is stored in the length parameter of the <code>io.debezium.data.Bits</code> type.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>SMALLINT</code>, <code>SMALLSERIAL</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT16</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INTEGER</code>, <code>SERIAL</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BIGINT</code>, <code>BIGSERIAL</code>, <code>OID</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>REAL</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>FLOAT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DOUBLE PRECISION</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>FLOAT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>CHAR[(M)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>VARCHAR[(M)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>CHARACTER[(M)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>CHARACTER VARYING[(M)]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIMESTAMPTZ</code>, <code>TIMESTAMP WITH TIME ZONE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.ZonedTimestamp</code><br>
<br>
A string representation of a timestamp with timezone information, where the timezone is GMT.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIMETZ</code>, <code>TIME WITH TIME ZONE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.ZonedTime</code><br>
<br>
A string representation of a time value with timezone information, where the timezone is GMT.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INTERVAL [P]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.MicroDuration</code><br>
(default)<br>
<br>
The approximate number of microseconds for a time interval using the <code>365.25 / 12.0</code> formula for days per month average.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INTERVAL [P]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.Interval</code><br>
(when <code>interval.handling.mode</code> is set to <code>string</code>)<br>
<br>
The string representation of the interval value that follows the pattern <code>P&lt;years&gt;Y&lt;months&gt;M&lt;days&gt;DT&lt;hours&gt;H&lt;minutes&gt;M&lt;seconds&gt;S</code>, for example,  <code>P1Y2M3DT4H5M6.78S</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTEA</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code> or <code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a<br>
<br>
Either the raw bytes (the default), a base64-encoded string, or a hex-encoded string, based on the connector&#8217;s <a href="#postgresql-property-binary-handling-mode">binary handling mode</a> setting.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>JSON</code>, <code>JSONB</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.Json</code><br>
<br>
Contains the string representation of a JSON document, array, or scalar.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>XML</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.Xml</code><br>
<br>
Contains the string representation of an XML document.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>UUID</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.Uuid</code><br>
<br>
Contains the string representation of a PostgreSQL UUID value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>POINT</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRUCT</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.geometry.Point</code><br>
<br>
Contains a structure with two <code>FLOAT64</code> fields, <code>(x,y)</code>. Each field represents the coordinates of a geometric point.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>LTREE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.Ltree</code><br>
<br>
Contains the string representation of a PostgreSQL LTREE value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>CITEXT</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INET</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT4RANGE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a<br>
<br>
Range of integer.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT8RANGE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a<br>
<br>
Range of <code>bigint</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>NUMRANGE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a<br>
<br>
Range of <code>numeric</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TSRANGE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a<br>
<br>
Contains the string representation of a timestamp range without a time zone.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TSTZRANGE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a<br>
<br>
Contains the string representation of a timestamp range with the local system time zone.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DATERANGE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a<br>
<br>
Contains the string representation of a date range. It always has an exclusive upper-bound.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>ENUM</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.Enum</code><br>
<br>
Contains the string representation of the PostgreSQL <code>ENUM</code> value. The set of allowed values is maintained in the <code>allowed</code> schema parameter.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="postgresql-temporal-types"><a class="anchor" href="#postgresql-temporal-types"></a>Temporal types</h3>
<div class="paragraph">
<p>Other than PostgreSQL&#8217;s <code>TIMESTAMPTZ</code> and <code>TIMETZ</code> data types, which contain time zone information, how temporal types are mapped depends on the value of the <code>time.precision.mode</code> connector configuration property. The following sections describe these mappings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#postgresql-time-precision-mode-adaptive"><code>time.precision.mode=adaptive</code></a></p>
</li>
<li>
<p><a href="#postgresql-time-precision-mode-adaptive-time-microseconds"><code>time.precision.mode=adaptive_time_microseconds</code></a></p>
</li>
<li>
<p><a href="#postgresql-time-precision-mode-connect"><code>time.precision.mode=connect</code></a></p>
</li>
</ul>
</div>
<div id="postgresql-time-precision-mode-adaptive" class="paragraph">
<div class="title"><code>time.precision.mode=adaptive</code></div>
<p>When the <code>time.precision.mode</code> property is set to <code>adaptive</code>, the default, the connector determines the literal type and semantic type based on the column&#8217;s data type definition. This ensures that events <em>exactly</em> represent the values in the database.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Mappings when <code>time.precision.mode</code> is <code>adaptive</code></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 20%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PostgreSQL data type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name) and Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DATE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.Date</code><br>
<br>
Represents the number of days since the epoch.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIME(1)</code>, <code>TIME(2)</code>, <code>TIME(3)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.Time</code><br>
<br>
Represents the number of milliseconds past midnight, and does not include timezone information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIME(4)</code>, <code>TIME(5)</code>, <code>TIME(6)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.MicroTime</code><br>
<br>
Represents the number of microseconds past midnight, and does not include timezone information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIMESTAMP(1)</code>, <code>TIMESTAMP(2)</code>, <code>TIMESTAMP(3)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.Timestamp</code><br>
<br>
Represents the number of milliseconds since the epoch, and does not include timezone information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIMESTAMP(4)</code>, <code>TIMESTAMP(5)</code>, <code>TIMESTAMP(6)</code>, <code>TIMESTAMP</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.MicroTimestamp</code><br>
<br>
Represents the number of microseconds since the epoch, and does not include timezone information.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div id="postgresql-time-precision-mode-adaptive-time-microseconds" class="paragraph">
<div class="title"><code>time.precision.mode=adaptive_time_microseconds</code></div>
<p>When the <code>time.precision.mode</code> configuration property is set to <code>adaptive_time_microseconds</code>, the connector determines the literal type and semantic type for temporal types based on the column&#8217;s data type definition. This ensures that events <em>exactly</em> represent the values in the database, except all <code>TIME</code> fields are captured as microseconds.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Mappings when <code>time.precision.mode</code> is <code>adaptive_time_microseconds</code></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 20%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PostgreSQL data type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name) and Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DATE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.Date</code><br>
<br>
Represents the number of days since the epoch.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIME([P])</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.MicroTime</code><br>
<br>
Represents the time value in microseconds and does not include timezone information. PostgreSQL allows precision <code>P</code> to be in the range 0-6 to store up to microsecond precision.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIMESTAMP(1)</code> , <code>TIMESTAMP(2)</code>, <code>TIMESTAMP(3)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.Timestamp</code><br>
<br>
Represents the number of milliseconds past the epoch, and does not include timezone information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIMESTAMP(4)</code> , <code>TIMESTAMP(5)</code>, <code>TIMESTAMP(6)</code>, <code>TIMESTAMP</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.time.MicroTimestamp</code><br>
<br>
Represents the number of microseconds past the epoch, and does not include timezone information.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div id="postgresql-time-precision-mode-connect" class="paragraph">
<div class="title"><code>time.precision.mode=connect</code></div>
<p>When the <code>time.precision.mode</code> configuration property is set to <code>connect</code>, the connector uses Kafka Connect logical types. This may be useful when consumers can handle only the built-in Kafka Connect logical types and are unable to handle variable-precision time values. However, since PostgreSQL supports microsecond precision, the events generated by a connector with the <code>connect</code> time precision mode <strong>results in a loss of precision</strong> when the database column has a <em>fractional second precision</em> value that is greater than 3.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Mappings when <code>time.precision.mode</code> is <code>connect</code></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 20%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PostgreSQL data type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name) and Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DATE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT32</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Date</code><br>
<br>
Represents the number of days since the epoch.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIME([P])</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Time</code><br>
<br>
Represents the number of milliseconds since midnight, and does not include timezone information. PostgreSQL allows <code>P</code> to be in the range 0-6 to store up to microsecond precision, though this mode results in a loss of precision when <code>P</code> is greater than 3.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>TIMESTAMP([P])</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Timestamp</code><br>
<br>
Represents the number of milliseconds since the epoch, and does not include timezone information. PostgreSQL allows <code>P</code> to be in the range 0-6 to store up to microsecond precision, though this mode results in a loss of precision when <code>P</code> is greater than 3.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="postgresql-timestamp-type"><a class="anchor" href="#postgresql-timestamp-type"></a>TIMESTAMP type</h3>
<div class="paragraph">
<p>The <code>TIMESTAMP</code> type represents a timestamp without time zone information.
Such columns are converted into an equivalent Kafka Connect value based on UTC. For example, the <code>TIMESTAMP</code> value "2018-06-20 15:13:16.945104" is represented by an <code>io.debezium.time.MicroTimestamp</code> with the value "1529507596945104" when <code>time.precision.mode</code> is not set to <code>connect</code>.</p>
</div>
<div class="paragraph">
<p>The timezone of the JVM running Kafka Connect and Debezium does not affect this conversion.</p>
</div>
<div class="paragraph">
<p>PostgreSQL supports using <code>+/-infinite</code> values in <code>TIMESTAMP</code> columns.
These special values are converted to timestamps with value <code>9223372036825200000</code> in case of positive infinity or <code>-9223372036832400000</code> in case of negative infinity.
This behaviour mimics the standard behaviour of PostgreSQL JDBC driver - see <code>org.postgresql.PGStatement</code> interface for reference.</p>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-decimal-types"><a class="anchor" href="#postgresql-decimal-types"></a>Decimal types</h3>
<div class="paragraph">
<p>The setting of the PostgreSQL connector configuration property, <code>decimal.handling.mode</code> determines how the connector maps decimal types.</p>
</div>
<div class="paragraph">
<p>When the <code>decimal.handling.mode</code> property is set to <code>precise</code>, the connector uses the Kafka Connect <code>org.apache.kafka.connect.data.Decimal</code> logical type for all <code>DECIMAL</code> and <code>NUMERIC</code> columns. This is the default mode.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Mappings when <code>decimal.handling.mode</code> is <code>precise</code></caption>
<colgroup>
<col style="width: 28%;">
<col style="width: 17%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PostgreSQL data type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name) and Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>NUMERIC[(M[,D])]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Decimal</code><br>
<br>
The <code>scale</code> schema parameter contains an integer representing how many digits the decimal point was shifted.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DECIMAL[(M[,D])]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BYTES</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.apache.kafka.connect.data.Decimal</code><br>
<br>
The <code>scale</code> schema parameter contains an integer representing how many digits the decimal point was shifted.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There is an exception to this rule.
When the <code>NUMERIC</code> or <code>DECIMAL</code> types are used without scale constraints, the values coming from the database have a different (variable) scale for each value. In this case, the connector uses <code>io.debezium.data.VariableScaleDecimal</code>, which contains both the value and the scale of the transferred value.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Mappings of decimal types when there are no scale constraints</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 20%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PostgreSQL data type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name) and Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>NUMERIC</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRUCT</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.VariableScaleDecimal</code><br>
<br>
Contains a structure with two fields: <code>scale</code> of type <code>INT32</code> that contains the scale of the transferred value and <code>value</code> of type <code>BYTES</code> containing the original value in an unscaled form.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DECIMAL</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRUCT</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.VariableScaleDecimal</code><br>
<br>
Contains a structure with two fields: <code>scale</code> of type <code>INT32</code> that contains the scale of the transferred value and <code>value</code> of type <code>BYTES</code> containing the original value in an unscaled form.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the <code>decimal.handling.mode</code> property is set to <code>double</code>, the connector represents all <code>DECIMAL</code> and <code>NUMERIC</code> values as Java double values and encodes them as shown in the following table.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. Mappings when <code>decimal.handling.mode</code> is <code>double</code></caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PostgreSQL data type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>NUMERIC[(M[,D])]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>FLOAT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DECIMAL[(M[,D])]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>FLOAT64</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The last possible setting for the <code>decimal.handling.mode</code> configuration property is <code>string</code>. In this case, the connector represents <code>DECIMAL</code> and <code>NUMERIC</code> values as their formatted string representation, and encodes them as shown in the following table.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. Mappings when <code>decimal.handling.mode</code> is <code>string</code></caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PostgreSQL data type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>NUMERIC[(M[,D])]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DECIMAL[(M[,D])]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>PostgreSQL supports <code>NaN</code> (not a number) as a special value to be stored in <code>DECIMAL</code>/<code>NUMERIC</code> values when the setting of <code>decimal.handling.mode</code> is <code>string</code> or <code>double</code>. In this case, the connector encodes <code>NaN</code> as either <code>Double.NaN</code> or the string constant <code>NAN</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-hstore-type"><a class="anchor" href="#postgresql-hstore-type"></a>HSTORE type</h3>
<div class="paragraph">
<p>When the <code>hstore.handling.mode</code> connector configuration property is set to <code>json</code> (the default), the connector represents <code>HSTORE</code> values as string representations of JSON values and encodes them as shown in the following table. When the <code>hstore.handling.mode</code> property is set to <code>map</code>, the connector uses the <code>MAP</code> schema type for <code>HSTORE</code> values.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. Mappings for <code>HSTORE</code> data type</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 20%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PostgreSQL data type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name) and Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>HSTORE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.Json</code><br>
<br>
Example: output representation using the JSON converter is <code>{\"key\" : \"val\"}</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>HSTORE</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>MAP</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a<br>
<br>
Example: output representation  using the JSON converter is <code>{"key" : "val"}</code></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="postgresql-domain-types"><a class="anchor" href="#postgresql-domain-types"></a>Domain types</h3>
<div class="paragraph">
<p>PostgreSQL supports user-defined types that are based on other underlying types. When such column types are used, Debezium exposes the column&#8217;s representation based on the full type hierarchy.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Capturing changes in columns that use PostgreSQL domain types requires special consideration. When a column is defined to contain a domain type that extends one of the default database types and the domain type defines a custom length or scale, the generated schema inherits that defined length or scale.</p>
</div>
<div class="paragraph">
<p>When a column is defined to contain a domain type that extends another domain type that defines a custom length or scale, the generated schema does <strong>not</strong> inherit the defined length or scale because that information is not available in the PostgreSQL driver&#8217;s column metadata.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-network-address-types"><a class="anchor" href="#postgresql-network-address-types"></a>Network address types</h3>
<div class="paragraph">
<p>PostgreSQL has data types that can store IPv4, IPv6, and MAC addresses. It is better to use these types instead of plain text types to store network addresses. Network address types offer input error checking and specialized operators and functions.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. Mappings for network address types</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 20%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PostgreSQL data type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name) and Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INET</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a<br>
<br>
IPv4 and IPv6 networks</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>CIDR</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a<br>
<br>
IPv4 and IPv6 hosts and networks</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>MACADDR</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a<br>
<br>
MAC addresses</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>MACADDR8</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRING</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>n/a<br>
<br>
MAC addresses in EUI-64 format</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="postgresql-postgis-types"><a class="anchor" href="#postgresql-postgis-types"></a>PostGIS types</h3>
<div class="paragraph">
<p>The PostgreSQL connector supports all <a href="http://postgis.net">PostGIS data types</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. Mappings of PostGIS data types</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 20%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PostGIS data type</th>
<th class="tableblock halign-left valign-top">Literal type (schema type)</th>
<th class="tableblock halign-left valign-top">Semantic type (schema name) and Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>GEOMETRY</code><br>
(planar)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRUCT</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.geometry.Geometry</code><br>
<br>
Contains a structure with two fields:<br></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>srid (INT32)</code> - Spatial Reference System Identifier that defines what type of geometry object is stored in the structure.</p>
</li>
<li>
<p><code>wkb (BYTES)</code> - A binary representation of the geometry object encoded in the Well-Known-Binary format.<br></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For format details, see <a href="http://www.opengeospatial.org/standards/sfa">Open Geospatial Consortium Simple Features Access specification</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>GEOGRAPHY</code><br>
(spherical)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>STRUCT</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>io.debezium.data.geometry.Geography</code><br>
<br>
Contains a structure with two fields:<br></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>srid (INT32)</code> - Spatial Reference System Identifier that defines what type of geography object is stored in the structure.</p>
</li>
<li>
<p><code>wkb (BYTES)</code> - A binary representation of the geometry object encoded in the Well-Known-Binary format.<br></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For format details, see <a href="http://www.opengeospatial.org/standards/sfa">Open Geospatial Consortium Simple Features Access specification</a>.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="postgresql-toasted-values"><a class="anchor" href="#postgresql-toasted-values"></a>Toasted values</h3>
<div class="paragraph">
<p>PostgreSQL has a hard limit on the page size.
This means that values that are larger than around 8 KBs need to be stored by using link::https://www.postgresql.org/docs/current/storage-toast.html[TOAST storage].
This impacts replication messages that are coming from the database. Values that were stored by using the TOAST mechanism and that have not been changed are not included in the message, unless they are part of the table&#8217;s replica identity.
There is no safe way for Debezium to read the missing value out-of-bands directly from the database, as this would potentially lead to race conditions. Consequently, Debezium follows these rules to handle toasted values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tables with <code>REPLICA IDENTITY FULL</code> - TOAST column values are part of the <code>before</code> and <code>after</code> fields in change events just like any other column.</p>
</li>
<li>
<p>Tables with <code>REPLICA IDENTITY DEFAULT</code> - When receiving an <code>UPDATE</code> event from the database, any unchanged TOAST column value that is not part of the replica identity is not contained in the event.
Similarly, when receiving a <code>DELETE</code> event, no TOAST columns, if any, are  in the <code>before</code> field.
As Debezium cannot safely provide the column value in this case, the connector returns a placeholder value as defined by the connector configuration property, <code>toasted.value.placeholder</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There is a problem related to Amazon RDS instances. The <code>wal2json</code> plug-in has evolved over the time and there were releases that provided out-of-band toasted values. Amazon supports different versions of the plug-in for different PostgreSQL versions. See <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_PostgreSQL.html">Amazon&#8217;s documentation</a> to obtain version to version mapping. For consistent toasted values handling:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the <code>pgoutput</code> plug-in for PostgreSQL 10+ instances.</p>
</li>
<li>
<p>Set <code>include-unchanged-toast=0</code> for older versions of the <code>wal2json</code> plug-in by using the <code>slot.stream.params</code> configuration option.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setting-up-postgresql"><a class="anchor" href="#setting-up-postgresql"></a>Set up</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before using the PostgreSQL connector to monitor the changes committed on a PostgreSQL server, decide which logical decoding plug-in you intend to use.
If you plan <strong>not</strong> to use the native <code>pgoutput</code> logical replication stream support, then you must install the logical decoding plug-in into the PostgreSQL server. Afterward, enable a replication slot, and configure a user with sufficient privileges to perform the replication.</p>
</div>
<div class="paragraph">
<p>If your database is hosted by a service such as <a href="https://www.heroku.com/postgres">Heroku Postgres</a> you might be unable to install the plug-in. If so, and if you are using PostgreSQL 10+, you can use the <code>pgoutput</code> decoder support to capture changes in your database. If that is not an option, you are unable to use Debezium with your database.</p>
</div>
<div class="sect2">
<h3 id="postgresql-in-the-cloud"><a class="anchor" href="#postgresql-in-the-cloud"></a>PostgreSQL in the Cloud</h3>
<div class="sect3">
<h4 id="postgresql-on-amazon-rds"><a class="anchor" href="#postgresql-on-amazon-rds"></a>PostgreSQL on Amazon RDS</h4>
<div class="paragraph">
<p>It is possible to capture changes in a PostgreSQL database that is running in <a href="https://aws.amazon.com/rds/">Amazon RDS</a>. To do this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the instance parameter <code>rds.logical_replication</code> to <code>1</code>.</p>
</li>
<li>
<p>Verify that the <code>wal_level</code> parameter is set to <code>logical</code> by running the query <code>SHOW wal_level</code> as the database RDS master user.
This might not be the case in multi-zone replication setups.
You cannot set this option manually.
It is <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithParamGroups.html">automatically changed</a> when the <code>rds.logical_replication</code> parameter is set to <code>1</code>.
If the <code>wal_level</code> is not set to <code>logical</code> after you make the preceding change, it is probably because the instance has to be restarted after the parameter group change.
Restarts occur during your maintenance window, or you can initiate a restart manually.</p>
</li>
<li>
<p>Set the  Debezium <code>plugin.name</code> parameter to <code>wal2json</code>. You can skip this on PostgreSQL 10+ if you plan to use <code>pgoutput</code> logical replication stream support.</p>
</li>
<li>
<p>Initiate logical replication from an AWS account that has the <code>rds_replication</code> role.
The role grants permissions to manage logical slots and to stream data using logical slots.
By default, only the master user account on AWS has the <code>rds_replication</code> role on Amazon RDS.
To enable a user account other than the master account to initiate logical replication, you must grant the account the <code>rds_replication</code> role.
For example, <code>grant rds_replication to <em>&lt;my_user&gt;</em></code>. You must have <code>superuser</code> access to grant the <code>rds_replication</code> role to a user.
To enable accounts other than the master account to create an initial snapshot, you must grant <code>SELECT</code> permission to the accounts on the tables to be captured.
For more information about security for PostgreSQL logical replication, see the <a href="https://www.postgresql.org/docs/current/logical-replication-security.html">PostgreSQL documentation</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure that you use the latest versions of PostgreSQL 9.6, 10 or 11 on Amazon RDS.
Otherwise, older versions of the <code>wal2json</code> plug-in might be installed.
See <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_PostgreSQL.html">the official documentation</a> for the exact <code>wal2json</code> versions installed on Amazon RDS.
In the case of an older version, replication messages received from the database might not contain complete information about type constraints such as length or scale or <code>NULL</code>/<code>NOT NULL</code>. This might cause creation of messages with an inconsistent schema for a short period of time when there are changes to a column&#8217;s definition.</p>
</div>
<div class="paragraph">
<p>As of January 2019, the following PostgreSQL versions on RDS come with an up-to-date version of <code>wal2json</code> and thus should be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PostgreSQL 9.6: 9.6.10 and newer</p>
</li>
<li>
<p>PostgreSQL 10: 10.5 and newer</p>
</li>
<li>
<p>PostgreSQL 11: any version</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="postgresql-on-azure"><a class="anchor" href="#postgresql-on-azure"></a>PostgreSQL on Azure</h4>
<div class="paragraph">
<p>It is possible to use Debezium with<a href="https://docs.microsoft.com/azure/postgresql/">Azure Database for PostgreSQL</a>, which has support for the <code>wal2json</code> and<code>pgoutput</code>plug-ins, both of which are supported by Debezium as well.</p>
</div>
<div class="paragraph">
<p>Set the Azure replication support to<code>logical</code>. You can use the <a href="https://docs.microsoft.com/en-us/azure/postgresql/concepts-logical#using-azure-cli">Azure CLI</a> or the <a href="https://docs.microsoft.com/en-us/azure/postgresql/concepts-logical#using-azure-portal">Azure Portal</a> to configure this. For example, to use the Azure CLI, here are the <a href="https://docs.microsoft.com/cli/azure/postgres/server?view=azure-cli-latest"><code>az postgres server</code></a> commands that you need to execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>az postgres server configuration set --resource-group mygroup --server-name myserver --name azure.replication_support --value logical

az postgres server restart --resource-group mygroup --name myserver</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="postgresql-on-crunchybridge"><a class="anchor" href="#postgresql-on-crunchybridge"></a>PostgreSQL on CrunchyBridge</h4>
<div class="paragraph">
<p>It is possible to use Debezium with <a href="https://crunchybridge.com/">CrunchyBridge</a>; logical replication is already turned on. The <code>pgoutput</code> plugin is available. You will have to create a replication user and provide correct privileges.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While using the <code>pgoutput</code> plug-in, it is recommended that you configure <code>filtered</code> as the <a href="#postgresql-publication-autocreate-mode"><code>publication.autocreate.mode</code></a>. If you use <code>all_tables</code>, which is the default value for <code>publication.autocreate.mode</code>, and the publication is not found, the connector tries to create one by using<code>CREATE PUBLICATION &lt;publication_name&gt; FOR ALL TABLES;</code>, but this fails due to lack of permissions.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="installing-postgresql-output-plugin"><a class="anchor" href="#installing-postgresql-output-plugin"></a>Installing the logical decoding output plug-in</h3>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>See <a href="../postgres-plugins.html" class="page">Logical Decoding Output Plug-in Installation for PostgreSQL</a> for more detailed instructions for setting up and testing logical decoding plug-ins.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As of Debezium 0.10, the connector supports PostgreSQL 10+ logical replication streaming by using <code>pgoutput</code>.
This means that a logical decoding output plug-in is no longer necessary and changes can be emitted directly from the replication stream by the connector.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As of PostgreSQL 9.4, the only way to read changes to the write-ahead-log is to install a logical decoding output plug-in. Plug-ins are written in C, compiled, and installed on the machine that runs the PostgreSQL server. Plug-ins use  a number of PostgreSQL specific APIs, as described by the <a href="https://www.postgresql.org/docs/current/static/logicaldecoding-output-plugin.html">PostgreSQL documentation</a>.</p>
</div>
<div class="paragraph">
<p>The PostgreSQL connector works with one of Debezium&#8217;s supported logical decoding plug-ins to encode the changes in either <a href="https://github.com/google/protobuf">Protobuf format</a> or <a href="http://www.json.org/">JSON</a> format.
See the documentation for your chosen plug-in to learn more about the plug-in&#8217;s requirements, limitations, and how to compile it.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/debezium/postgres-decoderbufs/blob/master/README.md"><code>protobuf</code></a></p>
</li>
<li>
<p><a href="https://github.com/eulerto/wal2json/blob/master/README.md"><code>wal2json</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For simplicity, Debezium also provides a Docker image based on a vanilla PostgreSQL server image on top of which it compiles and installs the plug-ins. You can <a href="https://github.com/debezium/docker-images/tree/master/postgres/9.6">use this image</a> as an example of the detailed steps required for the installation.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Debezium logical decoding plug-ins have been installed and tested on only Linux machines. For Windows and other operating systems, different installation steps might be required.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-differences-between-plugins"><a class="anchor" href="#postgresql-differences-between-plugins"></a>Plug-in differences</h3>
<div class="paragraph">
<p>Plug-in behavior is not completely the same for all cases.
These differences have been identified:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>wal2json</code> and <code>decoderbufs</code> plug-ins emit events for tables without primary keys.</p>
</li>
<li>
<p>The <code>wal2json</code> plug-in does not support special values, such as <code>NaN</code> or <code>infinity</code>, for floating point types.</p>
</li>
<li>
<p>The <code>wal2json</code> plug-in should be used with the <code>schema.refresh.mode</code> connector configuration property set to <code>columns_diff_exclude_unchanged_toast</code>. Otherwise, when receiving a change event for a row that contains an unchanged <code>TOAST</code> column, no field for that column is contained in the emitted change event&#8217;s <code>after</code> field. This is because <code>wal2json</code> plug-in messages do not contain a field for such a column.</p>
<div class="paragraph">
<p>The requirement for adding this is tracked under the <a href="https://github.com/eulerto/wal2json/issues/98"><code>wal2json</code> issue 98</a>.
See the documentation of <code>columns_diff_exclude_unchanged_toast</code> further below for implications of using it.</p>
</div>
</li>
<li>
<p>The <code>pgoutput</code> plug-in does not emit all events for tables without primary keys. It emits only events for <code>INSERT</code> operations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All up-to-date differences are tracked in a test suite <a href="https://github.com/debezium/debezium/blob/master/debezium-connector-postgres/src/test/java/io/debezium/connector/postgresql/DecoderDifferences.java">Java class</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-server-configuration"><a class="anchor" href="#postgresql-server-configuration"></a>Configuring the PostgreSQL server</h3>
<div class="paragraph">
<p>If you are using a <a href="#postgresql-output-plugin">logical decoding plug-in</a> other than pgoutput, after installing it, configure the PostgreSQL server as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To load the plug-in at startup, add the following to the <code>postgresql.conf</code> file::</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># MODULES
shared_preload_libraries = 'decoderbufs,wal2json' <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Instructs the server to load the <code>decoderbufs</code> and <code>wal2json</code> logical decoding plug-ins at startup. The names of the plug-ins are set in the <a href="https://github.com/debezium/postgres-decoderbufs/blob/v0.3.0/Makefile"><code>Protobuf</code></a> and <a href="https://github.com/eulerto/wal2json/blob/master/Makefile"><code>wal2json</code></a> make files.</td>
</tr>
</table>
</div>
</li>
<li>
<p>To configure the replication slot regardless of the decoder being used, specify the following in the <code>postgresql.conf</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># REPLICATION
wal_level = logical             <i class="conum" data-value="1"></i><b>(1)</b>
max_wal_senders = 1             <i class="conum" data-value="2"></i><b>(2)</b>
max_replication_slots = 1       <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>instructs the server to use logical decoding with the write-ahead log.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>instructs the server to use a maximum of <code>1</code> separate process for processing WAL changes.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>instructs the server to allow a maximum of <code>1</code> replication slot to be created for streaming WAL changes.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Debezium uses PostgreSQL&#8217;s logical decoding, which uses replication slots.
Replication slots are guaranteed to retain all WAL segments required for Debezium even during Debezium outages. For this reason, it is important to closely monitor replication slots to avoid too much disk consumption and other conditions that can happen such as catalog bloat if a replication slot stays unused for too long.
For more information, see the <a href="https://www.postgresql.org/docs/current/warm-standby.html#STREAMING-REPLICATION-SLOTS">PostgreSQL streaming replication documentation</a>.</p>
</div>
<div class="paragraph">
<p>If you are working with a <code>synchronous_commit</code> setting other than <code>on</code>,
the recommendation is to set <code>wal_writer_delay</code> to a value such as 10 milliseconds to achieve a low latency of change events.
Otherwise, its default value is applied, which adds a latency of about 200 milliseconds.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Reading and understanding <a href="https://www.postgresql.org/docs/current/static/wal-configuration.html">PostgreSQL documentation about the mechanics and configuration of the PostgreSQL write-ahead log</a> is strongly recommended.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-permissions"><a class="anchor" href="#postgresql-permissions"></a>Setting up permissions</h3>
<div class="paragraph">
<p>Setting up a PostgreSQL server to run a Debezium connector requires a database user that can perform replications.
Replication can be performed only by a database user that has appropriate permissions and only for a configured number of hosts.</p>
</div>
<div class="paragraph">
<p>Although, by default, superusers have the necessary <code>REPLICATION</code> and <code>LOGIN</code> roles, as mentioned in <a href="#postgresql-security">Security</a>, it is best not to provide the Debezium replication user with elevated privileges.
Instead, create a Debezium user that has the the minimum required privileges.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>PostgreSQL administrative permissions.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To provide a user with replication permissions, define a PostgreSQL role that has <em>at least</em> the <code>REPLICATION</code> and <code>LOGIN</code> permissions, and then grant that role to the user.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE ROLE <em>&lt;name&gt;</em> REPLICATION LOGIN;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-replication-user-privileges"><a class="anchor" href="#postgresql-replication-user-privileges"></a>Setting privileges to enable Debezium to create PostgreSQL publications when you use <code>pgoutput</code></h3>
<div class="paragraph">
<p>If you use <code>pgoutput</code> as the logical decoding plugin, Debezium must operate in the database as a user with specific privileges.</p>
</div>
<div class="paragraph">
<p>Debezium streams change events for PostgreSQL source tables from <em>publications</em> that are created for the tables.
Publications contain a filtered set of change events that are generated from one or more tables.
The data in each publication is filtered based on the publication specification.
The specification can be created by the PostgreSQL database administrator or by the Debezium connector.
To permit the Debezium PostgreSQL connector to create publications and specify the data to replicate to them, the connector must operate with specific privileges in the database.</p>
</div>
<div class="paragraph">
<p>There are several options for determining how publications are created.
In general, it is best to manually create publications for the tables that you want to capture, before you set up the connector.
However, you can configure your environment in a way that permits Debezium to create publications automatically, and to specify the data that is added to them.</p>
</div>
<div class="paragraph">
<p>Debezium uses include list and exclude list properties to specify how data is inserted in the publication.
For more information about the options for enabling Debezium to create publications, see <a href="#postgresql-publication-autocreate-mode"><code>publication.autocreate.mode</code></a>.</p>
</div>
<div class="paragraph">
<p>For Debezium to create a PostgreSQL publication, it must run as a user that has the following privileges:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Replication privileges in the database to add the table to a publication.</p>
</li>
<li>
<p><code>CREATE</code> privileges on the database to add publications.</p>
</li>
<li>
<p><code>SELECT</code> privileges on the tables to copy the initial table data. Table owners automatically have <code>SELECT</code> permission for the table.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To add tables to a publication, the user be an owner of the table.
But because the source table already exists, you need a mechanism to share ownership with the original owner.
To enable shared ownership, you create a PostgreSQL replication group, and then add the existing table owner and the replication user to the group.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a replication group.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE ROLE <em>&lt;replication_group&gt;</em>;</code></pre>
</div>
</div>
</li>
<li>
<p>Add the original owner of the table to the group.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">GRANT REPLICATION_GROUP TO <em>&lt;original_owner&gt;</em>;</code></pre>
</div>
</div>
</li>
<li>
<p>Add the Debezium replication user to the group.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">GRANT REPLICATION_GROUP TO <em>&lt;replication_user&gt;</em>;</code></pre>
</div>
</div>
</li>
<li>
<p>Transfer ownership of the table to <code>&lt;replication_group&gt;</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">ALTER TABLE <em>&lt;table_name&gt;</em> OWNER TO REPLICATION_GROUP;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For Debezium to specify the capture configuration, the value of <a href="#postgresql-publication-autocreate-mode"><code>publication.autocreate.mode</code></a> must be set to <code>filtered</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-host-replication-permissions"><a class="anchor" href="#postgresql-host-replication-permissions"></a>Configuring PostgreSQL to allow replication with the Debezium connector host</h3>
<div class="paragraph">
<p>To enable {prodname] to replicate PostgreSQL data, you must configure the database to permit replication with the host that runs the PostgreSQL connector.
To specify the clients that are permitted to replicate with the database, add entries to the PostgreSQL host-based authentication file, <code>pg_hba.conf</code>.
For more information about the <code>pg_hba.conf</code> file, see <a href="https://www.postgresql.org/docs/10/auth-pg-hba-conf.html">the PostgreSQL</a> documentation.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Add entries to the <code>pg_hba.conf</code> file to specify the Debezium connector hosts that can replicate with the database host.
For example,</p>
<div class="listingblock">
<div class="title"><code>pg_hba.conf</code> file example:</div>
<div class="content">
<pre class="highlightjs highlight"><code>local   replication     &lt;youruser&gt;                          trust   <i class="conum" data-value="1"></i><b>(1)</b>
host    replication     &lt;youruser&gt;  127.0.0.1/32            trust   <i class="conum" data-value="2"></i><b>(2)</b>
host    replication     &lt;youruser&gt;  ::1/128                 trust   <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Instructs the server to allow replication for <code>&lt;youruser&gt;</code> locally, that is, on the server machine.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Instructs the server to allow <code>&lt;youruser&gt;</code> on <code>localhost</code> to receive replication changes using <code>IPV4</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Instructs the server to allow <code>&lt;youruser&gt;</code> on <code>localhost</code> to receive replication changes using <code>IPV6</code>.</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more information about network masks, see <a href="https://www.postgresql.org/docs/current/static/datatype-net-types.html">the PostgreSQL documentation</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="supported-postgresql-topologies"><a class="anchor" href="#supported-postgresql-topologies"></a>Supported PostgreSQL topologies</h3>
<div class="paragraph">
<p>The PostgreSQL connector can be used with a standalone PostgreSQL server or with a cluster of PostgreSQL servers.</p>
</div>
<div class="paragraph">
<p>As mentioned <a href="#postgresql-limitations">in the beginning</a>, PostgreSQL (for all versions &#8656; 12) supports logical replication slots on only <code>primary</code> servers. This means that a replica in a PostgreSQL cluster cannot be configured for logical replication, and consequently that the Debezium PostgreSQL connector can connect and communicate with only the primary server. Should this server fail, the connector stops. When the cluster is repaired, if the original primary server is once again promoted to <code>primary</code>, you can restart the connector. However, if a different PostgreSQL server <em>with the plug-in and proper configuration</em> is promoted to <code>primary</code>, you must change the connector configuration to point to the new <code>primary</code> server and then you can restart the connector.</p>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-wal-disk-space"><a class="anchor" href="#postgresql-wal-disk-space"></a>WAL disk space consumption</h3>
<div class="paragraph">
<p>In certain cases, it is possible for PostgreSQL disk space consumed by WAL files to spike or increase out of usual proportions.
There are several possible reasons for this situation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The LSN up to which the connector has received data is available in the <code>confirmed_flush_lsn</code> column of the server&#8217;s <code>pg_replication_slots</code> view. Data that is older than this LSN is no longer available, and the database is responsible for reclaiming the disk space.</p>
<div class="paragraph">
<p>Also in the <code>pg_replication_slots</code> view, the <code>restart_lsn</code> column contains the LSN of the oldest WAL that the connector might require. If the value for <code>confirmed_flush_lsn</code> is regularly increasing and the value of  <code>restart_lsn</code> lags then the database needs to reclaim the space.</p>
</div>
<div class="paragraph">
<p>The database typically reclaims disk space in batch blocks. This is expected behavior and no action by a user is necessary.</p>
</div>
</li>
<li>
<p>There are many updates in a database that is being tracked but only a tiny number of updates are related to the table(s) and schema(s) for which the connector is capturing changes. This situation can be easily solved with periodic heartbeat events. Set the <a href="#postgresql-property-heartbeat-interval-ms"><code>heartbeat.interval.ms</code></a> connector configuration property.</p>
</li>
<li>
<p>The PostgreSQL instance contains multiple databases and one of them is a high-traffic database. Debezium captures changes in another database that is low-traffic in comparison to the other database. Debezium then cannot confirm the LSN as replication slots work per-database and Debezium is not invoked. As WAL is shared by all databases, the amount used tends to grow until an event is emitted by the database for which Debezium is capturing changes. To overcome this, it is necessary to:</p>
<div class="ulist">
<ul>
<li>
<p>Enable periodic heartbeat record generation with the <code>heartbeat.interval.ms</code> connector configuration property.</p>
</li>
<li>
<p>Regularly emit change events from the database for which Debezium is capturing changes.</p>
<div class="paragraph">
<p>In the case of <code>wal2json</code> decoder plug-in, it is sufficient to generate empty events. This can be achieved for example by truncating an empty temporary table. For other decoder plug-ins, the recommendation is to create a supplementary table for which Debezium is not capturing changes.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>A separate process would then periodically update the table by either inserting a new row or repeatedly updating the same row.
PostgreSQL then invokes Debezium, which confirms the latest LSN and allows the database to reclaim the WAL space.
This task can be automated by means of the <a href="#postgresql-property-heartbeat-action-query"><code>heartbeat.action.query</code></a> connector configuration property.</p>
</div>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For users on AWS RDS with PostgreSQL, a situation similar to the high traffic/low traffic scenario can occur in an idle environment. AWS RDS causes writes to its own system tables to be invisible to clients on a frequent basis (5 minutes).
Again, regularly emitting events solves the problem.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="postgresql-deployment"><a class="anchor" href="#postgresql-deployment"></a>Deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To deploy a Debezium PostgreSQL connector, you install the Debezium PostgreSQL connector archive, configure the connector, and start the connector by adding its configuration to Kafka Connect.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p><a href="https://zookeeper.apache.org/">Zookeeper</a>, <a href="http://kafka.apache.org/">Kafka</a>, and <a href="https://kafka.apache.org/documentation.html#connect">Kafka Connect</a> are installed.</p>
</li>
<li>
<p>PostgreSQL is installed and is <a href="#setting-up-postgresql">set up to run the Debezium connector</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Download the Debezium <a href="https://repo1.maven.org/maven2/io/debezium/debezium-connector-postgres/1.6.0.Alpha1/debezium-connector-postgres-1.6.0.Alpha1-plugin.tar.gz">PostgreSQL connector plug-in archive</a>.</p>
</li>
<li>
<p>Extract the files into your Kafka Connect environment.</p>
</li>
<li>
<p>Add the directory with the JAR files to <a href="https://kafka.apache.org/documentation/#connectconfigs">Kafka Connect&#8217;s <code>plugin.path</code></a>.</p>
</li>
<li>
<p>Restart your Kafka Connect process to pick up the new JAR files.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you are working with immutable containers, see <a href="https://hub.docker.com/r/debezium/">Debezium&#8217;s Container images</a> for Zookeeper, Kafka, PostgreSQL and Kafka Connect with the PostgreSQL connector already installed and ready to run. You can also <a href="../operations/openshift.html" class="page">run Debezium on Kubernetes and OpenShift</a>.</p>
</div>
<div class="sect2">
<h3 id="postgresql-example-configuration"><a class="anchor" href="#postgresql-example-configuration"></a>Connector configuration example</h3>
<div class="paragraph">
<p>Following is an example of the configuration for a PostgreSQL connector that connects to a PostgreSQL server on port 5432 at 192.168.99.100, whose logical name is <code>fulfillment</code>.
Typically, you configure the Debezium PostgreSQL connector in a JSON file by setting the configuration properties available for the connector.</p>
</div>
<div class="paragraph">
<p>You can choose to produce events for a subset of the schemas and tables in a database.
Optionally, you can ignore, mask, or truncate columns that contain sensitive data, are larger than a specified size, or that you do not need.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "fulfillment-connector",  <i class="conum" data-value="1"></i><b>(1)</b>
  "config": {
    "connector.class": "io.debezium.connector.postgresql.PostgresConnector", <i class="conum" data-value="2"></i><b>(2)</b>
    "database.hostname": "192.168.99.100", <i class="conum" data-value="3"></i><b>(3)</b>
    "database.port": "5432", <i class="conum" data-value="4"></i><b>(4)</b>
    "database.user": "postgres", <i class="conum" data-value="5"></i><b>(5)</b>
    "database.password": "postgres", <i class="conum" data-value="6"></i><b>(6)</b>
    "database.dbname" : "postgres", <i class="conum" data-value="7"></i><b>(7)</b>
    "database.server.name": "fulfillment", <i class="conum" data-value="8"></i><b>(8)</b>
    "table.include.list": "public.inventory" <i class="conum" data-value="9"></i><b>(9)</b>

  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The name of the connector when registered with a Kafka Connect service.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The name of this PostgreSQL connector class.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The address of the PostgreSQL server.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The port number of the PostgreSQL server.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The name of the PostgreSQL user that has the <a href="#postgresql-permissions">required privileges</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The password for the PostgreSQL user that has the <a href="#postgresql-permissions">required privileges</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The name of the PostgreSQL database to connect to</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The logical name of the PostgreSQL server/cluster, which forms a namespace and is used in all the names of the Kafka topics to which the connector writes, the Kafka Connect schema names, and the namespaces of the corresponding Avro schema when the Avro converter is used.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>A list of all tables hosted by this server that this connector will monitor. This is optional, and there are other properties for listing the schemas and tables to include or exclude from monitoring.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See the <a href="#postgresql-connector-properties">complete list of PostgreSQL connector properties</a> that can be specified in these configurations.</p>
</div>
<div class="paragraph">
<p>You can send this configuration with a <code>POST</code> command to a running Kafka Connect service.
The service records the configuration and starts one connector task that performs the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connects to the PostgreSQL database.</p>
</li>
<li>
<p>Reads the transaction log.</p>
</li>
<li>
<p>Streams change event records to Kafka topics.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-adding-connector-configuration"><a class="anchor" href="#postgresql-adding-connector-configuration"></a>Adding connector configuration</h3>
<div class="paragraph">
<p>To run a Debezium PostgreSQL connector, create a connector configuration and add the configuration to your Kafka Connect cluster.
.Prerequisites</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#postgresql-server-configuration">PostgreSQL is configured to support logical replication</a>.</p>
</li>
<li>
<p>The <a href="#installing-postgresql-output-plugin">logical decoding plug-in</a> is installed.</p>
</li>
<li>
<p>The PostgreSQL connector is installed.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a configuration for the PostgreSQL connector.</p>
</li>
<li>
<p>Use the <a href="https://kafka.apache.org/documentation/#connect_rest">Kafka Connect REST API</a> to add that connector configuration to your Kafka Connect cluster.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Results</div>
<p>When the connector starts, it <a href="#postgresql-snapshots">performs a consistent snapshot</a> of the PostgreSQL server databases that the connector is configured for. The connector then starts generating data change events for row-level operations and streaming change event records to Kafka topics.</p>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-connector-properties"><a class="anchor" href="#postgresql-connector-properties"></a>Connector configuration properties</h3>
<div class="paragraph">
<p>The Debezium PostgreSQL connector has many configuration properties that you can use to achieve the right connector behavior for your application. Many properties have default values. Information about the properties is organized as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#postgresql-required-configuration-properties">Required configuration properties</a></p>
</li>
<li>
<p><a href="#postgresql-advanced-configuration-properties">Advanced configuration properties</a></p>
</li>
<li>
<p><a href="#postgresql-pass-through-properties">Pass-through configuration properties</a></p>
</li>
</ul>
</div>
<div id="postgresql-required-configuration-properties" class="paragraph">
<p>The following configuration properties are <em>required</em> unless a default value is available.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. Required connector configuration properties</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 25%;">
<col style="width: 45%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-name"></a><a href="#postgresql-property-name"><code>name</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Unique name for the connector. Attempting to register again with the same name will fail. This property is required by all Kafka Connect connectors.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-connector-class"></a><a href="#postgresql-property-connector-class"><code>connector.class</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the Java class for the connector. Always use a value of <code>io.debezium.connector.postgresql.PostgresConnector</code> for the PostgreSQL connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-tasks-max"></a><a href="#postgresql-property-tasks-max"><code>tasks.max</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>1</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The maximum number of tasks that should be created for this connector. The PostgreSQL connector always uses a single task and therefore does not use this value, so the default is always acceptable.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-plugin-name"></a><a href="#postgresql-property-plugin-name"><code>plugin.name</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>decoderbufs</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the PostgreSQL <a href="#postgresql-output-plugin">logical decoding plug-in</a> installed on the PostgreSQL server.</p>
</div>
<div class="paragraph">
<p>Supported values are <code>decoderbufs</code>, <code>wal2json</code>, <code>wal2json_rds</code>, <code>wal2json_streaming</code>, <code>wal2json_rds_streaming</code> and <code>pgoutput</code>.</p>
</div>
<div class="paragraph">
<p>If you are using a <code>wal2json</code> plug-in and transactions are very large, the JSON batch event that contains all transaction changes might not fit into the hard-coded memory buffer, which has a size of 1 GB. In such cases, switch to a streaming plug-in, by setting the <code>plugin-name</code> property to <code>wal2json_streaming</code> or  <code>wal2json_rds_streaming</code>. With a streaming plug-in, PostgreSQL sends the connector a separate message for each change in a transaction.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-slot-name"></a><a href="#postgresql-property-slot-name"><code>slot.name</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>debezium</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the PostgreSQL logical decoding slot that was created for streaming changes from a particular plug-in for a particular database/schema. The server uses this slot to stream events to the Debezium connector that you are configuring.</p>
</div>
<div class="paragraph">
<p>Slot names must conform to <a href="https://www.postgresql.org/docs/current/static/warm-standby.html#STREAMING-REPLICATION-SLOTS-MANIPULATION">PostgreSQL replication slot naming rules</a>, which state: <em>"Each replication slot has a name, which can contain lower-case letters, numbers, and the underscore character."</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-slot-drop-on-stop"></a><a href="#postgresql-property-slot-drop-on-stop"><code>slot.drop.on.stop</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>false</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Whether or not to delete the logical replication slot when the connector stops in a graceful, expected way. The default behavior is that the replication slot remains configured for the connector when the connector stops. When the connector restarts, having the same replication slot enables the connector to start processing where it left off.</p>
</div>
<div class="paragraph">
<p>Set to <code>true</code> in only testing or development environments. Dropping the slot allows the database to discard WAL segments. When the connector restarts it performs a new snapshot or it can continue from a persistent offset in the Kafka Connect offsets topic.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-publication-name"></a><a href="#postgresql-property-publication-name"><code>publication.name</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>dbz_publication</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the PostgreSQL publication created for streaming changes when using <code>pgoutput</code>.</p>
</div>
<div class="paragraph">
<p>This publication is created at start-up if it does not already exist and it includes <em>all tables</em>.
Debezium then applies its own include/exclude list filtering, if configured, to limit the publication to change events for the specific tables of interest.
The connector user must have superuser permissions to create this publication,
so it is usually preferable to create the publication before starting the connector for the first time.</p>
</div>
<div class="paragraph">
<p>If the publication already exists, either for all tables or configured with a subset of tables, Debezium uses the publication as it is defined.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-database-hostname"></a><a href="#postgresql-property-database-hostname"><code>database.hostname</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IP address or hostname of the PostgreSQL database server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-database-port"></a><a href="#postgresql-property-database-port"><code>database.port</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>5432</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Integer port number of the PostgreSQL database server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-database-user"></a><a href="#postgresql-property-database-user"><code>database.user</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name of the PostgreSQL database user for connecting to the PostgreSQL database server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-database-password"></a><a href="#postgresql-property-database-password"><code>database.password</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Password to use when connecting to the PostgreSQL database server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-database-dbname"></a><a href="#postgresql-property-database-dbname"><code>database.dbname</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the PostgreSQL database from which to stream the changes.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-database-server-name"></a><a href="#postgresql-property-database-server-name"><code>database.server.name</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Logical name that identifies and provides a namespace for the particular PostgreSQL database server or cluster in which Debezium is capturing changes. Only alphanumeric characters and underscores must be used in the database server logical name. The logical name should be unique across all other connectors, since it is used as a topic name prefix for all Kafka topics that receive records from this connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-schema-include-list"></a><a href="#postgresql-property-schema-include-list"><code>schema.include.list</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match names of schemas for which you <strong>want</strong> to capture changes. Any schema name not included in <code>schema.include.list</code> is excluded from having its changes captured. By default, all non-system schemas have their changes captured. Do not also set the <code>schema.exclude.list</code> property.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-schema-exclude-list"></a><a href="#postgresql-property-schema-exclude-list"><code>schema.exclude.list</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match names of schemas for which you <strong>do not</strong> want to capture changes. Any schema whose name is not included in <code>schema.exclude.list</code> has its changes captured, with the exception of system schemas. Do not also set the <code>schema.include.list</code> property.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-table-include-list"></a><a href="#postgresql-property-table-include-list"><code>table.include.list</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match fully-qualified table identifiers for tables whose changes you want to capture. Any table not included in <code>table.include.list</code> does not have its changes captured. Each identifier is of the form <em>schemaName</em>.<em>tableName</em>. By default, the connector captures changes in every non-system table in each schema whose changes are being captured. Do not also set the <code>table.exclude.list</code> property.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-table-exclude-list"></a><a href="#postgresql-property-table-exclude-list"><code>table.exclude.list</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match fully-qualified table identifiers for tables whose changes you <strong>do not</strong> want to capture. Any table not included in <code>table.exclude.list</code> has it changes captured. Each identifier is of the form <em>schemaName</em>.<em>tableName</em>. Do not also set the <code>table.include.list</code> property.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-column-include-list"></a><a href="#postgresql-property-column-include-list"><code>column.include.list</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match the fully-qualified names of columns that should be included in change event record values. Fully-qualified names for columns are of the form <em>schemaName</em>.<em>tableName</em>.<em>columnName</em>. Do not also set the <code>column.exclude.list</code> property.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-column-exclude-list"></a><a href="#postgresql-property-column-exclude-list"><code>column.exclude.list</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match the fully-qualified names of columns that should be excluded from change event record values. Fully-qualified names for columns are of the form <em>schemaName</em>.<em>tableName</em>.<em>columnName</em>. Do not also set the <code>column.include.list</code> property.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-time-precision-mode"></a><a href="#postgresql-property-time-precision-mode"><code>time.precision.mode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>adaptive</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Time, date, and timestamps can be represented with different kinds of precision:<br>
<br>
<code>adaptive</code> captures the time and timestamp values exactly as in the database using either millisecond, microsecond, or nanosecond precision values based on the database column&#8217;s type.<br>
<br>
<code>adaptive_time_microseconds</code> captures the date, datetime and timestamp values exactly as in the database using either millisecond, microsecond, or nanosecond precision values based on the database column&#8217;s type. An exception is <code>TIME</code> type fields, which are always captured as microseconds.<br>
<br>
<code>connect</code> always represents time and timestamp values by using Kafka Connect&#8217;s built-in representations for <code>Time</code>, <code>Date</code>, and <code>Timestamp</code>, which use millisecond precision regardless of the database columns' precision. See <a href="#postgresql-temporal-values">temporal values</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-decimal-handling-mode"></a><a href="#postgresql-property-decimal-handling-mode"><code>decimal.handling.mode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>precise</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies how the connector should handle values for <code>DECIMAL</code> and <code>NUMERIC</code> columns:<br>
<br>
<code>precise</code> represents values by using <code>java.math.BigDecimal</code> to represent values in binary form in change events.<br>
<br>
<code>double</code> represents values by using <code>double</code> values, which might result in a loss of precision but which is easier to use.<br>
<br>
<code>string</code> encodes values as formatted strings, which are easy to consume but semantic information about the real type is lost. See <a href="#postgresql-decimal-types">Decimal types</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-hstore-handling-mode"></a><a href="#postgresql-property-hstore-handling-mode"><code>hstore.handling.mode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>map</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies how the connector should handle values for <code>hstore</code> columns:<br>
<br>
<code>map</code> represents values by using <code>MAP</code>.<br>
<br>
<code>json</code> represents values by using <code>json string</code>. This setting encodes values as formatted strings such as <code>{"key" : "val"}</code>. See <a href="#postgresql-hstore-type">PostgreSQL <code>HSTORE</code> type</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-interval-handling-mode"></a><a href="#postgresql-property-interval-handling-mode"><code>interval.handling.mode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>numeric</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies how the connector should handle values for <code>interval</code> columns:<br>
<br>
<code>numeric</code> represents intervals using approximate number of microseconds.<br>
<br>
<code>string</code> represents intervals exactly by using the string pattern representation <code>P&lt;years&gt;Y&lt;months&gt;M&lt;days&gt;DT&lt;hours&gt;H&lt;minutes&gt;M&lt;seconds&gt;S</code>. For example: <code>P1Y2M3DT4H5M6.78S</code>. See <a href="#postgresql-basic-types">PostgreSQL basic types</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-database-sslmode"></a><a href="#postgresql-property-database-sslmode"><code>database.sslmode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>disable</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Whether to use an encrypted connection to the PostgreSQL server. Options include:<br>
<br>
<code>disable</code> uses an unencrypted connection.<br>
<br>
<code>require</code> uses a secure (encrypted) connection, and fails if one cannot be established.<br>
<br>
<code>verify-ca</code> behaves like <code>require</code> but also verifies the server TLS certificate against the configured Certificate Authority (CA) certificates, or fails if no valid matching CA certificates are found.<br>
<br>
<code>verify-full</code> behaves like <code>verify-ca</code> but also verifies that the server certificate matches the host to which the connector is trying to connect. See <a href="https://www.postgresql.org/docs/current/static/libpq-connect.html">the PostgreSQL documentation</a> for more information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-database-sslcert"></a><a href="#postgresql-property-database-sslcert"><code>database.sslcert</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The path to the file that contains the SSL certificate for the client. See <a href="https://www.postgresql.org/docs/current/static/libpq-connect.html">the PostgreSQL documentation</a> for more information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-database-sslkey"></a><a href="#postgresql-property-database-sslkey"><code>database.sslkey</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The path to the file that contains the SSL private key of the client. See <a href="https://www.postgresql.org/docs/current/static/libpq-connect.html">the PostgreSQL documentation</a> for more information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-database-sslpassword"></a><a href="#postgresql-property-database-sslpassword"><code>database.sslpassword</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The password to access the client private key from the file specified by <code>database.sslkey</code>. See <a href="https://www.postgresql.org/docs/current/static/libpq-connect.html">the PostgreSQL documentation</a> for more information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-database-sslrootcert"></a><a href="#postgresql-property-database-sslrootcert"><code>database.sslrootcert</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The path to the file that contains the root certificate(s) against which the server is validated. See <a href="https://www.postgresql.org/docs/current/static/libpq-connect.html">the PostgreSQL documentation</a> for more information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-database-tcpkeepalive"></a><a href="#postgresql-property-database-tcpkeepalive"><code>database.tcpKeepAlive</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>true</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Enable TCP keep-alive probe to verify that the database connection is still alive. See <a href="https://www.postgresql.org/docs/current/static/libpq-connect.html">the PostgreSQL documentation</a> for more information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-tombstones-on-delete"></a><a href="#postgresql-property-tombstones-on-delete"><code>tombstones.on.delete</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>true</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Controls whether a <em>delete</em> event is followed by a tombstone event.<br>
<br>
<code>true</code> - a delete operation is represented by a <em>delete</em> event and a subsequent tombstone event. <br>
<br>
<code>false</code> - only a <em>delete</em> event is emitted.<br>
<br>
After a source record is deleted, emitting a tombstone event (the default behavior) allows Kafka to completely delete all events that pertain to the key of the deleted row in case <a href="https://kafka.apache.org/documentation/#compaction">log compaction</a> is enabled for the topic.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-column-truncate-to-length-chars"></a><a href="#postgresql-property-column-truncate-to-length-chars"><code>column.truncate.to._length_.chars</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match the fully-qualified names of character-based columns. Fully-qualified names for columns are of the form <em>schemaName</em>.<em>tableName</em>.<em>columnName</em>. In change event records, values in these columns are truncated if they are longer than the number of characters specified by <em>length</em> in the property name. You can specify multiple properties with different lengths in a single configuration. Length must be a positive integer, for example, <code>+column.truncate.to.20.chars</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-column-mask-with-length-chars"></a><a href="#postgresql-property-column-mask-with-length-chars"><code>column.mask.with._length_.chars</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match the fully-qualified names of character-based columns. Fully-qualified names for columns are of the form <em>schemaName</em>.<em>tableName</em>.<em>columnName</em>. In change event values, the values in the specified table columns are replaced with <em>length</em> number of asterisk (<code>*</code>) characters. You can specify multiple properties with different lengths in a single configuration. Length must be a positive integer or zero. When you specify zero, the connector replaces a value with an empty string.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-column-mask-hash"></a><a href="#postgresql-property-column-mask-hash"><code>column.mask.hash._hashAlgorithm_.with.salt._salt_</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match the fully-qualified names of character-based columns. Fully-qualified names for columns are of the form <em>schemaName</em>.<em>tableName</em>.<em>columnName</em>. In change event values, the values in the specified columns are replaced with pseudonyms.<br>
<br>
A pseudonym consists of the hashed value that results from applying the specifed <em>hashAlgorithm</em> and <em>salt</em>. Based on the hash function that is used, referential integrity is kept while column values are replaced with pseudonyms. Supported hash functions are described in the <a href="https://docs.oracle.com/javase/7/docs/technotes/guides/security/StandardNames.html#MessageDigest">MessageDigest section</a> of the Java Cryptography Architecture Standard Algorithm Name Documentation.<br>
<br>
If necessary, the pseudonym is automatically shortened to the length of the column. You can specify multiple properties with different hash algorithms and salts in a single configuration. In the following example, <code>CzQMA0cB5K</code> is a randomly selected salt.<br>
<br>
<code>column.mask.hash.SHA-256.with.salt.CzQMA0cB5K =inventory.orders.customerName,inventory.shipment.customerName</code><br>
<br>
Depending on the <em>hashAlgorithm</em> used, the <em>salt</em> selected, and the actual data set, the resulting masked data set might not be completely masked.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-column-propagate-source-type"></a><a href="#postgresql-property-column-propagate-source-type"><code>column.propagate.source.type</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match the fully-qualified names of columns. Fully-qualified names for columns are of the form <em>databaseName</em>.<em>tableName</em>.<em>columnName</em>, or <em>databaseName</em>.<em>schemaName</em>.<em>tableName</em>.<em>columnName</em>.<br>
<br>
For each specified column, the connector adds the column&#8217;s original type and original length as parameters to the corresponding field schemas in the emitted change records. The following added schema parameters propagate the original type name and also the original length for variable-width types:<br>
<br>
<code>__debezium.source.column.type</code> + <code>__debezium.source.column.length</code> + <code>__debezium.source.column.scale</code><br>
<br>
This property is useful for properly sizing corresponding columns in sink databases.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-datatype-propagate-source-type"></a><a href="#postgresql-property-datatype-propagate-source-type"><code>datatype.propagate.source.type</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>n/a</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match the database-specific data type name for some columns. Fully-qualified data type names are of the form <em>databaseName</em>.<em>tableName</em>.<em>typeName</em>, or <em>databaseName</em>.<em>schemaName</em>.<em>tableName</em>.<em>typeName</em>.<br>
<br>
For these data types, the connector adds parameters to the corresponding field schemas in emitted change records. The added parameters specify the original type and length of the column:<br>
<br>
<code>__debezium.source.column.type</code> + <code>__debezium.source.column.length</code> + <code>__debezium.source.column.scale</code><br>
<br>
These parameters propagate a column&#8217;s original type name and length, for variable-width types, respectively. This property is useful for properly sizing corresponding columns in sink databases.<br>
<br>
See the <a href="#postgresql-data-types">list of PostgreSQL-specific data type names</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-message-key-columns"></a><a href="#postgresql-property-message-key-columns"><code>message.key.columns</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>empty string</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A semicolon separated list of tables with regular expressions that match table column names. The connector maps values in matching columns to key fields in change event records that it sends to Kafka topics. This is useful when a table does not have a primary key, or when you want to order change event records in a Kafka topic according to a field that is not a primary key.<br>
<br>
Separate entries with semicolons. Insert a colon between the fully-qualified table name and its regular expression. The format is:<br>
<br>
<em>schema-name</em>.<em>table-name</em>:_regexp_;&#8230;&#8203;<br>
<br>
For example,<br>
<br>
<code>schemaA.table_a:regex_1;schemaB.table_b:regex_2;schemaC.table_c:regex_3</code><br>
<br>
If <code>table_a</code> has a an <code>id</code> column, and <code>regex_1</code> is <code>^i</code> (matches any column that starts with <code>i</code>), the connector maps the value in <code>table_a</code>'s <code>id</code> column to a key field in change events that the connector sends to Kafka.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-publication-autocreate-mode"></a><a href="#postgresql-publication-autocreate-mode"><code>publication.autocreate.mode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>all_tables</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Applies only when streaming changes by using <a href="https://www.postgresql.org/docs/current/sql-createpublication.html">the <code>pgoutput</code> plug-in</a>. The setting determines how creation of a <a href="https://www.postgresql.org/docs/current/logical-replication-publication.html">publication</a> should work. Possible settings are:<br>
<br>
<code>all_tables</code> - If a publication exists, the connector uses it. If a publication does not exist, the connector creates a publication for all tables in the database for which the connector is capturing changes. This requires that the database user that has permission to perform replications also has permission to create a publication. This is granted with <code>CREATE PUBLICATION &lt;publication_name&gt; FOR ALL TABLES;</code>.<br>
<br>
<code>disabled</code> - The connector does not attempt to create a publication. A database administrator or the user configured to perform replications must have created the publication before running the connector. If the connector cannot find the publication, the connector throws an exception and stops.<br>
<br>
<code>filtered</code> - If a publication exists, the connector uses it. If no publication exists, the connector creates a new publication for tables that match the current filter configuration as specified by the <code>database.exclude.list</code>, <code>schema.include.list</code>, <code>schema.exclude.list</code>, and <code>table.include.list</code> connector configuration properties. For example: <code>CREATE PUBLICATION &lt;publication_name&gt; FOR TABLE &lt;tbl1, tbl2, tbl3&gt;</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-binary-handling-mode"></a><a href="#postgresql-property-binary-handling-mode"><code>binary.handling.mode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>bytes</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies how binary (<code>bytea</code>) columns should be represented in change events:<br>
<br>
<code>bytes</code> represents binary data as  byte array.<br>
<br>
<code>base64</code> represents binary data as base64-encoded strings.<br>
<br>
<code>hex</code> represents binary data as hex-encoded (base16) strings.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-truncate-handling-mode"></a><a href="#postgresql-property-truncate-handling-mode"><code>truncate.handling.mode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>bytes</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies how whether <code>TRUNCATE</code> events should be propagated or not (only available when using the <code>pgoutput</code> plug-in with Postgres 11 or later):<br>
<br>
<code>skip</code> causes those event to be omitted (the default).<br>
<br>
<code>include</code> causes hos events to be included.<br></p>
</div>
<div class="paragraph">
<p>+
Please see <a href="#postgresql-truncate-events"><em>truncate</em> events</a> for the structure of <em>truncate</em> events and their ordering semantics.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div id="postgresql-advanced-configuration-properties" class="paragraph">
<p>The following <em>advanced</em> configuration properties have defaults that work in most situations and therefore rarely need to be specified in the connector&#8217;s configuration.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 20. Advanced connector configuration properties</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-snapshot-mode"></a><a href="#postgresql-property-snapshot-mode"><code>snapshot.mode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>initial</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies the criteria for performing a snapshot when the connector starts:<br>
<br>
<code>initial</code> -  The connector performs a snapshot only when no offsets have been recorded for the logical server name.<br>
<br>
<code>always</code> - The connector performs a snapshot each time the connector starts.<br>
<br>
<code>never</code> - The connector never performs snapshots. When a connector is configured this way, its behavior when it starts is as follows. If there is a previously stored LSN in the Kafka offsets topic, the connector continues streaming changes from that position. If no LSN has been stored, the connector starts streaming changes from the point in time when the PostgreSQL logical replication slot was created on the server. The <code>never</code> snapshot mode is useful only when you know all data of interest is still reflected in the WAL.<br>
<br>
<code>initial_only</code> - The connector performs an initial snapshot and then stops, without processing any subsequent changes.<br>
<br>
<code>exported</code> -  The connector performs a snapshot based on the point in time when the replication slot was created. This is an excellent way to perform the snapshot in a lock-free way.<br>
<br>
<code>custom</code> - The connector performs a snapshot according to the setting for the <code>snapshot.custom.class</code> property, which is a custom implementation of the <code>io.debezium.connector.postgresql.spi.Snapshotter</code> interface.<br>
<br>
The<a href="#snapshot-mode-settings">reference table for snapshot mode settings</a> has more details.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-snapshot-custom-class"></a><a href="#postgresql-property-snapshot-custom-class"><code>snapshot.custom.class</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A full Java class name that is an implementation of the <code>io.debezium.connector.postgresql.spi.Snapshotter</code> interface. Required when the <code>snapshot.mode</code> property is set to <code>custom</code>. See <a href="#postgresql-custom-snapshot">custom snapshotter SPI</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-snapshot-include-collection-list"></a><a href="#postgresql-property-snapshot-include-collection-list"><code>snapshot.include.collection.list</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>All tables specified in <code>table.include.list</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional, comma-separated list of regular expressions that match names of schemas specified in <code>table.include.list</code> for which you <strong>want</strong> to take the snapshot when the <code>snapshot.mode</code> is not <code>never</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-snapshot-lock-timeout-ms"></a><a href="#postgresql-property-snapshot-lock-timeout-ms"><code>snapshot.lock.timeout.ms</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>10000</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Positive integer value that specifies the maximum amount of time (in milliseconds) to wait to obtain table locks when performing a snapshot. If the connector cannot acquire table locks in this time interval, the snapshot fails. <a href="#postgresql-snapshots">How the connector performs snapshots</a> provides details.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-snapshot-select-statement-overrides"></a><a href="#postgresql-property-snapshot-select-statement-overrides"><code>snapshot.select.statement.overrides</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Controls which table rows are included in snapshots. This property affects snapshots only. It does not affect events that are generated by the logical decoding plug-in. Specify a comma-separated list of fully-qualified table names in the form <em>databaseName.tableName</em>.<br>
<br>
For each table that you specify, also specify another configuration property: <code>snapshot.select.statement.overrides.<em>DB_NAME</em>.<em>TABLE_NAME</em></code>, for example: <code>snapshot.select.statement.overrides.customers.orders</code>. Set this property to a <code>SELECT</code> statement that obtains only the rows that you want in the snapshot. When the connector performs a snapshot, it executes this <code>SELECT</code> statement to retrieve data from that table.<br>
<br>
A possible use case for setting these properties is large, append-only tables. You can specify a <code>SELECT</code> statement that sets a specific point for where to start a snapshot, or where to resume a snapshot if a previous snapshot was interrupted.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-event-processing-failure-handling-mode"></a><a href="#postgresql-property-event-processing-failure-handling-mode"><code>event.processing.failure.handling.mode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>fail</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies how the connector should react to exceptions during processing of events:<br>
<br>
<code>fail</code> propagates the exception, indicates the offset of the problematic event, and causes the connector to stop.<br>
<br>
<code>warn</code> logs the offset of the problematic event, skips that event, and continues processing.<br>
<br>
<code>skip</code> skips the problematic event and continues processing.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-max-queue-size"></a><a href="#postgresql-property-max-queue-size"><code>max.queue.size</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>20240</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Positive integer value for the maximum size of the blocking queue. The connector places change events received from streaming replication in the blocking queue before writing them to Kafka. This queue can provide backpressure when, for example, writing records to Kafka is slower that it should be or Kafka is not available.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-max-batch-size"></a><a href="#postgresql-property-max-batch-size"><code>max.batch.size</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>10240</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Positive integer value that specifies the maximum size of each batch of events that the connector processes.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-max-queue-size-in-bytes"></a><a href="#postgresql-property-max-queue-size-in-bytes"><code>max.queue.size.in.bytes</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>0</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Long value for the maximum size in bytes of the blocking queue. The feature is disabled by default, it will be active if it&#8217;s set with a positive long value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-poll-interval-ms"></a><a href="#postgresql-property-poll-interval-ms"><code>poll.interval.ms</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>1000</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Positive integer value that specifies the number of milliseconds the connector should wait for new change events to appear before it starts processing a batch of events. Defaults to 1000 milliseconds, or 1 second.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-include-unknown-datatypes"></a><a href="#postgresql-property-include-unknown-datatypes"><code>include.unknown.datatypes</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>false</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies connector behavior when the connector encounters a field whose data type is unknown. The default behavior is that the connector omits the field from the change event and logs a warning.<br>
<br>
Set this property to <code>true</code> if you want the change event to contain an opaque binary representation of the field. This lets consumers decode the field. You can control the exact representation by setting the <a href="#postgresql-property-binary-handling-mode"><code>binary handling mode</code></a> property.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Consumers risk backward compatibility issues when <code>include.unknown.datatypes</code> is set to <code>true</code>. Not only may the database-specific binary representation change between releases, but if the data type is eventually supported by Debezium, the data type will be sent downstream in a logical type, which would require adjustments by consumers. In general, when encountering unsupported data types, create a feature request so that support can be added.
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-database-initial-statements"></a><a href="#postgresql-property-database-initial-statements"><code>database.initial.statements</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A semicolon separated list of SQL statements that the connector executes when it establishes a JDBC connection to the database. To use a semicolon as a character and not as a delimiter, specify two consecutive semicolons, <code>;;</code>.<br>
<br>
The connector may establish JDBC connections at its own discretion. Consequently, this property is useful for configuration of session parameters only, and not for executing DML statements.<br>
<br>
The connector does not execute these statements when it creates a connection for reading the transaction log.<br></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-heartbeat-interval-ms"></a><a href="#postgresql-property-heartbeat-interval-ms"><code>heartbeat.interval.ms</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>0</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Controls how frequently the connector sends heartbeat messages to a Kafka topic. The default behavior is that the connector does not send heartbeat messages.<br>
<br>
Heartbeat messages are useful for monitoring whether the connector is receiving change events from the database. Heartbeat messages might help decrease the number of change events that need to be re-sent when a connector restarts. To send heartbeat messages, set this property to a positive integer, which indicates the number of milliseconds between heartbeat messages.<br>
<br>
Heartbeat messages are needed when there are many updates in a database that is being tracked but only a tiny number of updates are related to the table(s) and schema(s) for which the connector is capturing changes. In this situation, the connector reads from the database transaction log as usual but rarely emits change records to Kafka. This means that no offset updates are committed to Kafka and the connector does not have an opportunity to send the latest retrieved LSN to the database. The database retains WAL files that contain events that have already been processed by the connector. Sending heartbeat messages enables the connector to send the latest retrieved LSN to the database, which allows the database to reclaim disk space being used by no longer needed WAL files.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-heartbeat-topics-prefix"></a><a href="#postgresql-property-heartbeat-topics-prefix"><code>heartbeat.topics.prefix</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>__debezium-heartbeat</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Controls the name of the topic to which the connector sends heartbeat messages. The topic name has this pattern:<br>
<br>
<em>&lt;heartbeat.topics.prefix&gt;</em>.<em>&lt;server.name&gt;</em><br>
<br>
For example, if the database server name is <code>fulfillment</code>, the default topic name is <code>__debezium-heartbeat.fulfillment</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-heartbeat-action-query"></a><a href="#postgresql-property-heartbeat-action-query"><code>heartbeat.action.query</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies a query that the connector executes on the source database when the connector sends a heartbeat message.<br>
<br>
This is useful for resolving the situation described in <a href="#postgresql-wal-disk-space">WAL disk space consumption</a>, where capturing changes from a low-traffic database on the same host as a high-traffic database prevents Debezium from processing WAL records and thus acknowledging WAL positions with the database. To address this situation, create a heartbeat table in the low-traffic database, and set this property to a statement that inserts records into that table, for example: <br>
<br>
<code>INSERT INTO test_heartbeat_table (text) VALUES ('test_heartbeat')</code><br>
<br>
This allows the connector to receive changes from the low-traffic database and acknowledge their LSNs, which prevents unbounded WAL growth on the database host.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-schema-refresh-mode"></a><a href="#postgresql-property-schema-refresh-mode"><code>schema.refresh.mode</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>columns_diff</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specify the conditions that trigger a refresh of the in-memory schema for a table.<br>
<br>
<code>columns_diff</code> is the safest mode. It ensures that the in-memory schema stays in sync with the database table&#8217;s schema at all times.<br>
<br>
<code>columns_diff_exclude_unchanged_toast</code> instructs the connector to refresh the in-memory schema cache if there is a discrepancy with the schema derived from the incoming message, unless unchanged TOASTable data fully accounts for the discrepancy.<br>
<br>
This setting can significantly improve connector performance if there are frequently-updated tables that have TOASTed data that are rarely part of updates. However, it is possible for the in-memory schema to
become outdated if TOASTable columns are dropped from the table.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-snapshot-delay-ms"></a><a href="#postgresql-property-snapshot-delay-ms"><code>snapshot.delay.ms</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An interval in milliseconds that the connector should wait before performing a snapshot when the connector starts. If you are starting multiple connectors in a cluster, this property is useful for avoiding snapshot interruptions, which might cause re-balancing of connectors.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-snapshot-fetch-size"></a><a href="#postgresql-property-snapshot-fetch-size"><code>snapshot.fetch.size</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>10240</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>During a snapshot, the connector reads table content in batches of rows. This property specifies the maximum number of rows in a batch.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-slot-stream-params"></a><a href="#postgresql-property-slot-stream-params"><code>slot.stream.params</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Semicolon separated list of parameters to pass to the configured logical decoding plug-in. For example, <code>add-tables=public.table,public.table2;include-lsn=true</code>.</p>
</div>
<div class="paragraph">
<p>If you are using the <code>wal2json</code> plug-in, this property is useful for enabling server-side table filtering. Allowed values depend on the configured plug-in.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-sanitize-field-names"></a><a href="#postgresql-property-sanitize-field-names"><code>sanitize.field.names</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>true</code> if connector configuration sets the <code>key.converter</code> or <code>value.converter</code> property to the Avro converter.</p>
</div>
<div class="paragraph">
<p><code>false</code> if not.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Indicates whether field names are sanitized to adhere to <a href="../configuration/avro.html#avro-naming" class="page">Avro naming requirements</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-slot-max-retries"></a><a href="#postgresql-property-slot-max-retries"><code>slot.max.retries</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>6</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If connecting to a replication slot fails, this is the maximum number of consecutive attempts to connect.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-slot-retry-delay-ms"></a><a href="#postgresql-property-slot-retry-delay-ms"><code>slot.retry.delay.ms</code></a><br></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>10000</code> (10 seconds)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of milliseconds to wait between retry attempts when the connector fails to connect to a replication slot.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-toasted-value-placeholder"></a><a href="#postgresql-property-toasted-value-placeholder"><code>toasted.value.placeholder</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>__debezium_unavailable_value</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies the constant that the connector provides to indicate that the original value is a toasted value that is not provided by the database.
If the setting of <code>toasted.value.placeholder</code> starts with the <code>hex:</code> prefix it is expected that the rest of the string represents hexadecimally encoded octets. See <a href="#postgresql-toasted-values">toasted values</a> for additional details.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-provide-transaction-metadata"></a><a href="#postgresql-property-provide-transaction-metadata"><code>provide.transaction.metadata</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>false</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Determines whether the connector generates events with transaction boundaries and enriches change event envelopes with transaction metadata. Specify <code>true</code> if you want the connector to do this. See <a href="#postgresql-transaction-metadata">Transaction metadata</a> for details.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-retriable-restart-connector-wait-ms"></a><a href="#postgresql-property-retriable-restart-connector-wait-ms"><code>retriable.restart.connector.wait.ms</code></a><br></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>10000 (10 seconds)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of milliseconds to wait before restarting a connector after a retriable error occurs.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="postgresql-property-skipped-operations"></a><a href="#postgresql-property-skipped-operations"><code>skipped.operations</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>comma-separated list of operation types that will be skipped during streaming.
The operations include: <code>c</code> for inserts/create, <code>u</code> for updates, and <code>d</code> for deletes.
By default, no operations are skipped.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div id="postgresql-pass-through-properties" class="paragraph">
<div class="title">Pass-through connector configuration properties</div>
<p>The connector also supports <em>pass-through</em> configuration properties that are used when creating the Kafka producer and consumer.</p>
</div>
<div class="paragraph">
<p>Be sure to consult the <a href="https://kafka.apache.org/documentation.html">Kafka documentation</a> for all of the configuration properties for Kafka producers and consumers. The PostgreSQL connector does use the <a href="https://kafka.apache.org/documentation.html#consumerconfigs">new consumer configuration properties</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="postgresql-monitoring"><a class="anchor" href="#postgresql-monitoring"></a>Monitoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Debezium PostgreSQL connector provides two types of metrics that are in addition to the built-in support for JMX metrics that Zookeeper, Kafka, and Kafka Connect provide.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#postgresql-snapshot-metrics">Snapshot metrics</a> provide information about connector operation while performing a snapshot.</p>
</li>
<li>
<p><a href="#postgresql-streaming-metrics">Streaming metrics</a> provide information about connector operation when the connector is capturing changes and streaming change event records.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="../operations/monitoring.html#monitoring-debezium" class="page">Debezium monitoring documentation</a> provides details for how to expose these metrics by using JMX.</p>
</div>
<div class="sect2">
<h3 id="postgresql-snapshot-metrics"><a class="anchor" href="#postgresql-snapshot-metrics"></a>Snapshot metrics</h3>
<div class="paragraph">
<p>The <strong>MBean</strong> is <code>debezium.postgres:type=connector-metrics,context=snapshot,server=<em>&lt;database.server.name&gt;</em></code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 45%;">
<col style="width: 25%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attributes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-lastevent_postgresql"></a><a href="#connectors-snaps-metric-lastevent_postgresql"><code>LastEvent</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>string</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The last snapshot event that the connector has read.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-millisecondssincelastevent_postgresql"></a><a href="#connectors-snaps-metric-millisecondssincelastevent_postgresql"><code>MilliSecondsSinceLastEvent</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of milliseconds since the connector has read and processed the most recent event.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-totalnumberofeventsseen_postgresql"></a><a href="#connectors-snaps-metric-totalnumberofeventsseen_postgresql"><code>TotalNumberOfEventsSeen</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The total number of events that this connector has seen since last started or reset.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-numberofeventsfiltered_postgresql"></a><a href="#connectors-snaps-metric-numberofeventsfiltered_postgresql"><code>NumberOfEventsFiltered</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of events that have been filtered by include/exclude list filtering rules configured on the connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-monitoredtables_postgresql"></a><a href="#connectors-snaps-metric-monitoredtables_postgresql"><code>MonitoredTables</code></a>
<em>deprecated and scheduled for removal in a future release; use the 'CapturedTables' metric instead</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>string[]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The list of tables that are monitored by the connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-capturedtables_postgresql"></a><a href="#connectors-snaps-metric-capturedtables__postgresql"><code>MonitoredTables</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>string[]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The list of tables that are captured by the connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-queuetotalcapacity_postgresql"></a><a href="#connectors-snaps-metric-queuetotalcapacity_postgresql"><code>QueueTotalCapacity</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>int</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The length the queue used to pass events between the snapshotter and the main Kafka Connect loop.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-queueremainingcapacity_postgresql"></a><a href="#connectors-snaps-metric-queueremainingcapacity_postgresql"><code>QueueRemainingCapacity</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>int</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The free capacity of the queue used to pass events between the snapshotter and the main Kafka Connect loop.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-totaltablecount_postgresql"></a><a href="#connectors-snaps-metric-totaltablecount_postgresql"><code>TotalTableCount</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>int</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The total number of tables that are being included in the snapshot.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-remainingtablecount_postgresql"></a><a href="#connectors-snaps-metric-remainingtablecount_postgresql"><code>RemainingTableCount</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>int</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of tables that the snapshot has yet to copy.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-snapshotrunning_postgresql"></a><a href="#connectors-snaps-metric-snapshotrunning_postgresql"><code>SnapshotRunning</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>boolean</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Whether the snapshot was started.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-snapshotaborted_postgresql"></a><a href="#connectors-snaps-metric-snapshotaborted_postgresql"><code>SnapshotAborted</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>boolean</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Whether the snapshot was aborted.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-snapshotcompleted_postgresql"></a><a href="#connectors-snaps-metric-snapshotcompleted_postgresql"><code>SnapshotCompleted</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>boolean</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Whether the snapshot completed.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-snapshotdurationinseconds_postgresql"></a><a href="#connectors-snaps-metric-snapshotdurationinseconds_postgresql"><code>SnapshotDurationInSeconds</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The total number of seconds that the snapshot has taken so far, even if not complete.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-rowsscanned_postgresql"></a><a href="#connectors-snaps-metric-rowsscanned_postgresql"><code>RowsScanned</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Map&lt;String, Long&gt;</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Map containing the number of rows scanned for each table in the snapshot.
Tables are incrementally added to the Map during processing.
Updates every 10,000 rows scanned and upon completing a table.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-maxqueuesizeinbytes_postgresql"></a><a href="#connectors-snaps-metric-maxqueuesizeinbytes_postgresql"><code>MaxQueueSizeInBytes</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The maximum buffer of the queue in bytes. It will be enabled if <code>max.queue.size.in.bytes</code> is passed with a positive long value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-snaps-metric-currentqueuesizeinbytes_postgresql"></a><a href="#connectors-snaps-metric-currentqueuesizeinbytes_postgresql"><code>CurrentQueueSizeInBytes</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The current data of records in the queue in bytes.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="postgresql-streaming-metrics"><a class="anchor" href="#postgresql-streaming-metrics"></a>Streaming metrics</h3>
<div class="paragraph">
<p>The <strong>MBean</strong> is <code>debezium.postgres:type=connector-metrics,context=streaming,server=<em>&lt;database.server.name&gt;</em></code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 45%;">
<col style="width: 25%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attributes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-lastevent_postgresql"></a><a href="#connectors-strm-metric-lastevent_postgresql"><code>LastEvent</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>string</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The last streaming event that the connector has read.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-millisecondssincelastevent_postgresql"></a><a href="#connectors-strm-metric-millisecondssincelastevent_postgresql"><code>MilliSecondsSinceLastEvent</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of milliseconds since the connector has read and processed the most recent event.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-totalnumberofeventsseen_postgresql"></a><a href="#connectors-strm-metric-totalnumberofeventsseen_postgresql"><code>TotalNumberOfEventsSeen</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The total number of events that this connector has seen since last started or reset.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-numberofeventsfiltered_postgresql"></a><a href="#connectors-strm-metric-numberofeventsfiltered_postgresql"><code>NumberOfEventsFiltered</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of events that have been filtered by include/exclude list filtering rules configured on the connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-monitoredtables_postgresql"></a><a href="#connectors-strm-metric-monitoredtables_postgresql"><code>MonitoredTables</code></a>
<em>deprecated and scheduled for removal in a future release; use the 'CapturedTables' metric instead</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>string[]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The list of tables that are monitored by the connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-capturedtables_postgresql"></a><a href="#connectors-strm-metric-capturedtablespostgresql"><code>CapturedTables</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>string[]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The list of tables that are captured by the connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-queuetotalcapacity_postgresql"></a><a href="#connectors-strm-metric-queuetotalcapacity_postgresql"><code>QueueTotalCapacity</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>int</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The length the queue used to pass events between the streamer and the main Kafka Connect loop.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-queueremainingcapacity_postgresql"></a><a href="#connectors-strm-metric-queueremainingcapacity_postgresql"><code>QueueRemainingCapacity</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>int</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The free capacity of the queue used to pass events between the streamer and the main Kafka Connect loop.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-connected_postgresql"></a><a href="#connectors-strm-metric-connected_postgresql"><code>Connected</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>boolean</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Flag that denotes whether the connector is currently connected to the database server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-millisecondsbehindsource_postgresql"></a><a href="#connectors-strm-metric-millisecondsbehindsource_postgresql"><code>MilliSecondsBehindSource</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of milliseconds between the last change event&#8217;s timestamp and the connector processing it.
The values will incoporate any differences between the clocks on the machines where the database server and the connector are running.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-numberofcommittedtransactions_postgresql"></a><a href="#connectors-strm-metric-numberofcommittedtransactions_postgresql"><code>NumberOfCommittedTransactions</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of processed transactions that were committed.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-sourceeventposition_postgresql"></a><a href="#connectors-strm-metric-sourceeventposition_postgresql"><code>SourceEventPosition</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Map&lt;String, String&gt;</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The coordinates of the last received event.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-lasttransactionid_postgresql"></a><a href="#connectors-strm-metric-lasttransactionid_postgresql"><code>LastTransactionId</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>string</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Transaction identifier of the last processed transaction.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-maxqueuesizeinbytes_postgresql"></a><a href="#connectors-strm-metric-maxqueuesizeinbytes_postgresql"><code>MaxQueueSizeInBytes</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The maximum buffer of the queue in bytes.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="connectors-strm-metric-currentqueuesizeinbytes_postgresql"></a><a href="#connectors-strm-metric-currentqueuesizeinbytes_postgresql"><code>CurrentQueueSizeInBytes</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>long</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The current data of records in the queue in bytes.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="postgresql-when-things-go-wrong"><a class="anchor" href="#postgresql-when-things-go-wrong"></a>Behavior when things go wrong</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Debezium is a distributed system that captures all changes in multiple upstream databases; it never misses or loses an event. When the system is operating normally or being managed carefully then Debezium provides <em>exactly once</em> delivery of every change event record.</p>
</div>
<div class="paragraph">
<p>If a fault does happen then the system does not lose any events. However, while it is recovering from the fault, it might repeat some change events. In these abnormal situations, Debezium, like Kafka, provides <em>at least once</em> delivery of change events.</p>
</div>
<div class="paragraph">
<p>The rest of this section describes how Debezium handles various kinds of faults and problems.</p>
</div>
<div class="sect2">
<h3 id="postgresql-connector-configuration-and-startup-errors"><a class="anchor" href="#postgresql-connector-configuration-and-startup-errors"></a>Configuration and startup errors</h3>
<div class="paragraph">
<p>In the following situations, the connector fails when trying to start, reports an error/exception in the log, and stops running:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The connector&#8217;s configuration is invalid.</p>
</li>
<li>
<p>The connector cannot successfully connect to PostgreSQL by using the specified connection parameters.</p>
</li>
<li>
<p>The connector is restarting from a previously-recorded position in the PostgreSQL WAL (by using the LSN) and PostgreSQL no longer has that history available.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In these cases, the error message has details about the problem and possibly a suggested workaround. After you correct the configuration or address the PostgreSQL problem, restart the connector.</p>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-becomes-unavailable"><a class="anchor" href="#postgresql-becomes-unavailable"></a>PostgreSQL becomes unavailable</h3>
<div class="paragraph">
<p>When the connector is running, the PostgreSQL server that it is connected to could become unavailable for any number of reasons. If this happens, the connector fails with an error and stops. When the server is available again, restart the connector.</p>
</div>
<div class="paragraph">
<p>The PostgreSQL connector externally stores the last processed offset in the form of a PostgreSQL LSN. After a connector restarts and connects to a server instance, the connector communicates with the server to continue streaming from that particular offset. This offset is available as long as the Debezium replication slot remains intact.  Never drop a replication slot on the primary server or you will lose data. See the next section for failure cases in which a slot has been removed.</p>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-cluster-failures"><a class="anchor" href="#postgresql-cluster-failures"></a>Cluster failures</h3>
<div class="paragraph">
<p>As of release 12, PostgreSQL allows logical replication slots <em>only on primary servers</em>. This means that you can point a Debezium PostgreSQL connector to only the active primary server of a database cluster.
Also, replication slots themselves are not propagated to replicas.
If the primary server goes down, a new primary must be promoted.</p>
</div>
<div class="paragraph">
<p>The new primary must have the <a href="#installing-postgresql-output-plugin">logical decoding plug-in</a> installed and a replication slot that is configured for use by the plug-in and the database for which you want to capture changes. Only then can you point the connector to the new server and restart the connector.</p>
</div>
<div class="paragraph">
<p>There are important caveats when failovers occur and you should pause Debezium until you can verify that you have an intact replication slot that has not lost data. After a failover:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There must be a process that re-creates the Debezium replication slot before allowing the application to write to the <strong>new</strong> primary. This is crucial. Without this process, your application can miss change events.</p>
</li>
<li>
<p>You might need to verify that Debezium was able to read all changes in the slot <strong>before the old primary failed</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>One reliable method of recovering and verifying whether any changes were lost is to recover a backup of the failed primary to the point immediately before it failed. While this can be administratively difficult, it allows you to inspect the replication slot for any unconsumed changes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There are discussions in the PostgreSQL community around a feature called <code>failover slots</code> that would help mitigate this problem, but as of PostgreSQL 12, they have not been implemented.  However, there is active development for PostgreSQL 13 to support logical decoding on standbys, which is a major requirement to make failover possible. You can find more about this in this <a href=""https://www.postgresql.org/message-id/CAJ3gD9fE=<a href="mailto:0w50sRagcs+jrktBXuJAWGZQdSTMa57CCY+Dh-xbg@mail.gmail.com">0w50sRagcs+jrktBXuJAWGZQdSTMa57CCY+Dh-xbg@mail.gmail.com</a>"">community thread</a>.</p>
</div>
<div class="paragraph">
<p>More about the concept of failover slots is in <a href="http://blog.2ndquadrant.com/failover-slots-postgresql">this blog post</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-kafka-connect-process-stops-gracefully"><a class="anchor" href="#postgresql-kafka-connect-process-stops-gracefully"></a>Kafka Connect process stops gracefully</h3>
<div class="paragraph">
<p>Suppose that Kafka Connect is being run in distributed mode and a Kafka Connect process is stopped gracefully. Prior to shutting down that process, Kafka Connect migrates the process&#8217;s connector tasks to another Kafka Connect process in that group. The new connector tasks start processing exactly where the prior tasks stopped. There is a short delay in processing while the connector tasks are stopped gracefully and restarted on the new processes.</p>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-kafka-connect-process-crashes"><a class="anchor" href="#postgresql-kafka-connect-process-crashes"></a>Kafka Connect process crashes</h3>
<div class="paragraph">
<p>If the Kafka Connector process stops unexpectedly, any connector tasks it was running terminate without recording their most recently processed offsets. When Kafka Connect is being run in distributed mode, Kafka Connect restarts those connector tasks on other processes. However, PostgreSQL connectors resume from the last offset that was <em>recorded</em> by the earlier processes. This means that the new replacement tasks might generate some of the same change events that were processed just prior to the crash. The number of duplicate events depends on the offset flush period and the volume of data changes just before the crash.</p>
</div>
<div class="paragraph">
<p>Because there is a chance that some events might be duplicated during a recovery from failure, consumers should always anticipate some duplicate events. Debezium changes are idempotent, so a sequence of events always results in the same state.</p>
</div>
<div class="paragraph">
<p>In each change event record, Debezium connectors insert source-specific information about the origin of the event, including the PostgreSQL server&#8217;s time of the event, the ID of the server transaction, and the position in the write-ahead log where the transaction changes were written. Consumers can keep track of this information, especially the LSN, to determine whether an event is a duplicate.</p>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-kafka-becomes-unavailable"><a class="anchor" href="#postgresql-kafka-becomes-unavailable"></a>Kafka becomes unavailable</h3>
<div class="paragraph">
<p>As the connector generates change events, the Kafka Connect framework records those events in Kafka by using the Kafka producer API. Periodically, at a frequency that you specify in the Kafka Connect configuration, Kafka Connect records the latest offset that appears in those change events. If the Kafka brokers become unavailable, the Kafka Connect process that is running the connectors repeatedly tries to reconnect to the Kafka brokers. In other words, the connector tasks pause until a connection can be re-established, at which point the connectors resume exactly where they left off.</p>
</div>
</div>
<div class="sect2">
<h3 id="postgresql-connector-is-stopped-for-a-duration"><a class="anchor" href="#postgresql-connector-is-stopped-for-a-duration"></a>Connector is stopped for a duration</h3>
<div class="paragraph">
<p>If the connector is gracefully stopped, the database can continue to be used. Any changes are recorded in the PostgreSQL WAL. When the connector restarts, it resumes streaming changes where it left off. That is, it generates change event records for all database changes that were made while the connector was stopped.</p>
</div>
<div class="paragraph">
<p>A properly configured Kafka cluster is able to handle massive throughput. Kafka Connect is written according to Kafka best practices, and given enough resources a Kafka Connect connector can also handle very large numbers of database change events. Because of this, after being stopped for a while, when a Debezium connector restarts, it is very likely to catch up with the database changes that were made while it was stopped. How quickly this happens depends on the capabilities and performance of Kafka and the volume of changes being made to the data in PostgreSQL.</p>
</div>
</div>
</div>
</div>
</article>
</div>
<div class="article-cell2">
</div>
</div>

<div id="toc-rightbar"></div>    <footer class="footer">
        <div class="wrapper">
            <div class="copyright">Copyright &copy; 2021 Debezium Community</div>
        </div>
    </footer>
</main>
</div>
<script>
    /* Make sure TOC carets are expanded if sub-elements exist */
    $("#toc").each(function(i,v) {
      $(this).closest('article').addClass('with-toc');
    });

    $("#toc ul.sectlevel1 > li").each(function(i,v) {
      $(this).has("ul").addClass("expanded");
    });

    $(function() {
        /* Expands all the documentation submenus */
        $(".nav-list > .nav-item:not(.is-active) .nav-item-toggle").click();
    });

    /**
     * This checks if a "#toc" element exists in the DOM and if so:
     *
     *  1. Appends a cloned copy of the #toc node to the #toc-rightbar div.
     *  2. Forces the #toc-rightbar div to be visible.
     *  3. Adds the .toc-right class to the #article-wrapper div to restrict the article's overall width.
     */
    var $toc = $("#toc");
    if ( $toc.length ) {
        $("#toc-rightbar").append($toc.clone());
        $("body .main").addClass("with-toc");
    }

    /**
     * In order to make CSS changes that are backward compatible with old adoc files, this applies a version
     * style to the body tag so we can use it to differentiate between CSS styles per version if needed,
     * such as tfoot rows.
     */
    var $version = $("body .nav-container").data("version");
    var $versionClass = "version-" + $version;
    $versionClass = $versionClass.replace('.','-');
    $("body").addClass($versionClass);

    /** A CSS trick to wrap long-width tables in a div that can be scrolled on smaller screens */
    $("table.tableblock").wrap("<div class='table-scroll-wrapper'></div>");

    $(function() {
        /* apply floating scrollbar to the scroll-wrapper */
        $(".table-scroll-wrapper").floatingScrollbar();
    });

</script>
<script src="../../../debezium-antora/js/site.js"></script>
<script async src="../../../debezium-antora/js/vendor/highlight.js"></script>

<script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
  try {
    var pageTracker = _gat._getTracker("UA-10656779-1");
    pageTracker._trackPageview();
  } catch(err) {}
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-76464546-1', 'auto');
  ga('send', 'pageview');
  ga('set', 'anonymizeIp', true);
  ga('require', 'linkid', 'linkid.js');
</script>
</body>
</html>