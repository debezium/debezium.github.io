<!DOCTYPE html> <html> <head> <title>Building Audit Logs with Change Data Capture and Stream Processing</title> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="description" content="Debezium is an open source distributed platform for change data capture. Start it up, point it at your databases, and your apps can start responding to all of the inserts, updates, and deletes that other apps commit to your databases. Debezium is durable and fast, so your apps can respond quickly and never miss an event, even when things go wrong."> <meta content="Debezium" property="og:site_name"> <meta content="Building Audit Logs with Change Data Capture and Stream Processing" property="og:title"> <meta content="https://debezium.io/assets/images/color_black_debezium_type_1200px.png" property="og:image" name="image"> <meta property="og:description" content="Debezium is an open source distributed platform for change data capture. Start it up, point it at your databases, and your apps can start responding to all of the inserts, updates, and deletes that other apps commit to your databases. Debezium is durable and fast, so your apps can respond quickly and never miss an event, even when things go wrong."> <meta property="og:url" content="https://debezium.io/blog/2019/10/01/audit-logs-with-change-data-capture-and-stream-processing/"> <meta name="twitter:site" content="@debezium"> <meta name="twitter:title" content="Building Audit Logs with Change Data Capture and Stream Processing"> <meta name="twitter:creator" content="@gmorling"> <meta name="twitter:description" content="Debezium is an open source distributed platform for change data capture. Start it up, point it at your databases, and your apps can start responding to all of the inserts, updates, and deletes that other apps commit to your databases. Debezium is durable and fast, so your apps can respond quickly and never miss an event, even when things go wrong."> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="https://debezium.io/assets/images/color_black_debezium_type_1200px.png"> <meta property="twitter:url" content="https://debezium.io/blog/2019/10/01/audit-logs-with-change-data-capture-and-stream-processing/"> <link rel="alternate" type="application/rss+xml" title="Debezium Blog" href="/blog.atom"> <link rel="shortcut icon" type="image/png" href="/favicon.ico"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css"/> <link rel="stylesheet" href="/assets/css/custom.css"/> <link rel="stylesheet" href="/assets/css/highlight.min.css"/> <link rel="stylesheet" href="/assets/css/coderay.css"/> </head> <body class="post"> <div id="rhbar"> <a class="jbdevlogo" href="https://developers.redhat.com"></a> <a class="rhlogo" href="https://www.redhat.com/"></a> </div> <div id> <div class="container" id="content"> <nav class="navbar navbar-inverse navbar-fix"> <div class="container-fluid"> <div class="navbar-header"> <button class="navbar-toggle collapsed border-0" type="button" data-toggle="collapse" data-target="#navigation" aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/"><img class="project-logo" src="/assets/images/color_white_debezium_type_600px.svg" style="height: 32px; margin-right: 5px; margin-top: -5px;"></a> </div> <div class="collapse navbar-collapse collapsed" id="navigation"> <ul class="nav navbar-nav pull-right"> <li> <a href="/documentation/faq" class="">FAQ</a> </li> <li class="item"> <a href="/documentation/" class="">Documentation</a> </li> <li> <a href="/releases/" class="">Releases</a> </li> <li> <a href="/community/" class="">Community</a> </li> <li class="active"> <a href="/blog/" class="active">Blog</a> </li> </ul> </div> </div> </nav> <div class="row post-text-padding row-no-expand"> <div class="col-md-3"><div id="leftdocnav"> <div class="hidden-lg hidden-md hidden-sm"> <button class="navbar-toggle docssubmenu-toggle collapsed" data-target="#docssubmenu" data-toggle="collapse" style=" float: none; background-color: #656565; border-color: #656565; width: 100%; color: #fff; "> Navigation Menu </button> </div> <div class="collapse" id="docssubmenu"> <div class="doc-pills"> <ul class="nav nav-pills nav-stacked"> <li class="item"> <a href="/blog">Home</a> <div class="icon"><span class="icon-home"></span></div> </li> <li class="item"> <a href="/archives">Archive</a> <div class="icon"><span class="icon-arrow-down"></span></div> </li> <li class="item"> <a href="/blog.atom">Feed</a> <div class="icon"><span class="icon-rss"></span></div> </li> </ul> </div> <p></p> <div class="featured-posts"> <div id="#featured" style="margin-bottom: 4px; border-bottom: 1px solid #ccc; font-size: 115%; margin-left: 2px;">Featured Posts</div> <ul style="padding-inline-start: 22px;"> <li style="margin-bottom: 3px;"> <a href="/blog/2023/07/10/custom-http-signaling-notification/" style="font-size: 95%;"> Debezium signaling and notifications - Part 2: Customisation </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2023/06/27/Debezium-signaling-and-notifications/" style="font-size: 95%;"> Debezium signaling and notifications - Part 1 </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2023/05/02/tensorflow-mnist-classification/" style="font-size: 95%;"> Image classification with Debezium and TensorFlow </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2020/11/04/streaming-vitess-at-bolt/" style="font-size: 95%;"> Streaming Vitess at Bolt </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2020/02/10/event-sourcing-vs-cdc/" style="font-size: 95%;"> Distributed Data for Microservices â€” Event Sourcing vs. Change Data Capture </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2019/10/01/audit-logs-with-change-data-capture-and-stream-processing/" style="font-size: 95%;"> Building Audit Logs with Change Data Capture and Stream Processing </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2019/07/12/streaming-cassandra-at-wepay-part-1/" style="font-size: 95%;"> Streaming Cassandra at WePay - Part 1 </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2019/02/19/reliable-microservices-data-exchange-with-the-outbox-pattern/" style="font-size: 95%;"> Reliable Microservices Data Exchange With the Outbox Pattern </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/12/05/automating-cache-invalidation-with-change-data-capture/" style="font-size: 95%;"> Automating Cache Invalidation With Change Data Capture </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/09/20/materializing-aggregate-views-with-hibernate-and-debezium/" style="font-size: 95%;"> Materializing Aggregate Views With Hibernate and Debezium </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/07/19/advantages-of-log-based-change-data-capture/" style="font-size: 95%;"> Five Advantages of Log-Based Change Data Capture </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/03/08/creating-ddd-aggregates-with-debezium-and-kafka-streams/" style="font-size: 95%;"> Creating DDD aggregates with Debezium and Kafka Streams </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/01/17/streaming-to-elasticsearch/" style="font-size: 95%;"> Streaming Data Changes from Your Database to Elasticsearch </a> </li> </ul> </div> <p></p> <p></p> <div class="cloud-tags"> <div id="tags" style="margin-bottom: 4px; border-bottom: 1px solid #ccc; font-size: 115%; margin-left: 2px;"> Tags </div> <div class="tag-cloud"> <span class="site-tag"> <a href="/tag/apache-kafka/" style="font-size: 82%"> apache kafka </a> </span> <span class="site-tag"> <a href="/tag/apache-kafka/" style="font-size: 92%"> apache kafka </a> </span> <span class="site-tag"> <a href="/tag/apicurio/" style="font-size: 82%"> apicurio </a> </span> <span class="site-tag"> <a href="/tag/avro/" style="font-size: 84%"> avro </a> </span> <span class="site-tag"> <a href="/tag/aws/" style="font-size: 82%"> aws </a> </span> <span class="site-tag"> <a href="/tag/caassandra/" style="font-size: 84%"> caassandra </a> </span> <span class="site-tag"> <a href="/tag/camel/" style="font-size: 82%"> camel </a> </span> <span class="site-tag"> <a href="/tag/cassandra/" style="font-size: 246%"> cassandra </a> </span> <span class="site-tag"> <a href="/tag/cdc/" style="font-size: 82%"> cdc </a> </span> <span class="site-tag"> <a href="/tag/channels/" style="font-size: 82%"> channels </a> </span> <span class="site-tag"> <a href="/tag/community/" style="font-size: 124%"> community </a> </span> <span class="site-tag"> <a href="/tag/community-stories/" style="font-size: 84%"> community stories </a> </span> <span class="site-tag"> <a href="/tag/containers/" style="font-size: 82%"> containers </a> </span> <span class="site-tag"> <a href="/tag/cqrs/" style="font-size: 84%"> cqrs </a> </span> <span class="site-tag"> <a href="/tag/custom/" style="font-size: 82%"> custom </a> </span> <span class="site-tag"> <a href="/tag/datalake/" style="font-size: 82%"> datalake </a> </span> <span class="site-tag"> <a href="/tag/db2/" style="font-size: 228%"> db2 </a> </span> <span class="site-tag"> <a href="/tag/ddd/" style="font-size: 82%"> ddd </a> </span> <span class="site-tag"> <a href="/tag/debezium/" style="font-size: 96%"> debezium </a> </span> <span class="site-tag"> <a href="/tag/debezium-server/" style="font-size: 90%"> debezium server </a> </span> <span class="site-tag"> <a href="/tag/debezium-ui/" style="font-size: 90%"> debezium ui </a> </span> <span class="site-tag"> <a href="/tag/deduplication/" style="font-size: 82%"> deduplication </a> </span> <span class="site-tag"> <a href="/tag/discussion/" style="font-size: 114%"> discussion </a> </span> <span class="site-tag"> <a href="/tag/docker/" style="font-size: 186%"> docker </a> </span> <span class="site-tag"> <a href="/tag/elasticsearch/" style="font-size: 82%"> elasticsearch </a> </span> <span class="site-tag"> <a href="/tag/event-sourcing/" style="font-size: 82%"> event sourcing </a> </span> <span class="site-tag"> <a href="/tag/exactly-once-semantics/" style="font-size: 82%"> exactly once semantics </a> </span> <span class="site-tag"> <a href="/tag/example/" style="font-size: 88%"> example </a> </span> <span class="site-tag"> <a href="/tag/examples/" style="font-size: 114%"> examples </a> </span> <span class="site-tag"> <a href="/tag/features/" style="font-size: 84%"> features </a> </span> <span class="site-tag"> <a href="/tag/fedora/" style="font-size: 82%"> fedora </a> </span> <span class="site-tag"> <a href="/tag/hiring/" style="font-size: 84%"> hiring </a> </span> <span class="site-tag"> <a href="/tag/iceberg/" style="font-size: 82%"> iceberg </a> </span> <span class="site-tag"> <a href="/tag/integration/" style="font-size: 84%"> integration </a> </span> <span class="site-tag"> <a href="/tag/introduction/" style="font-size: 84%"> introduction </a> </span> <span class="site-tag"> <a href="/tag/jaeger/" style="font-size: 82%"> jaeger </a> </span> <span class="site-tag"> <a href="/tag/json/" style="font-size: 82%"> json </a> </span> <span class="site-tag"> <a href="/tag/kafka/" style="font-size: 94%"> kafka </a> </span> <span class="site-tag"> <a href="/tag/kafka-streams/" style="font-size: 82%"> kafka streams </a> </span> <span class="site-tag"> <a href="/tag/kafka-streams/" style="font-size: 86%"> kafka streams </a> </span> <span class="site-tag"> <a href="/tag/kogito/" style="font-size: 82%"> kogito </a> </span> <span class="site-tag"> <a href="/tag/ksql/" style="font-size: 82%"> ksql </a> </span> <span class="site-tag"> <a href="/tag/kubernetes/" style="font-size: 82%"> kubernetes </a> </span> <span class="site-tag"> <a href="/tag/lakehouse/" style="font-size: 82%"> lakehouse </a> </span> <span class="site-tag"> <a href="/tag/machine-learning/" style="font-size: 82%"> machine learning </a> </span> <span class="site-tag"> <a href="/tag/microservices/" style="font-size: 84%"> microservices </a> </span> <span class="site-tag"> <a href="/tag/mongo/" style="font-size: 86%"> mongo </a> </span> <span class="site-tag"> <a href="/tag/mongodb/" style="font-size: 246%"> mongodb </a> </span> <span class="site-tag"> <a href="/tag/mysql/" style="font-size: 382%"> mysql </a> </span> <span class="site-tag"> <a href="/tag/news/" style="font-size: 112%"> news </a> </span> <span class="site-tag"> <a href="/tag/newsletter/" style="font-size: 88%"> newsletter </a> </span> <span class="site-tag"> <a href="/tag/notifications/" style="font-size: 84%"> notifications </a> </span> <span class="site-tag"> <a href="/tag/oracle/" style="font-size: 278%"> oracle </a> </span> <span class="site-tag"> <a href="/tag/outbox/" style="font-size: 216%"> outbox </a> </span> <span class="site-tag"> <a href="/tag/postgres/" style="font-size: 350%"> postgres </a> </span> <span class="site-tag"> <a href="/tag/presentation/" style="font-size: 84%"> presentation </a> </span> <span class="site-tag"> <a href="/tag/production/" style="font-size: 82%"> production </a> </span> <span class="site-tag"> <a href="/tag/quarkus/" style="font-size: 92%"> quarkus </a> </span> <span class="site-tag"> <a href="/tag/questdb/" style="font-size: 82%"> questdb </a> </span> <span class="site-tag"> <a href="/tag/rds/" style="font-size: 84%"> rds </a> </span> <span class="site-tag"> <a href="/tag/releases/" style="font-size: 364%"> releases </a> </span> <span class="site-tag"> <a href="/tag/schema/" style="font-size: 82%"> schema </a> </span> <span class="site-tag"> <a href="/tag/scylla/" style="font-size: 82%"> scylla </a> </span> <span class="site-tag"> <a href="/tag/secrets/" style="font-size: 82%"> secrets </a> </span> <span class="site-tag"> <a href="/tag/sentry/" style="font-size: 82%"> sentry </a> </span> <span class="site-tag"> <a href="/tag/serialization/" style="font-size: 82%"> serialization </a> </span> <span class="site-tag"> <a href="/tag/signaling/" style="font-size: 84%"> signaling </a> </span> <span class="site-tag"> <a href="/tag/smt/" style="font-size: 84%"> smt </a> </span> <span class="site-tag"> <a href="/tag/snapshots/" style="font-size: 84%"> snapshots </a> </span> <span class="site-tag"> <a href="/tag/spanner/" style="font-size: 104%"> spanner </a> </span> <span class="site-tag"> <a href="/tag/sql/" style="font-size: 84%"> sql </a> </span> <span class="site-tag"> <a href="/tag/sqlserver/" style="font-size: 292%"> sqlserver </a> </span> <span class="site-tag"> <a href="/tag/tensorflow/" style="font-size: 82%"> tensorflow </a> </span> <span class="site-tag"> <a href="/tag/testcontainers/" style="font-size: 88%"> testcontainers </a> </span> <span class="site-tag"> <a href="/tag/tests/" style="font-size: 82%"> tests </a> </span> <span class="site-tag"> <a href="/tag/time-series/" style="font-size: 82%"> time series </a> </span> <span class="site-tag"> <a href="/tag/topics/" style="font-size: 82%"> topics </a> </span> <span class="site-tag"> <a href="/tag/tracing/" style="font-size: 82%"> tracing </a> </span> <span class="site-tag"> <a href="/tag/transactions/" style="font-size: 82%"> transactions </a> </span> <span class="site-tag"> <a href="/tag/vagrant/" style="font-size: 82%"> vagrant </a> </span> <span class="site-tag"> <a href="/tag/vitess/" style="font-size: 208%"> vitess </a> </span> <span class="site-tag"> <a href="/tag/website/" style="font-size: 84%"> website </a> </span> </div> </div> </div> </div> </div> <div class="col-md-9"> <div class="post"> <div class="row" style="margin-left: 0; margin-right: 0; margin-bottom: 10px"> <div class="col-sm-12" style="padding-left: 0px"> <div style="display: table-cell; vertical-align: top"> <div style=" width: 72px; border: 1px solid #ccc; padding: 3px; display: inline-block; "> <img src="/assets/images/gmorling.jpg" style="width: 64px;"> </div> </div> <div style="display: table-cell; vertical-align: top"> <div style="margin-left: 8px"> <span class="hidden-sm hidden-xs" style="font-size: 2.75rem; line-height: 1"> <a href="/blog/2019/10/01/audit-logs-with-change-data-capture-and-stream-processing/">Building Audit Logs with Change Data Capture and Stream Processing</a> </span> <span class="hidden-md hidden-lg" style="font-size: 2rem; line-height: 1"> <a href="/blog/2019/10/01/audit-logs-with-change-data-capture-and-stream-processing/">Building Audit Logs with Change Data Capture and Stream Processing</a> </span> <div class="byline" style="line-height: 1"> <em> October 1, 2019 by </em> <em> Gunnar Morling </em> <div class="hidden-xs" style="margin-top: 5px"> <a class="label label-info hidden-sm hidden-xs" href="/tag/discussion/">discussion</a> <a class="label label-info hidden-sm hidden-xs" href="/tag/examples/">examples</a> <a class="label label-info hidden-sm hidden-xs" href="/tag/apache-kafka/">apache-kafka</a> <a class="label label-info hidden-sm hidden-xs" href="/tag/kafka-streams/">kafka-streams</a> </div> </div> </div> </div> </div> </div> <div class="grid__item width-12-12"><div class="paragraph"> <p>It is a common requirement for business applications to maintain some form of audit log, i.e. a persistent trail of all the changes to the application&#8217;s data. If you squint a bit, a Kafka topic with Debezium data change events is quite similar to that: sourced from database transaction logs, it describes all the changes to the records of an application. What&#8217;s missing though is some metadata: why, when and by whom was the data changed? In this post we&#8217;re going to explore how that metadata can be provided and exposed via change data capture (CDC), and how stream processing can be used to enrich the actual data change events with such metadata.</p> </div> <div class="paragraph"> <p></p> </div> <div class="paragraph"> <p>Reasons for maintaining data audit trails are manyfold: e.g. regulatory requirements may mandate businesses to keep complete historic information of their customer, purchase order, invoice or other data. Also for an enterprise&#8217;s own purposes it can be very useful to have insight into why and how certain data has changed, e.g. allowing to improve business processes or analyze errors.</p> </div> <div class="paragraph"> <p>One common approach for creating audit trails are application-side libraries. Hooked into the chosen persistence library, they&#8217;d maintain specific column(s) in the data tables ("createdBy", "lastUpdated" etc.), and/or copy earlier record versions into some form of history tables.</p> </div> <div class="paragraph"> <p>There are some disadvantages to this, though:</p> </div> <div class="ulist"> <ul> <li> <p>writing records in history tables as part of OLTP transactions increases the number of executed statements within the transaction (for each update or delete, also an insert must be written into the corresponding history table) and thus may cause longer response times of the application</p> </li> <li> <p>oftentimes no audit events can be provided in case of bulk updates and deletes (e.g. <code>DELETE from purchaseorders where status = 'SHIPPED'</code>), as the listeners used to hook the library into the persistence framework are not aware of all the affected records</p> </li> <li> <p>changes done directly in the database cannot be tracked, e.g. when running a data load, doing batch processing in a stored procedure or when bypassing the application during an emergency data patch</p> </li> </ul> </div> <div class="paragraph"> <p>Another technique are database triggers. They won&#8217;t miss any operations, no matter whether issued from the application or the database itself. They&#8217;ll also be able to process each record affected by a bulk statement. On the downside, there&#8217;s still is the problem of increased latency when executing triggers as part of OLTP transactions. Also, a process must be in place for installing and updating the triggers for each table.</p> </div> <div class="sect1"> <h2 id="audit_logs_based_on_change_data_capture">Audit Logs Based on Change Data Capture</h2> <div class="sectionbody"> <div class="paragraph"> <p>The aforementioned problems don&#8217;t exist when leveraging the transaction log as the source for an audit trail and using change data capture for retrieving the change information and sending it into a message broker or log such as Apache Kafka.</p> </div> <div class="paragraph"> <p>Running asynchronously, the CDC process can extract the change data without impacting OLTP transactions. The transaction logs contain one entry whenever there&#8217;s a data change, be it issued from the application or directly executed in the database. There&#8217;ll be a log entry for each record updated or deleted in a bulk operation, so a change event for each of them can be produced. Also there is no impact on the data model, i.e. no special columns or history tables must be created.</p> </div> <div class="paragraph"> <p>But how can CDC access the metadata we&#8217;d discussed initially? This could for instance be data such as the application user that performed a data change, their IP address and device configuration, a tracing span id, or an identifier for the application use case.</p> </div> <div class="paragraph"> <p>As that metadata typically isn&#8217;t (nor shouldn&#8217;t) be stored in the actual business tables of an application, it must be provided separately. One approach is to have a separate table where this metadata is stored. For each executed transaction, the business application produces one record in that table, containing all the required metadata and using the transaction id as a primary key. When running manual data changes, it is easy to also provide the metadata record with an additional insert. As Debezium&#8217;s data change events contain the id of the transaction causing the specific change, the data change events and the metadata records can be correlated.</p> </div> <div class="paragraph"> <p>In the remainder of this post we&#8217;re going to take a closer look at how a business application can provide the transaction-scoped metadata and how data change events can be enriched with the corresponding metadata using the Kafka Streams API.</p> </div> </div> </div> <div class="sect1"> <h2 id="solution_overview">Solution Overview</h2> <div class="sectionbody"> <div class="paragraph"> <p>The following image shows the overall solution design, based on the example of a microservice for managing vegetable data:</p> </div> <div class="imageblock centered-image"> <img src="/assets/images/auditing_overview.png" class="responsive-image" alt="Auditing With Change Data Capture and Stream Processing"> </div> <div class="paragraph"> <p>There are two services involved:</p> </div> <div class="ulist"> <ul> <li> <p><em>vegetables-service</em>: a simple REST service for inserting and updating vegetable data into a Postgres database; as part of its processing, it will not only update its actual "business table" <code>vegetable</code>, but also insert some auditing metadata into a dedicated metadata table <code>transaction_context_data</code>; Debezium is used to stream change events from the two tables into corresponding topics in Apache Kafka</p> </li> <li> <p><em>log-enricher</em>: a stream processing application built with Kafka Streams and Quarkus, which enriches the messages from the CDC topic containing the vegetable change events (<code>dbserver1.inventory.vegetable</code>) with the corresponding metadata in the <code>dbserver1.inventory.transaction_context_data</code> topic and writes the enriched vegetable change event back to Kafka into the <code>dbserver1.inventory.vegetable.enriched</code> topic.</p> </li> </ul> </div> <div class="paragraph"> <p>You can find a <a href="https://github.com/debezium/debezium-examples/tree/main/auditlog">complete example</a> with all the components and instructions for running them on GitHub.</p> </div> </div> </div> <div class="sect1"> <h2 id="providing_auditing_metadata">Providing Auditing Metadata</h2> <div class="sectionbody"> <div class="paragraph"> <p>Let&#8217;s first discuss how an application such as the vegetable service can provide the required auditing metadata. As an example, the following metadata should be made available for auditing purposes:</p> </div> <div class="ulist"> <ul> <li> <p>The application user that did a data change, as represented by the <code>sub</code> claim of a JWT token (<a href="https://tools.ietf.org/html/rfc7519">JSON Web Token</a>)</p> </li> <li> <p>The request timestamp, as represented by the <code>Date</code> HTTP header</p> </li> <li> <p>A use case identifier, as provided via a custom Java annotation on the invoked REST resource method</p> </li> </ul> </div> <div class="paragraph"> <p>Here is a basic implementation of a REST resource for persisting a new vegetable using the <a href="https://jcp.org/en/jsr/detail?id=370">JAX-RS API</a>:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/vegetables</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@RequestScoped</span>
<span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="annotation">@Consumes</span>(MediaType.APPLICATION_JSON)
<span class="directive">public</span> <span class="type">class</span> <span class="class">VegetableResource</span> {

    <span class="annotation">@Inject</span>
    VegetableService vegetableService;

    <span class="annotation">@POST</span>
    <span class="annotation">@RolesAllowed</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">farmers</span><span class="delimiter">&quot;</span></span>})
    <span class="annotation">@Transactional</span>
    <span class="annotation">@Audited</span>(useCase=<span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE VEGETABLE</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Response createVegetable(Vegetable vegetable) {
        <span class="keyword">if</span> (vegetable.getId() != <span class="predefined-constant">null</span>) {
            <span class="keyword">return</span> Response.status(Status.BAD_REQUEST.getStatusCode()).build();
        }

        vegetable = vegetableService.createVegetable(vegetable);

        <span class="keyword">return</span> Response.ok(vegetable).status(Status.CREATED).build();
    }

    <span class="comment">// update, delete ...</span>
}</code></pre> </div> </div> <div class="paragraph"> <p>If you&#8217;ve ever built REST services with JAX-RS before, the implementation will look familiar to you: a resource method annotated with <code>@POST</code> takes the incoming request payload and passes it to a service bean which is injected via CDI. The <code>@Audited</code> annotation is special, though. It is a custom annotation type which serves two purposes:</p> </div> <div class="ulist"> <ul> <li> <p>Specifying the use case that should be referenced in the audit log ("CREATE VEGETABLE")</p> </li> <li> <p>Binding an <a href="https://jcp.org/en/jsr/detail?id=318">interceptor</a> which will be triggered for each invocation of a method annotated with <code>@Audited</code></p> </li> </ul> </div> <div class="paragraph"> <p>That interceptor kicks in whenever a method annotated with <code>@Audited</code> is invoked and implements the logic for writing the transaction-scoped audit metadata. It looks like this:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Interceptor</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@Audited</span>(useCase = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Priority</span>(value = Interceptor.Priority.APPLICATION + <span class="integer">100</span>) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TransactionInterceptor</span> {

    <span class="annotation">@Inject</span>
    JsonWebToken jwt; <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="annotation">@Inject</span>
    EntityManager entityManager;

    <span class="annotation">@Inject</span>
    HttpServletRequest request;

    <span class="annotation">@AroundInvoke</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> manageTransaction(InvocationContext ctx) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">BigInteger</span> txtId = (<span class="predefined-type">BigInteger</span>) entityManager <i class="conum" data-value="4"></i><b>(4)</b>
            .createNativeQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT txid_current()</span><span class="delimiter">&quot;</span></span>)
            .getSingleResult();
        <span class="predefined-type">String</span> useCase = ctx.getMethod().getAnnotation(Audited.class).useCase();

        TransactionContextData context = <span class="keyword">new</span> TransactionContextData(); <i class="conum" data-value="5"></i><b>(5)</b>

        context.transactionId = txtId.longValueExact();
        context.userName = jwt.&lt;<span class="predefined-type">String</span>&gt;claim(<span class="string"><span class="delimiter">&quot;</span><span class="content">sub</span><span class="delimiter">&quot;</span></span>).orElse(<span class="string"><span class="delimiter">&quot;</span><span class="content">anonymous</span><span class="delimiter">&quot;</span></span>);
        context.clientDate = getRequestDate();
        context.useCase = useCase;

        entityManager.persist(context);

        <span class="keyword">return</span> ctx.proceed(); <i class="conum" data-value="6"></i><b>(6)</b>
    }

    <span class="directive">private</span> ZonedDateTime getRequestDate() {
        <span class="predefined-type">String</span> requestDate = request.getHeader(HttpHeaders.DATE);
        <span class="keyword">return</span> requestDate != <span class="predefined-constant">null</span> ?
            ZonedDateTime.parse(requestDate, DateTimeFormatter.RFC_1123_DATE_TIME) :
            <span class="predefined-constant">null</span>;
    }
}</code></pre> </div> </div> <div class="colist arabic"> <table> <tr> <td><i class="conum" data-value="1"></i><b>1</b></td> <td><code>@Interceptor</code> and <code>@Audited</code> mark this as an interceptor bound to our custom <code>@Audited</code> annotion.</td> </tr> <tr> <td><i class="conum" data-value="2"></i><b>2</b></td> <td>The <code>@Priority</code> annotation controls at which point in the interceptor stack the auditing interceptor should be invoked. Any application-provided interceptors should have a priority larger than <code>Priority.APPLICATION</code> (2000); in particular, this ensures that a transaction will have been started before by means of the <code>@Transactional</code> annotation and its accompanying interceptor which run in the <code>Priority.PLATFORM_BEFORE</code> range (&lt; 1000).</td> </tr> <tr> <td><i class="conum" data-value="3"></i><b>3</b></td> <td>The caller&#8217;s JWT token injected via the <a href="https://microprofile.io/project/eclipse/microprofile-jwt-auth">MicroProfile JWT RBAC</a> API</td> </tr> </table> </div> <div class="paragraph"> <p>For each audited method the interceptor fires and will</p> </div> <div class="ulist"> <ul> <li> <p>obtain the current transaction id (the exact way for doing so is database-specific, in the example the <code>txid_current()</code> function from Postgres is called) <i class="conum" data-value="4"></i></p> </li> <li> <p>persist a <code>TransactionContextData</code> entity via JPA; its primary key value is the transaction id selected before, and it has attributes for the user name (obtained from the JWT token), the request date (obtained from the <code>DATE</code> HTTP request header) and the use case identifier (obtained from the <code>@Audited</code> annotation of the invoked method) <i class="conum" data-value="5"></i></p> </li> <li> <p>continue the call flow of the invoked method <i class="conum" data-value="6"></i></p> </li> </ul> </div> <div class="paragraph"> <p>When invoking the REST service to create and update a few vegetables, the following records should be created in the database (refer to the README in the provided example for instructions on building the example code and <a href="https://github.com/debezium/debezium-examples/tree/main/auditlog#inserting-some-data-and-observing-the-audit-log">invoking the vegetable service</a> with a suitable JWT token):</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="sql">vegetablesdb&gt; <span class="class">select</span> * <span class="keyword">from</span> inventory.vegetable;
+<span class="comment">------+---------------+---------+</span>
| id   | description   | name    |
|<span class="comment">------+---------------+---------|</span>
| <span class="integer">1</span>    | Spicy!        | Potato  |
| <span class="integer">11</span>   | Delicious!    | Pumpkin |
| <span class="integer">10</span>   | Tasty!        | Tomato  |
+<span class="comment">------+---------------+---------+</span></code></pre> </div> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="sql">vegetablesdb&gt; <span class="class">select</span> * <span class="keyword">from</span> inventory.transaction_context_data;
+<span class="comment">------------------+---------------------+------------------+----------------+</span>
| transaction_id   | client_date         | usecase          | user_name      |
|<span class="comment">------------------+---------------------+------------------+----------------|</span>
| <span class="integer">608</span>              | <span class="integer">2019</span><span class="integer">-08</span><span class="integer">-22</span> <span class="integer">08</span>:<span class="integer">12</span>:<span class="integer">31</span> | <span class="class">CREATE</span> VEGETABLE | farmerbob      |
| <span class="integer">609</span>              | <span class="integer">2019</span><span class="integer">-08</span><span class="integer">-22</span> <span class="integer">08</span>:<span class="integer">12</span>:<span class="integer">31</span> | <span class="class">CREATE</span> VEGETABLE | farmerbob      |
| <span class="integer">610</span>              | <span class="integer">2019</span><span class="integer">-08</span><span class="integer">-22</span> <span class="integer">08</span>:<span class="integer">12</span>:<span class="integer">31</span> | <span class="class">UPDATE</span> VEGETABLE | farmermargaret |
+<span class="comment">------------------+---------------------+------------------+----------------+</span></code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="enriching_change_events_with_auditing_metadata">Enriching Change Events with Auditing Metadata</h2> <div class="sectionbody"> <div class="paragraph"> <p>With the business data (vegetables) and the transaction-scoped metadata being stored in the database, it&#8217;s time to set up the <a href="/documentation/reference/0.10/connectors/postgresql.html">Debezium Postgres connector</a> and stream the data changes from the <code>vegetable</code> and <code>transaction_context_data</code> tables into corresponding Kafka topics. Again refer to the example README file for the details of <a href="https://github.com/debezium/debezium-examples/tree/main/auditlog#deploy-the-debezium-postgres-connector">deploying the connector</a>.</p> </div> <div class="paragraph"> <p>The <code>dbserver1.inventory.vegetable</code> topic should contain change events for created, updated and deleted vegetable records, whereas the <code>dbserver1.inventory.transaction_context_data</code> topic should only contain create messages for each inserted metadata record.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="title">Topic Retention</div> <div class="paragraph"> <p>In order to manage the growth of involved topics, the retention policy for each topic should be well-defined. For instance for the actual audit log topic with the enriched change events, a time based retention policy might be suitable, keeping each log event for as long as needed as per your requirements. The transaction metadata topic on the other hand can be fairly short-lived, as its entries are not needed any longer, once all corresponding data change events have been processed. It may be a good idea to set up some monitoring of the end-to-end lag in order to make sure the log enricher stream application keeps up with the incoming messages and doesn&#8217;t fall behind that far so it is at risk of transaction messages being discarded before processing the corresponding change events.</p> </div> </td> </tr> </table> </div> <div class="paragraph"> <p>Now, if we look at messages from the two topics, we can see that they can be correlated based on the transaction id. It is part of the <code>source</code> structure of vegetable change events, and it is the message key of transaction metadata events:</p> </div> <div class="imageblock centered-image"> <img src="/assets/images/auditing_input_messages.png" class="responsive-image" alt="Vegetable and Transaction Metadata Messages"> </div> <div class="paragraph"> <p>Once we&#8217;ve found the corresponding transaction event for a given vegetable change event, the <code>client_date</code>, <code>usecase</code> and <code>user_name</code> attributes from the former can be added to the latter:</p> </div> <div class="imageblock centered-image"> <img src="/assets/images/auditing_output_message.png" class="responsive-image" alt="Enriched Vegetable Message"> </div> <div class="paragraph"> <p>This kind of message transformation is a perfect use case for <a href="https://kafka.apache.org/documentation/streams/">Kafka Streams</a>, a Java API for implementing stream processing applications on top of Kafka topics, providing operators that let you filter, transform, aggregate and join Kafka messages.</p> </div> <div class="paragraph"> <p>As runtime environment for our stream processing application we&#8217;re going to use <a href="https://quarkus.io/">Quarkus</a>, which is "a Kubernetes Native Java stack tailored for GraalVM &amp; OpenJDK HotSpot, crafted from the best of breed Java libraries and standards".</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="title">Building Kafka Streams Applications with Quarkus</div> <div class="paragraph"> <p>Amongst many others, Quarkus comes with an <a href="https://quarkus.io/guides/kafka-streams-guide">extension for Kafka Streams</a>, which allows to build stream processing applications running on the JVM and as native code compiled ahead-of-time. It takes care of the lifecycle of the streaming topology, so you don&#8217;t have to deal with details like registering JVM shutdown hooks, awaiting the creation of all input topics and more.</p> </div> <div class="paragraph"> <p>The extension also comes with "live development" support, which automatically reloads the stream processing application while you&#8217;re working on it, allowing for very fast turnaround cycles during development.</p> </div> </td> </tr> </table> </div> <div class="sect2"> <h3 id="the_joining_logic">The Joining Logic</h3> <div class="paragraph"> <p>When thinking about the actual implementation of the enrichment logic, a <a href="https://kafka.apache.org/23/documentation/streams/developer-guide/dsl-api.html#kstream-kstream-join">stream-to-stream</a> join might appear as a suitable solution. By creating <code>KStream</code>s for the two topics, we may try and implement the joining functionality. One challenge though is how to define a suitable <a href="https://kafka.apache.org/23/documentation/streams/developer-guide/dsl-api.html#windowing-sliding">joining window</a>, as there is no timing guarantees between messages on the two topics, and we must not miss any event.</p> </div> <div class="paragraph"> <p>Another problem arises in regards to ordering guarantees of the change events. By default, Debezium will use a table&#8217;s primary key as the message key for the corresponding Kafka messages. This means that all messages for the same vegetable record will have the same key and thus will go into the same partition of the vegetables Kafka topic. This in turn guarantees that a consumer of these events sees all the messages pertaining to the same vegetable record in the exact same order as they were created.</p> </div> <div class="paragraph"> <p>Now, in order to join the two streams, the message key must be the same on both sides. This means the vegetables topic must be re-keyed by transaction id (we cannot re-key the transaction metadata topic, as there&#8217;s no information about concerned vegetables contained in the metadata events; and even if that were the case, one transaction might impact multiple vegetable records). By doing so, we&#8217;d loose the original ordering guarantees, though. One vegetable record might be modified in two subsequent transactions, and its change events may end up in different partitions of the re-keyed topic, which may cause a consumer to receive the second change event before the first one.</p> </div> <div class="paragraph"> <p>If a <code>KStream</code>-<code>KStream</code> join isn&#8217;t feasible, what else could be done? <a href="https://kafka.apache.org/23/documentation/streams/developer-guide/dsl-api.html#streams-developer-guide-dsl-joins-kstream-globalktable">A join</a> between a <code>KStream</code> and <code>GlobalKTable</code> looks promising, too. It doesn&#8217;t have the <a href="https://kafka.apache.org/23/documentation/streams/developer-guide/dsl-api.html#streams-developer-guide-dsl-joins-co-partitioning">co-partitioning requirements</a> of stream-to-stream joins, as all partitions of the <code>GlobalKTable</code> are present on all nodes of a distributed Kafka Streams application. This seems like an acceptable trade-off, because the messages from the transaction metadata topic can be discarded rather quickly and the size of the corresponding table should be within reasonable bounds. So we could have a <code>KStream</code> sourced from the vegetables topic and a <code>GlobalKTable</code> based on the transaction metadata topic.</p> </div> <div class="paragraph"> <p>But unfortunately, there is a timing issue: as the messages are consumed from multiple topics, it may happen that at the point in time when an element from the vegetables stream is processed, the corresponding transaction metadata message isn&#8217;t available yet. So depending on whether we&#8217;d be using an inner join or a left join, we&#8217;d in this case either skip change events or propagate them without having enriched them with the transaction metadata. Both outcomes are not desirable.</p> </div> </div> <div class="sect2"> <h3 id="customized_joins_with_buffering">Customized Joins With Buffering</h3> <div class="paragraph"> <p>The combination of <code>KStream</code> and <code>GlobalKTable</code> still hints into the right direction. Only that instead of relying on the built-in join operators we&#8217;ll have to implement a custom joining logic. The basic idea is to buffer messages arriving on the vegetable <code>KStream</code> until the corresponding transaction metadata message is available from the <code>GlobalKTable</code>s state store. This can be achieved by creating a custom <a href="https://kafka.apache.org/23/javadoc/org/apache/kafka/streams/kstream/KStream.html#transform-org.apache.kafka.streams.kstream.TransformerSupplier-java.lang.String&#8230;&#8203;-">transformer</a> which implements the required buffering logic and is applied to the vegetable <code>KStream</code>.</p> </div> <div class="paragraph"> <p>Let&#8217;s begin with the streaming topology itself. Thanks to the Quarkus Kafka Streams extension, a CDI producer method returning the <code>Topology</code> object is all that&#8217;s needed for that:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ApplicationScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TopologyProducer</span> {

    <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> STREAM_BUFFER_NAME = <span class="string"><span class="delimiter">&quot;</span><span class="content">stream-buffer-state-store</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> STORE_NAME = <span class="string"><span class="delimiter">&quot;</span><span class="content">transaction-meta-data</span><span class="delimiter">&quot;</span></span>;

    <span class="annotation">@ConfigProperty</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">audit.context.data.topic</span><span class="delimiter">&quot;</span></span>)
    <span class="predefined-type">String</span> txContextDataTopic;

    <span class="annotation">@ConfigProperty</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">audit.vegetables.topic</span><span class="delimiter">&quot;</span></span>)
    <span class="predefined-type">String</span> vegetablesTopic;

    <span class="annotation">@ConfigProperty</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">audit.vegetables.enriched.topic</span><span class="delimiter">&quot;</span></span>)
    <span class="predefined-type">String</span> vegetablesEnrichedTopic;

    <span class="annotation">@Produces</span>
    <span class="directive">public</span> Topology buildTopology() {
        StreamsBuilder builder = <span class="keyword">new</span> StreamsBuilder();

        StoreBuilder&lt;KeyValueStore&lt;<span class="predefined-type">Long</span>, JsonObject&gt;&gt; streamBufferStateStore =
                Stores
                    .keyValueStoreBuilder(
                        Stores.persistentKeyValueStore(STREAM_BUFFER_NAME),
                        <span class="keyword">new</span> Serdes.LongSerde(),
                        <span class="keyword">new</span> JsonObjectSerde()
                    )
                    .withCachingDisabled();
            builder.addStateStore(streamBufferStateStore); <i class="conum" data-value="1"></i><b>(1)</b>

        builder.globalTable(txContextDataTopic, Materialized.as(STORE_NAME)); <i class="conum" data-value="2"></i><b>(2)</b>

        builder.&lt;JsonObject, JsonObject&gt;stream(vegetablesTopic) <i class="conum" data-value="3"></i><b>(3)</b>
                .filter((id, changeEvent) -&gt; changeEvent != <span class="predefined-constant">null</span>)
                .filter((id, changeEvent) -&gt; !changeEvent.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">op</span><span class="delimiter">&quot;</span></span>).equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">r</span><span class="delimiter">&quot;</span></span>))
                .transform(() -&gt; <span class="keyword">new</span> ChangeEventEnricher(), STREAM_BUFFER_NAME)
                .to(vegetablesEnrichedTopic);

        <span class="keyword">return</span> builder.build();
    }
}</code></pre> </div> </div> <div class="colist arabic"> <table> <tr> <td><i class="conum" data-value="1"></i><b>1</b></td> <td>State store which will serve as the buffer for change events that cannot be processed yet</td> </tr> <tr> <td><i class="conum" data-value="2"></i><b>2</b></td> <td><code>GlobalKTable</code> based on the transaction metadata topic</td> </tr> <tr> <td><i class="conum" data-value="3"></i><b>3</b></td> <td><code>KStream</code> based on the vegetables topic; on this stream, any incoming tombstone markers are filtered, the reasoning being that the retention policy for an audit trail topic typically should be time-based than based on log compaction; <div class="paragraph"> <p>similarly, snapshot events are filtered, assuming they are not relevant for an audit trail and there wouldn&#8217;t be any corresponding metadata provided by the application for the snapshot transaction initiated by the Debezium connector</p> </div> <div class="paragraph"> <p>Any other messages are enriched with the corresponding transaction metadata via a custom <code>Transformer</code> (see below) and finally are written to an output topic</p> </div></td> </tr> </table> </div> <div class="paragraph"> <p>The topic names are injected using the <a href="https://microprofile.io/project/eclipse/microprofile-config">MicroProfile Config API</a>, with the values being provided in Quarkus <em>application.properties</em> configuration file. Besides the topic names, this file also has the information about the Kafka bootstrap server, default serdes any more:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code>audit.context.data.topic=dbserver1.inventory.transaction_context_data
audit.vegetables.topic=dbserver1.inventory.vegetable
audit.vegetables.enriched.topic=dbserver1.inventory.vegetable.enriched

# may be overridden with env vars
quarkus.kafka-streams.bootstrap-servers=localhost:9092
quarkus.kafka-streams.application-id=auditlog-enricher
quarkus.kafka-streams.topics=${audit.context.data.topic},${audit.vegetables.topic}

# pass-through
kafka-streams.cache.max.bytes.buffering=10240
kafka-streams.commit.interval.ms=1000
kafka-streams.metadata.max.age.ms=500
kafka-streams.auto.offset.reset=earliest
kafka-streams.metrics.recording.level=DEBUG
kafka-streams.default.key.serde=io.debezium.demos.auditing.enricher.JsonObjectSerde
kafka-streams.default.value.serde=io.debezium.demos.auditing.enricher.JsonObjectSerde
kafka-streams.processing.guarantee=exactly_once</code></pre> </div> </div> <div class="paragraph"> <p>In the next step let&#8217;s take a look at the <code>ChangeEventEnricher</code> class, our custom transformer. The implemention is based on the assumption that change events are serialized as JSON, but of course it could be done equally well using other formats such as Avro or Protocol Buffers.</p> </div> <div class="paragraph"> <p>This is a bit of code, but hopefully its decomposition into multiple smaller methods makes it comprehensible:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">ChangeEventEnricher</span> <span class="directive">implements</span> <span class="predefined-type">Transformer</span>
        &lt;JsonObject, JsonObject, KeyValue&lt;JsonObject, JsonObject&gt;&gt; {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Long</span> BUFFER_OFFSETS_KEY = -<span class="integer">1L</span>;

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> LOG = LoggerFactory.getLogger(ChangeEventEnricher.class);

    <span class="directive">private</span> ProcessorContext context;
    <span class="directive">private</span> KeyValueStore&lt;JsonObject, JsonObject&gt; txMetaDataStore;
    <span class="directive">private</span> KeyValueStore&lt;<span class="predefined-type">Long</span>, JsonObject&gt; streamBuffer; <i class="conum" data-value="5"></i><b>(5)</b>

    <span class="annotation">@Override</span>
    <span class="annotation">@SuppressWarnings</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">unchecked</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> init(ProcessorContext context) {
        <span class="local-variable">this</span>.context = context;
        streamBuffer = (KeyValueStore&lt;<span class="predefined-type">Long</span>, JsonObject&gt;) context.getStateStore(
            TopologyProducer.STREAM_BUFFER_NAME
        );
        txMetaDataStore = (KeyValueStore&lt;JsonObject, JsonObject&gt;) context.getStateStore(
            TopologyProducer.STORE_NAME
        );

        context.schedule(
            <span class="predefined-type">Duration</span>.ofSeconds(<span class="integer">1</span>),
            PunctuationType.WALL_CLOCK_TIME, ts -&gt; enrichAndEmitBufferedEvents()
        ); <i class="conum" data-value="4"></i><b>(4)</b>
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> KeyValue&lt;JsonObject, JsonObject&gt; transform(JsonObject key, JsonObject value) {
        <span class="type">boolean</span> enrichedAllBufferedEvents = enrichAndEmitBufferedEvents(); <i class="conum" data-value="3"></i><b>(3)</b>

        <span class="keyword">if</span> (!enrichedAllBufferedEvents) {
            bufferChangeEvent(key, value);
            <span class="keyword">return</span> <span class="predefined-constant">null</span>;
        }

        KeyValue&lt;JsonObject, JsonObject&gt; enriched = enrichWithTxMetaData(key, value); <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="keyword">if</span> (enriched == <span class="predefined-constant">null</span>) { <i class="conum" data-value="2"></i><b>(2)</b>
            bufferChangeEvent(key, value);
        }

        <span class="keyword">return</span> enriched;
    }

    <span class="comment">/**
     * Enriches the buffered change event(s) with the metadata from the associated
     * transactions and forwards them.
     *
     * @return {@code true}, if all buffered events were enriched and forwarded,
     *         {@code false} otherwise.
     */</span>
    <span class="directive">private</span> <span class="type">boolean</span> enrichAndEmitBufferedEvents() { <i class="conum" data-value="3"></i><b>(3)</b>
        Optional&lt;BufferOffsets&gt; seq = bufferOffsets();

        <span class="keyword">if</span> (!seq.isPresent()) {
            <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        }

        BufferOffsets sequence = seq.get();

        <span class="type">boolean</span> enrichedAllBuffered = <span class="predefined-constant">true</span>;

        <span class="keyword">for</span>(<span class="type">long</span> i = sequence.getFirstValue(); i &lt; sequence.getNextValue(); i++) {
            JsonObject buffered = streamBuffer.get(i);

            LOG.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Processing buffered change event for key {}</span><span class="delimiter">&quot;</span></span>,
                    buffered.getJsonObject(<span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>));

            KeyValue&lt;JsonObject, JsonObject&gt; enriched = enrichWithTxMetaData(
                    buffered.getJsonObject(<span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>), buffered.getJsonObject(<span class="string"><span class="delimiter">&quot;</span><span class="content">changeEvent</span><span class="delimiter">&quot;</span></span>));
            <span class="keyword">if</span> (enriched == <span class="predefined-constant">null</span>) {
                enrichedAllBuffered = <span class="predefined-constant">false</span>;
                <span class="keyword">break</span>;
            }

            context.forward(enriched.key, enriched.value);
            streamBuffer.delete(i);
            sequence.incrementFirstValue();
        }

        <span class="keyword">if</span> (sequence.isModified()) {
            streamBuffer.put(BUFFER_OFFSETS_KEY, sequence.toJson());
        }

        <span class="keyword">return</span> enrichedAllBuffered;
    }

    <span class="comment">/**
     * Adds the given change event to the stream-side buffer.
     */</span>
    <span class="directive">private</span> <span class="type">void</span> bufferChangeEvent(JsonObject key, JsonObject changeEvent) { <i class="conum" data-value="2"></i><b>(2)</b>
        LOG.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Buffering change event for key {}</span><span class="delimiter">&quot;</span></span>, key);

        BufferOffsets sequence = bufferOffsets().orElseGet(BufferOffsets::initial);

        JsonObject wrapper = Json.createObjectBuilder()
                .add(<span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>, key)
                .add(<span class="string"><span class="delimiter">&quot;</span><span class="content">changeEvent</span><span class="delimiter">&quot;</span></span>, changeEvent)
                .build();

        streamBuffer.putAll(<span class="predefined-type">Arrays</span>.asList(
                KeyValue.pair(sequence.getNextValueAndIncrement(), wrapper),
                KeyValue.pair(BUFFER_OFFSETS_KEY, sequence.toJson())
        ));
    }

    <span class="comment">/**
     * Enriches the given change event with the metadata from the associated
     * transaction.
     *
     * @return The enriched change event or {@code null} if no metadata for the
     *         associated transaction was found.
     */</span>
    <span class="directive">private</span> KeyValue&lt;JsonObject, JsonObject&gt; enrichWithTxMetaData(JsonObject key,
            JsonObject changeEvent) { <i class="conum" data-value="1"></i><b>(1)</b>
        JsonObject txId = Json.createObjectBuilder()
                .add(<span class="string"><span class="delimiter">&quot;</span><span class="content">transaction_id</span><span class="delimiter">&quot;</span></span>, changeEvent.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">source</span><span class="delimiter">&quot;</span></span>).asJsonObject()
                        .getJsonNumber(<span class="string"><span class="delimiter">&quot;</span><span class="content">txId</span><span class="delimiter">&quot;</span></span>).longValue())
                .build();

        JsonObject metaData = txMetaDataStore.get(txId);

        <span class="keyword">if</span> (metaData != <span class="predefined-constant">null</span>) {
            LOG.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Enriched change event for key {}</span><span class="delimiter">&quot;</span></span>, key);

            metaData = Json.createObjectBuilder(metaData.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">after</span><span class="delimiter">&quot;</span></span>).asJsonObject())
                    .remove(<span class="string"><span class="delimiter">&quot;</span><span class="content">transaction_id</span><span class="delimiter">&quot;</span></span>)
                    .build();

            <span class="keyword">return</span> KeyValue.pair(
                    key,
                    Json.createObjectBuilder(changeEvent)
                        .add(<span class="string"><span class="delimiter">&quot;</span><span class="content">audit</span><span class="delimiter">&quot;</span></span>, metaData)
                        .build()
            );
        }

        LOG.warn(<span class="string"><span class="delimiter">&quot;</span><span class="content">No metadata found for transaction {}</span><span class="delimiter">&quot;</span></span>, txId);
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }

    <span class="directive">private</span> Optional&lt;BufferOffsets&gt; bufferOffsets() {
        JsonObject bufferOffsets = streamBuffer.get(BUFFER_OFFSETS_KEY);
        <span class="keyword">if</span> (bufferOffsets == <span class="predefined-constant">null</span>) {
            <span class="keyword">return</span> Optional.empty();
        }
        <span class="keyword">else</span> {
            <span class="keyword">return</span> Optional.of(BufferOffsets.fromJson(bufferOffsets));
        }
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> close() {
    }
}</code></pre> </div> </div> <div class="colist arabic"> <table> <tr> <td><i class="conum" data-value="1"></i><b>1</b></td> <td>When a vegetables change event arrives, look up the corresponding metadata in the state store of the transaction topic&#8217;s <code>GlobalKTable</code>, using the transaction id from the <code>source</code> block of the change event as the key; if the metadata could be found, add the metadata to change event (under the <code>audit</code> field) and return that enriched event</td> </tr> <tr> <td><i class="conum" data-value="2"></i><b>2</b></td> <td>If the metadata could not be found, add the incoming event into the buffer of change events and return</td> </tr> <tr> <td><i class="conum" data-value="3"></i><b>3</b></td> <td>Before actually getting to the incoming event, all buffered events are processed; this is required to make sure that the original change events is retained; only if all could be enriched, the incoming event will be processed, too</td> </tr> <tr> <td><i class="conum" data-value="4"></i><b>4</b></td> <td>In order to emit buffered events also if no new change event is coming in, a punctuation is scheduled that periodically processes the buffer</td> </tr> <tr> <td><i class="conum" data-value="5"></i><b>5</b></td> <td>A buffer for vegetable events whose corresponding metadata hasn&#8217;t arrived yet</td> </tr> </table> </div> <div class="paragraph"> <p>The key piece is the buffer for unprocessable change events. To maintain the order of events, the buffer must be processed in order of insertion, beginning with the event inserted first (think of a FIFO queue). As there&#8217;s no guaranteed traversing order when getting all the entries from a <code>KeyValueStore</code>, this is implemented by using the values of a strictly increasing sequence as the keys. A <a href="https://github.com/debezium/debezium-examples/blob/main/auditlog/log-enricher/src/main/java/io/debezium/demos/auditing/enricher/BufferOffsets.java">special entry</a> in the key value store is used to store the information about the current "oldest" index in the buffer and the next sequence value.</p> </div> <div class="paragraph"> <p>One could also think of alternative implementations for such buffer, e.g. based on a Kafka topic or a custom <code>KeyValueStore</code> implementation that ensures iteration order from oldest to newest entry. Ultimately, it could also be useful if Kafka Streams came with built-in means of retrying a stream element that cannot be joined yet; this would avoid any custom buffering implementation.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="title">If Things Go Wrong</div> <div class="paragraph"> <p>For a reliable and consistent processing logic it&#8217;s vital to think about the behavior in case of failures, e.g. if the stream application crashes after adding an element to the buffer but before updating the sequence value.</p> </div> <div class="paragraph"> <p>The key to this is the <code>exactly_once</code> value of the <code>processing.guarantee</code> property given in <em>application.properties</em>. This ensures a transactionally consistent processing; e.g. in the aforementioned scenario, after a restart the original change event would be handled again, and the buffer state would look exactly like it did before the event was processed for the first time.</p> </div> <div class="paragraph"> <p>Consumers of the enriched vegetable events should apply an isolation level of <code>read_committed</code>; otherwise they may see uncommitted and thus duplicate messages in case of an application crash after a buffered event was forwarded but before it was removed from the buffer.</p> </div> </td> </tr> </table> </div> <div class="paragraph"> <p>With the custom transformer logic in place, we can build the Quarkus project and run the stream processing application. You should see messages like this in the <code>dbserver1.inventory.vegetable.enriched</code> topic:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">10</span>}
{
    <span class="string"><span class="delimiter">&quot;</span><span class="content">before</span><span class="delimiter">&quot;</span></span>: {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">10</span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Yummy!</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Tomato</span><span class="delimiter">&quot;</span></span>
    },
    <span class="string"><span class="delimiter">&quot;</span><span class="content">after</span><span class="delimiter">&quot;</span></span>: {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">10</span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Tasty!</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Tomato</span><span class="delimiter">&quot;</span></span>
    },
    <span class="string"><span class="delimiter">&quot;</span><span class="content">source</span><span class="delimiter">&quot;</span></span>: {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">0.10.0-SNAPSHOT</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">connector</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">postgresql</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">dbserver1</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">ts_ms</span><span class="delimiter">&quot;</span></span>: <span class="integer">1569700445392</span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">snapshot</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">db</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">vegetablesdb</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">schema</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">inventory</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">table</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">vegetable</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">txId</span><span class="delimiter">&quot;</span></span>: <span class="integer">610</span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">lsn</span><span class="delimiter">&quot;</span></span>: <span class="integer">34204240</span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">xmin</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">null</span>
    },
    <span class="string"><span class="delimiter">&quot;</span><span class="content">op</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">u</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">ts_ms</span><span class="delimiter">&quot;</span></span>: <span class="integer">1569700445537</span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">audit</span><span class="delimiter">&quot;</span></span>: {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">client_date</span><span class="delimiter">&quot;</span></span>: <span class="integer">1566461551000000</span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">usecase</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">UPDATE VEGETABLE</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">user_name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">farmermargaret</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre> </div> </div> <div class="paragraph"> <p>Of course, the buffer processing logic may be adjusted as per your specific requirements; for instance instead of indefinitely waiting for corresponding transaction metadata, we may also decide that it makes more sense to propagate change events unenriched after some waiting time or to raise an exception indicating the missing metadata.</p> </div> <div class="paragraph"> <p>In order to see whether the buffering works as expected, you could do a small experiment: modify a vegetable record using SQL directly in the database. Debezium will capture the event, but as there&#8217;s no corresponding transaction metadata provided, the event will not be forwarded to the enriched vegetables topic. If you add another vegetable using the REST API, this one also will not be propagated: although there is a metadata record for it, it&#8217;s blocked by the other change event. Only once you have inserted a metadata record for the first change&#8217;s transaction into the <code>transaction_context_data</code> table, both change events will be processed and sent to the output topic.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="summary">Summary</h2> <div class="sectionbody"> <div class="paragraph"> <p>In this blog post we&#8217;ve discussed how change data capture in combination with stream processing can be used to build audit logs in an efficient, low-overhead way. In contrast to library and trigger-based approaches, the events that form the audit trail are retrieved via CDC from the database&#8217;s transaction logs, and apart from the insertion of a single metadata record per transaction (which in similar form would be required for any kind of audit log), no overhead to OLTP transactions is incurred. Also audit log entries can be obtained when data records are subject to bulk updates or deletes, something typically not possible with library-based auditing solutions.</p> </div> <div class="paragraph"> <p>Additional metadata that typically should be part of an audit log, can be provided by the application via a separate table, which also is captured via Debezium. With the help of Kafka Streams the actual data change events can be enriched with the data from that metadata table.</p> </div> <div class="paragraph"> <p>One aspect we haven&#8217;t discussed yet is querying the audit trail entries, e.g. to examine specific earlier versions of the data. To do so, the enriched change data events typically would be stored in a queryable database. Unlike a basic data replication pipeline, not only the latest version of each record would be stored in the database in that case, but all the versions, i.e. the primary keys typically would be amended with the transaction id of each change. This would allow to select single data records or even joins of multiple tables to get the data valid as per a given transaction id. How this could be implemented in detail may be discussed in a future post.</p> </div> <div class="paragraph"> <p>Your feedback on this approach for building audit logs is very welcomed, just post a comment below. To get started with your own implementation, you can check out <a href="https://github.com/debezium/debezium-examples/tree/main/auditlog">the code</a> in the Debezium examples repository on GitHub.</p> </div> <div class="paragraph"> <p><em>Many thanks to <a href="https://twitter.com/crancran77">Chris Cranford</a>, <a href="https://twitter.com/hpgrahsl">Hans-Peter Grahsl</a>, <a href="https://twitter.com/hashhar">Ashhar Hasan</a>, <a href="https://twitter.com/jbfletch_">Anna McDonald</a> and Jiri Pechanec for their feedback while working on this post and the accompanying example code!</em></p> </div> </div> </div></div> </div> <div class="well"> <div class="row"> <div class="col-md-8"> <h2>Gunnar Morling</h2> <p> <span class="bio-size">Gunnar is a software engineer at Decodable and an open-source enthusiast by heart. He has been the project lead of Debezium over many years. Gunnar has created open-source projects like kcctl, JfrUnit, and MapStruct, and is the spec lead for Bean Validation 2.0 (JSR 380). Heâ€™s based in Hamburg, Germany.</span> </p> <p class="bio-size"> <a href="https://twitter.com/gunnarmorling"> <i class="icon-twitter"></i> </a> &nbsp; <a href="https://github.com/gunnarmorling"> <i class="icon-github"></i> </a> &nbsp; </p> </div> <div class="col-md-4"> <img alt="" class="img-responsive pull-right portrait" src="/assets/images/gmorling.jpg"/> </div> </div> </div> <ul class="pager pager-blog"> <li class="previous"> <a href="/blog/2019/09/26/debezium-0-10-0-cr2-released/" class="previous"> &laquo; Previous</a> </li> <li class="next"><a href="/blog/2019/10/02/debezium-0-10-0-final-released/">Next &raquo; </a></li> </ul> <div class="row"> <div class="col-md-12"> <hr> <h2>About Debezium</h2> <p> Debezium is an open source distributed platform that turns your existing databases into event streams, so applications can see and respond almost instantly to each committed row-level change in the databases. Debezium is built on top of <a href="http://kafka.apache.org/">Kafka</a> and provides <a href="http://kafka.apache.org/documentation.html#connect">Kafka Connect</a> compatible connectors that monitor specific database management systems. Debezium records the history of data changes in Kafka logs, so your application can be stopped and restarted at any time and can easily consume all of the events it missed while it was not running, ensuring that all events are processed correctly and completely. Debezium is <a href="/license/">open source</a> under the <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache License, Version 2.0</a>. </p> </div> </div> <div class="row"> <div class="col-md-12"> <h2>Get involved</h2> <p> We hope you find Debezium interesting and useful, and want to give it a try. Follow us on Twitter <a href="https://twitter.com/debezium">@debezium</a>, <a href="https://debezium.zulipchat.com/#narrow/stream/302529-users">chat with us on Zulip</a>, or join our <a href="https://groups.google.com/forum/#!forum/debezium">mailing list</a> to talk with the community. All of the code is open source <a href="https://github.com/debezium/">on GitHub</a>, so build the code locally and help us improve ours existing connectors and add even more connectors. If you find problems or have ideas how we can improve Debezium, please let us know or <a href="https://issues.redhat.com/projects/DBZ/issues/">log an issue</a>. </p> </div> </div> <div id="disqus_thread"></div> <script>var disqus_config=function(){this.page.url="https://debezium.io/blog/2019/10/01/audit-logs-with-change-data-capture-and-stream-processing/",this.page.identifier="https://debezium.io/blog/2019/10/01/audit-logs-with-change-data-capture-and-stream-processing/"};!function(){var t=document,e=t.createElement("script");e.src="https://Debezium.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}();</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> </div> </div> </div> <footer class="container"> <div> <div class="row mr-0 ml-0"> <div class="col-md-5 col-md-offset-1"> <h4>Debezium</h4> <p> &#169; 2023 Debezium Community <br/> <br/> <i class="icon-fire"></i> Mixed with <a href="https://getbootstrap.com/">Bootstrap</a>, baked by <a href="https://jekyllrb.com/">Jekyll</a>. <br/> <i class="icon-flag"></i> Website and docs licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>. <br/> <i class="icon-flag-alt"></i> Code released under <a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache License, v2.0</a>. <br/> <i class="icon-file-alt"></i> <a href="https://www.redhat.com/legal/legal_statement.html" title="Terms">Terms</a> | <a href="https://www.redhat.com/legal/privacy_statement.html" title="Privacy Policy">Privacy</a> </p> <p>Rev: <a target="_blank" href="https://github.com/debezium/debezium.github.io/commit/ceccd02eecf23b3d2ecb48c13cf3138102c68b0f">ceccd02</a> </p> </div> <div class="col-md-3"> <h4>Documentation</h4> <ul class="list-unstyled"> <li><a href="/documentation/reference/stable/features.html" title="Features">Features</a></li> <li> <a href="/documentation/reference/stable/install.html" title="Install">Install</a> </li> <li> <a href="/documentation/reference/stable/architecture.html" title="Architecture">Architecture</a> </li> <li><a href="/documentation/faq/" title="FAQ">FAQ</a></li> <li> <a href="/community/contribute/" title="Contribute">Contribute</a> </li> </ul> </div> <div class="col-md-3"> <h4>Connect</h4> <ul class="list-unstyled"> <li><a href="/blog" title="Blog">Blog</a></li> <li> <a href="https://twitter.com/debezium" title="Twitter">Twitter</a> </li> <li><a href="https://github.com/debezium" title="GitHub">GitHub</a></li> <li><a href="https://debezium.zulipchat.com/#narrow/stream/302529-users" title="Chat">Chat</a></li> <li> <a href="https://groups.google.com/forum/#!forum/debezium" title="Google Groups">Google Groups</a> </li> <li> <a href="https://stackoverflow.com/questions/tagged/debezium" title="StackOverflow">StackOverflow</a> </li> </ul> </div> </div> </div> </footer> <div class="container" id="companyfooter"> <div class="redhatlogo"> <a href="https://www.redhat.com/"> <img src="/assets/images/Logo-Red_Hat-Sponsored_By-B-Standard-RGB.svg"/> </a> </div> </div> </div> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-76464546-1"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-76464546-1");</script> <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script> <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script> <script type="text/javascript" src="/assets/javascript/vanilla-back-to-top.min.js"></script> <script type="text/javascript" src="/assets/javascript/highlight.min.js"></script> <script>addBackToTop({scrollDuration:400}),hljs.initHighlightingOnLoad();</script> </body> </html>