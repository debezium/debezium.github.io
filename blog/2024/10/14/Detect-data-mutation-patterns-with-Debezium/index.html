<!DOCTYPE html> <html> <head> <title>Detect data mutation patterns with Debezium</title> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="description" content="Debezium is an open source distributed platform for change data capture. Start it up, point it at your databases, and your apps can start responding to all of the inserts, updates, and deletes that other apps commit to your databases. Debezium is durable and fast, so your apps can respond quickly and never miss an event, even when things go wrong."> <meta content="Debezium" property="og:site_name"> <meta content="Detect data mutation patterns with Debezium" property="og:title"> <meta content="https://debezium.io/assets/images/color_black_debezium_type_1200px.png" property="og:image" name="image"> <meta property="og:description" content="Debezium is an open source distributed platform for change data capture. Start it up, point it at your databases, and your apps can start responding to all of the inserts, updates, and deletes that other apps commit to your databases. Debezium is durable and fast, so your apps can respond quickly and never miss an event, even when things go wrong."> <meta property="og:url" content="https://debezium.io/blog/2024/10/14/Detect-data-mutation-patterns-with-Debezium/"> <meta name="twitter:site" content="@debezium"> <meta name="twitter:title" content="Detect data mutation patterns with Debezium"> <meta name="twitter:creator" content="@mfvitale"> <meta name="twitter:description" content="Debezium is an open source distributed platform for change data capture. Start it up, point it at your databases, and your apps can start responding to all of the inserts, updates, and deletes that other apps commit to your databases. Debezium is durable and fast, so your apps can respond quickly and never miss an event, even when things go wrong."> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="https://debezium.io/assets/images/color_black_debezium_type_1200px.png"> <meta property="twitter:url" content="https://debezium.io/blog/2024/10/14/Detect-data-mutation-patterns-with-Debezium/"> <link rel="alternate" type="application/rss+xml" title="Debezium Blog" href="/blog.atom"> <link rel="shortcut icon" type="image/png" href="/favicon.ico"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css"/> <link rel="stylesheet" href="/assets/css/custom.css"/> <link rel="stylesheet" href="/assets/css/highlight.min.css"/> <link rel="stylesheet" href="/assets/css/coderay.css"/> </head> <body class="post"> <div id="rhbar"> <a class="jbdevlogo" href="https://developers.redhat.com"></a> <a class="rhlogo" href="https://www.redhat.com/"></a> </div> <div id> <div class="container" id="content"> <nav class="navbar navbar-inverse navbar-fix"> <div class="container-fluid"> <div class="navbar-header"> <button class="navbar-toggle collapsed border-0" type="button" data-toggle="collapse" data-target="#navigation" aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/"><img class="project-logo" src="/assets/images/color_white_debezium_type_600px.svg" style="height: 32px; margin-right: 5px; margin-top: -5px;"></a> </div> <div class="collapse navbar-collapse collapsed" id="navigation"> <ul class="nav navbar-nav pull-right"> <li> <a href="/documentation/faq" class="">FAQ</a> </li> <li class="item"> <a href="/documentation/" class="">Documentation</a> </li> <li> <a href="/releases/" class="">Releases</a> </li> <li> <a href="/community/" class="">Community</a> </li> <li class="active"> <a href="/blog/" class="active">Blog</a> </li> </ul> </div> </div> </nav> <div class="row post-text-padding row-no-expand"> <div class="col-md-3"><div id="leftdocnav"> <div class="hidden-lg hidden-md hidden-sm"> <button class="navbar-toggle docssubmenu-toggle collapsed" data-target="#docssubmenu" data-toggle="collapse" style=" float: none; background-color: #656565; border-color: #656565; width: 100%; color: #fff; "> Navigation Menu </button> </div> <div class="collapse" id="docssubmenu"> <div class="doc-pills"> <ul class="nav nav-pills nav-stacked"> <li class="item"> <a href="/blog">Home</a> <div class="icon"><span class="icon-home"></span></div> </li> <li class="item"> <a href="/archives">Archive</a> <div class="icon"><span class="icon-arrow-down"></span></div> </li> <li class="item"> <a href="/blog.atom">Feed</a> <div class="icon"><span class="icon-rss"></span></div> </li> </ul> </div> <p></p> <div class="featured-posts"> <div id="#featured" style="margin-bottom: 4px; border-bottom: 1px solid #ccc; font-size: 115%; margin-left: 2px;">Featured Posts</div> <ul style="padding-inline-start: 22px;"> <li style="margin-bottom: 3px;"> <a href="/blog/2024/10/14/Detect-data-mutation-patterns-with-Debezium/" style="font-size: 95%;"> Detect data mutation patterns with Debezium </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2024/07/08/async-embedded-engine/" style="font-size: 95%;"> Debezium asynchronous engine </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2024/01/11/Debezium-and-TimescaleDB/" style="font-size: 95%;"> Debezium and TimescaleDB </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2023/12/20/JDBC-sink-connector-batch-support/" style="font-size: 95%;"> Streamlined Performance: Debezium JDBC connector batch support </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2023/10/19/Debezium-Operator-Takes-off-to-the-Clouds/" style="font-size: 95%;"> Debezium Operator Takes off to the Clouds </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2023/10/05/Debezium-JMX-signaling-and-notifications/" style="font-size: 95%;"> Debezium signaling and notifications - Part 3: JMX channel </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2023/09/23/flink-spark-online-learning/" style="font-size: 95%;"> Online machine learning with the data streams from the database </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2023/07/10/custom-http-signaling-notification/" style="font-size: 95%;"> Debezium signaling and notifications - Part 2: Customisation </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2023/06/27/Debezium-signaling-and-notifications/" style="font-size: 95%;"> Debezium signaling and notifications - Part 1 </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2023/05/02/tensorflow-mnist-classification/" style="font-size: 95%;"> Image classification with Debezium and TensorFlow </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2020/11/04/streaming-vitess-at-bolt/" style="font-size: 95%;"> Streaming Vitess at Bolt </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2020/02/10/event-sourcing-vs-cdc/" style="font-size: 95%;"> Distributed Data for Microservices — Event Sourcing vs. Change Data Capture </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2019/10/01/audit-logs-with-change-data-capture-and-stream-processing/" style="font-size: 95%;"> Building Audit Logs with Change Data Capture and Stream Processing </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2019/07/12/streaming-cassandra-at-wepay-part-1/" style="font-size: 95%;"> Streaming Cassandra at WePay - Part 1 </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2019/02/19/reliable-microservices-data-exchange-with-the-outbox-pattern/" style="font-size: 95%;"> Reliable Microservices Data Exchange With the Outbox Pattern </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/12/05/automating-cache-invalidation-with-change-data-capture/" style="font-size: 95%;"> Automating Cache Invalidation With Change Data Capture </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/09/20/materializing-aggregate-views-with-hibernate-and-debezium/" style="font-size: 95%;"> Materializing Aggregate Views With Hibernate and Debezium </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/07/19/advantages-of-log-based-change-data-capture/" style="font-size: 95%;"> Five Advantages of Log-Based Change Data Capture </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/03/08/creating-ddd-aggregates-with-debezium-and-kafka-streams/" style="font-size: 95%;"> Creating DDD aggregates with Debezium and Kafka Streams </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/01/17/streaming-to-elasticsearch/" style="font-size: 95%;"> Streaming Data Changes from Your Database to Elasticsearch </a> </li> </ul> </div> <p></p> <p></p> <div class="cloud-tags"> <div id="tags" style="margin-bottom: 4px; border-bottom: 1px solid #ccc; font-size: 115%; margin-left: 2px;"> Tags </div> <div class="tag-cloud"> <span class="site-tag"> <a href="/tag/analytics/" style="font-size: 82%"> analytics </a> </span> <span class="site-tag"> <a href="/tag/announcement/" style="font-size: 82%"> announcement </a> </span> <span class="site-tag"> <a href="/tag/apache-kafka/" style="font-size: 82%"> apache kafka </a> </span> <span class="site-tag"> <a href="/tag/apache-kafka/" style="font-size: 96%"> apache kafka </a> </span> <span class="site-tag"> <a href="/tag/apicurio/" style="font-size: 82%"> apicurio </a> </span> <span class="site-tag"> <a href="/tag/avro/" style="font-size: 84%"> avro </a> </span> <span class="site-tag"> <a href="/tag/aws/" style="font-size: 82%"> aws </a> </span> <span class="site-tag"> <a href="/tag/batch/" style="font-size: 82%"> batch </a> </span> <span class="site-tag"> <a href="/tag/caassandra/" style="font-size: 86%"> caassandra </a> </span> <span class="site-tag"> <a href="/tag/camel/" style="font-size: 82%"> camel </a> </span> <span class="site-tag"> <a href="/tag/cassandra/" style="font-size: 308%"> cassandra </a> </span> <span class="site-tag"> <a href="/tag/cdc/" style="font-size: 82%"> cdc </a> </span> <span class="site-tag"> <a href="/tag/channels/" style="font-size: 82%"> channels </a> </span> <span class="site-tag"> <a href="/tag/community/" style="font-size: 124%"> community </a> </span> <span class="site-tag"> <a href="/tag/community-stories/" style="font-size: 84%"> community stories </a> </span> <span class="site-tag"> <a href="/tag/connectors/" style="font-size: 82%"> connectors </a> </span> <span class="site-tag"> <a href="/tag/containers/" style="font-size: 82%"> containers </a> </span> <span class="site-tag"> <a href="/tag/cqrs/" style="font-size: 84%"> cqrs </a> </span> <span class="site-tag"> <a href="/tag/custom/" style="font-size: 82%"> custom </a> </span> <span class="site-tag"> <a href="/tag/datalake/" style="font-size: 82%"> datalake </a> </span> <span class="site-tag"> <a href="/tag/db2/" style="font-size: 292%"> db2 </a> </span> <span class="site-tag"> <a href="/tag/ddd/" style="font-size: 82%"> ddd </a> </span> <span class="site-tag"> <a href="/tag/debezium/" style="font-size: 110%"> debezium </a> </span> <span class="site-tag"> <a href="/tag/debezium-server/" style="font-size: 94%"> debezium server </a> </span> <span class="site-tag"> <a href="/tag/debezium-ui/" style="font-size: 90%"> debezium ui </a> </span> <span class="site-tag"> <a href="/tag/deduplication/" style="font-size: 82%"> deduplication </a> </span> <span class="site-tag"> <a href="/tag/discussion/" style="font-size: 114%"> discussion </a> </span> <span class="site-tag"> <a href="/tag/docker/" style="font-size: 188%"> docker </a> </span> <span class="site-tag"> <a href="/tag/elasticsearch/" style="font-size: 82%"> elasticsearch </a> </span> <span class="site-tag"> <a href="/tag/event-sourcing/" style="font-size: 82%"> event sourcing </a> </span> <span class="site-tag"> <a href="/tag/exactly-once-semantics/" style="font-size: 82%"> exactly once semantics </a> </span> <span class="site-tag"> <a href="/tag/example/" style="font-size: 88%"> example </a> </span> <span class="site-tag"> <a href="/tag/examples/" style="font-size: 118%"> examples </a> </span> <span class="site-tag"> <a href="/tag/features/" style="font-size: 96%"> features </a> </span> <span class="site-tag"> <a href="/tag/fedora/" style="font-size: 82%"> fedora </a> </span> <span class="site-tag"> <a href="/tag/flink/" style="font-size: 84%"> flink </a> </span> <span class="site-tag"> <a href="/tag/hiring/" style="font-size: 84%"> hiring </a> </span> <span class="site-tag"> <a href="/tag/ibmi/" style="font-size: 116%"> ibmi </a> </span> <span class="site-tag"> <a href="/tag/iceberg/" style="font-size: 82%"> iceberg </a> </span> <span class="site-tag"> <a href="/tag/images/" style="font-size: 82%"> images </a> </span> <span class="site-tag"> <a href="/tag/informix/" style="font-size: 126%"> informix </a> </span> <span class="site-tag"> <a href="/tag/integration/" style="font-size: 86%"> integration </a> </span> <span class="site-tag"> <a href="/tag/introduction/" style="font-size: 84%"> introduction </a> </span> <span class="site-tag"> <a href="/tag/jaeger/" style="font-size: 82%"> jaeger </a> </span> <span class="site-tag"> <a href="/tag/jdbc/" style="font-size: 128%"> jdbc </a> </span> <span class="site-tag"> <a href="/tag/json/" style="font-size: 82%"> json </a> </span> <span class="site-tag"> <a href="/tag/kafka/" style="font-size: 94%"> kafka </a> </span> <span class="site-tag"> <a href="/tag/kafka-streams/" style="font-size: 82%"> kafka streams </a> </span> <span class="site-tag"> <a href="/tag/kafka-streams/" style="font-size: 86%"> kafka streams </a> </span> <span class="site-tag"> <a href="/tag/kogito/" style="font-size: 82%"> kogito </a> </span> <span class="site-tag"> <a href="/tag/ksql/" style="font-size: 82%"> ksql </a> </span> <span class="site-tag"> <a href="/tag/kubernetes/" style="font-size: 86%"> kubernetes </a> </span> <span class="site-tag"> <a href="/tag/lakehouse/" style="font-size: 82%"> lakehouse </a> </span> <span class="site-tag"> <a href="/tag/machine-learning/" style="font-size: 86%"> machine learning </a> </span> <span class="site-tag"> <a href="/tag/mariadb/" style="font-size: 124%"> mariadb </a> </span> <span class="site-tag"> <a href="/tag/metrics/" style="font-size: 82%"> metrics </a> </span> <span class="site-tag"> <a href="/tag/microservices/" style="font-size: 84%"> microservices </a> </span> <span class="site-tag"> <a href="/tag/mongo/" style="font-size: 86%"> mongo </a> </span> <span class="site-tag"> <a href="/tag/mongodb/" style="font-size: 310%"> mongodb </a> </span> <span class="site-tag"> <a href="/tag/monitoring/" style="font-size: 82%"> monitoring </a> </span> <span class="site-tag"> <a href="/tag/mysql/" style="font-size: 446%"> mysql </a> </span> <span class="site-tag"> <a href="/tag/news/" style="font-size: 112%"> news </a> </span> <span class="site-tag"> <a href="/tag/newsletter/" style="font-size: 88%"> newsletter </a> </span> <span class="site-tag"> <a href="/tag/notifications/" style="font-size: 86%"> notifications </a> </span> <span class="site-tag"> <a href="/tag/online-learning/" style="font-size: 84%"> online learning </a> </span> <span class="site-tag"> <a href="/tag/operator/" style="font-size: 84%"> operator </a> </span> <span class="site-tag"> <a href="/tag/oracle/" style="font-size: 342%"> oracle </a> </span> <span class="site-tag"> <a href="/tag/outbox/" style="font-size: 280%"> outbox </a> </span> <span class="site-tag"> <a href="/tag/performance/" style="font-size: 82%"> performance </a> </span> <span class="site-tag"> <a href="/tag/postgres/" style="font-size: 416%"> postgres </a> </span> <span class="site-tag"> <a href="/tag/presentation/" style="font-size: 84%"> presentation </a> </span> <span class="site-tag"> <a href="/tag/production/" style="font-size: 82%"> production </a> </span> <span class="site-tag"> <a href="/tag/quarkus/" style="font-size: 92%"> quarkus </a> </span> <span class="site-tag"> <a href="/tag/questdb/" style="font-size: 82%"> questdb </a> </span> <span class="site-tag"> <a href="/tag/rds/" style="font-size: 84%"> rds </a> </span> <span class="site-tag"> <a href="/tag/releases/" style="font-size: 428%"> releases </a> </span> <span class="site-tag"> <a href="/tag/schema/" style="font-size: 82%"> schema </a> </span> <span class="site-tag"> <a href="/tag/scylla/" style="font-size: 82%"> scylla </a> </span> <span class="site-tag"> <a href="/tag/secrets/" style="font-size: 82%"> secrets </a> </span> <span class="site-tag"> <a href="/tag/sentry/" style="font-size: 82%"> sentry </a> </span> <span class="site-tag"> <a href="/tag/serialization/" style="font-size: 82%"> serialization </a> </span> <span class="site-tag"> <a href="/tag/signaling/" style="font-size: 86%"> signaling </a> </span> <span class="site-tag"> <a href="/tag/smt/" style="font-size: 84%"> smt </a> </span> <span class="site-tag"> <a href="/tag/snapshots/" style="font-size: 84%"> snapshots </a> </span> <span class="site-tag"> <a href="/tag/spanner/" style="font-size: 168%"> spanner </a> </span> <span class="site-tag"> <a href="/tag/spark/" style="font-size: 84%"> spark </a> </span> <span class="site-tag"> <a href="/tag/sql/" style="font-size: 84%"> sql </a> </span> <span class="site-tag"> <a href="/tag/sqlserver/" style="font-size: 356%"> sqlserver </a> </span> <span class="site-tag"> <a href="/tag/tensorflow/" style="font-size: 82%"> tensorflow </a> </span> <span class="site-tag"> <a href="/tag/testcontainers/" style="font-size: 88%"> testcontainers </a> </span> <span class="site-tag"> <a href="/tag/tests/" style="font-size: 82%"> tests </a> </span> <span class="site-tag"> <a href="/tag/time-series/" style="font-size: 82%"> time series </a> </span> <span class="site-tag"> <a href="/tag/timescaledb/" style="font-size: 82%"> timescaledb </a> </span> <span class="site-tag"> <a href="/tag/topics/" style="font-size: 82%"> topics </a> </span> <span class="site-tag"> <a href="/tag/tracing/" style="font-size: 82%"> tracing </a> </span> <span class="site-tag"> <a href="/tag/transactions/" style="font-size: 82%"> transactions </a> </span> <span class="site-tag"> <a href="/tag/ui/" style="font-size: 82%"> ui </a> </span> <span class="site-tag"> <a href="/tag/vagrant/" style="font-size: 82%"> vagrant </a> </span> <span class="site-tag"> <a href="/tag/vitess/" style="font-size: 272%"> vitess </a> </span> <span class="site-tag"> <a href="/tag/website/" style="font-size: 84%"> website </a> </span> </div> </div> </div> </div> </div> <div class="col-md-9"> <div class="post"> <div class="row" style="margin-left: 0; margin-right: 0; margin-bottom: 10px"> <div class="col-sm-12" style="padding-left: 0px"> <div style="display: table-cell; vertical-align: top"> <div style=" width: 72px; border: 1px solid #ccc; padding: 3px; display: inline-block; "> <img src="/assets/images/mario.jpg" style="width: 64px;"> </div> </div> <div style="display: table-cell; vertical-align: top"> <div style="margin-left: 8px"> <span class="hidden-sm hidden-xs" style="font-size: 2.75rem; line-height: 1"> <a href="/blog/2024/10/14/Detect-data-mutation-patterns-with-Debezium/">Detect data mutation patterns with Debezium</a> </span> <span class="hidden-md hidden-lg" style="font-size: 2rem; line-height: 1"> <a href="/blog/2024/10/14/Detect-data-mutation-patterns-with-Debezium/">Detect data mutation patterns with Debezium</a> </span> <div class="byline" style="line-height: 1"> <em> October 14, 2024 by </em> <em> Fiore Mario Vitale </em> <div class="hidden-xs" style="margin-top: 5px"> <a class="label label-info hidden-sm hidden-xs" href="/tag/debezium/">debezium</a> <a class="label label-info hidden-sm hidden-xs" href="/tag/features/">features</a> <a class="label label-info hidden-sm hidden-xs" href="/tag/monitoring/">monitoring</a> <a class="label label-info hidden-sm hidden-xs" href="/tag/analytics/">analytics</a> <a class="label label-info hidden-sm hidden-xs" href="/tag/metrics/">metrics</a> </div> </div> </div> </div> </div> </div> <div class="grid__item width-12-12"><div class="paragraph"> <p>In today&#8217;s dynamic data environments, detecting and understanding data mutation patterns is critical for system reliability. In this blog post, we&#8217;ll explore how to use Debezium for comprehensive database activity logging and analysis in microservice architectures. We&#8217;ll delve into how Debezium captures row-level changes and streams them in real-time, enabling immediate visibility into database operations. By integrating with analytics tools, we&#8217;ll see how to build detailed activity dashboards that reveal the volume and nature of operations per table. These insights are invaluable for identifying unexpected patterns, such as a sudden drop in inserts caused by a new microservice deployment with a bug. You will learn how to set up Debezium, configure it for this specific use case, and utilize the generated data to create actionable dashboards.</p> </div> <div class="paragraph"> <p></p> </div> <div class="sect1"> <h2 id="the_concept_and_the_idea_behind">The concept and the idea behind</h2> <div class="sectionbody"> <div class="paragraph"> <p>In recent years, observability has become an essential part of modern systems due to the increasing complexity of architectures like microservices, containerized applications, and cloud environments.</p> </div> <div class="paragraph"> <p>Here are some important reasons why observability is crucial today:</p> </div> <div class="dlist"> <dl> <dt class="hdlist1">Faster Troubleshooting and Incident Response</dt> <dd> <p>Observability provides deep insights into system behavior, helping teams quickly identify and resolve issues by correlating logs, metrics, and traces, reducing downtime and improving response times.</p> </dd> <dt class="hdlist1">Proactive Issue Detection</dt> <dd> <p>Observability enables proactive monitoring by identifying anomalies and patterns in real-time, allowing teams to address potential problems before they impact users.</p> </dd> </dl> </div> <div class="paragraph"> <p>An application typically exposes different types of metrics to provide insights into its behavior, performance, and overall health. These metrics can be categorized into several key types:</p> </div> <div class="dlist"> <dl> <dt class="hdlist1">Infrastructure Metrics</dt> <dd> <p>These track the resource usage of the underlying infrastructure, such as: CPU Usage, Memory Usage, Disk I/O, Network I/O.</p> </dd> <dt class="hdlist1">Application Performance Metrics</dt> <dd> <p>These measure the application’s operational performance to ensure the application performs optimally and meets user expectations. For example: Request Rate, Error Rate, Latency, Throughput.</p> </dd> <dt class="hdlist1">Business Metrics</dt> <dd> <p>These focus on the application&#8217;s impact on business goals, such as: Number of Transactions, Conversion Rate, Revenue, User Signups.</p> </dd> </dl> </div> <div class="paragraph"> <p>Usually, infrastructure and application metrics are quite "standard," and there are frameworks/tools that can be easily used to instruct your application to expose those metrics. On the other hand, business metrics can vary between applications, so you need to implement custom code every time to expose those metrics.</p> </div> <div class="paragraph"> <p>The idea is to think at a lower level and leverage change data capture (CDC) to extract data that can be used as business metrics.</p> </div> <div class="paragraph"> <p>Suppose we have an order service that processes and stores orders made by our customers. An important business metric to monitor would be the number of orders made. This number is very relevant to the business because it directly correlates to the company’s earnings. A relevant drop in number of orders should alert the team responsible for that service as soon as possible.</p> </div> <div class="paragraph"> <p>Normally, we would need a <a href="https://prometheus.io/docs/concepts/metric_types/#counter">counter</a> metric that increments every time an order is correctly placed and stored in the database. But what if we could extract this information just by monitoring the database through CDC?</p> </div> <div class="paragraph"> <p>Let’s explore how Debezium offers this possibility.</p> </div> </div> </div> <div class="sect1"> <h2 id="how_debezium_exposes_metrics">How Debezium Exposes Metrics</h2> <div class="sectionbody"> <div class="paragraph"> <p>Debezium exposes three categories of metrics:</p> </div> <div class="dlist"> <dl> <dt class="hdlist1">Snapshot metrics</dt> <dd> <p>Provide information about connector operation while performing a snapshot, such as RowsScanned, RemainingTableCount, TotalTableCount.</p> </dd> <dt class="hdlist1">Streaming metrics</dt> <dd> <p>Provide information about connector operation when the connector is reading the database log, such as TotalNumberOfCreateEventsSeen, QueueRemainingCapacity, QueueTotalCapacity.</p> </dd> <dt class="hdlist1">Schema history metrics</dt> <dd> <p>Provide information about the status of the connector’s schema history, such as ChangesApplied, ChangesRecovered, Status.</p> </dd> </dl> </div> <div class="paragraph"> <p>All these metrics are exposed through JMX. You can read more in our <a href="https://debezium.io/documentation/reference/stable/operations/monitoring.html">documentation</a>.</p> </div> <div class="sect2"> <h3 id="database_activity_metrics">Database Activity Metrics</h3> <div class="paragraph"> <p>Starting from the 3.0.0.Final release (specifically 3.0.0.Beta1), the following new streaming metrics were introduced:</p> </div> <div class="dlist"> <dl> <dt class="hdlist1">NumberOfCreateEventsSeen</dt> <dd> <p>Counts the number of create events per table.</p> </dd> <dt class="hdlist1">NumberOfDeleteEventsSeen</dt> <dd> <p>Counts the number of delete events per table.</p> </dd> <dt class="hdlist1">NumberOfUpdateEventsSeen</dt> <dd> <p>Counts the number of update events per table.</p> </dd> <dt class="hdlist1">NumberOfTruncateEventsSeen</dt> <dd> <p>Counts the number of truncate events per table.</p> </dd> </dl> </div> <div class="paragraph"> <p>Since these metrics are experimental, you need to opt-in to enable them by setting the <code>internal.advanced.metrics.enable</code> property to true.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="demo_order_service_monitoring_dashboard">Demo: Order service monitoring dashboard</h2> <div class="sectionbody"> <div class="paragraph"> <p>After you expose these metrics with Debezium, you can easily create a dashboard with alerts to monitor any significant change that can influence your business. We&#8217;ll set up our order service with its own PostgreSQL database, Debezium PostgreSQL connector on the Kafka Connect runtime and Prometheus and Grafana as our observability platform.</p> </div> <div class="paragraph"> <p>For this demo you need to clone the code in the <a href="https://github.com/debezium/debezium-examples">Debezium examples repository</a> and go to the <code>db-activity-monitoring</code> directory.</p> </div> </div> </div> <div class="sect1"> <h2 id="components_overview">Components overview</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="order_service">Order service</h3> <div class="paragraph"> <p>The order service is a <a href="https://quarkus.io/">Quarkus</a> application that, per default, stores 100 orders every 10 seconds, or a rate of ~10 orders per second. You can simulate a bad deployment by setting the <code>app.version</code> property in application.properties to anything other than <code>1.0</code>. This will force the application to perform order inserts at half the standard rate.</p> </div> <div class="paragraph"> <p>The application also exposes the <code>application.info</code> metric with a constant value of <code>1.0</code> but with two labels: <code>version</code> and <code>name</code>. We will use this metric to put a label on the graph to indicate the version of the deployed service.</p> </div> </div> <div class="sect2"> <h3 id="jmx_exporter_configuration">JMX exporter configuration</h3> <div class="paragraph"> <p>We saw that Debezium exposes metrics as a JMX bean so normally to expose those metrics to Prometheus we can use the <a href="https://github.com/prometheus/jmx_exporter">JMX exporter</a>. In the <code>debezium-jmx-exporter</code> the <code>config.yml</code> file contain its configuration. The most important the following pattern</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="yaml">- <span class="string"><span class="content">pattern: &quot;debezium.([^:]+)&lt;type=connector-metrics, context=([^,]+), server=([^,]+), key=([^&gt;]+)&gt;&lt;&gt;NumberOfCreateEventsSeen&quot;</span></span>
  <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">debezium_metrics_create_events_count</span><span class="delimiter">&quot;</span></span>
  <span class="key">labels</span>:
    <span class="key">plugin</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">$1</span><span class="delimiter">&quot;</span></span>
    <span class="key">context</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">$2</span><span class="delimiter">&quot;</span></span>
    <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">$3</span><span class="delimiter">&quot;</span></span>
    <span class="key">table</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">$4</span><span class="delimiter">&quot;</span></span>
  <span class="key">type</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">COUNTER</span><span class="delimiter">&quot;</span></span></code></pre> </div> </div> <div class="paragraph"> <p>Given that the name of the MBean is <code>debezium.postgres&lt;type=connector-metrics, context=streaming, server=monitoring, key=inventory.orders&gt;&lt;&gt;NumberOfCreateEventsSeen</code>, the rule above simply creates the following metric:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="text"># TYPE debezium_metrics_create_events_count_total counter
debezium_metrics_create_events_count{context=&quot;streaming&quot;,name=&quot;monitoring&quot;,plugin=&quot;postgres&quot;,table=&quot;inventory.orders&quot;,} 100.0</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="components_start_up">Components start up</h3> <div class="paragraph"> <p>After that you are ready to start the demo with the following steps:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>Build our order service.</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="shell">order-service/mvnw package -f order-service/pom.xml</code></pre> </div> </div> </li> <li> <p>Run our compose file to start everything is needed.</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="shell">export DEBEZIUM_VERSION=3.0.0.Final
docker-compose up -d --build</code></pre> </div> </div> </li> <li> <p>When all service are up and running we can register our connector</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="shell">curl -i -X POST -H &quot;Accept:application/json&quot; -H  &quot;Content-Type:application/json&quot; http://localhost:8083/connectors/ -d @postgres-activity-monitoring.json</code></pre> </div> </div> </li> </ol> </div> </div> <div class="sect2"> <h3 id="accessing_the_dashboard">Accessing the dashboard</h3> <div class="paragraph"> <p>Open a web browser and go to the Grafana UI at <a href="http://localhost:3000">http://localhost:3000</a>. Login into the console as user <code>admin</code> with password <code>admin</code>. When asked either change the password or skip this step.</p> </div> <div class="paragraph"> <p>Then, to monitor the order service activity, we have created the <code>General/ Microservices activity monitoring</code> dashboard.</p> </div> <div class="paragraph"> <p>After a couple of minutes you should see that the order rate will be ~10 per second.</p> </div> <div class="paragraph"> <p>To simulate a drop, we can just update the <code>APP_VERSION</code> env to a value different to <code>1.0</code>.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="shell">docker stop order-service
docker rm -f order-service &amp;&amp; \
docker compose run -d -e APP_VERSION=1.1 --name order-service order-service</code></pre> </div> </div> <div class="paragraph"> <p>After a while you will see that the service will start creating orders with a ~50% drop (see <em>Figure 1</em>).</p> </div> <div class="paragraph"> <p>Since we have also configured an alert to fire when the order rate is below 7, you can also check that it is firing in the alert panel.</p> </div> <div class="imageblock centered-image"> <div class="content"> <img src="/assets/images/2024-09-20-Detect-data-mutation-patterns-with-Debezium/activity-monitoring-dashboard.png" alt="activity monitoring dashboard"> </div> <div class="title">Figure 1. &#160;</div> </div> <div class="paragraph"> <p>But that&#8217;s not all, we have also configured a mail notification that you can check accessing the Fake SMTP UI at <a href="http://localhost:8085">http://localhost:8085</a>.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="conclusion">Conclusion</h2> <div class="sectionbody"> <div class="paragraph"> <p>We have seen how Change Data Capture (CDC) can extract insights from the database to serve as key performance indicators (KPIs) in the reliability and observability of microservices. This approach allows us to avoid modifying our service to expose these metrics and instead rely on Debezium for data collection.</p> </div> <div class="paragraph"> <p>While not all business metrics can be derived from database operations, a significant portion can be.</p> </div> <div class="paragraph"> <p>Any comments, suggestions, or questions are welcome, so please feel free to reach out to me to discuss further.</p> </div> </div> </div></div> </div> <div class="well"> <div class="row"> <div class="col-md-8"> <h2>Fiore Mario Vitale</h2> <p> <span class="bio-size">Mario is a Senior Software Engineer at Red Hat. He lives in Italy.</span> </p> <p class="bio-size"> <a href="https://github.com/mfvitale"> <i class="icon-github"></i> </a> &nbsp; <a href="https://www.linkedin.com/in/mfvitale"> <i class="icon-linkedin"></i> </a> &nbsp; </p> </div> <div class="col-md-4"> <img alt="" class="img-responsive pull-right portrait" src="/assets/images/mario.jpg"/> </div> </div> </div> <ul class="pager pager-blog"> <li class="previous"> <a href="/blog/2024/10/03/plan-to-move-debezium-to-foundation/" class="previous"> &laquo; Previous</a> </li> <li class="next disabled"><a href="">Next &raquo; </a></li> </ul> <div class="row"> <div class="col-md-12"> <hr> <h2>About Debezium</h2> <p> Debezium is an open source distributed platform that turns your existing databases into event streams, so applications can see and respond almost instantly to each committed row-level change in the databases. Debezium is built on top of <a href="http://kafka.apache.org/">Kafka</a> and provides <a href="http://kafka.apache.org/documentation.html#connect">Kafka Connect</a> compatible connectors that monitor specific database management systems. Debezium records the history of data changes in Kafka logs, so your application can be stopped and restarted at any time and can easily consume all of the events it missed while it was not running, ensuring that all events are processed correctly and completely. Debezium is <a href="/license/">open source</a> under the <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache License, Version 2.0</a>. </p> </div> </div> <div class="row"> <div class="col-md-12"> <h2>Get involved</h2> <p> We hope you find Debezium interesting and useful, and want to give it a try. Follow us on Twitter <a href="https://twitter.com/debezium">@debezium</a>, <a href="https://debezium.zulipchat.com/#narrow/stream/302529-users">chat with us on Zulip</a>, or join our <a href="https://groups.google.com/forum/#!forum/debezium">mailing list</a> to talk with the community. All of the code is open source <a href="https://github.com/debezium/">on GitHub</a>, so build the code locally and help us improve ours existing connectors and add even more connectors. If you find problems or have ideas how we can improve Debezium, please let us know or <a href="https://issues.redhat.com/projects/DBZ/issues/">log an issue</a>. </p> </div> </div> <div id="disqus_thread"></div> <script>var disqus_config=function(){this.page.url="https://debezium.io/blog/2024/10/14/Detect-data-mutation-patterns-with-Debezium/",this.page.identifier="https://debezium.io/blog/2024/10/14/Detect-data-mutation-patterns-with-Debezium/"};!function(){var t=document,e=t.createElement("script");e.src="https://Debezium.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}();</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> </div> </div> </div> <footer class="container"> <div> <div class="row mr-0 ml-0"> <div class="col-md-5 col-md-offset-1"> <h4>Debezium</h4> <p> &#169; 2024 Debezium Community <br/> <br/> <i class="icon-fire"></i> Mixed with <a href="https://getbootstrap.com/">Bootstrap</a>, baked by <a href="https://jekyllrb.com/">Jekyll</a>. <br/> <i class="icon-flag"></i> Website and docs licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>. <br/> <i class="icon-flag-alt"></i> Code released under <a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache License, v2.0</a>. <br/> <i class="icon-file-alt"></i> <a href="https://www.redhat.com/legal/legal_statement.html" title="Terms">Terms</a> | <a href="https://www.redhat.com/legal/privacy_statement.html" title="Privacy Policy">Privacy</a> </p> <p>Rev: <a target="_blank" href="https://github.com/debezium/debezium.github.io/commit/878ff9e2bd3eaca421ee296c3d05cd1a786c3773">878ff9e</a> </p> </div> <div class="col-md-3"> <h4>Documentation</h4> <ul class="list-unstyled"> <li><a href="/documentation/reference/stable/features.html" title="Features">Features</a></li> <li> <a href="/documentation/reference/stable/install.html" title="Install">Install</a> </li> <li> <a href="/documentation/reference/stable/architecture.html" title="Architecture">Architecture</a> </li> <li><a href="/documentation/faq/" title="FAQ">FAQ</a></li> <li> <a href="/community/contribute/" title="Contribute">Contribute</a> </li> </ul> </div> <div class="col-md-3"> <h4>Connect</h4> <ul class="list-unstyled"> <li><a href="/blog" title="Blog">Blog</a></li> <li> <a href="https://twitter.com/debezium" title="Twitter">Twitter</a> </li> <li><a href="https://github.com/debezium" title="GitHub">GitHub</a></li> <li><a href="https://debezium.zulipchat.com/#narrow/stream/302529-users" title="Chat">Chat</a></li> <li> <a href="https://groups.google.com/forum/#!forum/debezium" title="Google Groups">Google Groups</a> </li> <li> <a href="https://stackoverflow.com/questions/tagged/debezium" title="StackOverflow">StackOverflow</a> </li> </ul> </div> </div> </div> </footer> <div class="container" id="companyfooter"> <div class="redhatlogo"> <a href="https://www.redhat.com/"> <img src="/assets/images/Logo-Red_Hat-Sponsored_By-B-Standard-RGB.svg"/> </a> </div> </div> </div> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-76464546-1"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-76464546-1");</script> <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script> <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script> <script type="text/javascript" src="/assets/javascript/vanilla-back-to-top.min.js"></script> <script type="text/javascript" src="/assets/javascript/highlight.min.js"></script> <script>addBackToTop({scrollDuration:400}),hljs.initHighlightingOnLoad();</script> </body> </html>