<!DOCTYPE html> <html> <head> <title>Change Data Capture with QuestDB and Debezium</title> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="description" content="Debezium is an open source distributed platform for change data capture. Start it up, point it at your databases, and your apps can start responding to all of the inserts, updates, and deletes that other apps commit to your databases. Debezium is durable and fast, so your apps can respond quickly and never miss an event, even when things go wrong."> <meta content="Debezium" property="og:site_name"> <meta content="Change Data Capture with QuestDB and Debezium" property="og:title"> <meta content="https://debezium.io/assets/images/color_white_debezium_type_600px.svg" property="og:image"> <meta property="og:description" content="Debezium is an open source distributed platform for change data capture. Start it up, point it at your databases, and your apps can start responding to all of the inserts, updates, and deletes that other apps commit to your databases. Debezium is durable and fast, so your apps can respond quickly and never miss an event, even when things go wrong."> <meta property="og:url" content="https://debezium.io/blog/2023/01/06/change-data-capture-with-questdb-and-debezium/"> <meta name="twitter:site" content="@debezium"> <meta name="twitter:title" content="Change Data Capture with QuestDB and Debezium"> <meta name="twitter:creator" content="@yhwang"> <meta name="twitter:description" content="Debezium is an open source distributed platform for change data capture. Start it up, point it at your databases, and your apps can start responding to all of the inserts, updates, and deletes that other apps commit to your databases. Debezium is durable and fast, so your apps can respond quickly and never miss an event, even when things go wrong."> <meta name="twitter:card" content="summary_large_image"> <meta property="twitter:url" content="https://debezium.io/blog/2023/01/06/change-data-capture-with-questdb-and-debezium/"> <link rel="alternate" type="application/rss+xml" title="Debezium Blog" href="/blog.atom"> <link rel="shortcut icon" type="image/png" href="/favicon.ico"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css"/> <link rel="stylesheet" href="/assets/css/custom.css"/> <link rel="stylesheet" href="/assets/css/highlight.min.css"/> <link rel="stylesheet" href="/assets/css/coderay.css"/> <link rel="canonical" href="https://questdb.io/blog/2023/01/03/change-data-capture-with-questdb-and-debezium"/> </head> <body class="post"> <div id="rhbar"> <a class="jbdevlogo" href="https://developers.redhat.com"></a> <a class="rhlogo" href="https://www.redhat.com/"></a> </div> <div id> <div class="container" id="content"> <nav class="navbar navbar-inverse navbar-fix"> <div class="container-fluid"> <div class="navbar-header"> <button class="navbar-toggle collapsed border-0" type="button" data-toggle="collapse" data-target="#navigation" aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/"><img class="project-logo" src="/assets/images/color_white_debezium_type_600px.svg" style="height: 32px; margin-right: 5px; margin-top: -5px;"></a> </div> <div class="collapse navbar-collapse collapsed" id="navigation"> <ul class="nav navbar-nav pull-right"> <li> <a href="/documentation/faq" class="">FAQ</a> </li> <li class="item"> <a href="/documentation/" class="">Documentation</a> </li> <li> <a href="/releases/" class="">Releases</a> </li> <li> <a href="/community/" class="">Community</a> </li> <li class="active"> <a href="/blog/" class="active">Blog</a> </li> </ul> </div> </div> </nav> <div class="row post-text-padding row-no-expand"> <div class="col-md-3"><div id="leftdocnav"> <div class="hidden-lg hidden-md hidden-sm"> <button class="navbar-toggle docssubmenu-toggle collapsed" data-target="#docssubmenu" data-toggle="collapse" style=" float: none; background-color: #656565; border-color: #656565; width: 100%; color: #fff; "> Navigation Menu </button> </div> <div class="collapse" id="docssubmenu"> <div class="doc-pills"> <ul class="nav nav-pills nav-stacked"> <li class="item"> <a href="/blog">Home</a> <div class="icon"><span class="icon-home"></span></div> </li> <li class="item"> <a href="/archives">Archive</a> <div class="icon"><span class="icon-arrow-down"></span></div> </li> <li class="item"> <a href="/blog.atom">Feed</a> <div class="icon"><span class="icon-rss"></span></div> </li> </ul> </div> <p></p> <div class="featured-posts"> <div id="#featured" style="margin-bottom: 4px; border-bottom: 1px solid #ccc; font-size: 115%; margin-left: 2px;">Featured Posts</div> <ul style="padding-inline-start: 22px;"> <li style="margin-bottom: 3px;"> <a href="/blog/2020/11/04/streaming-vitess-at-bolt/" style="font-size: 95%;"> Streaming Vitess at Bolt </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2020/02/10/event-sourcing-vs-cdc/" style="font-size: 95%;"> Distributed Data for Microservices — Event Sourcing vs. Change Data Capture </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2019/10/01/audit-logs-with-change-data-capture-and-stream-processing/" style="font-size: 95%;"> Building Audit Logs with Change Data Capture and Stream Processing </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2019/07/12/streaming-cassandra-at-wepay-part-1/" style="font-size: 95%;"> Streaming Cassandra at WePay - Part 1 </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2019/02/19/reliable-microservices-data-exchange-with-the-outbox-pattern/" style="font-size: 95%;"> Reliable Microservices Data Exchange With the Outbox Pattern </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/12/05/automating-cache-invalidation-with-change-data-capture/" style="font-size: 95%;"> Automating Cache Invalidation With Change Data Capture </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/09/20/materializing-aggregate-views-with-hibernate-and-debezium/" style="font-size: 95%;"> Materializing Aggregate Views With Hibernate and Debezium </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/07/19/advantages-of-log-based-change-data-capture/" style="font-size: 95%;"> Five Advantages of Log-Based Change Data Capture </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/03/08/creating-ddd-aggregates-with-debezium-and-kafka-streams/" style="font-size: 95%;"> Creating DDD aggregates with Debezium and Kafka Streams </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/01/17/streaming-to-elasticsearch/" style="font-size: 95%;"> Streaming Data Changes from Your Database to Elasticsearch </a> </li> </ul> </div> <p></p> <p></p> <div class="cloud-tags"> <div id="tags" style="margin-bottom: 4px; border-bottom: 1px solid #ccc; font-size: 115%; margin-left: 2px;"> Tags </div> <div class="tag-cloud"> <span class="site-tag"> <a href="/tag/apache-kafka/" style="font-size: 82%"> apache kafka </a> </span> <span class="site-tag"> <a href="/tag/apache-kafka/" style="font-size: 88%"> apache kafka </a> </span> <span class="site-tag"> <a href="/tag/apicurio/" style="font-size: 82%"> apicurio </a> </span> <span class="site-tag"> <a href="/tag/avro/" style="font-size: 84%"> avro </a> </span> <span class="site-tag"> <a href="/tag/aws/" style="font-size: 82%"> aws </a> </span> <span class="site-tag"> <a href="/tag/camel/" style="font-size: 82%"> camel </a> </span> <span class="site-tag"> <a href="/tag/cassandra/" style="font-size: 220%"> cassandra </a> </span> <span class="site-tag"> <a href="/tag/cdc/" style="font-size: 82%"> cdc </a> </span> <span class="site-tag"> <a href="/tag/community/" style="font-size: 120%"> community </a> </span> <span class="site-tag"> <a href="/tag/community-stories/" style="font-size: 84%"> community stories </a> </span> <span class="site-tag"> <a href="/tag/cqrs/" style="font-size: 84%"> cqrs </a> </span> <span class="site-tag"> <a href="/tag/datalake/" style="font-size: 82%"> datalake </a> </span> <span class="site-tag"> <a href="/tag/db2/" style="font-size: 198%"> db2 </a> </span> <span class="site-tag"> <a href="/tag/ddd/" style="font-size: 82%"> ddd </a> </span> <span class="site-tag"> <a href="/tag/debezium/" style="font-size: 90%"> debezium </a> </span> <span class="site-tag"> <a href="/tag/debezium-server/" style="font-size: 90%"> debezium server </a> </span> <span class="site-tag"> <a href="/tag/debezium-ui/" style="font-size: 88%"> debezium ui </a> </span> <span class="site-tag"> <a href="/tag/discussion/" style="font-size: 114%"> discussion </a> </span> <span class="site-tag"> <a href="/tag/docker/" style="font-size: 184%"> docker </a> </span> <span class="site-tag"> <a href="/tag/elasticsearch/" style="font-size: 82%"> elasticsearch </a> </span> <span class="site-tag"> <a href="/tag/event-sourcing/" style="font-size: 82%"> event sourcing </a> </span> <span class="site-tag"> <a href="/tag/example/" style="font-size: 88%"> example </a> </span> <span class="site-tag"> <a href="/tag/examples/" style="font-size: 110%"> examples </a> </span> <span class="site-tag"> <a href="/tag/fedora/" style="font-size: 82%"> fedora </a> </span> <span class="site-tag"> <a href="/tag/hiring/" style="font-size: 84%"> hiring </a> </span> <span class="site-tag"> <a href="/tag/iceberg/" style="font-size: 82%"> iceberg </a> </span> <span class="site-tag"> <a href="/tag/integration/" style="font-size: 82%"> integration </a> </span> <span class="site-tag"> <a href="/tag/introduction/" style="font-size: 84%"> introduction </a> </span> <span class="site-tag"> <a href="/tag/jaeger/" style="font-size: 82%"> jaeger </a> </span> <span class="site-tag"> <a href="/tag/json/" style="font-size: 82%"> json </a> </span> <span class="site-tag"> <a href="/tag/kafka/" style="font-size: 94%"> kafka </a> </span> <span class="site-tag"> <a href="/tag/kafka-streams/" style="font-size: 82%"> kafka streams </a> </span> <span class="site-tag"> <a href="/tag/kafka-streams/" style="font-size: 86%"> kafka streams </a> </span> <span class="site-tag"> <a href="/tag/kogito/" style="font-size: 82%"> kogito </a> </span> <span class="site-tag"> <a href="/tag/ksql/" style="font-size: 82%"> ksql </a> </span> <span class="site-tag"> <a href="/tag/kubernetes/" style="font-size: 82%"> kubernetes </a> </span> <span class="site-tag"> <a href="/tag/lakehouse/" style="font-size: 82%"> lakehouse </a> </span> <span class="site-tag"> <a href="/tag/microservices/" style="font-size: 84%"> microservices </a> </span> <span class="site-tag"> <a href="/tag/mongo/" style="font-size: 86%"> mongo </a> </span> <span class="site-tag"> <a href="/tag/mongodb/" style="font-size: 216%"> mongodb </a> </span> <span class="site-tag"> <a href="/tag/mysql/" style="font-size: 352%"> mysql </a> </span> <span class="site-tag"> <a href="/tag/news/" style="font-size: 108%"> news </a> </span> <span class="site-tag"> <a href="/tag/newsletter/" style="font-size: 88%"> newsletter </a> </span> <span class="site-tag"> <a href="/tag/oracle/" style="font-size: 246%"> oracle </a> </span> <span class="site-tag"> <a href="/tag/outbox/" style="font-size: 188%"> outbox </a> </span> <span class="site-tag"> <a href="/tag/postgres/" style="font-size: 320%"> postgres </a> </span> <span class="site-tag"> <a href="/tag/presentation/" style="font-size: 84%"> presentation </a> </span> <span class="site-tag"> <a href="/tag/production/" style="font-size: 82%"> production </a> </span> <span class="site-tag"> <a href="/tag/quarkus/" style="font-size: 92%"> quarkus </a> </span> <span class="site-tag"> <a href="/tag/questdb/" style="font-size: 82%"> questdb </a> </span> <span class="site-tag"> <a href="/tag/rds/" style="font-size: 84%"> rds </a> </span> <span class="site-tag"> <a href="/tag/releases/" style="font-size: 334%"> releases </a> </span> <span class="site-tag"> <a href="/tag/schema/" style="font-size: 82%"> schema </a> </span> <span class="site-tag"> <a href="/tag/scylla/" style="font-size: 82%"> scylla </a> </span> <span class="site-tag"> <a href="/tag/secrets/" style="font-size: 82%"> secrets </a> </span> <span class="site-tag"> <a href="/tag/sentry/" style="font-size: 82%"> sentry </a> </span> <span class="site-tag"> <a href="/tag/serialization/" style="font-size: 82%"> serialization </a> </span> <span class="site-tag"> <a href="/tag/smt/" style="font-size: 84%"> smt </a> </span> <span class="site-tag"> <a href="/tag/snapshots/" style="font-size: 84%"> snapshots </a> </span> <span class="site-tag"> <a href="/tag/spanner/" style="font-size: 82%"> spanner </a> </span> <span class="site-tag"> <a href="/tag/sql/" style="font-size: 84%"> sql </a> </span> <span class="site-tag"> <a href="/tag/sqlserver/" style="font-size: 262%"> sqlserver </a> </span> <span class="site-tag"> <a href="/tag/testcontainers/" style="font-size: 88%"> testcontainers </a> </span> <span class="site-tag"> <a href="/tag/tests/" style="font-size: 82%"> tests </a> </span> <span class="site-tag"> <a href="/tag/time-series/" style="font-size: 82%"> time series </a> </span> <span class="site-tag"> <a href="/tag/topics/" style="font-size: 82%"> topics </a> </span> <span class="site-tag"> <a href="/tag/tracing/" style="font-size: 82%"> tracing </a> </span> <span class="site-tag"> <a href="/tag/vagrant/" style="font-size: 82%"> vagrant </a> </span> <span class="site-tag"> <a href="/tag/vitess/" style="font-size: 178%"> vitess </a> </span> <span class="site-tag"> <a href="/tag/website/" style="font-size: 84%"> website </a> </span> </div> </div> </div> </div> </div> <div class="col-md-9"> <div class="post"> <div class="row" style="margin-left: 0; margin-right: 0; margin-bottom: 10px"> <div class="col-sm-12" style="padding-left: 0px"> <div style="display: table-cell; vertical-align: top"> <div style=" width: 72px; border: 1px solid #ccc; padding: 3px; display: inline-block; "> <img src="/assets/images/yitaek.jpg" style="width: 64px;"> </div> </div> <div style="display: table-cell; vertical-align: top"> <div style="margin-left: 8px"> <span class="hidden-sm hidden-xs" style="font-size: 2.75rem; line-height: 1"> <a href="/blog/2023/01/06/change-data-capture-with-questdb-and-debezium/">Change Data Capture with QuestDB and Debezium</a> </span> <span class="hidden-md hidden-lg" style="font-size: 2rem; line-height: 1"> <a href="/blog/2023/01/06/change-data-capture-with-questdb-and-debezium/">Change Data Capture with QuestDB and Debezium</a> </span> <div class="byline" style="line-height: 1"> <em> January 6, 2023 by </em> <em> Yitaek Hwang </em> <div class="hidden-xs" style="margin-top: 5px"> <a class="label label-info hidden-sm hidden-xs" href="/tag/questdb/">questdb</a> <a class="label label-info hidden-sm hidden-xs" href="/tag/kafka/">kafka</a> <a class="label label-info hidden-sm hidden-xs" href="/tag/debezium/">debezium</a> <a class="label label-info hidden-sm hidden-xs" href="/tag/time series/">time series</a> </div> </div> </div> </div> </div> </div> <div class="grid__item width-12-12"><div class="paragraph"> <p>This tutorial was originally published by <a href="https://questdb.io/">QuestDB</a>, where guest contributor, <a href="https://yitaek.medium.com/">Yitaek Hwang</a>, shows us how to stream data into QuestDB with change data capture via Debezium and Kafka Connect.</p> </div> <div class="paragraph"> <p></p> </div> <div class="paragraph"> <p>Modern data architecture has largely shifted away from the <strong>ETL</strong> (Extract-Transform-Load) paradigm to <strong>ELT</strong> (Extract-Load-Transform) where raw data is first loaded into a data lake before transformations are applied (e.g., aggregations, joins) for further analysis. Traditional ETL pipelines were hard to maintain and relatively inflexible with changing business needs. As new cloud technologies promised cheaper storage and better scalability, data pipelines could move away from pre-built extractions and batch uploads to a more streaming architecture.</p> </div> <div class="paragraph"> <p><a href="https://en.wikipedia.org/wiki/Change_data_capture">Change data capture</a>(CDC) fits nicely into this paradigm shift where changes to data from one source can be streamed to other destinations. As the name implies, CDC tracks changes in data (usually a database) and provides plugins to act on those changes. For event-driven architectures, CDC is especially useful as a consistent data delivery mechanism between service boundaries (e.g., <a href="https://microservices.io/patterns/data/transactional-outbox.html">Outbox Pattern</a>). In a complex microservice environment, CDC helps to simplify data delivery logic by offloading the burden to the CDC systems.</p> </div> <div class="paragraph"> <p>To illustrate, let&#8217;s take a reference architecture to stream stock updates from PostgreSQL into QuestDB. A simple Java Spring App polls stock prices by ticker symbol and updates the current price to a PostgreSQL database. Then the updates are detected by Debezium and fed to a Kafka topic. Finally, the Kafka Connect QuestDB connector listens to that topic and streams changes into QuestDB for analysis.</p> </div> <div class="exampleblock centered-image responsive-image"> <div class="content"> <img src="/assets/images/2023-01-06-change-data-capture-with-questdb-and-debezium/overview.png" style="max-width:90%;" class="responsive-image"> <div class="paragraph"> <p>Design overview</p> </div> </div> </div> <div class="paragraph"> <p>Structuring the data pipeline this way allows the application to be simple. The Java Spring App only needs to fetch the latest stock data and commit to PostgreSQL. Since PostgreSQL is an excellent OLTP (transactional) database, the app can rely on the ACID compliance to ensure that only the committed data will be seen by downstream services. The app developer does not need to worry about complicated retry logic or out-of-sync datasets. From the database standpoint, PostgreSQL can be optimized to do what it does best — transactional queries. Kafka can be leveraged to reliably feed data to other endpoints, and QuestDB can be used to store historical data to run analytical queries and visualization.</p> </div> <div class="paragraph"> <p>So without further ado, let&#8217;s get to the example:</p> </div> <div class="sect1"> <h2 id="prerequisites">Prerequisites</h2> <div class="sectionbody"> <div class="ulist"> <ul> <li> <p>Git</p> </li> <li> <p>Docker Engine: 20.10+</p> </li> </ul> </div> </div> </div> <div class="sect1"> <h2 id="setup">Setup</h2> <div class="sectionbody"> <div class="paragraph"> <p>To run the example locally, first clone the <a href="https://github.com/questdb/kafka-questdb-connector.git">QuestDG Kafka connector repo</a>:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="shell">$ git clone https://github.com/questdb/kafka-questdb-connector.git</code></pre> </div> </div> <div class="paragraph"> <p>Then, navigate to the stocks sample to build and run the Docker compose files:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="shell">$ cd kafka-questdb-connector/kafka-questdb-connector-samples/stocks/
$ docker compose build
$ docker compose up</code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="paragraph"> <p>In Linux or older versions of Docker, the <code>compose</code> subcommand might not be available. You can try to execute <code>docker-compose</code> instead of <code>docker compose</code>. If <code>docker-compose</code> is unavailable in your distribution, you can <a href="https://docs.docker.com/compose/install/other/">install it</a> manually.</p> </div> </td> </tr> </table> </div> <div class="paragraph"> <p>This will build the Dockerfile for the Java Spring App/Kafka Connector for QuestDB and pull down PostgreSQL (preconfigured with Debezium), Kafka/Zookeeper, QuestDB, and Grafana containers. Kafka and Kafka Connect take a bit to initialize. Wait for the logs to stop by inspecting the connect container.</p> </div> <div class="sect2"> <h3 id="start_the_debezium_connector">Start the Debezium connector</h3> <div class="paragraph"> <p>At this point, the Java App is continuously updating the stock table in PostgreSQL, but the connections have not been setup. Create the Debezium connector (i.e., PostgreSQL → Debezium → Kafka) by executing the following:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="shell">curl -X POST -H &quot;Content-Type: application/json&quot; -d  '{&quot;name&quot;:&quot;debezium_source&quot;,&quot;config&quot;:{&quot;tasks.max&quot;:1,&quot;database.hostname&quot;:&quot;postgres&quot;,&quot;database.port&quot;:5432,&quot;database.user&quot;:&quot;postgres&quot;,&quot;database.password&quot;:&quot;postgres&quot;,&quot;connector.class&quot;:&quot;io.debezium.connector.postgresql.PostgresConnector&quot;,&quot;database.dbname&quot;:&quot;postgres&quot;,&quot;database.server.name&quot;:&quot;dbserver1&quot;}} ' localhost:8083/connectors</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="start-the-questdb-kafka-connect-sink">Start the QuestDB Kafka Connect sink</h3> <div class="paragraph"> <p>Finish the plumbing by creating the Kafka Connect side (i.e., Kafka → QuestDB sink):</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="shell">curl -X POST -H &quot;Content-Type: application/json&quot; -d '{&quot;name&quot;:&quot;questdb-connect&quot;,&quot;config&quot;:{&quot;topics&quot;:&quot;dbserver1.public.stock&quot;,&quot;table&quot;:&quot;stock&quot;, &quot;connector.class&quot;:&quot;io.questdb.kafka.QuestDBSinkConnector&quot;,&quot;tasks.max&quot;:&quot;1&quot;,&quot;key.converter&quot;:&quot;org.apache.kafka.connect.storage.StringConverter&quot;,&quot;value.converter&quot;:&quot;org.apache.kafka.connect.json.JsonConverter&quot;,&quot;host&quot;:&quot;questdb&quot;, &quot;transforms&quot;:&quot;unwrap&quot;, &quot;transforms.unwrap.type&quot;:&quot;io.debezium.transforms.ExtractNewRecordState&quot;, &quot;include.key&quot;: &quot;false&quot;, &quot;symbols&quot;: &quot;symbol&quot;, &quot;timestamp.field.name&quot;: &quot;last_update&quot;}}' localhost:8083/connectors</code></pre> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="final_result">Final result</h2> <div class="sectionbody"> <div class="paragraph"> <p>Now all the updates written to the PostgreSQL table will also be reflected in QuestDB. To validate, navigate to <a href="http://localhost:19000">http://localhost:19000</a> and select from the stock table:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> * <span class="keyword">FROM</span> stock;</code></pre> </div> </div> <div class="paragraph"> <p>You can also run aggregations for a more complex analysis:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="sql"> <span class="class">SELECT</span>
   <span class="predefined-type">timestamp</span>,
   symbol,
   <span class="predefined">avg</span>(price),
   <span class="predefined">min</span>(price),
   <span class="predefined">max</span>(price)
 <span class="keyword">FROM</span> stock
   <span class="keyword">WHERE</span> symbol = <span class="string"><span class="delimiter">'</span><span class="content">IBM</span><span class="delimiter">'</span></span>
 SAMPLE <span class="keyword">BY</span> <span class="integer">1</span>m ALIGN <span class="keyword">TO</span> CALENDAR;</code></pre> </div> </div> <div class="paragraph"> <p>Finally, you can interact with a Grafana dashboard for visualization at <a href="http://localhost:3000/d/stocks/stocks?orgId=1&amp;refresh=5s&amp;viewPanel=2">http://localhost:3000/d/stocks/stocks?orgId=1&amp;refresh=5s&amp;viewPanel=2</a>.</p> </div> <div class="paragraph"> <p>The visualization is a candle chart composed of changes captured by Debezium; each candle shows the opening, closing, high, and low price, in a given time interval. The time interval can be changed by selecting the top-left 'Interval' option:</p> </div> <div class="exampleblock centered-image responsive-image"> <div class="content"> <img src="/assets/images/2023-01-06-change-data-capture-with-questdb-and-debezium/screenshot.png" style="max-width:90%;" class="responsive-image"> <div class="paragraph"> <p>Grafana candle chart</p> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="deep_dive">Deep dive</h2> <div class="sectionbody"> <div class="paragraph"> <p>Now that we have the sample application up and running, let&#8217;s take a deeper dive into each component in the <a href="https://github.com/questdb/kafka-questdb-connector/tree/main/kafka-questdb-connector-samples/stocks">stocks</a> example.</p> </div> <div class="paragraph"> <p>We will look at the following files:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code>├── kafka-questdb-connector/kafka-questdb-connector-samples/stocks/
│   ├── Dockerfile-App
|   |    -- The Dockerfile to package our Java App
|   ├── Dockerfile-Connect
|   |    -- The Dockerfile to combine the Debezium container
|   |    -- image the with QuestDB Kafka connector
│   ├── src/main/resources/schema.sql
|   |    -- The SQL which creates the stock table in PostgreSQL
|   |    -- and populates it with initial data
│   ├── src/main/java/com/questdb/kafka/connector/samples/StocksApplication.java
|   |    -- The Java Spring App which updates the stock table in PostgreSQL
|   |    -- in regular intervals
...</code></pre> </div> </div> <div class="sect2"> <h3 id="producer_java_app">Producer (Java App)</h3> <div class="paragraph"> <p>The producer is a simple Java Spring Boot App. It has two components:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>The <a href="https://github.com/questdb/kafka-questdb-connector/blob/main/kafka-questdb-connector-samples/stocks/src/main/resources/schema.sql">schema.sql</a> file. This file is used to create the stock table in PostgreSQL and populate it with initial data. It&#8217;s picked up by the Spring Boot App and executed on startup.</p> <div class="literalblock"> <div class="content"> <pre>[source,sql]
----
CREATE TABLE IF NOT EXISTS stock (
    id serial primary key,
    symbol varchar(10) unique,
    price float8,
    last_update timestamp
);
INSERT INTO stock (symbol, price, last_update) VALUES ('AAPL', 500.0, now()) ON CONFLICT DO NOTHING;
INSERT INTO stock (symbol, price, last_update) VALUES ('IBM', 50.0, now()) ON CONFLICT DO NOTHING;
INSERT INTO stock (symbol, price, last_update) VALUES ('MSFT', 100.0, now()) ON CONFLICT DO NOTHING;
INSERT INTO stock (symbol, price, last_update) VALUES ('GOOG', 1000.0, now()) ON CONFLICT DO NOTHING;
INSERT INTO stock (symbol, price, last_update) VALUES ('FB', 200.0, now()) ON CONFLICT DO NOTHING;
INSERT INTO stock (symbol, price, last_update) VALUES ('AMZN', 1000.0, now()) ON CONFLICT DO NOTHING;
INSERT INTO stock (symbol, price, last_update) VALUES ('TSLA', 500.0, now()) ON CONFLICT DO NOTHING;
INSERT INTO stock (symbol, price, last_update) VALUES ('NFLX', 500.0, now()) ON CONFLICT DO NOTHING;
INSERT INTO stock (symbol, price, last_update) VALUES ('TWTR', 50.0, now()) ON CONFLICT DO NOTHING;
INSERT INTO stock (symbol, price, last_update) VALUES ('SNAP', 10.0, now()) ON CONFLICT DO NOTHING;
----</pre> </div> </div> <div class="literalblock"> <div class="content"> <pre>The `ON CONFLICT DO NOTHING` clause is used to avoid duplicate entries in the
table when the App is restarted.</pre> </div> </div> </li> <li> <p><a href="https://github.com/questdb/kafka-questdb-connector/blob/main/kafka-questdb-connector-samples/stocks/src/main/java/io/questdb/kafka/samples/StockService.java">Java code</a> to update prices and timestamps with a random value. The updates are not perfectly random, the application uses a very simple algorithm to generate updates which very roughly resembles stock price movements. In a real-life scenario, the application would fetch the price from some external source.</p> </li> </ol> </div> <div class="paragraph"> <p>The producer is packaged into a minimal Dockerfile, <a href="https://github.com/questdb/kafka-questdb-connector/blob/main/kafka-questdb-connector-samples/stocks/Dockerfile-App">Dockerfile-App</a>, and linked to PostgreSQL:</p> </div> <div class="listingblock"> <div class="content"> <pre>FROM maven:3.8-jdk-11-slim AS builder
COPY ./pom.xml /opt/stocks/pom.xml
COPY ./src ./opt/stocks/src
WORKDIR /opt/stocks
RUN mvn clean install -DskipTest
FROM azul/zulu-openjdk:11-latest
COPY --from=builder /opt/stocks/target/kafka-samples-stocks-*.jar /stocks.jar
CMD ["java", "-jar", "/stocks.jar"]</pre> </div> </div> </div> <div class="sect2"> <h3 id="kafka_connect_debezium_and_questdb_kafka_connector">Kafka Connect, Debezium, and QuestDB Kafka Connector</h3> <div class="paragraph"> <p>Before we dive into the Kafka Connect, Debezium, and the QuestDB Kafka connector configurations, let&#8217;s take a look at their relation with each other.</p> </div> <div class="paragraph"> <p>Kafka Connect is a framework for building connectors to move data between Kafka and other systems. It supports 2 classes of connectors:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>Source connectors - read data from a source system and write it to Kafka</p> </li> <li> <p>Sink connectors - read data from Kafka and write it to a sink system</p> </li> </ol> </div> <div class="paragraph"> <p>Debezium is a Source connector for Kafka Connect that can monitor and capture the row-level changes in the databases. What does it mean? Whenever a row is inserted, updated, or deleted in a database, Debezium will capture the change and write it as an event to Kafka.</p> </div> <div class="paragraph"> <p>On a technical level, Debezium is a Kafka Connect connector running inside the Kafka Connect framework. This is reflected in the <a href="https://hub.docker.com/r/debezium/connect">Debezium container image</a>, which packages the Kafka Connect with Debezium connectors pre-installed.</p> </div> <div class="paragraph"> <p>QuestDB Kafka connector is also a Kafka Connect connector. It&#8217;s a Sink connector that reads data from Kafka and writes it to QuestDB. We add the QuestDB Kafka connector to the Debezium container image, and we get a Kafka Connect image that has both Debezium and QuestDB Kafka connector installed!</p> </div> <div class="paragraph"> <p>This is the Dockerfile we use to build the image:</p> </div> <div class="paragraph"> <p>(<a href="https://github.com/questdb/kafka-questdb-connector/blob/main/kafka-questdb-connector-samples/stocks/Dockerfile-Connect">Dockerfile-Connect</a>)</p> </div> <div class="listingblock"> <div class="content"> <pre>FROM ubuntu:latest AS builder
WORKDIR /opt
RUN apt-get update &amp;&amp; apt-get install -y curl wget unzip jq
RUN curl -s https://api.github.com/repos/questdb/kafka-questdb-connector/releases/latest | jq -r '.assets[]|select(.content_type == "application/zip")|.browser_download_url'|wget -qi -
RUN unzip kafka-questdb-connector-*-bin.zip

FROM debezium/connect:1.9.6.Final
COPY --from=builder /opt/kafka-questdb-connector/*.jar /kafka/connect/questdb-connector/</pre> </div> </div> <div class="paragraph"> <p>The Dockerfile downloads the latest release of the QuestDB Kafka connector, unzip it copies it to the Debezium container image. The resulting image has both Debezium and QuestDB Kafka connector installed:</p> </div> <div class="exampleblock centered-image responsive-image"> <div class="content"> <img src="/assets/images/2023-01-06-change-data-capture-with-questdb-and-debezium/dockerfile-connect.png" style="max-width:90%;" class="responsive-image"> <div class="paragraph"> <p>Dockerfile-Coonnect adding the QuestDB Kafka Connector layer</p> </div> </div> </div> <div class="paragraph"> <p>The overall Kafka connector is completed with a Source connector and a Sink connector:</p> </div> <div class="exampleblock centered-image responsive-image"> <div class="content"> <img src="/assets/images/2023-01-06-change-data-capture-with-questdb-and-debezium/kafka-cluster.png" style="max-width:90%;" class="responsive-image"> <div class="paragraph"> <p>How the Source and Sink connector work with the Kafka cluster and the databases</p> </div> </div> </div> <div class="sect3"> <h4 id="debezium_connector">Debezium Connector</h4> <div class="paragraph"> <p>We already know that Debezium is a Kafka Connect connector that can monitor and capture the row-level changes in the databases. We also have a Docker image that has both Debezium and QuestDB Kafka connectors installed. However, at this point neither of the connectors is running. We need to configure and start them. This is done via CURL command that sends a POST request to the Kafka Connect REST API.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="shell">curl -X POST -H &quot;Content-Type: application/json&quot; -d  '{&quot;name&quot;:&quot;debezium_source&quot;,&quot;config&quot;:{&quot;tasks.max&quot;:1,&quot;database.hostname&quot;:&quot;postgres&quot;,&quot;database.port&quot;:5432,&quot;database.user&quot;:&quot;postgres&quot;,&quot;database.password&quot;:&quot;postgres&quot;,&quot;connector.class&quot;:&quot;io.debezium.connector.postgresql.PostgresConnector&quot;,&quot;database.dbname&quot;:&quot;postgres&quot;,&quot;database.server.name&quot;:&quot;dbserver1&quot;}} ' localhost:8083/connectors</code></pre> </div> </div> <div class="paragraph"> <p>The request body contains the configuration for the Debezium connector, let&#8217;s break it down:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">debezium_source</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">config</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">tasks.max</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">database.hostname</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">postgres</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">database.port</span><span class="delimiter">&quot;</span></span>: <span class="integer">5432</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">database.user</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">postgres</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">database.password</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">postgres</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">connector.class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">io.debezium.connector.postgresql.PostgresConnector</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">database.dbname</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">postgres</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">database.server.name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">dbserver1</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre> </div> </div> <div class="paragraph"> <p>It listens to changes in the PostgreSQL database and publishes to Kafka with the above configuration. The topic name defaults to <code>&lt;server-name&gt;.&lt;schema&gt;.&lt;table&gt;.</code> In our example, it is <code>dbserver1.public.stock</code>. Why? Because the database server name is <code>dbserver1</code>, the schema is <code>public</code> and the only table we have is <code>stock</code>.</p> </div> <div class="paragraph"> <p>So after we send the request, Debezium will start listening to changes in the <code>stock</code> table and publish them to the <code>dbserver1.public.stock</code> topic.</p> </div> </div> <div class="sect3"> <h4 id="questdb_kafka_connector">QuestDB Kafka Connector</h4> <div class="paragraph"> <p>At this point, we have a PostgreSQL table <code>stock</code> being populated with random stock prices and a Kafka topic <code>dbserver1.public.stock</code> that contains the changes. The next step is to configure the QuestDB Kafka connector to read from the <code>dbserver1.public.stock</code> topic and write the data to QuestDB.</p> </div> <div class="paragraph"> <p>Let&#8217;s take a deeper look at the configuration in the <a href="#start-the-questdb-kafka-connect-sink">start the QuestDB Kafka Connect sink</a>:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="jason">{
  &quot;name&quot;: &quot;questdb-connect&quot;,
  &quot;config&quot;: {
    &quot;topics&quot;: &quot;dbserver1.public.stock&quot;,
    &quot;table&quot;: &quot;stock&quot;,
    &quot;connector.class&quot;: &quot;io.questdb.kafka.QuestDBSinkConnector&quot;,
    &quot;tasks.max&quot;: &quot;1&quot;,
    &quot;key.converter&quot;: &quot;org.apache.kafka.connect.storage.StringConverter&quot;,
    &quot;value.converter&quot;: &quot;org.apache.kafka.connect.json.JsonConverter&quot;,
    &quot;host&quot;: &quot;questdb&quot;,
    &quot;transforms&quot;: &quot;unwrap&quot;,
    &quot;transforms.unwrap.type&quot;: &quot;io.debezium.transforms.ExtractNewRecordState&quot;,
    &quot;include.key&quot;: &quot;false&quot;,
    &quot;symbols&quot;: &quot;symbol&quot;,
    &quot;timestamp.field.name&quot;: &quot;last_update&quot;
  }
}</code></pre> </div> </div> <div class="paragraph"> <p>The important things to note here are:</p> </div> <div class="ulist"> <ul> <li> <p><code>table</code> and <code>topics</code>: The QuestDB Kafka connector will create a QuestDB table with the name <code>stock</code> and write the data from the <code>dbserver1.public.stock</code> topic to it.</p> </li> <li> <p><code>host</code>: The QuestDB Kafka connector will connect to QuestDB running on the <code>questdb</code> host. This is the name of the QuestDB container.</p> </li> <li> <p><code>connector.class</code>: The QuestDB Kafka connector class name. This tells Kafka Connect to use the QuestDB Kafka connector.</p> </li> <li> <p><code>value.converter</code>: The Debezium connector produces the data in JSON format. This is why we need to configure the QuestDB connector to use the JSON converter to read the data: <code>org.apache.kafka.connect.json.JsonConverter</code>.</p> </li> <li> <p><code>symbols</code>: Stock symbols are translated to <a href="https://questdb.io/docs/concept/symbol/">QuestDB symbol type</a>, used for string values with low cardinality (e.g., enums).</p> </li> <li> <p><code>timestamp.field.name</code>: Since QuestDB has great support for timestamp and partitioning based on that, we can specify the designated timestamp column.</p> </li> <li> <p><code>transforms</code>: unwrap field uses <code>io.debezium.transforms.ExtractNewRecordState</code> type to extract just the new data and not the metadata that Debezium emits. In other words, this is a filter to basically take the <code>payload.after</code> portion of the Debezium data on the Kafka topics. See its <a href="https://debezium.io/documentation/reference/1.9/transformations/event-flattening.html">documentation</a> for more details.</p> </li> </ul> </div> <div class="paragraph"> <p>The <code>ExtractNewRecordState</code> transform is probably the least intuitive part of the configuration. Let&#8217;s have a closer look at it: In short, for every change in the PostgreSQL table, the Debezium emits a JSON message to a Kafka topic such as the following:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">schema</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">This JSON key contains Debezium message schema. It's not very relevant for this sample. Omitted for brevity.</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">payload</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">before</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">after</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">8</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">symbol</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">NFLX</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span>: <span class="float">1544.3357414199545</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">last_update</span><span class="delimiter">&quot;</span></span>: <span class="integer">1666172978269856</span>
    }
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">source</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1.9.6.Final</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">connector</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">postgresql</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">dbserver1</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ts_ms</span><span class="delimiter">&quot;</span></span>: <span class="integer">1666172978272</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">snapshot</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">db</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">postgres</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">sequence</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">[</span><span class="char">\&quot;</span><span class="content">87397208</span><span class="char">\&quot;</span><span class="content">,</span><span class="char">\&quot;</span><span class="content">87397208</span><span class="char">\&quot;</span><span class="content">]</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">schema</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">table</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">stock</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">txId</span><span class="delimiter">&quot;</span></span>: <span class="integer">402087</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">lsn</span><span class="delimiter">&quot;</span></span>: <span class="integer">87397208</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">xmin</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">op</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">u</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">ts_ms</span><span class="delimiter">&quot;</span></span>: <span class="integer">1666172978637</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">transaction</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>
}</code></pre> </div> </div> <div class="paragraph"> <p>Don&#8217;t get scared if you feel overwhelmed by the sheer size of this message. Most of the fields are metadata, and they are not relevant to this sample. See <a href="https://debezium.io/documentation/reference/1.9/connectors/postgresql.html#postgresql-events">Debezium documentation</a>, for more details. The important point is that we cannot push the whole JSON message to QuestDB and we do not want all the metadata in QuestDB. We need to extract the <code>payload.after</code> portion of the message and only then push it to QuestDB. This is exactly what the <code>ExtractNewRecordState</code> transform does: It transforms the big message into a smaller one that contains only the <code>payload.after</code> portion of the message. Hence, it is as if the message looked like this:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">8</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">symbol</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">NFLX</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span>: <span class="float">1544.3357414199545</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">last_update</span><span class="delimiter">&quot;</span></span>: <span class="integer">1666172978269856</span>
}</code></pre> </div> </div> <div class="paragraph"> <p>This is the message that we can push to QuestDB. The QuestDB Kafka connector will read this message and write it to the QuestDB table. The QuestDB Kafka connector will also create the QuestDB table if it does not exist. The QuestDB table will have the same schema as the JSON message - where each JSON field will be a column in the QuestDB table.</p> </div> </div> </div> <div class="sect2"> <h3 id="questdb_and_grafana">QuestDB and Grafana</h3> <div class="paragraph"> <p>Once the data is written to QuestDB tables, we can work with the time-series data easier. Since QuestDB is compatible with the PostgreSQL wire protocol, we can use the PostgreSQL data source on Grafana to visualize the data. The preconfigured dashboard is using the following query:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span>
  <span class="error">$</span>__time(<span class="predefined-type">timestamp</span>),
  <span class="predefined">min</span>(price) <span class="keyword">as</span> low,
  <span class="predefined">max</span>(price) <span class="keyword">as</span> high,
  first(price) <span class="keyword">as</span> open,
  last(price) <span class="keyword">as</span> close
<span class="keyword">FROM</span>
  stock
<span class="keyword">WHERE</span>
  <span class="error">$</span>__timeFilter(<span class="predefined-type">timestamp</span>)
  <span class="keyword">and</span> symbol = <span class="string"><span class="delimiter">'</span><span class="content">$Symbol</span><span class="delimiter">'</span></span>
SAMPLE <span class="keyword">BY</span> <span class="error">$</span>Interval ALIGN <span class="keyword">TO</span> CALENDAR;</code></pre> </div> </div> <div class="paragraph"> <p>We have created a system that continuously tracks and stores the latest prices for multiple stocks in a PostgreSQL table. These prices are then fed as events to Kafka through Debezium, which captures every price change. The QuestDB Kafka connector reads these events from Kafka and stores each change as a new row in QuestDB, allowing us to retain a comprehensive history of stock prices. This history can then be analyzed and visualized using tools such as Grafana, as demonstrated by the candle chart.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="next_steps">Next steps</h2> <div class="sectionbody"> <div class="paragraph"> <p>This sample project is a foundational reference architecture to stream data from a relational database into an optimized time series database. For existing projects that are using PostgreSQL, Debezium can be configured to start streaming data to QuestDB and take advantage of time series queries and partitioning. For databases that are also storing raw historical data, adopting Debezium may need some architectural changes. However, this is beneficial as it is an opportunity to improve performance and establish service boundaries between a transactional database and an analytical, time-series database.</p> </div> <div class="paragraph"> <p>This reference architecture can also be extended to configure Kafka Connect to also stream to other data warehouses for long-term storage. After inspecting the data, QuestDB can also be configured to downsample the data for longer term storage or even <a href="https://questdb.io/blog/2022/11/02/data-lifecycle-questdb/">detach partitions to save space</a>.</p> </div> <div class="paragraph"> <p>Give this <a href="https://github.com/questdb/kafka-questdb-connector/issues/new">sample application</a> a try and join the <a href="https://slack.questdb.io/">QuestDB Slack community</a> if you have any questions.</p> </div> </div> </div></div> </div> <div class="well"> <div class="row"> <div class="col-md-8"> <h2>Yitaek Hwang</h2> <p> <span class="bio-size">Yitaek is a Software Engineer at NYDIG and a guest contributor to QuestDB.</span> </p> <p class="bio-size"> <a href="https://github.com/Yitaek"> <i class="icon-github"></i> </a> &nbsp; </p> </div> <div class="col-md-4"> <img alt="" class="img-responsive pull-right portrait" src="/assets/images/yitaek.jpg"/> </div> </div> </div> <ul class="pager pager-blog"> <li class="previous"> <a href="/blog/2022/12/22/debezium-2-1-final-released/" class="previous"> &laquo; Previous</a> </li> <li class="next"><a href="/blog/2023/01/19/debezium-2-2-alpha1-released/">Next &raquo; </a></li> </ul> <div class="row"> <div class="col-md-12"> <hr> <h2>About Debezium</h2> <p> Debezium is an open source distributed platform that turns your existing databases into event streams, so applications can see and respond almost instantly to each committed row-level change in the databases. Debezium is built on top of <a href="http://kafka.apache.org/">Kafka</a> and provides <a href="http://kafka.apache.org/documentation.html#connect">Kafka Connect</a> compatible connectors that monitor specific database management systems. Debezium records the history of data changes in Kafka logs, so your application can be stopped and restarted at any time and can easily consume all of the events it missed while it was not running, ensuring that all events are processed correctly and completely. Debezium is <a href="/license/">open source</a> under the <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache License, Version 2.0</a>. </p> </div> </div> <div class="row"> <div class="col-md-12"> <h2>Get involved</h2> <p> We hope you find Debezium interesting and useful, and want to give it a try. Follow us on Twitter <a href="https://twitter.com/debezium">@debezium</a>, <a href="https://debezium.zulipchat.com/#narrow/stream/302529-users">chat with us on Zulip</a>, or join our <a href="https://groups.google.com/forum/#!forum/debezium">mailing list</a> to talk with the community. All of the code is open source <a href="https://github.com/debezium/">on GitHub</a>, so build the code locally and help us improve ours existing connectors and add even more connectors. If you find problems or have ideas how we can improve Debezium, please let us know or <a href="https://issues.redhat.com/projects/DBZ/issues/">log an issue</a>. </p> </div> </div> <div id="disqus_thread"></div> <script>var disqus_config=function(){this.page.url="https://debezium.io/blog/2023/01/06/change-data-capture-with-questdb-and-debezium/",this.page.identifier="https://debezium.io/blog/2023/01/06/change-data-capture-with-questdb-and-debezium/"};!function(){var e=document,t=e.createElement("script");t.src="https://Debezium.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}();</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> </div> </div> </div> <footer class="container"> <div> <div class="row mr-0 ml-0"> <div class="col-md-5 col-md-offset-1"> <h4>Debezium</h4> <p> &#169; 2023 Debezium Community <br/> <br/> <i class="icon-fire"></i> Mixed with <a href="https://getbootstrap.com/">Bootstrap</a>, baked by <a href="https://jekyllrb.com/">Jekyll</a>. <br/> <i class="icon-flag"></i> Website and docs licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>. <br/> <i class="icon-flag-alt"></i> Code released under <a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache License, v2.0</a>. <br/> <i class="icon-file-alt"></i> <a href="https://www.redhat.com/legal/legal_statement.html" title="Terms">Terms</a> | <a href="https://www.redhat.com/legal/privacy_statement.html" title="Privacy Policy">Privacy</a> </p> <p>Rev: <a target="_blank" href="https://github.com/debezium/debezium.github.io/commit/5a967effce45395a2d7dc4fa90750544d5591356">5a967ef</a> </p> </div> <div class="col-md-3"> <h4>Documentation</h4> <ul class="list-unstyled"> <li><a href="/documentation/reference/stable/features.html" title="Features">Features</a></li> <li> <a href="/documentation/reference/stable/install.html" title="Install">Install</a> </li> <li> <a href="/documentation/reference/stable/architecture.html" title="Architecture">Architecture</a> </li> <li><a href="/documentation/faq/" title="FAQ">FAQ</a></li> <li> <a href="/community/contribute/" title="Contribute">Contribute</a> </li> </ul> </div> <div class="col-md-3"> <h4>Connect</h4> <ul class="list-unstyled"> <li><a href="/blog" title="Blog">Blog</a></li> <li> <a href="https://twitter.com/debezium" title="Twitter">Twitter</a> </li> <li><a href="https://github.com/debezium" title="GitHub">GitHub</a></li> <li><a href="https://debezium.zulipchat.com/#narrow/stream/302529-users" title="Chat">Chat</a></li> <li> <a href="https://groups.google.com/forum/#!forum/debezium" title="Google Groups">Google Groups</a> </li> <li> <a href="https://stackoverflow.com/questions/tagged/debezium" title="StackOverflow">StackOverflow</a> </li> </ul> </div> </div> </div> </footer> <div class="container" id="companyfooter"> <div class="redhatlogo"> <a href="https://www.redhat.com/"> <img src="/assets/images/Logo-Red_Hat-Sponsored_By-B-Standard-RGB.svg"/> </a> </div> </div> </div> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-76464546-1"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-76464546-1");</script> <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script> <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script> <script type="text/javascript" src="/assets/javascript/vanilla-back-to-top.min.js"></script> <script type="text/javascript" src="/assets/javascript/highlight.min.js"></script> <script>addBackToTop({scrollDuration:400}),hljs.initHighlightingOnLoad();</script> </body> </html>