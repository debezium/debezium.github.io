<!DOCTYPE html> <html> <head> <title>Streamlined Performance: Debezium JDBC connector batch support</title> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="description" content="Debezium is an open source distributed platform for change data capture. Start it up, point it at your databases, and your apps can start responding to all of the inserts, updates, and deletes that other apps commit to your databases. Debezium is durable and fast, so your apps can respond quickly and never miss an event, even when things go wrong."> <meta content="Debezium" property="og:site_name"> <meta content="Streamlined Performance: Debezium JDBC connector batch support" property="og:title"> <meta content="https://debezium.io/assets/images/color_black_debezium_type_1200px.png" property="og:image" name="image"> <meta property="og:description" content="Debezium is an open source distributed platform for change data capture. Start it up, point it at your databases, and your apps can start responding to all of the inserts, updates, and deletes that other apps commit to your databases. Debezium is durable and fast, so your apps can respond quickly and never miss an event, even when things go wrong."> <meta property="og:url" content="https://debezium.io/blog/2023/12/20/JDBC-sink-connector-batch-support/"> <meta name="twitter:site" content="@debezium"> <meta name="twitter:title" content="Streamlined Performance: Debezium JDBC connector batch support"> <meta name="twitter:creator" content="@mfvitale"> <meta name="twitter:description" content="Debezium is an open source distributed platform for change data capture. Start it up, point it at your databases, and your apps can start responding to all of the inserts, updates, and deletes that other apps commit to your databases. Debezium is durable and fast, so your apps can respond quickly and never miss an event, even when things go wrong."> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="https://debezium.io/assets/images/color_black_debezium_type_1200px.png"> <meta property="twitter:url" content="https://debezium.io/blog/2023/12/20/JDBC-sink-connector-batch-support/"> <link rel="alternate" type="application/rss+xml" title="Debezium Blog" href="/blog.atom"> <link rel="shortcut icon" type="image/png" href="/favicon.ico"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css"/> <link rel="stylesheet" href="/assets/css/custom.css"/> <link rel="stylesheet" href="/assets/css/highlight.min.css"/> <link rel="stylesheet" href="/assets/css/coderay.css"/> </head> <body class="post"> <div id="rhbar"> <a class="jbdevlogo" href="https://developers.redhat.com"></a> <a class="rhlogo" href="https://www.redhat.com/"></a> </div> <div id> <div class="container" id="content"> <nav class="navbar navbar-inverse navbar-fix"> <div class="container-fluid"> <div class="navbar-header"> <button class="navbar-toggle collapsed border-0" type="button" data-toggle="collapse" data-target="#navigation" aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/"><img class="project-logo" src="/assets/images/color_white_debezium_type_600px.svg" style="height: 32px; margin-right: 5px; margin-top: -5px;"></a> </div> <div class="collapse navbar-collapse collapsed" id="navigation"> <ul class="nav navbar-nav pull-right"> <li> <a href="/documentation/faq" class="">FAQ</a> </li> <li class="item"> <a href="/documentation/" class="">Documentation</a> </li> <li> <a href="/releases/" class="">Releases</a> </li> <li> <a href="/community/" class="">Community</a> </li> <li class="active"> <a href="/blog/" class="active">Blog</a> </li> </ul> </div> </div> </nav> <div class="row post-text-padding row-no-expand"> <div class="col-md-3"><div id="leftdocnav"> <div class="hidden-lg hidden-md hidden-sm"> <button class="navbar-toggle docssubmenu-toggle collapsed" data-target="#docssubmenu" data-toggle="collapse" style=" float: none; background-color: #656565; border-color: #656565; width: 100%; color: #fff; "> Navigation Menu </button> </div> <div class="collapse" id="docssubmenu"> <div class="doc-pills"> <ul class="nav nav-pills nav-stacked"> <li class="item"> <a href="/blog">Home</a> <div class="icon"><span class="icon-home"></span></div> </li> <li class="item"> <a href="/archives">Archive</a> <div class="icon"><span class="icon-arrow-down"></span></div> </li> <li class="item"> <a href="/blog.atom">Feed</a> <div class="icon"><span class="icon-rss"></span></div> </li> </ul> </div> <p></p> <div class="featured-posts"> <div id="#featured" style="margin-bottom: 4px; border-bottom: 1px solid #ccc; font-size: 115%; margin-left: 2px;">Featured Posts</div> <ul style="padding-inline-start: 22px;"> <li style="margin-bottom: 3px;"> <a href="/blog/2024/01/11/Debezium-and-TimescaleDB/" style="font-size: 95%;"> Debezium and TimescaleDB </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2023/12/20/JDBC-sink-connector-batch-support/" style="font-size: 95%;"> Streamlined Performance: Debezium JDBC connector batch support </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2023/10/19/Debezium-Operator-Takes-off-to-the-Clouds/" style="font-size: 95%;"> Debezium Operator Takes off to the Clouds </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2023/10/05/Debezium-JMX-signaling-and-notifications/" style="font-size: 95%;"> Debezium signaling and notifications - Part 3: JMX channel </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2023/09/23/flink-spark-online-learning/" style="font-size: 95%;"> Online machine learning with the data streams from the database </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2023/07/10/custom-http-signaling-notification/" style="font-size: 95%;"> Debezium signaling and notifications - Part 2: Customisation </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2023/06/27/Debezium-signaling-and-notifications/" style="font-size: 95%;"> Debezium signaling and notifications - Part 1 </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2023/05/02/tensorflow-mnist-classification/" style="font-size: 95%;"> Image classification with Debezium and TensorFlow </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2020/11/04/streaming-vitess-at-bolt/" style="font-size: 95%;"> Streaming Vitess at Bolt </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2020/02/10/event-sourcing-vs-cdc/" style="font-size: 95%;"> Distributed Data for Microservices â€” Event Sourcing vs. Change Data Capture </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2019/10/01/audit-logs-with-change-data-capture-and-stream-processing/" style="font-size: 95%;"> Building Audit Logs with Change Data Capture and Stream Processing </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2019/07/12/streaming-cassandra-at-wepay-part-1/" style="font-size: 95%;"> Streaming Cassandra at WePay - Part 1 </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2019/02/19/reliable-microservices-data-exchange-with-the-outbox-pattern/" style="font-size: 95%;"> Reliable Microservices Data Exchange With the Outbox Pattern </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/12/05/automating-cache-invalidation-with-change-data-capture/" style="font-size: 95%;"> Automating Cache Invalidation With Change Data Capture </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/09/20/materializing-aggregate-views-with-hibernate-and-debezium/" style="font-size: 95%;"> Materializing Aggregate Views With Hibernate and Debezium </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/07/19/advantages-of-log-based-change-data-capture/" style="font-size: 95%;"> Five Advantages of Log-Based Change Data Capture </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/03/08/creating-ddd-aggregates-with-debezium-and-kafka-streams/" style="font-size: 95%;"> Creating DDD aggregates with Debezium and Kafka Streams </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/01/17/streaming-to-elasticsearch/" style="font-size: 95%;"> Streaming Data Changes from Your Database to Elasticsearch </a> </li> </ul> </div> <p></p> <p></p> <div class="cloud-tags"> <div id="tags" style="margin-bottom: 4px; border-bottom: 1px solid #ccc; font-size: 115%; margin-left: 2px;"> Tags </div> <div class="tag-cloud"> <span class="site-tag"> <a href="/tag/apache-kafka/" style="font-size: 82%"> apache kafka </a> </span> <span class="site-tag"> <a href="/tag/apache-kafka/" style="font-size: 94%"> apache kafka </a> </span> <span class="site-tag"> <a href="/tag/apicurio/" style="font-size: 82%"> apicurio </a> </span> <span class="site-tag"> <a href="/tag/avro/" style="font-size: 84%"> avro </a> </span> <span class="site-tag"> <a href="/tag/aws/" style="font-size: 82%"> aws </a> </span> <span class="site-tag"> <a href="/tag/batch/" style="font-size: 82%"> batch </a> </span> <span class="site-tag"> <a href="/tag/caassandra/" style="font-size: 86%"> caassandra </a> </span> <span class="site-tag"> <a href="/tag/camel/" style="font-size: 82%"> camel </a> </span> <span class="site-tag"> <a href="/tag/cassandra/" style="font-size: 290%"> cassandra </a> </span> <span class="site-tag"> <a href="/tag/cdc/" style="font-size: 82%"> cdc </a> </span> <span class="site-tag"> <a href="/tag/channels/" style="font-size: 82%"> channels </a> </span> <span class="site-tag"> <a href="/tag/community/" style="font-size: 124%"> community </a> </span> <span class="site-tag"> <a href="/tag/community-stories/" style="font-size: 84%"> community stories </a> </span> <span class="site-tag"> <a href="/tag/connectors/" style="font-size: 82%"> connectors </a> </span> <span class="site-tag"> <a href="/tag/containers/" style="font-size: 82%"> containers </a> </span> <span class="site-tag"> <a href="/tag/cqrs/" style="font-size: 84%"> cqrs </a> </span> <span class="site-tag"> <a href="/tag/custom/" style="font-size: 82%"> custom </a> </span> <span class="site-tag"> <a href="/tag/datalake/" style="font-size: 82%"> datalake </a> </span> <span class="site-tag"> <a href="/tag/db2/" style="font-size: 274%"> db2 </a> </span> <span class="site-tag"> <a href="/tag/ddd/" style="font-size: 82%"> ddd </a> </span> <span class="site-tag"> <a href="/tag/debezium/" style="font-size: 104%"> debezium </a> </span> <span class="site-tag"> <a href="/tag/debezium-server/" style="font-size: 92%"> debezium server </a> </span> <span class="site-tag"> <a href="/tag/debezium-ui/" style="font-size: 90%"> debezium ui </a> </span> <span class="site-tag"> <a href="/tag/deduplication/" style="font-size: 82%"> deduplication </a> </span> <span class="site-tag"> <a href="/tag/discussion/" style="font-size: 114%"> discussion </a> </span> <span class="site-tag"> <a href="/tag/docker/" style="font-size: 186%"> docker </a> </span> <span class="site-tag"> <a href="/tag/elasticsearch/" style="font-size: 82%"> elasticsearch </a> </span> <span class="site-tag"> <a href="/tag/event-sourcing/" style="font-size: 82%"> event sourcing </a> </span> <span class="site-tag"> <a href="/tag/exactly-once-semantics/" style="font-size: 82%"> exactly once semantics </a> </span> <span class="site-tag"> <a href="/tag/example/" style="font-size: 88%"> example </a> </span> <span class="site-tag"> <a href="/tag/examples/" style="font-size: 116%"> examples </a> </span> <span class="site-tag"> <a href="/tag/features/" style="font-size: 92%"> features </a> </span> <span class="site-tag"> <a href="/tag/fedora/" style="font-size: 82%"> fedora </a> </span> <span class="site-tag"> <a href="/tag/flink/" style="font-size: 82%"> flink </a> </span> <span class="site-tag"> <a href="/tag/hiring/" style="font-size: 84%"> hiring </a> </span> <span class="site-tag"> <a href="/tag/ibmi/" style="font-size: 98%"> ibmi </a> </span> <span class="site-tag"> <a href="/tag/iceberg/" style="font-size: 82%"> iceberg </a> </span> <span class="site-tag"> <a href="/tag/informix/" style="font-size: 108%"> informix </a> </span> <span class="site-tag"> <a href="/tag/integration/" style="font-size: 86%"> integration </a> </span> <span class="site-tag"> <a href="/tag/introduction/" style="font-size: 84%"> introduction </a> </span> <span class="site-tag"> <a href="/tag/jaeger/" style="font-size: 82%"> jaeger </a> </span> <span class="site-tag"> <a href="/tag/jdbc/" style="font-size: 110%"> jdbc </a> </span> <span class="site-tag"> <a href="/tag/json/" style="font-size: 82%"> json </a> </span> <span class="site-tag"> <a href="/tag/kafka/" style="font-size: 94%"> kafka </a> </span> <span class="site-tag"> <a href="/tag/kafka-streams/" style="font-size: 82%"> kafka streams </a> </span> <span class="site-tag"> <a href="/tag/kafka-streams/" style="font-size: 86%"> kafka streams </a> </span> <span class="site-tag"> <a href="/tag/kogito/" style="font-size: 82%"> kogito </a> </span> <span class="site-tag"> <a href="/tag/ksql/" style="font-size: 82%"> ksql </a> </span> <span class="site-tag"> <a href="/tag/kubernetes/" style="font-size: 84%"> kubernetes </a> </span> <span class="site-tag"> <a href="/tag/lakehouse/" style="font-size: 82%"> lakehouse </a> </span> <span class="site-tag"> <a href="/tag/machine-learning/" style="font-size: 84%"> machine learning </a> </span> <span class="site-tag"> <a href="/tag/mariadb/" style="font-size: 106%"> mariadb </a> </span> <span class="site-tag"> <a href="/tag/microservices/" style="font-size: 84%"> microservices </a> </span> <span class="site-tag"> <a href="/tag/mongo/" style="font-size: 86%"> mongo </a> </span> <span class="site-tag"> <a href="/tag/mongodb/" style="font-size: 292%"> mongodb </a> </span> <span class="site-tag"> <a href="/tag/mysql/" style="font-size: 428%"> mysql </a> </span> <span class="site-tag"> <a href="/tag/news/" style="font-size: 112%"> news </a> </span> <span class="site-tag"> <a href="/tag/newsletter/" style="font-size: 88%"> newsletter </a> </span> <span class="site-tag"> <a href="/tag/notifications/" style="font-size: 86%"> notifications </a> </span> <span class="site-tag"> <a href="/tag/online-learning/" style="font-size: 82%"> online learning </a> </span> <span class="site-tag"> <a href="/tag/operator/" style="font-size: 82%"> operator </a> </span> <span class="site-tag"> <a href="/tag/oracle/" style="font-size: 324%"> oracle </a> </span> <span class="site-tag"> <a href="/tag/outbox/" style="font-size: 262%"> outbox </a> </span> <span class="site-tag"> <a href="/tag/performance/" style="font-size: 82%"> performance </a> </span> <span class="site-tag"> <a href="/tag/postgres/" style="font-size: 398%"> postgres </a> </span> <span class="site-tag"> <a href="/tag/presentation/" style="font-size: 84%"> presentation </a> </span> <span class="site-tag"> <a href="/tag/production/" style="font-size: 82%"> production </a> </span> <span class="site-tag"> <a href="/tag/quarkus/" style="font-size: 92%"> quarkus </a> </span> <span class="site-tag"> <a href="/tag/questdb/" style="font-size: 82%"> questdb </a> </span> <span class="site-tag"> <a href="/tag/rds/" style="font-size: 84%"> rds </a> </span> <span class="site-tag"> <a href="/tag/releases/" style="font-size: 410%"> releases </a> </span> <span class="site-tag"> <a href="/tag/schema/" style="font-size: 82%"> schema </a> </span> <span class="site-tag"> <a href="/tag/scylla/" style="font-size: 82%"> scylla </a> </span> <span class="site-tag"> <a href="/tag/secrets/" style="font-size: 82%"> secrets </a> </span> <span class="site-tag"> <a href="/tag/sentry/" style="font-size: 82%"> sentry </a> </span> <span class="site-tag"> <a href="/tag/serialization/" style="font-size: 82%"> serialization </a> </span> <span class="site-tag"> <a href="/tag/signaling/" style="font-size: 86%"> signaling </a> </span> <span class="site-tag"> <a href="/tag/smt/" style="font-size: 84%"> smt </a> </span> <span class="site-tag"> <a href="/tag/snapshots/" style="font-size: 84%"> snapshots </a> </span> <span class="site-tag"> <a href="/tag/spanner/" style="font-size: 150%"> spanner </a> </span> <span class="site-tag"> <a href="/tag/spark/" style="font-size: 82%"> spark </a> </span> <span class="site-tag"> <a href="/tag/sql/" style="font-size: 84%"> sql </a> </span> <span class="site-tag"> <a href="/tag/sqlserver/" style="font-size: 338%"> sqlserver </a> </span> <span class="site-tag"> <a href="/tag/tensorflow/" style="font-size: 82%"> tensorflow </a> </span> <span class="site-tag"> <a href="/tag/testcontainers/" style="font-size: 88%"> testcontainers </a> </span> <span class="site-tag"> <a href="/tag/tests/" style="font-size: 82%"> tests </a> </span> <span class="site-tag"> <a href="/tag/time-series/" style="font-size: 82%"> time series </a> </span> <span class="site-tag"> <a href="/tag/timescaledb/" style="font-size: 82%"> timescaledb </a> </span> <span class="site-tag"> <a href="/tag/topics/" style="font-size: 82%"> topics </a> </span> <span class="site-tag"> <a href="/tag/tracing/" style="font-size: 82%"> tracing </a> </span> <span class="site-tag"> <a href="/tag/transactions/" style="font-size: 82%"> transactions </a> </span> <span class="site-tag"> <a href="/tag/vagrant/" style="font-size: 82%"> vagrant </a> </span> <span class="site-tag"> <a href="/tag/vitess/" style="font-size: 254%"> vitess </a> </span> <span class="site-tag"> <a href="/tag/website/" style="font-size: 84%"> website </a> </span> </div> </div> </div> </div> </div> <div class="col-md-9"> <div class="post"> <div class="row" style="margin-left: 0; margin-right: 0; margin-bottom: 10px"> <div class="col-sm-12" style="padding-left: 0px"> <div style="display: table-cell; vertical-align: top"> <div style=" width: 72px; border: 1px solid #ccc; padding: 3px; display: inline-block; "> <img src="/assets/images/mario.jpg" style="width: 64px;"> </div> </div> <div style="display: table-cell; vertical-align: top"> <div style="margin-left: 8px"> <span class="hidden-sm hidden-xs" style="font-size: 2.75rem; line-height: 1"> <a href="/blog/2023/12/20/JDBC-sink-connector-batch-support/">Streamlined Performance: Debezium JDBC connector batch support</a> </span> <span class="hidden-md hidden-lg" style="font-size: 2rem; line-height: 1"> <a href="/blog/2023/12/20/JDBC-sink-connector-batch-support/">Streamlined Performance: Debezium JDBC connector batch support</a> </span> <div class="byline" style="line-height: 1"> <em> December 20, 2023 by </em> <em> Fiore Mario Vitale </em> <div class="hidden-xs" style="margin-top: 5px"> <a class="label label-info hidden-sm hidden-xs" href="/tag/debezium/">debezium</a> <a class="label label-info hidden-sm hidden-xs" href="/tag/features/">features</a> <a class="label label-info hidden-sm hidden-xs" href="/tag/jdbc/">jdbc</a> <a class="label label-info hidden-sm hidden-xs" href="/tag/batch/">batch</a> <a class="label label-info hidden-sm hidden-xs" href="/tag/performance/">performance</a> </div> </div> </div> </div> </div> </div> <div class="grid__item width-12-12"><div class="paragraph"> <p>In the realm of data streaming optimization, even subtle improvements can make a significant impact. This article focuses on one such refinement: the introduction of batch support in Debezium&#8217;s JDBC connector. We&#8217;ll guide you through the process of enabling batches and share the practical outcomes of our performance testing.</p> </div> <div class="paragraph"> <p></p> </div> <div class="sect1"> <h2 id="configuring_batches">Configuring batches</h2> <div class="sectionbody"> <div class="paragraph"> <p>Since our previous releases were primarily focused on core functionalities, our latest release is dedicated to addressing the main pain point associated with the connector: performance.</p> </div> <div class="paragraph"> <p>The goal was to improve throughput in terms of events processed per second (EPS). To achieve this, we revisited the connector to enable the processing of batches of events.</p> </div> <div class="paragraph"> <p>You can now fine-tune the size of the batch using a new property: <code>batch.size</code>.</p> </div> <div class="paragraph"> <p>The <code>batch.size</code> property defines the number of records to be <strong>attempted</strong> for batching into the destination table. However, it&#8217;s crucial to note that the actual size of processed records is contingent upon the <code>consumer.max.poll.records</code> property of the Kafka Connect worker.</p> </div> <div class="paragraph"> <p>It&#8217;s important to be aware that if you set <code>consumer.max.poll.records</code> in the Connect worker properties to a value lower than <code>batch.size</code>, batch processing will be constrained by <code>consumer.max.poll.records</code>, and the intended <code>batch.size</code> may not be achieved.</p> </div> <div class="sect2"> <h3 id="configure_consumer_max_poll_records">Configure consumer max poll records</h3> <div class="paragraph"> <p>If you prefer not to configure the <code>consumer.max.poll.records</code> property globally on the Connect worker, you have the option to set the underlying consumer&#8217;s <code>max.poll.records</code> for a specific connector using <code>consumer.override.max.poll.records</code> in the connector configuration.</p> </div> <div class="paragraph"> <p>To enable per-connector configuration properties and override the default worker properties, add the following parameter to the worker properties file: <code>connector.client.config.override.policy</code> <a href="https://docs.confluent.io/platform/current/connect/references/allconfigs.html#override-the-worker-configuration">(see override-the-worker-configuration)</a>.</p> </div> <div class="paragraph"> <p>This property defines which configurations can be overridden by the connector. The default implementation is <code>All</code>, but other possible policies include <code>None</code> and <code>Principal</code>.</p> </div> <div class="paragraph"> <p>When <code>connector.client.config.override.policy=All</code>, each connector belonging to the worker is permitted to override the worker configuration. You can now utilize the following override prefixes for sink connector configurations: <code>consumer.override.&lt;sink-configuration-property&gt;</code>.</p> </div> <div class="paragraph"> <p>It&#8217;s worth noting that even if you set <code>max.poll.records</code> (with the default value of 500), you may receive fewer records. This is due to other properties that can impact record fetching from the topic/partitions.</p> </div> <div class="paragraph"> <p><strong>Name</strong>: <a href="https://kafka.apache.org/documentation/#consumerconfigs_fetch.max.bytes">fetch.max.bytes</a><br> <strong>Default</strong>: 52428800 (52MB)<br></p> </div> <div class="paragraph"> <p><strong>Name</strong>: <a href="https://kafka.apache.org/documentation/#consumerconfigs_max.partition.fetch.bytes">max.partition.fetch.bytes</a><br> <strong>Default</strong>: 1048576 (1MB)<br></p> </div> <div class="paragraph"> <p><strong>Name</strong>: <a href="https://kafka.apache.org/documentation/#brokerconfigs_message.max.bytes">message.max.bytes</a><br> <strong>Default</strong>: 1048588 (1MB)<br></p> </div> <div class="paragraph"> <p><strong>Name</strong>: <a href="https://kafka.apache.org/documentation/#topicconfigs_max.message.bytes">max.message.bytes</a><br> <strong>Default</strong>: 1048588 (1MB)<br></p> </div> <div class="paragraph"> <p>So adjust these based on your expected payload size to reach the desired number of poll records.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="results_from_performance_testing">Results from performance testing</h2> <div class="sectionbody"> <div class="paragraph"> <p>The objective of the performance tests was to provide a sense of how batch support improved the EPS. Therefore, these numbers do not reflect any real scenario but rather showcase relative improvements compared to the old JDBC version.</p> </div> <div class="sect2"> <h3 id="configuration_used_for_the_tests">Configuration used for the tests</h3> <div class="paragraph"> <p>All tests executed on a <strong>ThinkPad T14s Gen 2i</strong></p> </div> <div class="paragraph"> <p><strong>CPU</strong>: Intel&#174; Core&#8482; i7-1185G7 @ 3.00GHz (8 cores)<br> <strong>RAM</strong>: 32GB<br> <strong>Disk</strong>: 512GB NVMe<br></p> </div> <div class="paragraph"> <p>All required components (Kafka, Connect, Zookeeper, etc.) inside docker containers.</p> </div> <div class="paragraph"> <p>The table used for the test has the following structure:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> <span class="type">TABLE</span> <span class="string"><span class="delimiter">`</span><span class="content">aviation</span><span class="delimiter">`</span></span> (
  <span class="string"><span class="delimiter">`</span><span class="content">id</span><span class="delimiter">`</span></span> <span class="predefined-type">int</span> <span class="keyword">NOT</span> <span class="predefined-constant">NULL</span>,
  <span class="string"><span class="delimiter">`</span><span class="content">aircraft</span><span class="delimiter">`</span></span> <span class="predefined-type">longtext</span>,
  <span class="string"><span class="delimiter">`</span><span class="content">airline</span><span class="delimiter">`</span></span> <span class="predefined-type">longtext</span>,
  <span class="string"><span class="delimiter">`</span><span class="content">passengers</span><span class="delimiter">`</span></span> <span class="predefined-type">int</span> <span class="directive">DEFAULT</span> <span class="predefined-constant">NULL</span>,
  <span class="string"><span class="delimiter">`</span><span class="content">airport</span><span class="delimiter">`</span></span> <span class="predefined-type">longtext</span>,
  <span class="string"><span class="delimiter">`</span><span class="content">flight</span><span class="delimiter">`</span></span> <span class="predefined-type">longtext</span>,
  <span class="string"><span class="delimiter">`</span><span class="content">metar</span><span class="delimiter">`</span></span> <span class="predefined-type">longtext</span>,
  <span class="string"><span class="delimiter">`</span><span class="content">flight_distance</span><span class="delimiter">`</span></span> <span class="predefined-type">double</span> <span class="directive">DEFAULT</span> <span class="predefined-constant">NULL</span>
)</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="test_plan">Test plan</h3> <div class="paragraph"> <p>We planned to execute these tests:</p> </div> <div class="ulist"> <ul> <li> <p>100K events from single table</p> <div class="ulist"> <ul> <li> <p>MySQL batch vs without batch</p> </li> </ul> </div> </li> <li> <p>100K events from three different table</p> <div class="ulist"> <ul> <li> <p>MySQL batch vs without batch</p> </li> </ul> </div> </li> <li> <p>1M events from single table</p> <div class="ulist"> <ul> <li> <p>MySQL batch with batch size: 500, 1000, 5000, 10000 vs without batch</p> </li> <li> <p>MySQL batch with batch size: 500, 1000, 5000, 10000 with JSONConverter</p> </li> <li> <p>MySQL batch with batch size: 500, 1000, 5000, 10000 with Avro</p> </li> <li> <p>MySQL batch with batch size: 500, 1000, 5000, 10000 with Avro and no index on destination table</p> </li> </ul> </div> </li> </ul> </div> <div class="imageblock centered-image"> <div class="content"> <img src="/assets/images/2023-12-06-JDBC-sink-connector-batch-support/100k-batch-no-batch.png" alt="100k batch no batch"> </div> <div class="title">Figure 1. &#160;</div> </div> <div class="paragraph"> <p><em>Figure 1</em> illustrates the total execution time required to process 100,000 events from a single table, comparing MySQL connector with and without the batch support.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="paragraph"> <p>Despite the default values being set to <code>500</code> for both <code>batch.size</code> and <code>consumer.max.poll.records</code>, the observed actual size was reduced to <code>337</code> records due to payload size considerations.</p> </div> </td> </tr> </table> </div> <div class="paragraph"> <p>We can observe, as expected, that the Debezium JDBC connector with batch support is faster.</p> </div> <div class="imageblock centered-image"> <div class="content"> <img src="/assets/images/2023-12-06-JDBC-sink-connector-batch-support/100k-3-tables.png" alt="100k 3 tables"> </div> <div class="title">Figure 2. &#160;</div> </div> <div class="paragraph"> <p>In <em>Figure 2</em>, we observe that splitting 100,000 events into three tables does not impact the results. The Debezium JDBC connector with batch support remains faster compared to the non-batch version.</p> </div> <div class="imageblock centered-image"> <div class="content"> <img src="/assets/images/2023-12-06-JDBC-sink-connector-batch-support/1M-batch-no-batch.png" alt="1M batch no batch"> </div> <div class="title">Figure 3. &#160;</div> </div> <div class="paragraph"> <p>In <em>Figure 3</em>, it is evident that the performance gain becomes more pronounced with 1,000,000 events. The Debezium JDBC connector with batch support took approximately 7 minutes to insert all events, with an average throughput of 2300 eps, while the process without batch support took 570 minutes (9.5 hours). Therefore, the Debezium JDBC connector with batch support is 79 times faster than the version without batch support.</p> </div> <div class="imageblock centered-image"> <div class="content"> <img src="/assets/images/2023-12-06-JDBC-sink-connector-batch-support/1M-different-batch-size-json.png" alt="1M different batch size json"> </div> <div class="title">Figure 4. &#160;</div> </div> <div class="paragraph"> <p>In <em>Figure 4</em>, we observe the behavior of the Debezium JDBC connector using the <code>org.apache.kafka.connect.json.JsonConverter</code> converter and writing to MySQL with different <code>batch.size</code> settings. While the initial differences are noticeable, it becomes apparent that the throughput continues to slow down. On average, all the <code>batch.size</code> configurations take about 7 minutes to process all events.</p> </div> <div class="paragraph"> <p>This raised a concern for us. After conducting a thorough analysis (profiling), we identified another issue: event deserialization. With high probability, this was the cause of the non-scalability of <code>batch.size</code> settings.</p> </div> <div class="paragraph"> <p>Although serialization improved scalability, we still lack an answer regarding the slowdown of EPS during the test run. One hypothesis could involve a certain type of buffer somewhere.</p> </div> <div class="imageblock centered-image"> <div class="content"> <img src="/assets/images/2023-12-06-JDBC-sink-connector-batch-support/1M-different-batch-size-avro.png" alt="1M different batch size avro"> </div> <div class="title">Figure 5. &#160;</div> </div> <div class="paragraph"> <p>We then conducted experiments with Avro, and as depicted in <em>Figure 5</em>, the results show a significant improvement. As expected, processing 1,000,000 events with <code>batch.size=500</code> is slower than with <code>batch.size=10000</code>. Notably, in our test configuration, the optimal value for <code>batch.size</code> is 1000, resulting in the fastest processing time.</p> </div> <div class="paragraph"> <p>Although the results are better compared to JSON, there is still some performance degradation.</p> </div> <div class="paragraph"> <p>To identify potential bottlenecks in the code, we added some metrics and found that the majority of time was spent executing batch statements on the database.</p> </div> <div class="paragraph"> <p>Further investigation revealed that our table had an index defined on the primary key, which was slowing down the inserts.</p> </div> <div class="imageblock centered-image"> <div class="content"> <img src="/assets/images/2023-12-06-JDBC-sink-connector-batch-support/1M-different-batch-size-avro-no-index.png" alt="1M different batch size avro no index"> </div> <div class="title">Figure 6. &#160;</div> </div> <div class="paragraph"> <p>in <em>Figure 6</em> you can see the improved performance with Avro and without primary key index. It is also evident the performance boost with a high value of <code>batch.size</code>.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="conclusion">Conclusion</h2> <div class="sectionbody"> <div class="paragraph"> <p>We&#8217;ve explored how adjusting the <code>batch.size</code> can enhance the performance of the Debezium JDBC connector and discussed the proper configuration for maximizing its benefits. Equally crucial is adhering to performance tips and general guidelines for efficient inserts tailored to your specific database.</p> </div> <div class="paragraph"> <p>Here are a few examples:</p> </div> <div class="ulist"> <ul> <li> <p><a href="https://dev.mysql.com/doc/refman/8.0/en/insert-optimization.html">MySQL - Optimizing INSERT Statements</a></p> </li> <li> <p><a href="https://dev.mysql.com/doc/connectors/en/connector-j-connp-props-performance-extensions.html">MySQL - Performance extensions</a></p> </li> <li> <p><a href="https://www.postgresql.org/docs/current/populate.html">PostgreSQL - Populating a Database</a></p> </li> </ul> </div> <div class="paragraph"> <p>While some settings may be specific to certain databases, several general principles apply across the majority of them.</p> </div> </div> </div></div> </div> <div class="well"> <div class="row"> <div class="col-md-8"> <h2>Fiore Mario Vitale</h2> <p> <span class="bio-size">Mario is a Senior Software Engineer at Red Hat. He lives in Italy.</span> </p> <p class="bio-size"> <a href="https://github.com/mfvitale"> <i class="icon-github"></i> </a> &nbsp; <a href="https://www.linkedin.com/in/mfvitale"> <i class="icon-linkedin"></i> </a> &nbsp; </p> </div> <div class="col-md-4"> <img alt="" class="img-responsive pull-right portrait" src="/assets/images/mario.jpg"/> </div> </div> </div> <ul class="pager pager-blog"> <li class="previous"> <a href="/blog/2023/12/14/debezium-2-5-cr1-released/" class="previous"> &laquo; Previous</a> </li> <li class="next"><a href="/blog/2023/12/21/debezium-2-5-final-released/">Next &raquo; </a></li> </ul> <div class="row"> <div class="col-md-12"> <hr> <h2>About Debezium</h2> <p> Debezium is an open source distributed platform that turns your existing databases into event streams, so applications can see and respond almost instantly to each committed row-level change in the databases. Debezium is built on top of <a href="http://kafka.apache.org/">Kafka</a> and provides <a href="http://kafka.apache.org/documentation.html#connect">Kafka Connect</a> compatible connectors that monitor specific database management systems. Debezium records the history of data changes in Kafka logs, so your application can be stopped and restarted at any time and can easily consume all of the events it missed while it was not running, ensuring that all events are processed correctly and completely. Debezium is <a href="/license/">open source</a> under the <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache License, Version 2.0</a>. </p> </div> </div> <div class="row"> <div class="col-md-12"> <h2>Get involved</h2> <p> We hope you find Debezium interesting and useful, and want to give it a try. Follow us on Twitter <a href="https://twitter.com/debezium">@debezium</a>, <a href="https://debezium.zulipchat.com/#narrow/stream/302529-users">chat with us on Zulip</a>, or join our <a href="https://groups.google.com/forum/#!forum/debezium">mailing list</a> to talk with the community. All of the code is open source <a href="https://github.com/debezium/">on GitHub</a>, so build the code locally and help us improve ours existing connectors and add even more connectors. If you find problems or have ideas how we can improve Debezium, please let us know or <a href="https://issues.redhat.com/projects/DBZ/issues/">log an issue</a>. </p> </div> </div> <div id="disqus_thread"></div> <script>var disqus_config=function(){this.page.url="https://debezium.io/blog/2023/12/20/JDBC-sink-connector-batch-support/",this.page.identifier="https://debezium.io/blog/2023/12/20/JDBC-sink-connector-batch-support/"};!function(){var t=document,e=t.createElement("script");e.src="https://Debezium.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}();</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> </div> </div> </div> <footer class="container"> <div> <div class="row mr-0 ml-0"> <div class="col-md-5 col-md-offset-1"> <h4>Debezium</h4> <p> &#169; 2024 Debezium Community <br/> <br/> <i class="icon-fire"></i> Mixed with <a href="https://getbootstrap.com/">Bootstrap</a>, baked by <a href="https://jekyllrb.com/">Jekyll</a>. <br/> <i class="icon-flag"></i> Website and docs licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>. <br/> <i class="icon-flag-alt"></i> Code released under <a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache License, v2.0</a>. <br/> <i class="icon-file-alt"></i> <a href="https://www.redhat.com/legal/legal_statement.html" title="Terms">Terms</a> | <a href="https://www.redhat.com/legal/privacy_statement.html" title="Privacy Policy">Privacy</a> </p> <p>Rev: <a target="_blank" href="https://github.com/debezium/debezium.github.io/commit/ddd6eafef0bf899319ecf3c47860ca6153690c7b">ddd6eaf</a> </p> </div> <div class="col-md-3"> <h4>Documentation</h4> <ul class="list-unstyled"> <li><a href="/documentation/reference/stable/features.html" title="Features">Features</a></li> <li> <a href="/documentation/reference/stable/install.html" title="Install">Install</a> </li> <li> <a href="/documentation/reference/stable/architecture.html" title="Architecture">Architecture</a> </li> <li><a href="/documentation/faq/" title="FAQ">FAQ</a></li> <li> <a href="/community/contribute/" title="Contribute">Contribute</a> </li> </ul> </div> <div class="col-md-3"> <h4>Connect</h4> <ul class="list-unstyled"> <li><a href="/blog" title="Blog">Blog</a></li> <li> <a href="https://twitter.com/debezium" title="Twitter">Twitter</a> </li> <li><a href="https://github.com/debezium" title="GitHub">GitHub</a></li> <li><a href="https://debezium.zulipchat.com/#narrow/stream/302529-users" title="Chat">Chat</a></li> <li> <a href="https://groups.google.com/forum/#!forum/debezium" title="Google Groups">Google Groups</a> </li> <li> <a href="https://stackoverflow.com/questions/tagged/debezium" title="StackOverflow">StackOverflow</a> </li> </ul> </div> </div> </div> </footer> <div class="container" id="companyfooter"> <div class="redhatlogo"> <a href="https://www.redhat.com/"> <img src="/assets/images/Logo-Red_Hat-Sponsored_By-B-Standard-RGB.svg"/> </a> </div> </div> </div> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-76464546-1"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-76464546-1");</script> <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script> <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script> <script type="text/javascript" src="/assets/javascript/vanilla-back-to-top.min.js"></script> <script type="text/javascript" src="/assets/javascript/highlight.min.js"></script> <script>addBackToTop({scrollDuration:400}),hljs.initHighlightingOnLoad();</script> </body> </html>