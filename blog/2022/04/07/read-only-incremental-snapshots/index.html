<!DOCTYPE html> <html> <head> <title>Read-only Incremental Snapshots for MySQL</title> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="description" content="Debezium is an open source distributed platform for change data capture. Start it up, point it at your databases, and your apps can start responding to all of the inserts, updates, and deletes that other apps commit to your databases. Debezium is durable and fast, so your apps can respond quickly and never miss an event, even when things go wrong."> <meta content="Debezium" property="og:site_name"> <meta content="Read-only Incremental Snapshots for MySQL" property="og:title"> <meta content="https://debezium.io/assets/images/color_black_debezium_type_1200px.png" property="og:image" name="image"> <meta property="og:description" content="Debezium is an open source distributed platform for change data capture. Start it up, point it at your databases, and your apps can start responding to all of the inserts, updates, and deletes that other apps commit to your databases. Debezium is durable and fast, so your apps can respond quickly and never miss an event, even when things go wrong."> <meta property="og:url" content="https://debezium.io/blog/2022/04/07/read-only-incremental-snapshots/"> <meta name="twitter:site" content="@debezium"> <meta name="twitter:title" content="Read-only Incremental Snapshots for MySQL"> <meta name="twitter:creator" content="@kgalieva"> <meta name="twitter:description" content="Debezium is an open source distributed platform for change data capture. Start it up, point it at your databases, and your apps can start responding to all of the inserts, updates, and deletes that other apps commit to your databases. Debezium is durable and fast, so your apps can respond quickly and never miss an event, even when things go wrong."> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="https://debezium.io/assets/images/color_black_debezium_type_1200px.png"> <meta property="twitter:url" content="https://debezium.io/blog/2022/04/07/read-only-incremental-snapshots/"> <link rel="alternate" type="application/rss+xml" title="Debezium Blog" href="/blog.atom"> <link rel="shortcut icon" type="image/png" href="/favicon.ico"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css"/> <link rel="stylesheet" href="/assets/css/custom.css"/> <link rel="stylesheet" href="/assets/css/highlight.min.css"/> <link rel="stylesheet" href="/assets/css/coderay.css"/> </head> <body class="post"> <div id="rhbar"> <a class="jbdevlogo" href="https://developers.redhat.com"></a> <a class="rhlogo" href="https://www.redhat.com/"></a> </div> <div id> <div class="container" id="content"> <nav class="navbar navbar-inverse navbar-fix"> <div class="container-fluid"> <div class="navbar-header"> <button class="navbar-toggle collapsed border-0" type="button" data-toggle="collapse" data-target="#navigation" aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/"><img class="project-logo" src="/assets/images/color_white_debezium_type_600px.svg" style="height: 32px; margin-right: 5px; margin-top: -5px;"></a> </div> <div class="collapse navbar-collapse collapsed" id="navigation"> <ul class="nav navbar-nav pull-right"> <li> <a href="/documentation/faq" class="">FAQ</a> </li> <li class="item"> <a href="/documentation/" class="">Documentation</a> </li> <li> <a href="/releases/" class="">Releases</a> </li> <li> <a href="/community/" class="">Community</a> </li> <li class="active"> <a href="/blog/" class="active">Blog</a> </li> </ul> </div> </div> </nav> <div class="row post-text-padding row-no-expand"> <div class="col-md-3"><div id="leftdocnav"> <div class="hidden-lg hidden-md hidden-sm"> <button class="navbar-toggle docssubmenu-toggle collapsed" data-target="#docssubmenu" data-toggle="collapse" style=" float: none; background-color: #656565; border-color: #656565; width: 100%; color: #fff; "> Navigation Menu </button> </div> <div class="collapse" id="docssubmenu"> <div class="doc-pills"> <ul class="nav nav-pills nav-stacked"> <li class="item"> <a href="/blog">Home</a> <div class="icon"><span class="icon-home"></span></div> </li> <li class="item"> <a href="/archives">Archive</a> <div class="icon"><span class="icon-arrow-down"></span></div> </li> <li class="item"> <a href="/blog.atom">Feed</a> <div class="icon"><span class="icon-rss"></span></div> </li> </ul> </div> <p></p> <div class="featured-posts"> <div id="#featured" style="margin-bottom: 4px; border-bottom: 1px solid #ccc; font-size: 115%; margin-left: 2px;">Featured Posts</div> <ul style="padding-inline-start: 22px;"> <li style="margin-bottom: 3px;"> <a href="/blog/2023/10/19/Debezium-Operator-Takes-off-to-the-Clouds/" style="font-size: 95%;"> Debezium Operator Takes off to the Clouds </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2023/10/05/Debezium-JMX-signaling-and-notifications/" style="font-size: 95%;"> Debezium signaling and notifications - Part 3: JMX channel </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2023/09/23/flink-spark-online-learning/" style="font-size: 95%;"> Online machine learning with the data streams from the database </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2023/07/10/custom-http-signaling-notification/" style="font-size: 95%;"> Debezium signaling and notifications - Part 2: Customisation </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2023/06/27/Debezium-signaling-and-notifications/" style="font-size: 95%;"> Debezium signaling and notifications - Part 1 </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2023/05/02/tensorflow-mnist-classification/" style="font-size: 95%;"> Image classification with Debezium and TensorFlow </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2020/11/04/streaming-vitess-at-bolt/" style="font-size: 95%;"> Streaming Vitess at Bolt </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2020/02/10/event-sourcing-vs-cdc/" style="font-size: 95%;"> Distributed Data for Microservices — Event Sourcing vs. Change Data Capture </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2019/10/01/audit-logs-with-change-data-capture-and-stream-processing/" style="font-size: 95%;"> Building Audit Logs with Change Data Capture and Stream Processing </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2019/07/12/streaming-cassandra-at-wepay-part-1/" style="font-size: 95%;"> Streaming Cassandra at WePay - Part 1 </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2019/02/19/reliable-microservices-data-exchange-with-the-outbox-pattern/" style="font-size: 95%;"> Reliable Microservices Data Exchange With the Outbox Pattern </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/12/05/automating-cache-invalidation-with-change-data-capture/" style="font-size: 95%;"> Automating Cache Invalidation With Change Data Capture </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/09/20/materializing-aggregate-views-with-hibernate-and-debezium/" style="font-size: 95%;"> Materializing Aggregate Views With Hibernate and Debezium </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/07/19/advantages-of-log-based-change-data-capture/" style="font-size: 95%;"> Five Advantages of Log-Based Change Data Capture </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/03/08/creating-ddd-aggregates-with-debezium-and-kafka-streams/" style="font-size: 95%;"> Creating DDD aggregates with Debezium and Kafka Streams </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/01/17/streaming-to-elasticsearch/" style="font-size: 95%;"> Streaming Data Changes from Your Database to Elasticsearch </a> </li> </ul> </div> <p></p> <p></p> <div class="cloud-tags"> <div id="tags" style="margin-bottom: 4px; border-bottom: 1px solid #ccc; font-size: 115%; margin-left: 2px;"> Tags </div> <div class="tag-cloud"> <span class="site-tag"> <a href="/tag/apache-kafka/" style="font-size: 82%"> apache kafka </a> </span> <span class="site-tag"> <a href="/tag/apache-kafka/" style="font-size: 94%"> apache kafka </a> </span> <span class="site-tag"> <a href="/tag/apicurio/" style="font-size: 82%"> apicurio </a> </span> <span class="site-tag"> <a href="/tag/avro/" style="font-size: 84%"> avro </a> </span> <span class="site-tag"> <a href="/tag/aws/" style="font-size: 82%"> aws </a> </span> <span class="site-tag"> <a href="/tag/caassandra/" style="font-size: 86%"> caassandra </a> </span> <span class="site-tag"> <a href="/tag/camel/" style="font-size: 82%"> camel </a> </span> <span class="site-tag"> <a href="/tag/cassandra/" style="font-size: 260%"> cassandra </a> </span> <span class="site-tag"> <a href="/tag/cdc/" style="font-size: 82%"> cdc </a> </span> <span class="site-tag"> <a href="/tag/channels/" style="font-size: 82%"> channels </a> </span> <span class="site-tag"> <a href="/tag/community/" style="font-size: 124%"> community </a> </span> <span class="site-tag"> <a href="/tag/community-stories/" style="font-size: 84%"> community stories </a> </span> <span class="site-tag"> <a href="/tag/containers/" style="font-size: 82%"> containers </a> </span> <span class="site-tag"> <a href="/tag/cqrs/" style="font-size: 84%"> cqrs </a> </span> <span class="site-tag"> <a href="/tag/custom/" style="font-size: 82%"> custom </a> </span> <span class="site-tag"> <a href="/tag/datalake/" style="font-size: 82%"> datalake </a> </span> <span class="site-tag"> <a href="/tag/db2/" style="font-size: 244%"> db2 </a> </span> <span class="site-tag"> <a href="/tag/ddd/" style="font-size: 82%"> ddd </a> </span> <span class="site-tag"> <a href="/tag/debezium/" style="font-size: 100%"> debezium </a> </span> <span class="site-tag"> <a href="/tag/debezium-server/" style="font-size: 92%"> debezium server </a> </span> <span class="site-tag"> <a href="/tag/debezium-ui/" style="font-size: 90%"> debezium ui </a> </span> <span class="site-tag"> <a href="/tag/deduplication/" style="font-size: 82%"> deduplication </a> </span> <span class="site-tag"> <a href="/tag/discussion/" style="font-size: 114%"> discussion </a> </span> <span class="site-tag"> <a href="/tag/docker/" style="font-size: 186%"> docker </a> </span> <span class="site-tag"> <a href="/tag/elasticsearch/" style="font-size: 82%"> elasticsearch </a> </span> <span class="site-tag"> <a href="/tag/event-sourcing/" style="font-size: 82%"> event sourcing </a> </span> <span class="site-tag"> <a href="/tag/exactly-once-semantics/" style="font-size: 82%"> exactly once semantics </a> </span> <span class="site-tag"> <a href="/tag/example/" style="font-size: 88%"> example </a> </span> <span class="site-tag"> <a href="/tag/examples/" style="font-size: 116%"> examples </a> </span> <span class="site-tag"> <a href="/tag/features/" style="font-size: 88%"> features </a> </span> <span class="site-tag"> <a href="/tag/fedora/" style="font-size: 82%"> fedora </a> </span> <span class="site-tag"> <a href="/tag/flink/" style="font-size: 82%"> flink </a> </span> <span class="site-tag"> <a href="/tag/hiring/" style="font-size: 84%"> hiring </a> </span> <span class="site-tag"> <a href="/tag/iceberg/" style="font-size: 82%"> iceberg </a> </span> <span class="site-tag"> <a href="/tag/informix/" style="font-size: 88%"> informix </a> </span> <span class="site-tag"> <a href="/tag/integration/" style="font-size: 86%"> integration </a> </span> <span class="site-tag"> <a href="/tag/introduction/" style="font-size: 84%"> introduction </a> </span> <span class="site-tag"> <a href="/tag/jaeger/" style="font-size: 82%"> jaeger </a> </span> <span class="site-tag"> <a href="/tag/json/" style="font-size: 82%"> json </a> </span> <span class="site-tag"> <a href="/tag/kafka/" style="font-size: 94%"> kafka </a> </span> <span class="site-tag"> <a href="/tag/kafka-streams/" style="font-size: 82%"> kafka streams </a> </span> <span class="site-tag"> <a href="/tag/kafka-streams/" style="font-size: 86%"> kafka streams </a> </span> <span class="site-tag"> <a href="/tag/kogito/" style="font-size: 82%"> kogito </a> </span> <span class="site-tag"> <a href="/tag/ksql/" style="font-size: 82%"> ksql </a> </span> <span class="site-tag"> <a href="/tag/kubernetes/" style="font-size: 84%"> kubernetes </a> </span> <span class="site-tag"> <a href="/tag/lakehouse/" style="font-size: 82%"> lakehouse </a> </span> <span class="site-tag"> <a href="/tag/machine-learning/" style="font-size: 84%"> machine learning </a> </span> <span class="site-tag"> <a href="/tag/mariadb/" style="font-size: 90%"> mariadb </a> </span> <span class="site-tag"> <a href="/tag/microservices/" style="font-size: 84%"> microservices </a> </span> <span class="site-tag"> <a href="/tag/mongo/" style="font-size: 86%"> mongo </a> </span> <span class="site-tag"> <a href="/tag/mongodb/" style="font-size: 262%"> mongodb </a> </span> <span class="site-tag"> <a href="/tag/mysql/" style="font-size: 398%"> mysql </a> </span> <span class="site-tag"> <a href="/tag/news/" style="font-size: 112%"> news </a> </span> <span class="site-tag"> <a href="/tag/newsletter/" style="font-size: 88%"> newsletter </a> </span> <span class="site-tag"> <a href="/tag/notifications/" style="font-size: 86%"> notifications </a> </span> <span class="site-tag"> <a href="/tag/online-learning/" style="font-size: 82%"> online learning </a> </span> <span class="site-tag"> <a href="/tag/operator/" style="font-size: 82%"> operator </a> </span> <span class="site-tag"> <a href="/tag/oracle/" style="font-size: 294%"> oracle </a> </span> <span class="site-tag"> <a href="/tag/outbox/" style="font-size: 232%"> outbox </a> </span> <span class="site-tag"> <a href="/tag/postgres/" style="font-size: 366%"> postgres </a> </span> <span class="site-tag"> <a href="/tag/presentation/" style="font-size: 84%"> presentation </a> </span> <span class="site-tag"> <a href="/tag/production/" style="font-size: 82%"> production </a> </span> <span class="site-tag"> <a href="/tag/quarkus/" style="font-size: 92%"> quarkus </a> </span> <span class="site-tag"> <a href="/tag/questdb/" style="font-size: 82%"> questdb </a> </span> <span class="site-tag"> <a href="/tag/rds/" style="font-size: 84%"> rds </a> </span> <span class="site-tag"> <a href="/tag/releases/" style="font-size: 380%"> releases </a> </span> <span class="site-tag"> <a href="/tag/schema/" style="font-size: 82%"> schema </a> </span> <span class="site-tag"> <a href="/tag/scylla/" style="font-size: 82%"> scylla </a> </span> <span class="site-tag"> <a href="/tag/secrets/" style="font-size: 82%"> secrets </a> </span> <span class="site-tag"> <a href="/tag/sentry/" style="font-size: 82%"> sentry </a> </span> <span class="site-tag"> <a href="/tag/serialization/" style="font-size: 82%"> serialization </a> </span> <span class="site-tag"> <a href="/tag/signaling/" style="font-size: 86%"> signaling </a> </span> <span class="site-tag"> <a href="/tag/smt/" style="font-size: 84%"> smt </a> </span> <span class="site-tag"> <a href="/tag/snapshots/" style="font-size: 84%"> snapshots </a> </span> <span class="site-tag"> <a href="/tag/spanner/" style="font-size: 120%"> spanner </a> </span> <span class="site-tag"> <a href="/tag/spark/" style="font-size: 82%"> spark </a> </span> <span class="site-tag"> <a href="/tag/sql/" style="font-size: 84%"> sql </a> </span> <span class="site-tag"> <a href="/tag/sqlserver/" style="font-size: 308%"> sqlserver </a> </span> <span class="site-tag"> <a href="/tag/tensorflow/" style="font-size: 82%"> tensorflow </a> </span> <span class="site-tag"> <a href="/tag/testcontainers/" style="font-size: 88%"> testcontainers </a> </span> <span class="site-tag"> <a href="/tag/tests/" style="font-size: 82%"> tests </a> </span> <span class="site-tag"> <a href="/tag/time-series/" style="font-size: 82%"> time series </a> </span> <span class="site-tag"> <a href="/tag/topics/" style="font-size: 82%"> topics </a> </span> <span class="site-tag"> <a href="/tag/tracing/" style="font-size: 82%"> tracing </a> </span> <span class="site-tag"> <a href="/tag/transactions/" style="font-size: 82%"> transactions </a> </span> <span class="site-tag"> <a href="/tag/vagrant/" style="font-size: 82%"> vagrant </a> </span> <span class="site-tag"> <a href="/tag/vitess/" style="font-size: 224%"> vitess </a> </span> <span class="site-tag"> <a href="/tag/website/" style="font-size: 84%"> website </a> </span> </div> </div> </div> </div> </div> <div class="col-md-9"> <div class="post"> <div class="row" style="margin-left: 0; margin-right: 0; margin-bottom: 10px"> <div class="col-sm-12" style="padding-left: 0px"> <div style="display: table-cell; vertical-align: top"> <div style=" width: 72px; border: 1px solid #ccc; padding: 3px; display: inline-block; "> <img src="/assets/images/kgalieva.jpg" style="width: 64px;"> </div> </div> <div style="display: table-cell; vertical-align: top"> <div style="margin-left: 8px"> <span class="hidden-sm hidden-xs" style="font-size: 2.75rem; line-height: 1"> <a href="/blog/2022/04/07/read-only-incremental-snapshots/">Read-only Incremental Snapshots for MySQL</a> </span> <span class="hidden-md hidden-lg" style="font-size: 2rem; line-height: 1"> <a href="/blog/2022/04/07/read-only-incremental-snapshots/">Read-only Incremental Snapshots for MySQL</a> </span> <div class="byline" style="line-height: 1"> <em> April 7, 2022 by </em> <em> Kate Galieva </em> <div class="hidden-xs" style="margin-top: 5px"> <a class="label label-info hidden-sm hidden-xs" href="/tag/mysql/">mysql</a> <a class="label label-info hidden-sm hidden-xs" href="/tag/snapshots/">snapshots</a> </div> </div> </div> </div> </div> </div> <div class="grid__item width-12-12"><div class="paragraph"> <p>The engineering team at Shopify recently improved the Debezium MySQL connector so that it supports incremental snapshotting for databases without write access by the connector, which is required when pointing Debezium to read-only replicas. In addition, the Debezium MySQL connector now also allows schema changes during an incremental snapshot. This blog post explains the implementation details of those features.</p> </div> <div class="paragraph"> <p></p> </div> <div class="sect1"> <h2 id="why_read_only">Why read-only?</h2> <div class="sectionbody"> <div class="paragraph"> <p>Debezium added the <a href="/documentation/reference/stable/connectors/mysql.html#mysql-incremental-snapshots">incremental snapshotting feature</a> in the 1.6 release, after Netflix had announced <a href="https://arxiv.org/pdf/2010.12597v1.pdf">their change data capture framework</a>. At Shopify, <a href="https://shopify.engineering/capturing-every-change-shopify-sharded-monolith">we use Debezium for change data capture (CDC)</a>, and we were looking forward to being the early adopters. Besides, we wished to have a solution that is writes and locks-free.</p> </div> <div class="paragraph"> <p>The no writes solution allows to capture changes from read-replicas and provides the highest guarantee that CDC won&#8217;t cause data corruption on the database side.</p> </div> <div class="paragraph"> <p>We&#8217;ve had to coordinate the snapshotting with migrations in the past since schema migrations blockades have affected other projects' development. The solution was to run snapshots only on weekends and as a result, we tried to snapshot as rarely as possible. We saw the opportunity to improve this part of the process as well.</p> </div> <div class="paragraph"> <p>This blog post dives into technical details of the read-only incremental snapshots implementation including lock-free schema changes handling during the incremental snapshot in MySQL connector.</p> </div> </div> </div> <div class="sect1"> <h2 id="incremental_snapshots">Incremental snapshots</h2> <div class="sectionbody"> <div class="paragraph"> <p>The <a href="/blog/2021/10/07/incremental-snapshots/">Incremental Snapshots in Debezium</a> blog post covers the default implementation in detail. The algorithm utilizes a signaling table for two types of signals:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p><code>snapshot-window-open/snapshot-window-close</code> as watermarks</p> </li> <li> <p><code>execute-snapshot</code> as a way to trigger an incremental snapshot</p> </li> </ol> </div> <div class="paragraph"> <p>For the read-only scenario, we needed to replace both types of signals with alternatives.</p> </div> <div class="sect2"> <h3 id="show_master_status_for_high_and_low_watermarks">SHOW MASTER STATUS for high and low watermarks</h3> <div class="paragraph"> <p>The solution is specific to MySQL and relies on <a href="https://dev.mysql.com/doc/refman/8.0/en/replication-gtids-concepts.html">global transaction identifiers (GTIDs)</a>. Therefore, you need to set <code>gtid_mode</code> to <code>ON</code> and configure the database to preserve GTID ordering if you&#8217;re reading from the read replica.</p> </div> <div class="paragraph"> <p>Prerequisites:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code>gtid_mode = ON
enforce_gtid_consistency = ON
if replica_parallel_workers &gt; 0 set replica_preserve_commit_order = ON</code></pre> </div> </div> <div class="paragraph"> <p>The algorithm runs a <a href="https://dev.mysql.com/doc/refman/8.0/en/show-master-status.html">SHOW MASTER STATUS</a> query to get the executed GTID set before and after the chunk selection:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code>low watermark = executed_gtid_set
high watermark = executed_gtid_set - low watermark</code></pre> </div> </div> <div class="paragraph"> <p>In the read-only implementation, the watermarks have a form of GTID sets, e.g. like this: <code>2174B383-5441-11E8-B90A-C80AA9429562:1-3, 24DA167-0C0C-11E8-8442-00059A3C7B00:1-19</code></p> </div> <div class="paragraph"> <p>Such watermarks do not appear in the binlog stream. Instead, the algorithm compares each event&#8217;s GTID against the in-memory watermarks. The implementation ensures there are no stale reads and that a chunk only has changes that are not older than events up to low watermark.</p> </div> </div> <div class="sect2"> <h3 id="deduplication_algorithm_with_read_only_watermarks">Deduplication algorithm with read-only watermarks</h3> <div class="paragraph"> <p>In pseudo-code, the algorithm for deduplicating events read from the binlog and events retrieved via snapshot chunks looks like this:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code>  (1) pause log event processing
  (2) GtidSet lwGtidSet := executed_gtid_set from SHOW MASTER STATUS
  (3) chunk := select next chunk from table
  (4) GtidSet hwGtidSet := executed_gtid_set from SHOW MASTER STATUS subtracted by lwGtidSet
  (5) resume log event processing
      inwindow := false
      // other steps of event processing loop
      while true do
           e := next event from changelog
           append e to outputbuffer
           if not inwindow then
               if not lwGtidSet.contains(e.gtid) //reached the low watermark
                   inwindow := true
           else
               if hwGtidSet.contains(e.gtid) //haven't reached the high watermark yet
                   if chunk contains e.key then
                       remove e.key from chunk
               else //reached the high watermark
                   for each row in chunk do
                       append row to outputbuffer
           // other steps of event processing loop</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="watermark_checks">Watermark checks</h3> <div class="paragraph"> <p>A database transaction can change several rows. In this case, multiple binlog events will have the same GTID. Due to GTIDs not being unique, it affects the logic of computing a chunk selection window. An event updates a window state when the watermark&#8217;s GTID set doesn&#8217;t contain its GTID. After the events like transaction completion and heartbeat, there won&#8217;t be any further binlog events with the same GTID. For those events, it&#8217;s enough to reach the watermark&#8217;s upper bound to trigger a window open/close.</p> </div> <div class="exampleblock centered-image responsive-image"> <div class="content"> <img src="/assets/images/2022-04-07-read-only-incremental-snapshots/window.png" style="max-width:90%;" class="responsive-image"> <div class="paragraph"> <p><strong>Figure 1. A chunk selection window</strong></p> </div> </div> </div> <div class="paragraph"> <p>The deduplication happens within the chunk selection window as in the default implementation. Finally, the algorithm inserts a deduplicated chunk right after the high watermark:</p> </div> <div class="exampleblock centered-image responsive-image"> <div class="content"> <img src="/assets/images/2022-04-07-read-only-incremental-snapshots/deduplication.png" style="max-width:90%;" class="responsive-image"> <div class="paragraph"> <p><strong>Figure 2. A chunk deduplication</strong></p> </div> </div> </div> </div> <div class="sect2"> <h3 id="no_updates_for_included_tables">No updates for included tables</h3> <div class="paragraph"> <p>It&#8217;s crucial to receive binlog events for the snapshot to make progress. So the algorithm checks GTIDs of <em>all</em> the events together with not included tables.</p> </div> </div> <div class="sect2"> <h3 id="no_binlog_events">No binlog events</h3> <div class="paragraph"> <p>The MySQL server sends a heartbeat event after the replication connection was idle for x-seconds. The read-only implementation utilizes heartbeats when the rate of binlog updates is low.</p> </div> <div class="paragraph"> <p>The heartbeat has the same GTID as the latest binlog event. Thus, for a heartbeat, it&#8217;s enough to reach the upper bound of the high watermark.</p> </div> <div class="paragraph"> <p>The algorithm uses the <code>server_uuid</code> part of a heartbeat&#8217;s GTID to get the max transaction id from the high watermark. The implementation makes sure the high watermark contains a single <code>server_uuid</code>. An unchanged <code>server_uuid</code> allows to avoid the scenario when the window is closed too early by a heartbeat. See the image below as an example:</p> </div> <div class="exampleblock centered-image responsive-image"> <div class="content"> <img src="/assets/images/2022-04-07-read-only-incremental-snapshots/heartbeat.png" style="max-width:90%;" class="responsive-image"> <div class="paragraph"> <p><strong>Figure 3. A scenario when the window would have been closed too early by a heartbeat</strong></p> </div> </div> </div> <div class="paragraph"> <p>A heartbeat comparison against the low watermark isn&#8217;t needed since it doesn&#8217;t matter if the window was open or not. This simplifies the checks when there are no new events between the high and low watermarks.</p> </div> </div> <div class="sect2"> <h3 id="no_changes_between_watermarks">No changes between watermarks</h3> <div class="paragraph"> <p>A binlog event can open and close a window right away when there were no binlog events during the chunk selection. In this case, a high watermark will be an empty set. In this case, the snapshot chunk gets inserted right after the low watermark without deduplication.</p> </div> <div class="exampleblock centered-image responsive-image"> <div class="content"> <img src="/assets/images/2022-04-07-read-only-incremental-snapshots/empty_window.png" style="max-width:90%;" class="responsive-image"> <div class="paragraph"> <p><strong>Figure 4. An empty chunk selection window</strong></p> </div> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="kafka_topic_based_signals">Kafka topic based signals</h2> <div class="sectionbody"> <div class="paragraph"> <p>Debezium supports ad-hoc incremental snapshots triggered via inserts to the signaling table. A read-only alternative is to send signals through a specific Kafka topic. The format of the message mimics the signaling table structure. An execute-snapshot Kafka message includes the parameters</p> </div> <div class="ulist"> <ul> <li> <p><code>data-collections</code> - list of tables to be captured</p> </li> <li> <p><code>type</code> - set to INCREMENTAL</p> </li> </ul> </div> <div class="paragraph"> <p>Example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="bash">Key: dbserver1
Value: {&quot;type&quot;:&quot;execute-snapshot&quot;,&quot;data&quot;: {&quot;data-collections&quot;: [&quot;inventory.orders&quot;], &quot;type&quot;: &quot;INCREMENTAL&quot;}}</code></pre> </div> </div> <div class="paragraph"> <p>The MySQL connector&#8217;s config has a new <a href="https://debezium.io/documentation/reference/stable/connectors/mysql.html#mysql-property-signal-kafka-topic"><code>signal.kafka.topic</code></a> property. The topic has to have one partition and the delete retention policy.</p> </div> <div class="paragraph"> <p>A separate thread retrieves the signal messages from the Kafka topic. The key of the Kafka message needs to match the connector&#8217;s name as set in <code>database.server.name</code>. The connector will skip events that don&#8217;t correspond to the connector&#8217;s name with a log entry. The message key check allows reusing a signal topic for multiple connectors.</p> </div> <div class="paragraph"> <p>The connector&#8217;s offsets include incremental snapshot context when an incremental snapshot is running. The read-only implementation adds the Kafka signal offset to the incremental snapshot context. Keeping track of the offset allows it not to miss or double process the signal when the connector restarts.</p> </div> <div class="paragraph"> <p>However, it&#8217;s not required to use Kafka to execute a read-only incremental snapshot and the default <code>execute-snapshot</code> signal written into a signaling table will also work. Going forward, a REST API for triggering ad-hoc incremental snapshots may be envisioned as well, either exposed through Debezium Server, or as an additional REST resource deployed to Kafka Connect.</p> </div> </div> </div> <div class="sect1"> <h2 id="schema_changes_during_incremental_snapshots">Schema changes during incremental snapshots</h2> <div class="sectionbody"> <div class="paragraph"> <p>The Debezium MySQL connector <a href="/documentation/reference/stable/connectors/mysql.html#mysql-property-incremental-snapshot-allow-schema-changes">allows schema changes during an incremental snapshot</a>. The connector will detect schema change during an incremental snapshot and re-select a current chunk to avoid locking DDLs.</p> </div> <div class="paragraph"> <p><em>Note that changes to a primary key are not supported and can cause incorrect results if performed during an incremental snapshot.</em></p> </div> <div class="paragraph"> <p>Historized Debezium connectors like the MySQL one parse Data Definition Language (DDL) events such as <code>ALTER TABLE</code> from the binlog stream. Connectors keep an in-memory representation of each table&#8217;s schema and use those schemas to produce the appropriate change events.</p> </div> <div class="paragraph"> <p>The incremental snapshot implementation uses binlog schema twice:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>at the moment of the chunk selection from the database</p> </li> <li> <p>at the moment of the chunk insertion to the binlog stream</p> </li> </ol> </div> <div class="paragraph"> <p>The chunk&#8217;s schema has to match the binlog schema at both times. Let&#8217;s explore how the algorithm achieves matching schemas in detail.</p> </div> <div class="sect2"> <h3 id="matching_chunk_and_binlog_schema_on_selection">Matching chunk and binlog schema on selection</h3> <div class="paragraph"> <p>When the incremental snapshot queries a database, the rows have the table&#8217;s latest schema. If the binlog stream is behind, the in-memory schema may be different from the latest schema. The solution is to wait for the connector to receive the DDL event in the binlog stream. After that, the connector can use the cached table&#8217;s structure to produce the correct incremental snapshot events.</p> </div> <div class="paragraph"> <p>A snapshot chunk is selected using the JDBC API. <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/ResultSetMetaData.html">ResultSetMetaData</a> stores the chunk&#8217;s schema. The challenge is that the schema from ResultSetMetaData and the schema from binlog DDL have different formats, making it hard to determine if they are identical.</p> </div> <div class="paragraph"> <p>The algorithm uses two steps to obtain the matching ResultSet-based and DDL-based schemas. First, the connector queries a table&#8217;s schema between low and high watermarks. As soon as the connector detects the window closure, the binlog schema is up to date with the ResultSetMetaData. After that, the connector queries the database to verify that the schema remains the same. If the schema has changed, then the connector repeats the process.</p> </div> <div class="paragraph"> <p>The algorithm keeps the matching ResultSet and binlog schemas in memory to allow the connector to compare each chunk&#8217;s schema against the cached ResultSet schema.</p> </div> <div class="paragraph"> <p>When a chunk&#8217;s schema doesn&#8217;t match the cached ResultSet schema, the connector drops the selected chunk. Then the algorithm repeats the verification process of matching ResultSet and binlog schemas. After that, the connector re-selects the same chunk from the database:</p> </div> <div class="exampleblock centered-image responsive-image"> <div class="content"> <img src="/assets/images/2022-04-07-read-only-incremental-snapshots/schema_change.png" style="max-width:90%;" class="responsive-image"> <div class="paragraph"> <p><strong>Figure 5. Binlog schema doesn&#8217;t match chunk schema on chunk selection</strong></p> </div> </div> </div> </div> <div class="sect2"> <h3 id="matching_chunk_and_binlog_schema_on_insertion">Matching chunk and binlog schema on insertion</h3> <div class="paragraph"> <p>A DDL event also triggers a chunk re-read for the affected table. A re-read prevents a scenario when a chunk has an older schema than the binlog stream has by the window closure. For example, the picture below illustrates the chunk selection that happened before the schema change:</p> </div> <div class="exampleblock centered-image responsive-image"> <div class="content"> <img src="/assets/images/2022-04-07-read-only-incremental-snapshots/ddl.png" style="max-width:90%;" class="responsive-image"> <div class="paragraph"> <p><strong>Figure 6. Binlog schema doesn&#8217;t match chunk schema on chunk insertion</strong></p> </div> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="demo">Demo</h2> <div class="sectionbody"> <div class="paragraph"> <p>We will use the standard <a href="https://github.com/debezium/debezium-examples/tree/main/tutorial">tutorial deployment</a> to demonstrate read-only ad-hoc incremental snapshotting. We are using <a href="https://github.com/debezium/debezium-examples/tree/main/tutorial#using-mysql">MySQL</a> as the source database. For this demo, you will need to open multiple terminal windows.</p> </div> <div class="paragraph"> <p>In the beginning we will start the deployment, create the signaling Kafka topic, and start the connector:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="bash"># Terminal 1 - start the deployment
# Start the deployment
export DEBEZIUM_VERSION=1.9
docker-compose -f docker-compose-mysql.yaml up

# Terminal 2

# Enable enforce_gtid_consistency and gtid_mode
docker-compose -f docker-compose-mysql.yaml exec mysql bash -c 'mysql -p$MYSQL_ROOT_PASSWORD inventory -e &quot;SET GLOBAL enforce_gtid_consistency=ON; SET GLOBAL gtid_mode=OFF_PERMISSIVE; SET GLOBAL gtid_mode=ON_PERMISSIVE; SET GLOBAL gtid_mode=ON;&quot;'

# Confirm the changes
docker-compose -f docker-compose-mysql.yaml exec mysql bash -c 'mysql -p$MYSQL_ROOT_PASSWORD inventory -e &quot;show global variables like \&quot;%GTID%\&quot;;&quot;'

# Create a signaling topic
docker-compose -f docker-compose-mysql.yaml exec kafka /kafka/bin/kafka-topics.sh \
    --create \
    --bootstrap-server kafka:9092 \
    --partitions 1 \
    --replication-factor 1 \
    --topic dbz-signals

# Start MySQL connector, capture only customers table and enable signaling
curl -i -X POST -H &quot;Accept:application/json&quot; -H  &quot;Content-Type:application/json&quot; http://localhost:8083/connectors/ -d @- &lt;&lt;EOF
{
    &quot;name&quot;: &quot;inventory-connector&quot;,
    &quot;config&quot;: {
        &quot;connector.class&quot;: &quot;io.debezium.connector.mysql.MySqlConnector&quot;,
        &quot;tasks.max&quot;: &quot;1&quot;,
        &quot;database.hostname&quot;: &quot;mysql&quot;,
        &quot;database.port&quot;: &quot;3306&quot;,
        &quot;database.user&quot;: &quot;debezium&quot;,
        &quot;database.password&quot;: &quot;dbz&quot;,
        &quot;database.server.id&quot;: &quot;184054&quot;,
        &quot;database.server.name&quot;: &quot;dbserver1&quot;,
        &quot;database.include.list&quot;: &quot;inventory&quot;,
        &quot;database.history.kafka.bootstrap.servers&quot;: &quot;kafka:9092&quot;,
        &quot;database.history.kafka.topic&quot;: &quot;schema-changes.inventory&quot;,
        &quot;table.include.list&quot;: &quot;inventory.customers&quot;,
        &quot;read.only&quot;: &quot;true&quot;,
        &quot;incremental.snapshot.allow.schema.changes&quot;: &quot;true&quot;,
        &quot;incremental.snapshot.chunk.size&quot;: &quot;5000&quot;,
        &quot;signal.kafka.topic&quot;: &quot;dbz-signals&quot;,
        &quot;signal.kafka.bootstrap.servers&quot;: &quot;kafka:9092&quot;
    }
}
EOF</code></pre> </div> </div> <div class="paragraph"> <p>From the log we see that as per the <code>table.include.list</code> setting only one table is snapshotted, <code>customers</code>:</p> </div> <div class="listingblock"> <div class="content"> <pre>tutorial-connect-1    | 2022-02-21 04:30:03,936 INFO   MySQL|dbserver1|snapshot  Snapshotting contents of 1 tables while still in transaction   [io.debezium.relational.RelationalSnapshotChangeEventSource]</pre> </div> </div> <div class="paragraph"> <p>In the next step we will simulate continuous activity in the database:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="bash"># Terminal 3
# Continuously consume messages from Debezium topic for customers table
docker-compose -f docker-compose-mysql.yaml exec kafka /kafka/bin/kafka-console-consumer.sh \
    --bootstrap-server kafka:9092 \
    --from-beginning \
    --property print.key=true \
    --topic dbserver1.inventory.customers

# Terminal 4
# Modify records in the database via MySQL client
docker-compose -f docker-compose-mysql.yaml exec mysql bash -c 'i=0; while true; do mysql -u $MYSQL_USER -p$MYSQL_PASSWORD inventory -e &quot;INSERT INTO customers VALUES(default, \&quot;name$i\&quot;, \&quot;surname$i\&quot;, \&quot;email$i\&quot;);&quot;; ((i++)); done'</code></pre> </div> </div> <div class="paragraph"> <p>The topic <code>dbserver1.inventory.customers</code> receives a continuous stream of messages. Now the connector will be reconfigured to also capture the <code>orders</code> table:</p> </div> <div class="listingblock"> <div class="content"> <pre># Terminal 5
# Add orders table among the captured
curl -i -X PUT -H "Accept:application/json" -H  "Content-Type:application/json" http://localhost:8083/connectors/inventory-connector/config -d @- &lt;&lt;EOF
{
    "connector.class": "io.debezium.connector.mysql.MySqlConnector",
    "tasks.max": "1",
    "database.hostname": "mysql",
    "database.port": "3306",
    "database.user": "debezium",
    "database.password": "dbz",
    "database.server.id": "184054",
    "database.server.name": "dbserver1",
    "database.include.list": "inventory",
    "database.history.kafka.bootstrap.servers": "kafka:9092",
    "database.history.kafka.topic": "schema-changes.inventory",
    "table.include.list": "inventory.customers,inventory.orders",
    "read.only": "true",
    "incremental.snapshot.allow.schema.changes": "true",
    "incremental.snapshot.chunk.size": "5000",
    "signal.kafka.topic": "dbz-signals",
    "signal.kafka.bootstrap.servers": "kafka:9092"
}
EOF</pre> </div> </div> <div class="paragraph"> <p>As expected, there are no messages for the <code>orders</code> table:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="bash"># Terminal 5
docker-compose -f docker-compose-mysql.yaml exec kafka /kafka/bin/kafka-console-consumer.sh \
--bootstrap-server kafka:9092 \
--from-beginning \
--property print.key=true \
--topic dbserver1.inventory.orders</code></pre> </div> </div> <div class="paragraph"> <p>Now let&#8217;s start an incremental ad-hoc snapshot by sending a signal. The snapshot messages for the <code>orders</code> table are delivered to the <code>dbserver1.inventory.orders</code> topic. Messages for the <code>customers</code> table are delivered without interruption.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="bash"># Terminal 5
# Send the signal
docker-compose -f docker-compose-mysql.yaml exec kafka /kafka/bin/kafka-console-producer.sh \
--broker-list kafka:9092 \
--property &quot;parse.key=true&quot; \
--property &quot;key.serializer=org.apache.kafka.common.serialization.StringSerializer&quot; \
--property &quot;value.serializer=custom.class.serialization.JsonSerializer&quot; \
--property &quot;key.separator=;&quot; \
--topic dbz-signals
dbserver1;{&quot;type&quot;:&quot;execute-snapshot&quot;,&quot;data&quot;: {&quot;data-collections&quot;: [&quot;inventory.orders&quot;], &quot;type&quot;: &quot;INCREMENTAL&quot;}}

# Check messages for orders table
docker-compose -f docker-compose-mysql.yaml exec kafka /kafka/bin/kafka-console-consumer.sh \
    --bootstrap-server kafka:9092 \
    --from-beginning \
    --property print.key=true \
    --topic dbserver1.inventory.orders</code></pre> </div> </div> <div class="paragraph"> <p>If you were to modify any record in the <code>orders</code> table while the snapshot is running, this would be either emitted as a <code>read</code> event or as an <code>update</code> event, depending on the exact timing and sequence of things.</p> </div> <div class="paragraph"> <p>As the last step, let&#8217;s terminate the deployed systems and close all terminals:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="bash"># Shut down the cluster
docker-compose -f docker-compose-mysql.yaml down</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="conclusion">Conclusion</h2> <div class="sectionbody"> <div class="paragraph"> <p>Debezium is an excellent change data capture tool under active development, and it&#8217;s a pleasure to be a part of its community. We&#8217;re excited to use incremental snapshots in production here at Shopify. If you have similar database usage restrictions, check out the read-only incremental snapshots feature. Many thanks to my team and the Debezium team without whom this project wouldn&#8217;t happen.</p> </div> </div> </div></div> </div> <div class="well"> <div class="row"> <div class="col-md-8"> <h2>Kate Galieva</h2> <p> <span class="bio-size">Kate is a Senior Production Engineer working on Shopify’s Streaming Platform. She lives in Toronto, Canada.</span> </p> <p class="bio-size"> <a href="https://github.com/kgalieva"> <i class="icon-github"></i> </a> &nbsp; </p> </div> <div class="col-md-4"> <img alt="" class="img-responsive pull-right portrait" src="/assets/images/kgalieva.jpg"/> </div> </div> </div> <ul class="pager pager-blog"> <li class="previous"> <a href="/blog/2022/04/06/debezium-1.9-final-released/" class="previous"> &laquo; Previous</a> </li> <li class="next"><a href="/blog/2022/04/21/debezium-1.9.1-final-released/">Next &raquo; </a></li> </ul> <div class="row"> <div class="col-md-12"> <hr> <h2>About Debezium</h2> <p> Debezium is an open source distributed platform that turns your existing databases into event streams, so applications can see and respond almost instantly to each committed row-level change in the databases. Debezium is built on top of <a href="http://kafka.apache.org/">Kafka</a> and provides <a href="http://kafka.apache.org/documentation.html#connect">Kafka Connect</a> compatible connectors that monitor specific database management systems. Debezium records the history of data changes in Kafka logs, so your application can be stopped and restarted at any time and can easily consume all of the events it missed while it was not running, ensuring that all events are processed correctly and completely. Debezium is <a href="/license/">open source</a> under the <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache License, Version 2.0</a>. </p> </div> </div> <div class="row"> <div class="col-md-12"> <h2>Get involved</h2> <p> We hope you find Debezium interesting and useful, and want to give it a try. Follow us on Twitter <a href="https://twitter.com/debezium">@debezium</a>, <a href="https://debezium.zulipchat.com/#narrow/stream/302529-users">chat with us on Zulip</a>, or join our <a href="https://groups.google.com/forum/#!forum/debezium">mailing list</a> to talk with the community. All of the code is open source <a href="https://github.com/debezium/">on GitHub</a>, so build the code locally and help us improve ours existing connectors and add even more connectors. If you find problems or have ideas how we can improve Debezium, please let us know or <a href="https://issues.redhat.com/projects/DBZ/issues/">log an issue</a>. </p> </div> </div> <div id="disqus_thread"></div> <script>var disqus_config=function(){this.page.url="https://debezium.io/blog/2022/04/07/read-only-incremental-snapshots/",this.page.identifier="https://debezium.io/blog/2022/04/07/read-only-incremental-snapshots/"};!function(){var e=document,t=e.createElement("script");t.src="https://Debezium.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}();</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> </div> </div> </div> <footer class="container"> <div> <div class="row mr-0 ml-0"> <div class="col-md-5 col-md-offset-1"> <h4>Debezium</h4> <p> &#169; 2023 Debezium Community <br/> <br/> <i class="icon-fire"></i> Mixed with <a href="https://getbootstrap.com/">Bootstrap</a>, baked by <a href="https://jekyllrb.com/">Jekyll</a>. <br/> <i class="icon-flag"></i> Website and docs licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>. <br/> <i class="icon-flag-alt"></i> Code released under <a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache License, v2.0</a>. <br/> <i class="icon-file-alt"></i> <a href="https://www.redhat.com/legal/legal_statement.html" title="Terms">Terms</a> | <a href="https://www.redhat.com/legal/privacy_statement.html" title="Privacy Policy">Privacy</a> </p> <p>Rev: <a target="_blank" href="https://github.com/debezium/debezium.github.io/commit/1925f0455724015d6c21372f7dff90a0c10ce48a">1925f04</a> </p> </div> <div class="col-md-3"> <h4>Documentation</h4> <ul class="list-unstyled"> <li><a href="/documentation/reference/stable/features.html" title="Features">Features</a></li> <li> <a href="/documentation/reference/stable/install.html" title="Install">Install</a> </li> <li> <a href="/documentation/reference/stable/architecture.html" title="Architecture">Architecture</a> </li> <li><a href="/documentation/faq/" title="FAQ">FAQ</a></li> <li> <a href="/community/contribute/" title="Contribute">Contribute</a> </li> </ul> </div> <div class="col-md-3"> <h4>Connect</h4> <ul class="list-unstyled"> <li><a href="/blog" title="Blog">Blog</a></li> <li> <a href="https://twitter.com/debezium" title="Twitter">Twitter</a> </li> <li><a href="https://github.com/debezium" title="GitHub">GitHub</a></li> <li><a href="https://debezium.zulipchat.com/#narrow/stream/302529-users" title="Chat">Chat</a></li> <li> <a href="https://groups.google.com/forum/#!forum/debezium" title="Google Groups">Google Groups</a> </li> <li> <a href="https://stackoverflow.com/questions/tagged/debezium" title="StackOverflow">StackOverflow</a> </li> </ul> </div> </div> </div> </footer> <div class="container" id="companyfooter"> <div class="redhatlogo"> <a href="https://www.redhat.com/"> <img src="/assets/images/Logo-Red_Hat-Sponsored_By-B-Standard-RGB.svg"/> </a> </div> </div> </div> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-76464546-1"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-76464546-1");</script> <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script> <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script> <script type="text/javascript" src="/assets/javascript/vanilla-back-to-top.min.js"></script> <script type="text/javascript" src="/assets/javascript/highlight.min.js"></script> <script>addBackToTop({scrollDuration:400}),hljs.initHighlightingOnLoad();</script> </body> </html>